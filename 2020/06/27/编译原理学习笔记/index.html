<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/avatar.png">
  <link rel="icon" type="image/png" href="/img/logo.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="Mr.BelieVe">
  <meta name="keywords" content="">
  <title>编译原理学习笔记 - Mr.BelieVe&#39;s Treasure</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/5.12.1/css/all.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/mdbootstrap/4.13.0/css/mdb.min.css" />
<link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/3.0.1/github-markdown.min.css" />

<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">



  <link  rel="stylesheet" href="/lib/prettify/tomorrow-night-eighties.min.css" />

<link  rel="stylesheet" href="/css/main.css" />


  <link defer rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />


<!-- 自定义样式保持在最底部 -->


<meta name="generator" content="Hexo 4.2.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>Mr.BelieVe's Treasure</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">Home</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">Archives</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">Categories</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">Tags</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">About</a>
          </li>
        
          
          
          
          
          <li class="nav-item">
            <a class="nav-link" href="/links/">Links</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="view intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              
                <p class="mt-3 post-meta">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                  星期六, 六月 27日 2020, 5:08 下午
                </p>
              

              <p class="mt-1">
                
                  
                  <span class="post-meta">
                    <i class="far fa-chart-bar"></i>
                    5k 字
                  </span>
                

                
                  
                  <span class="post-meta">
                      <i class="far fa-clock"></i>
                      22 分钟
                  </span>
                

                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5 z-depth-3" id="board">
          <div class="post-content mx-auto" id="post">
            
            <div class="markdown-body">
              <h1 id="编译原理学习笔记"><a href="#编译原理学习笔记" class="headerlink" title="编译原理学习笔记"></a>编译原理学习笔记</h1><p><a href="https://www.bilibili.com/video/BV1cE411f78c?p=1" target="_blank" rel="noopener">视频</a></p>
<h2 id="编译器结构"><a href="#编译器结构" class="headerlink" title="编译器结构"></a>编译器结构</h2><h3 id="词法分析-Lexical-analysis-or-scanning"><a href="#词法分析-Lexical-analysis-or-scanning" class="headerlink" title="词法分析 Lexical analysis or scanning"></a>词法分析 Lexical analysis or scanning</h3><p><strong>检测输入字符串中不属于我们语言的那部分符号</strong></p>
<p>词法分析把程序字段变成关键字words or 词法单元tokens</p>
<p>如</p>
<pre><code>if x == y then z = 1; else z = 2;</code></pre><p>分号，标点，分隔符都是词法单元</p>
<h3 id="语法分析syntax-analysis-parsing"><a href="#语法分析syntax-analysis-parsing" class="headerlink" title="语法分析syntax analysis parsing"></a>语法分析syntax analysis parsing</h3><p>试着去判断是否格式正确或者是否是有效程序（语句中是否存在格式错误或没用解析树）</p>
<p>if then else包含三部分</p>
<p>predicate条件判断，then语句和else语句</p>
{% asset_img image-20200626235143347.png image-20200626235143347 %}

<h3 id="语义分析-semantic-analysis"><a href="#语义分析-semantic-analysis" class="headerlink" title="语义分析 semantic analysis"></a>语义分析 semantic analysis</h3><p>尝试去找出矛盾的地方 </p>
<h3 id="优化-optimization"><a href="#优化-optimization" class="headerlink" title="优化 optimization"></a>优化 optimization</h3><p>修改代码使之使用更少的资源</p>
<h3 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h3><p>高级语言转变成汇编</p>
<h2 id="Cool语言"><a href="#Cool语言" class="headerlink" title="Cool语言"></a>Cool语言</h2><pre><code class="cool">class Main {
    i : IO &lt;- new IO;
    main() : Int { { i.out_string(&quot;Hello wordld!\n&quot;); 1;} };
};</code></pre>
<p>Int 是return type。</p>
<pre><code>class Main {
    i : IO &lt;- new IO;
    main() : IO { { i.out_string(&quot;Hello wordld!\n&quot;); } };
};//一旦打印完string就退出</code></pre><pre><code>class Main {
    i : IO &lt;- new IO;
    main() : Object { { i.out_string(&quot;Hello wordld!\n&quot;); } };
};//Object 返回类型

class Main {
    main() : Object { { (new IO).out_string(&quot;Hello wordld!\n&quot;); } };
};</code></pre><p>下面是继承的写法</p>
<pre><code>class Main inherits IO{
    main() : Object { { self.out_string(&quot;Hello wordld!\n&quot;); } };
};

class Main inherits IO{
    main() : Object { { out_string(&quot;Hello wordld!\n&quot;); } };
};</code></pre><h2 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h2><p>目标是将输入流划分为词素。</p>
<p>从左到右的扫描字符串，有时必须对输入字符串向前看，才能弄清楚当前字符串和子字符串在语言中的角色</p>
<p>变量名称：字母开头</p>
<p> 字符串-&gt; 语法分析器 -&gt;<code>变成token&lt;class, string&gt;</code> parser解析器</p>
<p>foo = 42 -&gt;                  &lt;Id, “foo”&gt; &lt;operator, “=”&gt; &lt;Int, “42”&gt;</p>
<p>有以下几类：</p>
<ul>
<li>空格whitespace</li>
<li>keyword</li>
<li>identifiers</li>
<li>numbers</li>
</ul>
<p>这些子字符串称为词素（构成词的要素），&lt;token class， lexemes词素&gt;，这就是一个token</p>
<h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><h4 id="基础表达式"><a href="#基础表达式" class="headerlink" title="基础表达式"></a>基础表达式</h4><h5 id="单字符"><a href="#单字符" class="headerlink" title="单字符"></a>单字符</h5><p>‘c’ = {‘c’}</p>
<h5 id="Epsilon"><a href="#Epsilon" class="headerlink" title="Epsilon"></a>Epsilon</h5><p>Epsilon = {“”} = 单个字符的空字符串 != 空字符串</p>
<h4 id="复合表达式"><a href="#复合表达式" class="headerlink" title="复合表达式"></a>复合表达式</h4><h5 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h5><p>A + B = {a|a属于A} U {b|b属于B}</p>
<p>A并B</p>
<h5 id="Concatencation-级联"><a href="#Concatencation-级联" class="headerlink" title="Concatencation 级联"></a>Concatencation 级联</h5><p>如[a,b]与[c,d]级联得到[ac,ad,bc,bd]</p>
<p>AB = {ab | a属于A ^ b 属于B }</p>
<h5 id="Iterator-串联"><a href="#Iterator-串联" class="headerlink" title="Iterator 串联"></a>Iterator 串联</h5><p>A* = 0到无穷个A串联 </p>
<h3 id="匹配变量名"><a href="#匹配变量名" class="headerlink" title="匹配变量名"></a>匹配变量名</h3><p>A+ = AA* = 至少一个A</p>
<p>digit = ‘0’ + ‘1’ + ‘2’ + ‘3’ + ‘4’ + ‘5’ + ‘6’ + ‘7’ + ‘8’ + ‘9’</p>
<p>letter = [a-zA-Z] 匹配所有字母</p>
<p>letter(letter+digit)* 字母+0或多个字母和数字的组合</p>
<p>空格 ‘ ‘ + ‘\n’ + ‘\t’</p>
<p>opt_function = (‘.’digits)?</p>
<p>Opt_exponent = (‘E’(‘+’ + ‘-‘)?digits)?</p>
<p>###词法规范</p>
<p>当输入值有两种不同的前缀，且这两种都是有效的词法单元时，就应该选择最长的那个，最长匹配原则Maximal Munch</p>
<p>当匹配到两个规则的时候，如keiword，identifiers，会优先匹配第一个choose the one listed first。</p>
<p>捕获有可能错误字符串的正则表达式并赋予其最低优先级</p>
<h3 id="有限自动机Finite-Automata"><a href="#有限自动机Finite-Automata" class="headerlink" title="有限自动机Finite Automata"></a>有限自动机Finite Automata</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><ul>
<li>一组能读取的输入字符串</li>
<li>一个有限状态的集合</li>
<li>一个特殊的集合被设定为开始状态</li>
<li>一组用于接受状态的集合（读取完可接受状态输入后自动结束，否则拒绝输入</li>
<li>有一些用于状态转换的集合</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628214134850.png" srcset="/img/loading.gif" class="" title="image-20200628214134850">

<h4 id="Exampls"><a href="#Exampls" class="headerlink" title="Exampls"></a>Exampls</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628160825195.png" srcset="/img/loading.gif" class="" title="image-20200628160825195">

<h4 id="确定性自动机和非确定性自动机的区别"><a href="#确定性自动机和非确定性自动机的区别" class="headerlink" title="确定性自动机和非确定性自动机的区别"></a>确定性自动机和非确定性自动机的区别</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628161433100.png" srcset="/img/loading.gif" class="" title="image-20200628161433100">

<p>DFA只有一条道可以通过</p>
<p>NFA基于输入执行，可能处于许多不同的状态，只要有任何一条路径可以接受，就会处于接受状态 ，这个字符串就属于这个NFA可以接受的语言</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628161945645.png" srcset="/img/loading.gif" class="" title="image-20200628161945645">

<p>NFA要远比DFA来的小，可以成倍缩小，DFA执行速度更快</p>
<h3 id="将正则表达式转换为NFA-非确定性有限自动机"><a href="#将正则表达式转换为NFA-非确定性有限自动机" class="headerlink" title="将正则表达式转换为NFA 非确定性有限自动机"></a>将正则表达式转换为NFA 非确定性有限自动机</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628213856496.png" srcset="/img/loading.gif" class="" title="image-20200628213856496">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628213913515.png" srcset="/img/loading.gif" class="" title="image-20200628213913515">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628213950201.png" srcset="/img/loading.gif" class="" title="image-20200628213950201">

<h3 id="NFA-to-DFA"><a href="#NFA-to-DFA" class="headerlink" title="NFA to DFA"></a>NFA to DFA</h3><p>Epsilon-closure：是状态选择，可以是一组状态，但只针对单个状态进行处理，只关注那些仅通过空跳就可以到达的状态。</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628215245905.png" srcset="/img/loading.gif" class="" title="image-20200628215245905">



<p>N种状态，可用状态数量子集|S| &lt;= N，公用2^N -1种非空子集</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628220546136.png" srcset="/img/loading.gif" class="" title="image-20200628220546136">

<p> 所维护的每一个属性都指代一条计算执行路径，DFA的状态记录了NFA基于相同输入可能进入的可能状态集</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628221202160.png" srcset="/img/loading.gif" class="" title="image-20200628221202160">

<p>原视频讲解链接：<a href="https://www.bilibili.com/video/BV1cE411f78c?p=16" target="_blank" rel="noopener">link</a> 11:15秒</p>
<h3 id="实现有限自动机"><a href="#实现有限自动机" class="headerlink" title="实现有限自动机"></a>实现有限自动机</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628221706335.png" srcset="/img/loading.gif" class="" title="image-20200628221706335">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628222154758.png" srcset="/img/loading.gif" class="" title="image-20200628222154758">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200629082652419.png" srcset="/img/loading.gif" class="" title="image-20200629082652419"> 

<h4 id="实现NFA"><a href="#实现NFA" class="headerlink" title="实现NFA"></a>实现NFA</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200629083217424.png" srcset="/img/loading.gif" class="" title="image-20200629083217424">

<p>节省了大量表空间，但是</p>
<p>执行速度比确定性自动机慢很多 </p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>DFA执行速度更快，结构上较为松散</p>
<p>NFA速度较慢，结构紧凑</p>
<h3 id="PA2"><a href="#PA2" class="headerlink" title="PA2"></a>PA2</h3><p><a href="https://github.com/mrbelieve128/Stanford-Compilers-PA/tree/master/PA2" target="_blank" rel="noopener">https://github.com/mrbelieve128/Stanford-Compilers-PA/tree/master/PA2</a></p>
<h2 id="解析器-Parsing"><a href="#解析器-Parsing" class="headerlink" title="解析器 Parsing"></a>解析器 Parsing</h2><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200707171225807.png" srcset="/img/loading.gif" class="" title="image-20200707171225807">

<h3 id="上下文无关文法-context-free-grammar"><a href="#上下文无关文法-context-free-grammar" class="headerlink" title="上下文无关文法 context-free grammar"></a>上下文无关文法 context-free grammar</h3><ul>
<li>不是所有token都是程序</li>
<li>解析器parse需要分辨有效和无效的字符串</li>
</ul>
<p>所以需要</p>
<ul>
<li>需要中算法来分辨有效token</li>
<li>算法来分辨有效token和无效token</li>
</ul>
<p>上下文无关的文法自然而然地用于描述这种递归结构</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708102409480.png" srcset="/img/loading.gif" class="" title="image-20200708102409480">

<p>上下文无关的文法包含</p>
<ul>
<li>A set of terminals <strong>T</strong></li>
<li>A set of non-terminal <strong>N</strong></li>
<li>A start symbol <strong>S</strong> <strong>(S 是 N之一)</strong></li>
<li>A set of productions (是指一个符号跟着一个箭头，紧接着一串符号)</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708103010382.png" srcset="/img/loading.gif" class="" title="image-20200708103010382">

<p><a href="https://www.bilibili.com/video/BV1cE411f78c?p=19" target="_blank" rel="noopener">定义7:43左右</a></p>
<h3 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h3><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>Grammer</p>
<p>E -&gt; E+E | E*E | (E) | id</p>
<p>String</p>
<p>id * id + id</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708111200187.png" srcset="/img/loading.gif" class="" title="image-20200708111200187">

<p>A parse tree has</p>
<ul>
<li>Terminals at the leaves</li>
<li>Non-terminals at the interior nodes (内部节点)</li>
</ul>
<p>叶子结点的中序遍历结果是原始输入</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708111904374.png" srcset="/img/loading.gif" class="" title="image-20200708111904374">

<p>解析树也展示了操作间的关联性，但输入字符串并没有展示</p>
<p>如上图，<strong>“*”</strong>要比<strong>“+”</strong>号更优先，因为*号是+号的子树</p>
<p>上图这个例子是最左推导(在每个步骤先替换最左边的非终结字符）也有个等价概念最右推导</p>
<p>最左和最右推导生成的解析树都是一样的 </p>
<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708113045442.png" srcset="/img/loading.gif" class="" title="image-20200708113045442">

<h3 id="Ambiguity-歧义性"><a href="#Ambiguity-歧义性" class="headerlink" title="Ambiguity 歧义性"></a>Ambiguity 歧义性</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708144341299.png" srcset="/img/loading.gif" class="">

<ul>
<li>如果对于某个字符串有多个解析树，那么这个语法就是模棱两可的。或者说，对于某个字符串有多个最右推导或者最左推导，那么这个字符串就会有两个截然不同的解析树，语法也会变得有歧义</li>
<li>Ambiguity is <strong>BAD</strong></li>
</ul>
<p>消除歧义性得最直接办法是重写语法，生成相同语法但生成单一解析树 </p>
<p>E -&gt; E’ + E | E’</p>
<p>E’ -&gt; id * E’ | id | (E) * E’ | (E)</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708151619295.png" srcset="/img/loading.gif" class="" title="image-20200708151619295">

<h4 id="if-then-else结构"><a href="#if-then-else结构" class="headerlink" title="if-then-else结构"></a>if-then-else结构</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708152324929.png" srcset="/img/loading.gif" class="" title="image-20200708152324929">

<h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><ul>
<li><p>Impossible to convert automatically an ambiguous grammar to an unambiguous one</p>
</li>
<li><p>User with care, ambiguity can simplify the grammar </p>
<blockquote>
<p>sometimes allows more natural definitions</p>
<p>We need disambiguation mechanisms</p>
</blockquote>
</li>
<li><p>Instead of rewriting the grammar</p>
<blockquote>
<p>Use the more natural (ambiguous) grammar</p>
<p>Along with disambiguating declarations</p>
</blockquote>
</li>
<li><p>Most tools allow precedence and associativity declarations(优先性和关联性声明) to disambiguate grammars</p>
</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708153308814.png" srcset="/img/loading.gif" class="" title="image-20200708153308814">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708153242579.png" srcset="/img/loading.gif" class="" title="image-20200708153242579">

<h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708211223360.png" srcset="/img/loading.gif" class="" title="image-20200708211223360">

<h4 id="紧急模式"><a href="#紧急模式" class="headerlink" title="紧急模式"></a>紧急模式</h4><p>最简单，最广泛使用的</p>
<p>检测到错误，解析器会开始抛弃 token直到找到作用明确的token</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708211933630.png" srcset="/img/loading.gif" class="" title="image-20200708211933630">

<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="错误产生式"><a href="#错误产生式" class="headerlink" title="错误产生式"></a>错误产生式</h4><p> 将常犯的已知错误指定为语法中的替代产生式</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708214135600.png" srcset="/img/loading.gif" class="" title="image-20200708214135600">



<h4 id="自动局部或全局校正"><a href="#自动局部或全局校正" class="headerlink" title="自动局部或全局校正"></a>自动局部或全局校正</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708214329681.png" srcset="/img/loading.gif" class="" title="image-20200708214329681">

<h3 id="抽象语法树-Abstract-Syntax-Trees"><a href="#抽象语法树-Abstract-Syntax-Trees" class="headerlink" title="抽象语法树 Abstract Syntax Trees"></a>抽象语法树 Abstract Syntax Trees</h3><ul>
<li>Like parse trees but ignore some details</li>
<li>Abbreviated as AST （简称AST）</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708215810670.png" srcset="/img/loading.gif" class="" title="image-20200708215810670">

<p>下图表示了上图相同的内容</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708215745811.png" srcset="/img/loading.gif" class="" title="image-20200708215745811">

<h3 id="递归下降解析"><a href="#递归下降解析" class="headerlink" title="递归下降解析"></a>递归下降解析</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709092646974.png" srcset="/img/loading.gif" class="" title="image-20200709092646974">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709093014117.png" srcset="/img/loading.gif" class="" title="image-20200709093014117">

<p>将E变成与(int)相同的格式使之可以匹配，则算解析成功，所以E-&gt;T-&gt;(E)-&gt;(int)</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709093210746.png" srcset="/img/loading.gif" class="" title="image-20200709093210746">

<h3 id="递归下降算法"><a href="#递归下降算法" class="headerlink" title="递归下降算法"></a>递归下降算法</h3><ul>
<li>Let TOKEN be the type of tokens<ul>
<li>Special tokens INT, OPEN, CLOSE, PLUS, TIMES</li>
</ul>
</li>
<li>Let the global <strong>next</strong> point to the next input token</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709093644246.png" srcset="/img/loading.gif" class="" title="image-20200709093644246">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709100234043.png" srcset="/img/loading.gif" class="" title="image-20200709100234043">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709100315068.png" srcset="/img/loading.gif" class="" title="image-20200709100315068">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709100353599.png" srcset="/img/loading.gif" class="" title="image-20200709100353599">

<h3 id="递归下降的局限性"><a href="#递归下降的局限性" class="headerlink" title="递归下降的局限性"></a>递归下降的局限性</h3><p><a href="https://www.bilibili.com/video/BV1cE411f78c?p=26" target="_blank" rel="noopener">link</a></p>
<ul>
<li>if a production for non-terminal X suceeds<ul>
<li>canno backtrack to try a different production for X later</li>
</ul>
</li>
<li>General recurisive-descent algorithms support such “full” backtracking<ul>
<li>Can implement any grammar</li>
</ul>
</li>
</ul>
<h3 id="递归下降解析的主要难点-左递归-left-recursion"><a href="#递归下降解析的主要难点-左递归-left-recursion" class="headerlink" title="递归下降解析的主要难点-左递归 left recursion"></a>递归下降解析的主要难点-左递归 left recursion</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709223432931.png" srcset="/img/loading.gif" class="" title="image-20200709223432931">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709223907932.png" srcset="/img/loading.gif" class="" title="image-20200709223907932">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709224244931.png" srcset="/img/loading.gif" class="" title="image-20200709224244931">

<h3 id="PA3"><a href="#PA3" class="headerlink" title="PA3"></a>PA3</h3><p><a href="https://github.com/mrbelieve128/Stanford-Compilers-PA/tree/master/PA3" target="_blank" rel="noopener">https://github.com/mrbelieve128/Stanford-Compilers-PA/tree/master/PA3</a></p>
<h3 id="预测解析-Predictive-Parsers"><a href="#预测解析-Predictive-Parsers" class="headerlink" title="预测解析 Predictive Parsers"></a>预测解析 Predictive Parsers</h3><p>预测解析和递归下降很像，依然是自上而下，但能从不出错的预测该使用哪一个产生式，并得出正确的解析。</p>
<blockquote>
<ul>
<li>根据输入字符串中出现的内容，来尝试得出该使用哪个产生式。只适合语法形式很固定的情况</li>
<li>不需要回滚操作。解析器可以完全肯定要使用的产生式</li>
</ul>
<p>接受 LL(K) 语法 (left-to-right 从左到右 left-most derivate 始终基于解析树上最左非终结符 k tokens lookahead)</p>
</blockquote>
<p>如</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200721124025300.png" srcset="/img/loading.gif" class="" title="image-20200721124025300">

<p>实际上是使用表格记录数据</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200721124104017.png" srcset="/img/loading.gif" class="" title="image-20200721124104017">

<p>使用栈记录边界</p>
<ul>
<li>把最左终结符或非终结符始终放在栈顶</li>
</ul>
<h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200721201621877.png" srcset="/img/loading.gif" class="" title="image-20200721201621877">

<ul>
<li>使用S和$初始化栈。</li>
<li>$标记栈底，可以看作输入结束的标记。</li>
<li>如果栈顶是最左非终结符，根据解析表来查找非终结符为X和下一个输入字符所对应的产生式右手边内容，然后弹出栈顶的X。如果不符合就会报错，因为没有回滚操作，没有办法解析字符串。</li>
<li>如果栈顶是终结符的话，试着匹配输入，匹配成功就移动到下一个输入元素，然后弹出栈顶元素。如果不符合就会报错，因为没有回滚操作，没有办法解析字符串。</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200721201531558.png" srcset="/img/loading.gif" class="" title="image-20200721201531558">

<h3 id="First集-First-Sets"><a href="#First集-First-Sets" class="headerlink" title="First集 First Sets"></a>First集 First Sets</h3><h4 id="构建LL-1-解析表"><a href="#构建LL-1-解析表" class="headerlink" title="构建LL(1) 解析表"></a>构建LL(1) 解析表</h4><p>non-terminal <strong>A</strong>, input singal t</p>
<p>什么时候T[A,t] = α（意思是解析表上[A, T]这一单元格里的内容是α</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722154608118.png" srcset="/img/loading.gif" class="" title="image-20200722154608118">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722160201765.png" srcset="/img/loading.gif" class="" title="image-20200722160201765">

<h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p>左边是terminal的first集，只包含自身，右边是non-terminal的</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722160742081.png" srcset="/img/loading.gif" class="" title="image-20200722160742081">

<h3 id="Follow集-Follow-Sets"><a href="#Follow集-Follow-Sets" class="headerlink" title="Follow集 Follow Sets"></a>Follow集 Follow Sets</h3><p>Follow集中的元素是那些被用到的元素而不是生成的符号。ε不会加进Follow集中</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722162012683.png" srcset="/img/loading.gif" class="" title="image-20200722162012683">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722162135668.png" srcset="/img/loading.gif" class="" title="image-20200722162135668">

<h4 id="一些规则"><a href="#一些规则" class="headerlink" title="一些规则"></a>一些规则</h4><p> 出现在产生式右侧末尾的，如E -&gt; TX Follow(E) 是Follow(X)的子集</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722164420950.png" srcset="/img/loading.gif" class="" title="image-20200722164420950">

<p>而在E -&gt; TX 中，X可以消除，所以Follow(E) 同样是Follow(T)中的元素</p>
<p>‘ ( ‘的Follow集就是First(E)中所有元素，而First(E) = First(T)</p>
<p>Follow(‘+’) = First(E)</p>
<p>Follow(int)因为可以Y可以变成ε，所以Follow(T)中的元素也会是Follow(int)中的元素</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722165632093.png" srcset="/img/loading.gif" class="" title="image-20200722165632093">

<h3 id="LL-1-解析表"><a href="#LL-1-解析表" class="headerlink" title="LL(1)解析表"></a>LL(1)解析表</h3><p>目标是为上下文无关语法G构建出一个解析表T</p>
<h4 id="语法-规则"><a href="#语法-规则" class="headerlink" title="语法/规则"></a>语法/规则</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722223652295.png" srcset="/img/loading.gif" class="" title="image-20200722223652295">

<h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722224646095.png" srcset="/img/loading.gif" class="" title="image-20200722224646095">

<p>根据字母（非终结符）和符号（终结符）来预测和匹配完整的对应关系</p>
<p>构建完解析表的时候，如果表格内的某些单元格中有多种操作的话，每种情况下的操作就不是唯一的，这就不是LL(1)语法。</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722225221200.png" srcset="/img/loading.gif" class="" title="image-20200722225221200">

<h3 id="自下而上的解析-Bottom-Up-Parsing"><a href="#自下而上的解析-Bottom-Up-Parsing" class="headerlink" title="自下而上的解析 Bottom-Up Parsing"></a>自下而上的解析 Bottom-Up Parsing</h3><p>Bottom-Up 解析比top-down 递归下降解析 更通用，且同样高效</p>
<p>Bottom-Up是大部分解析生成工具所使用的一种首选方法</p>
<ul>
<li>不需要提取左因子语法</li>
<li>回归到“正常”语法，但仍然需要对<strong>+号</strong>和<strong>*号</strong>的优先权进行编码</li>
<li>不会处理语义混淆的语法</li>
</ul>
<p>Bottom-Up解析 会进行归约，既通过反转产生式，逆向替换，将字符串规约为起始符号</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723094219185.png" srcset="/img/loading.gif" class="" title="image-20200723094219185">

<p>从下往上看，是最右推导</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723094508872.png" srcset="/img/loading.gif" class="" title="image-20200723094508872">

<p>解析树，也是从下往上生成的</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723094848086.png" srcset="/img/loading.gif" class="" title="image-20200723094848086">

<h3 id="移位规约解析-Shift-Reduce-Parsing"><a href="#移位规约解析-Shift-Reduce-Parsing" class="headerlink" title="移位规约解析 Shift Reduce Parsing"></a>移位规约解析 Shift Reduce Parsing</h3> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723095155240.png" srcset="/img/loading.gif" class="" title="image-20200723095155240">



<p>在执行规约操作前，始终得需要得到足够多的输入（移位足够多次）</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723095718573.png" srcset="/img/loading.gif" class="" title="image-20200723095718573">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723095745689.png" srcset="/img/loading.gif" class="" title="image-20200723095745689">

<ul>
<li>竖线左边的字符串能够由一个栈实现，栈顶就是那个竖线的位置</li>
<li>Shift移位操作会push一个terminal进入栈</li>
<li>规约操作，将一些符号弹出栈，这些是产生式右手边的内容。接着会把一个非终结符压入栈中，这歌非终结符是产生式左手边的内容</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723100832481.png" srcset="/img/loading.gif" class="" title="image-20200723100832481">

<h3 id="句柄-Handles"><a href="#句柄-Handles" class="headerlink" title="句柄 Handles"></a>句柄 Handles</h3><p>句柄就是一个规约点，可以允许解析器通过进一步的规约操作回到开始符号位置。（句柄就是包含了一个可规约的操作路径）</p>
<p>在shift-reduce解析中，句柄只会出现在栈顶</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723102541174.png" srcset="/img/loading.gif" class="" title="image-20200723102541174">

<h3 id="句柄识别"><a href="#句柄识别" class="headerlink" title="句柄识别"></a>句柄识别</h3><p>L代表从左到右扫描，R代表最右推导，K代表了需要向前看k个数量的token</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723103946950.png" srcset="/img/loading.gif" class="" title="image-20200723103946950">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723104156569.png" srcset="/img/loading.gif" class="" title="image-20200723104156569">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723104447205.png" srcset="/img/loading.gif" class="" title="image-20200723104447205">

<p>对于任何语法来说，可行前缀集就是一个正则语言</p>
<p>item是指一个产生式右手边某处存在的一个’ . ‘，如 T -&gt; (E) 的item包含 T -&gt; .(E)  T -&gt; (.E) T -&gt; (E.) T -&gt; (E).</p>
<p>而 X -&gt; ε 的item是 X -&gt; .</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723105616024.png" srcset="/img/loading.gif" class="" title="image-20200723105616024">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723105856274.png" srcset="/img/loading.gif" class="" title="image-20200723105856274">

<p>‘ . ‘左侧的内容是见过的，即栈内元素。右侧元素则是在进行规约操作前想要读取的内容。</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723111109950.png" srcset="/img/loading.gif" class="" title="image-20200723111109950">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723112430462.png" srcset="/img/loading.gif" class="" title="image-20200723112430462">

<p>从底向上开始处理</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723112639904.png" srcset="/img/loading.gif" class="" title="image-20200723112639904">

<h3 id="识别可行前缀-Recognizing-Viable-Prefixes"><a href="#识别可行前缀-Recognizing-Viable-Prefixes" class="headerlink" title="识别可行前缀 Recognizing Viable Prefixes"></a>识别可行前缀 Recognizing Viable Prefixes</h3><p>目标是去写一个非确定性有限自动机来识别解析器中有效的栈</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723152951096.png" srcset="/img/loading.gif" class="" title="image-20200723152951096">

<p>感觉是推算所有的可能性</p>
<h3 id="有效item-Valid-items"><a href="#有效item-Valid-items" class="headerlink" title="有效item Valid items"></a>有效item Valid items</h3><p>The states of the DFA are “canonical collections of items” or “canonical collections of LR(0) items”</p>
<h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723155218728.png" srcset="/img/loading.gif" class="" title="image-20200723155218728">

<h4 id="简化地说"><a href="#简化地说" class="headerlink" title="简化地说"></a>简化地说</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723155456565.png" srcset="/img/loading.gif" class="" title="image-20200723155456565">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723155514814.png" srcset="/img/loading.gif" class="" title="image-20200723155514814">

<h2 id="语义分析-Semantic-Analysis"><a href="#语义分析-Semantic-Analysis" class="headerlink" title="语义分析 Semantic Analysis"></a>语义分析 Semantic Analysis</h2><h3 id="语义分析简介"><a href="#语义分析简介" class="headerlink" title="语义分析简介"></a>语义分析简介</h3><h4 id="为什么需要单独一个语义分析阶段？"><a href="#为什么需要单独一个语义分析阶段？" class="headerlink" title="为什么需要单独一个语义分析阶段？"></a>为什么需要单独一个语义分析阶段？</h4><ul>
<li>编程语言会有一些特征，人可能会犯一些解析无法捕获的错误</li>
<li>一些语言结构并非上下文无关</li>
</ul>
<h4 id="语义分析实际上做什么"><a href="#语义分析实际上做什么" class="headerlink" title="语义分析实际上做什么"></a>语义分析实际上做什么</h4><p>如coolc的检查列表</p>
<ol>
<li>所有标识符被声明，作用域是否规范</li>
<li>类型检查（主要功能）</li>
<li>继承关系是否有意义</li>
<li>类仅定义一次</li>
<li>类中方法也只被定义一次</li>
<li>不滥用保留的关键字标识符</li>
<li>……</li>
</ol>
<h3 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h3><p>目标: 将用法和声明相匹配</p>
<p>静态分析在大多数语言中都相当重要</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723162419518.png" srcset="/img/loading.gif" class="" title="image-20200723162419518">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723165607420.png" srcset="/img/loading.gif" class="" title="image-20200723165607420">

<p>在下面例子中，对于X可能会有歧义，则使用最近嵌套规则 most closely nested rule</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723170146809.png" srcset="/img/loading.gif" class="" title="image-20200723170146809">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723170623797.png" srcset="/img/loading.gif" class="" title="image-20200723170623797">

<h3 id="Symbol-Tables"><a href="#Symbol-Tables" class="headerlink" title="Symbol Tables"></a>Symbol Tables</h3><p>在许多编译器中的一种重要的数据结构</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723171535802.png" srcset="/img/loading.gif" class="" title="image-20200723171535802">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724094925936.png" srcset="/img/loading.gif" class="" title="image-20200724094925936">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724095151576.png" srcset="/img/loading.gif" class="" title="image-20200724095151576">

<p>会先找最近的Y（也就是最新定义的） </p>
<p>而在下述错误示范中，为了解决这个问题</p>
<pre><code>f(x:INT, x:INT)
{}</code></pre><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724095821453.png" srcset="/img/loading.gif" class="" title="image-20200724095821453">

<p>check_scope直到x处在栈顶才返回true</p>
<p>因为cool中可以，class名先用再定义，所以不可能通过symbol table或在一次检查中检查完class名</p>
<p>解决办法</p>
<ul>
<li>第一次检查：记录所有的class名</li>
<li>第二次检查：检测</li>
</ul>
<p>语义分析通常要求多次检查，而且经常大于两次检查。</p>
<h3 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724102140619.png" srcset="/img/loading.gif" class="" title="image-20200724102140619">

<p>一种语言的type system定义了哪些类型能使用哪些操作符，目标是操作符只被正确的类型使用</p>
<p>目前，有三种类型语言：</p>
<ul>
<li>静态类型：编译的时候就检测类型</li>
<li>动态类型：直到执行代码才检测类型</li>
<li>untyped：没有类型检测（机器代码 ）</li>
</ul>
<h4 id="静态类型喝动态类型的看法"><a href="#静态类型喝动态类型的看法" class="headerlink" title="静态类型喝动态类型的看法"></a>静态类型喝动态类型的看法</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724103636901.png" srcset="/img/loading.gif" class="" title="image-20200724103636901">

<h3 id="Type-Checking"><a href="#Type-Checking" class="headerlink" title="Type Checking"></a>Type Checking<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724105958685.png" srcset="/img/loading.gif" class="" title="image-20200724105958685"></h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724110021635.png" srcset="/img/loading.gif" class="" title="image-20200724110021635">



<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724110937602.png" srcset="/img/loading.gif" class="" title="image-20200724110937602">

<h3 id="Type-Environments"><a href="#Type-Environments" class="headerlink" title="Type Environments"></a>Type Environments</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724111334320.png" srcset="/img/loading.gif" class="" title="image-20200724111334320">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724111354123.png" srcset="/img/loading.gif" class="" title="image-20200724111354123">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724111528046.png" srcset="/img/loading.gif" class="" title="image-20200724111528046">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724111731184.png" srcset="/img/loading.gif" class="" title="image-20200724111731184">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724112015350.png" srcset="/img/loading.gif" class="" title="image-20200724112015350">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724112448369.png" srcset="/img/loading.gif" class="" title="image-20200724112448369">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724112420945.png" srcset="/img/loading.gif" class="" title="image-20200724112420945">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724112952700.png" srcset="/img/loading.gif" class="" title="image-20200724112952700">



<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724113344525.png" srcset="/img/loading.gif" class="" title="image-20200724113344525">

<h3 id="Subtyping"><a href="#Subtyping" class="headerlink" title="Subtyping"></a>Subtyping</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724141347149.png" srcset="/img/loading.gif" class="" title="image-20200724141347149">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724141650601.png" srcset="/img/loading.gif" class="" title="image-20200724141650601">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724142110637.png" srcset="/img/loading.gif" class="" title="image-20200724142110637">

<h4 id="LUB-or-least-upper-bound"><a href="#LUB-or-least-upper-bound" class="headerlink" title="LUB or least upper bound"></a>LUB or least upper bound</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724142626399.png" srcset="/img/loading.gif" class="" title="image-20200724142626399">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724143528841.png" srcset="/img/loading.gif" class="" title="image-20200724143528841">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724143822176.png" srcset="/img/loading.gif" class="" title="image-20200724143822176">

<p>因为不知道会匹配上哪个类型，所以要lub(T1,…..Tn)</p>
<h3 id="Typing-Methods"><a href="#Typing-Methods" class="headerlink" title="Typing Methods"></a>Typing Methods</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724144324764.png" srcset="/img/loading.gif" class="" title="image-20200724144324764">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724144914464.png" srcset="/img/loading.gif" class="" title="image-20200724144914464">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724145112483.png" srcset="/img/loading.gif" class="" title="image-20200724145112483">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724145555997.png" srcset="/img/loading.gif" class="" title="image-20200724145555997">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724145757350.png" srcset="/img/loading.gif" class="" title="image-20200724145757350">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724150056109.png" srcset="/img/loading.gif" class="" title="image-20200724150056109">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724150109672.png" srcset="/img/loading.gif" class="" title="image-20200724150109672">

<h3 id="Implementing-Type-Checking"><a href="#Implementing-Type-Checking" class="headerlink" title="Implementing Type Checking"></a>Implementing Type Checking</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724151522565.png" srcset="/img/loading.gif" class="" title="image-20200724151522565">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724151938870.png" srcset="/img/loading.gif" class="" title="image-20200724151938870">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724152341217.png" srcset="/img/loading.gif" class="" title="image-20200724152341217">

<h3 id="PA4"><a href="#PA4" class="headerlink" title="PA4"></a>PA4</h3><h2 id="Cool-Type-Checking-amp-Runtime-Organization"><a href="#Cool-Type-Checking-amp-Runtime-Organization" class="headerlink" title="Cool Type Checking &amp; Runtime Organization"></a>Cool Type Checking &amp; Runtime Organization</h2><h3 id="Static-vs-Dynamic-Typing"><a href="#Static-vs-Dynamic-Typing" class="headerlink" title="Static vs. Dynamic Typing"></a>Static vs. Dynamic Typing</h3><p>Static type systems detect common errors( at compile time)</p>
<p><strong>But some correct programs are disallowed</strong></p>
<ul>
<li>Some argue for dynamic type checking instead</li>
<li>Others want more expressive static type checking</li>
</ul>
<p>Soundness theorem: for all expressions <strong>E</strong> </p>
<p><strong>dynamic_type(E)=static_type(E)</strong></p>
<p><em>In all executions,E evaluates to values of the type inferred by the compiler.</em></p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803110654648.png" srcset="/img/loading.gif" class="" title="image-20200803110654648">

<h3 id="Self-Type"><a href="#Self-Type" class="headerlink" title="Self Type"></a>Self Type</h3><pre><code>class Count{
    i:int-0; 
    inc():Count{//返回Count的class类型
        {
            i&lt;-i+1; 
            self;
        }
    };
};

class Stock inherits Count{
    name: String;--name of item
}
class Main{
    Stocka-(new Stock).inc();//类型错误，Count不是Stock的子集
    ...a.name ...
}</code></pre><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803112048486.png" srcset="/img/loading.gif" class="" title="image-20200803112048486">

<h3 id="Self-Type-Operations"><a href="#Self-Type-Operations" class="headerlink" title="Self Type Operations"></a>Self Type Operations</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803112942180.png" srcset="/img/loading.gif" class="" title="image-20200803112942180">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803113101122.png" srcset="/img/loading.gif" class="" title="image-20200803113101122">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803113408665.png" srcset="/img/loading.gif" class="" title="image-20200803113408665">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803114939592.png" srcset="/img/loading.gif" class="" title="image-20200803114939592">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803115337069.png" srcset="/img/loading.gif" class="" title="image-20200803115337069">

<h3 id="Self-Type-Usage"><a href="#Self-Type-Usage" class="headerlink" title="Self Type Usage"></a>Self Type Usage</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804090907495.png" srcset="/img/loading.gif" class="" title="image-20200804090907495">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804090921258.png" srcset="/img/loading.gif" class="" title="image-20200804090921258">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804091404056.png" srcset="/img/loading.gif" class="" title="image-20200804091404056">

<h3 id="Self-Type-Checking"><a href="#Self-Type-Checking" class="headerlink" title="Self Type Checking"></a>Self Type Checking</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094143731.png" srcset="/img/loading.gif" class="" title="image-20200804094143731">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094222838.png" srcset="/img/loading.gif" class="" title="image-20200804094222838">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094434305.png" srcset="/img/loading.gif" class="" title="image-20200804094434305">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094508391.png" srcset="/img/loading.gif" class="" title="image-20200804094508391">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094930978.png" srcset="/img/loading.gif" class="" title="image-20200804094930978">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094952794.png" srcset="/img/loading.gif" class="" title="image-20200804094952794">

<h3 id="Error-Recovery"><a href="#Error-Recovery" class="headerlink" title="Error Recovery"></a>Error Recovery</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804100054994.png" srcset="/img/loading.gif" class="" title="image-20200804100054994">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804095353003.png" srcset="/img/loading.gif" class="" title="image-20200804095353003">

<blockquote>
<p>a workable solution but with cascading errors</p>
</blockquote>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804100442013.png" srcset="/img/loading.gif" class="" title="image-20200804100442013">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804100525228.png" srcset="/img/loading.gif" class="" title="image-20200804100525228">

<h3 id="Runtime-Organization"><a href="#Runtime-Organization" class="headerlink" title="Runtime Organization"></a>Runtime Organization</h3><p> Enforcing the language definition is just one purpose of the front-end. The front-end also builds the data structures that are needed to do co-generation as we seen but there is a real. Once we get through the front-end we no longer looking for errors in the program. We’re no longer trying to figure out whether it’s a valid program. Now we’re really down to the point where we’re going to generate code And that is a job at the back end. </p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804100935737.png" srcset="/img/loading.gif" class="" title="image-20200804100935737">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804101607087.png" srcset="/img/loading.gif" class="" title="image-20200804101607087">

<h3 id="Activations"><a href="#Activations" class="headerlink" title="Activations"></a>Activations</h3><p>Two goals:</p>
<ul>
<li>Correctness</li>
<li>Speed</li>
</ul>
<p>Complications in code generation come from trying to be fast as well as correct</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804102036374.png" srcset="/img/loading.gif" class="" title="image-20200804102036374">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804103800174.png" srcset="/img/loading.gif" class="" title="image-20200804103800174">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804103904151.png" srcset="/img/loading.gif" class="" title="image-20200804103904151">

<h4 id="activation-tree"><a href="#activation-tree" class="headerlink" title="activation tree"></a>activation tree</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804104501937.png" srcset="/img/loading.gif" class="" title="image-20200804104501937">

<blockquote>
<p>子树在同一行内代表调用后，需要依次调用的函数</p>
<pre><code>isEven(x:Int) : Bool {x % 2 == 0};
isOne(x:Int) : Bool {x == 1};
powerOfTwo(x:Int) : Bool {
if isEven(x) then powerOfTwo(x / 2)
else isOne(x)
};</code></pre><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804105015043.png" srcset="/img/loading.gif" class="" title="image-20200804105015043">
</blockquote>
<h3 id="Activation-Records"><a href="#Activation-Records" class="headerlink" title="Activation Records"></a>Activation Records</h3><p>The information needed to manage one procedure activation is called an activation record (AR) or frame</p>
<p>If procedure <strong>F</strong> calls <strong>G</strong>, then <strong>G</strong>‘s activation record contains a mix of info about <strong>F</strong> and <strong>G</strong>.</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804105747132.png" srcset="/img/loading.gif" class="" title="image-20200804105747132">

<p>The compiler must determine,at compile-time,the layout of activation records and generate code that correctly accesses locations in the activation record </p>
<p>Thus,the AR layout and the code generator must be designed together!</p>
<h3 id="Globals-and-Heap"><a href="#Globals-and-Heap" class="headerlink" title="Globals and Heap"></a>Globals and Heap</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804111927233.png" srcset="/img/loading.gif" class="" title="image-20200804111927233">

<p>Both the heap and the stack grow</p>
<p>Must take care that they don’t grow into each other</p>
<p>Solution:start heap and stack at opposite ends of memory and let them grow towards each other</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804112106101.png" srcset="/img/loading.gif" class="" title="image-20200804112106101">

<h3 id="Alignment"><a href="#Alignment" class="headerlink" title="Alignment"></a>Alignment</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804112719766.png" srcset="/img/loading.gif" class="" title="image-20200804112719766">

<h3 id="Stack-Machines"><a href="#Stack-Machines" class="headerlink" title="Stack Machines"></a>Stack Machines</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804112851657.png" srcset="/img/loading.gif" class="" title="image-20200804112851657">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804113208145.png" srcset="/img/loading.gif" class="" title="image-20200804113208145">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804113359758.png" srcset="/img/loading.gif" class="" title="image-20200804113359758"> 

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804114035608.png" srcset="/img/loading.gif" class="" title="image-20200804114035608">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804114216478.png" srcset="/img/loading.gif" class="" title="image-20200804114216478">

<p>After evaluating an expression e, the accumulator holds the value of e and the stack is unchanged.</p>
<p> <em>Expression evaluation preserves the stack.</em></p>
<h4 id="exmaple"><a href="#exmaple" class="headerlink" title="exmaple"></a>exmaple</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804115009773.png" srcset="/img/loading.gif" class="" title="image-20200804115009773">

<h2 id="Code-Generation"><a href="#Code-Generation" class="headerlink" title="Code Generation"></a>Code Generation</h2><h3 id="Introduction-to-Code-Generation"><a href="#Introduction-to-Code-Generation" class="headerlink" title="Introduction to Code Generation"></a>Introduction to Code Generation</h3><p>The accumulator is kept in MIPS register $a0</p>
<p>The stack is kept in memory</p>
<ul>
<li>The stack grows towards lower addresses</li>
<li>Standard convention on MIPS</li>
</ul>
<p>The address of the next location on the stack is kept in MIPS register <code>$sp</code> (stack pointer</p>
<ul>
<li>The top of the stack is at address <code>$sp+4</code></li>
</ul>
<p><strong>Stack is growing towards low addresses</strong></p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808090532307.png" srcset="/img/loading.gif" class="" title="image-20200808090532307">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808090733566.png" srcset="/img/loading.gif" class="" title="image-20200808090733566">

<h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808090948399.png" srcset="/img/loading.gif" class="" title="image-20200808090948399">

<h3 id="Code-Generation-I"><a href="#Code-Generation-I" class="headerlink" title="Code Generation I"></a>Code Generation I</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092449719.png" srcset="/img/loading.gif" class="" title="image-20200808092449719">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092520377.png" srcset="/img/loading.gif" class="" title="image-20200808092520377">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092406241.png" srcset="/img/loading.gif" class="" title="image-20200808092406241">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092138761.png" srcset="/img/loading.gif" class="" title="image-20200808092138761">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092837102.png" srcset="/img/loading.gif" class="" title="image-20200808092837102">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808093434286.png" srcset="/img/loading.gif" class="" title="image-20200808093434286">

<h3 id="Code-Generation-II"><a href="#Code-Generation-II" class="headerlink" title="Code Generation II"></a>Code Generation II</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808101554898.png" srcset="/img/loading.gif" class="" title="image-20200808101554898">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808101652847.png" srcset="/img/loading.gif" class="" title="image-20200808101652847">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808101826630.png" srcset="/img/loading.gif" class="" title="image-20200808101826630">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808102115320.png" srcset="/img/loading.gif" class="" title="image-20200808102115320">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808102420307.png" srcset="/img/loading.gif" class="" title="image-20200808102420307">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808102625336.png" srcset="/img/loading.gif" class="" title="image-20200808102625336">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808102731121.png" srcset="/img/loading.gif" class="" title="image-20200808102731121">

<h4 id="example-1"><a href="#example-1" class="headerlink" title="example"></a>example</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808103106476.png" srcset="/img/loading.gif" class="" title="image-20200808103106476">



<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808103516812.png" srcset="/img/loading.gif" class="" title="image-20200808103516812">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808103618842.png" srcset="/img/loading.gif" class="" title="image-20200808103618842">

<h3 id="Code-Generation-Example"><a href="#Code-Generation-Example" class="headerlink" title="Code Generation Example"></a>Code Generation Example</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808104801419.png" srcset="/img/loading.gif" class="" title="image-20200808104801419">

<h3 id="Temporaries"><a href="#Temporaries" class="headerlink" title="Temporaries"></a>Temporaries</h3><p>Idea:Keep temporaries in the AR</p>
<p>The code generator must assign a fixed location in the AR for each temporary</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808113002505.png" srcset="/img/loading.gif" class="" title="image-20200808113002505">

<blockquote>
<p>While we need one here for the predicate, but notice that once the predicate is decided, once we know the answer to whether this predicate is true or false, we don’t need that temporary anymore. So in fact, that temporary can be reclaimed; we don’t need the space for that temporary anymore by the time we get to the false branch.</p>
</blockquote>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808112920088.png" srcset="/img/loading.gif" class="" title="image-20200808112920088">

<blockquote>
<p>NT(e1 + e2) = max(NT(e1), 1 + NT(e2))</p>
</blockquote>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808113708280.png" srcset="/img/loading.gif" class="" title="image-20200808113708280">

<h4 id="example-2"><a href="#example-2" class="headerlink" title="example"></a>example</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808113903169.png" srcset="/img/loading.gif" class="" title="image-20200808113903169">

<blockquote>
<p>最多需要两个temporaries来储存这些数据</p>
<p>if 的true 或flase 一个，单个int可以变成返回值（不用临时变量），调用fib 传递的参数需要用临时变量</p>
</blockquote>
<p>For a function definition <strong>f(x.…… Xn)=e</strong> the AR has <strong>2+n+NT(e)</strong> elements</p>
<ul>
<li>Return addressL</li>
<li>Frame pointer C</li>
<li><strong>n</strong> arguments</li>
<li><strong>NT(e)</strong> locations for intermediate results</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808114653932.png" srcset="/img/loading.gif" class="" title="image-20200808114653932">



<h4 id="new-scheme"><a href="#new-scheme" class="headerlink" title="new scheme"></a>new scheme</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808115316923.png" srcset="/img/loading.gif" class="" title="image-20200808115316923">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808115353156.png" srcset="/img/loading.gif" class="" title="image-20200808115353156">

<blockquote>
<p>nt  unused temporary</p>
</blockquote>
<h3 id="Object-Layout"><a href="#Object-Layout" class="headerlink" title="Object Layout"></a>Object Layout</h3><p>00 implementation=Basic code generation + <strong>More stuff</strong></p>
<p>0o Slogan:If <strong>B is a subclass of A</strong>,than an object of class B can be used wherever an object of class A is expected</p>
<p>This means that code in class A works <strong>unmodified</strong> for an object of class B</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808120906584.png" srcset="/img/loading.gif" class="" title="image-20200808120906584">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808121002133.png" srcset="/img/loading.gif" class="" title="image-20200808121002133">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808121205970.png" srcset="/img/loading.gif" class="" title="image-20200808121205970">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808120828905.png" srcset="/img/loading.gif" class="" title="image-20200808120828905">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808120723112.png" srcset="/img/loading.gif" class="" title="image-20200808120723112">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808121617559.png" srcset="/img/loading.gif" class="" title="image-20200808121617559">

<p>Every class has a fixed set of methods</p>
<ul>
<li>including inherited methods</li>
</ul>
<p>A <strong>dispatch table</strong> indexes these methods</p>
<ul>
<li>An array of method entry points</li>
<li>A method <strong>f</strong> lives at <strong>a fixed offset</strong> in the dispatch table for a class and <strong>all of its subclasses</strong></li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808122344016.png" srcset="/img/loading.gif" class="" title="image-20200808122344016">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808122753473.png" srcset="/img/loading.gif" class="" title="image-20200808122753473">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808122815394.png" srcset="/img/loading.gif" class="" title="image-20200808122815394">

<h3 id="opentional-Semantics-overview"><a href="#opentional-Semantics-overview" class="headerlink" title="opentional Semantics overview"></a>opentional Semantics overview</h3><p>We must specify for every Cool expression what happens<br>when it is evaluated</p>
<ul>
<li>This is the”meaning”of an expression</li>
</ul>
<p>The definition of a programming language:</p>
<ul>
<li>The tokens &gt;lexical analysis</li>
<li>The grammar &gt;syntactic analysis</li>
<li>The typing rules &gt;semantic analysis</li>
<li>The evaluation rules<br>  →code generation and optimization</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808142452501.png" srcset="/img/loading.gif" class="" title="image-20200808142452501">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808142730543.png" srcset="/img/loading.gif" class="" title="image-20200808142730543">

<h4 id="Denotaional-semantics"><a href="#Denotaional-semantics" class="headerlink" title="Denotaional semantics"></a>Denotaional semantics</h4><p>Program’s meaning is a mathematical function</p>
<h4 id="Axiomatic-semantics"><a href="#Axiomatic-semantics" class="headerlink" title="Axiomatic semantics"></a>Axiomatic semantics</h4><ul>
<li>Program behavior described via logical formulae<ul>
<li>If execution begins in state satisfying X,then it ends in state satisfyingY</li>
<li>X,Y formulas</li>
</ul>
</li>
<li>Foundation of many program verification systems</li>
</ul>
<h3 id="Operational-Semantics"><a href="#Operational-Semantics" class="headerlink" title="Operational Semantics"></a>Operational Semantics</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808143144331.png" srcset="/img/loading.gif" class="" title="image-20200808143144331">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808143427301.png" srcset="/img/loading.gif" class="" title="image-20200808143427301">

<p>A variable environment maps variables to locations</p>
<ul>
<li><p>Keeps track of which yariables are in scope</p>
</li>
<li><p>Tells us where those variables are</p>
<p><strong>E = [ a : l1, b : l2 ]</strong></p>
</li>
</ul>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808144113316.png" srcset="/img/loading.gif" class="" title="image-20200808144113316">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808144211557.png" srcset="/img/loading.gif" class="" title="image-20200808144211557">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808144502293.png" srcset="/img/loading.gif" class="" title="image-20200808144502293">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808144825648.png" srcset="/img/loading.gif" class="" title="image-20200808144825648">

<h3 id="Cool-Semantics"><a href="#Cool-Semantics" class="headerlink" title="Cool Semantics"></a>Cool Semantics</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145028046.png" srcset="/img/loading.gif" class="" title="image-20200808145028046">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145137544.png" srcset="/img/loading.gif" class="" title="image-20200808145137544">

<blockquote>
<p>first we look up in the environment <strong>E</strong> where that identifier <strong>id</strong> is stored so now we give us back a memory </p>
<p>location <strong>l</strong>. So by in this case And then we look up in the store <strong>S</strong> what the value is at that memory locations, So, </p>
<p>we use the same memory location here as an argument to the store to get back the value that variable currently</p>
<p>has And notice I just have a reference, this is a read of memories so this is loading, I think it was loading the </p>
<p>value of the variable. This does not affect the store so the store <strong>S</strong> is the same before and after. This is just looking </p>
<p>at the value</p>
</blockquote>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145557313.png" srcset="/img/loading.gif" class="" title="image-20200808145557313">

<h4 id="assignment"><a href="#assignment" class="headerlink" title="assignment"></a>assignment</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145750438.png" srcset="/img/loading.gif" class="" title="image-20200808145750438">

<blockquote>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145944381.png" srcset="/img/loading.gif" class="" title="image-20200808145944381">

<p>we modify the store at that point with the new value so we replace the location l id or we update the value of l, i, d to be the value of v and we do that in store s1 which gives us a new store s2.</p>
</blockquote>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808150452154.png" srcset="/img/loading.gif" class="" title="image-20200808150452154">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808150819402.png" srcset="/img/loading.gif" class="" title="image-20200808150819402">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808151558053.png" srcset="/img/loading.gif" class="" title="image-20200808151558053">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808151807567.png" srcset="/img/loading.gif" class="" title="image-20200808151807567">

<h4 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808151959085.png" srcset="/img/loading.gif" class="" title="image-20200808151959085">

<h4 id="while"><a href="#while" class="headerlink" title="while"></a>while</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808152117753.png" srcset="/img/loading.gif" class="" title="image-20200808152117753">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808152158870.png" srcset="/img/loading.gif" class="" title="image-20200808152158870">

<h4 id="let"><a href="#let" class="headerlink" title="let"></a>let</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808152603765.png" srcset="/img/loading.gif" class="" title="image-20200808152603765">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808152652618.png" srcset="/img/loading.gif" class="" title="image-20200808152652618">

<h3 id="Cool-Semantics-II"><a href="#Cool-Semantics-II" class="headerlink" title="Cool Semantics II"></a>Cool Semantics II</h3><h4 id="new"><a href="#new" class="headerlink" title="new"></a>new</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808153226162.png" srcset="/img/loading.gif" class="" title="image-20200808153226162">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808153301600.png" srcset="/img/loading.gif" class="" title="image-20200808153301600">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808153553893.png" srcset="/img/loading.gif" class="" title="image-20200808153553893">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808154013836.png" srcset="/img/loading.gif" class="" title="image-20200808154013836">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808154217191.png" srcset="/img/loading.gif" class="" title="image-20200808154217191">

<h4 id="dynamic-dispatch"><a href="#dynamic-dispatch" class="headerlink" title="dynamic dispatch"></a>dynamic dispatch</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808154401563.png" srcset="/img/loading.gif" class="" title="image-20200808154401563">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808154927736.png" srcset="/img/loading.gif" class="" title="image-20200808154927736">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808155513811.png" srcset="/img/loading.gif" class="" title="image-20200808155513811">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808155706318.png" srcset="/img/loading.gif" class="" title="image-20200808155706318">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808155830158.png" srcset="/img/loading.gif" class="" title="image-20200808155830158">

<h3 id="PA5"><a href="#PA5" class="headerlink" title="PA5"></a>PA5</h3><h2 id="优化-Optimization"><a href="#优化-Optimization" class="headerlink" title="优化 Optimization"></a>优化 Optimization</h2><h3 id="Intermediate-Code"><a href="#Intermediate-Code" class="headerlink" title="Intermediate Code"></a>Intermediate Code</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724164441833.png" srcset="/img/loading.gif" class="" title="image-20200724164441833">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724164545484.png" srcset="/img/loading.gif" class="" title="image-20200724164545484">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724164657828.png" srcset="/img/loading.gif" class="" title="image-20200724164657828">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724165004707.png" srcset="/img/loading.gif" class="" title="image-20200724165004707">

<h3 id="Optimization-Overview"><a href="#Optimization-Overview" class="headerlink" title="Optimization Overview"></a>Optimization Overview</h3><p><img src="%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727113032723.png" srcset="/img/loading.gif" alt="image-20200727113032723">)<img src="%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727113227764.png" srcset="/img/loading.gif" alt="image-20200727113227764"></p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727114137055.png" srcset="/img/loading.gif" class="" title="image-20200727114137055">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727114346148.png" srcset="/img/loading.gif" class="" title="image-20200727114346148">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727135941770.png" srcset="/img/loading.gif" class="" title="image-20200727135941770">

 <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727140110611.png" srcset="/img/loading.gif" class="" title="image-20200727140110611">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727141024199.png" srcset="/img/loading.gif" class="" title="image-20200727141024199">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727142541805.png" srcset="/img/loading.gif" class="" title="image-20200727142541805">

<h3 id="Local-Optimization"><a href="#Local-Optimization" class="headerlink" title="Local Optimization"></a>Local Optimization</h3><p>有些可以删除的</p>
<pre><code>x = x + 0
x = x * 1</code></pre><p>有些可以简化的</p>
<pre><code>x = x * 0 =&gt; x =0
y = y ** 2 =&gt; y = y * y
x = x *8 =&gt; x = x &lt;&lt; 3
x = x * 15 =&gt; t = x &lt;&lt; 4;x = t - x;</code></pre><p>（一些机子上&lt;&lt;比*号快</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727143956671.png" srcset="/img/loading.gif" class="" title="image-20200727143956671">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727144813527.png" srcset="/img/loading.gif" class="" title="image-20200727144813527">

<p>保留最高精度的浮点数，让架构决定计算结果</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727145423870.png" srcset="/img/loading.gif" class="" title="image-20200727145423870">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727145657145.png" srcset="/img/loading.gif" class="" title="image-20200727145657145">

<h3 id="Peephole-Optimization"><a href="#Peephole-Optimization" class="headerlink" title="Peephole Optimization"></a>Peephole Optimization</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727150656620.png" srcset="/img/loading.gif" class="" title="image-20200727150656620">

<h3 id="Dataflow-Analysis"><a href="#Dataflow-Analysis" class="headerlink" title="Dataflow Analysis"></a>Dataflow Analysis</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727152656236.png" srcset="/img/loading.gif" class="" title="image-20200727152656236">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727152915293.png" srcset="/img/loading.gif" class="" title="image-20200727152915293">

<h3 id="Constant-Propagation"><a href="#Constant-Propagation" class="headerlink" title="Constant Propagation"></a>Constant Propagation</h3> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727153509070.png" srcset="/img/loading.gif" class="" title="image-20200727153509070">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727154004049.png" srcset="/img/loading.gif" class="" title="image-20200727154004049">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727154640486.png" srcset="/img/loading.gif" class="" title="image-20200727154640486">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727155002293.png" srcset="/img/loading.gif" class="" title="image-20200727155002293">

<h3 id="Analysis-of-Loops"><a href="#Analysis-of-Loops" class="headerlink" title="Analysis of Loops"></a>Analysis of Loops</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727161011290.png" srcset="/img/loading.gif" class="" title="image-20200727161011290">

<h3 id="Orderings"><a href="#Orderings" class="headerlink" title="Orderings"></a>Orderings</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727162943132.png" srcset="/img/loading.gif" class="" title="image-20200727162943132">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727163013545.png" srcset="/img/loading.gif" class="" title="image-20200727163013545">

<h3 id="Liveness-Analysis"><a href="#Liveness-Analysis" class="headerlink" title="Liveness Analysis"></a>Liveness Analysis</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727164706188.png" srcset="/img/loading.gif" class="" title="image-20200727164706188">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727164954867.png" srcset="/img/loading.gif" class="" title="image-20200727164954867"> 

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165049700.png" srcset="/img/loading.gif" class="" title="image-20200727165049700">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165134688.png" srcset="/img/loading.gif" class="" title="image-20200727165134688">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165215533.png" srcset="/img/loading.gif" class="" title="image-20200727165215533">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165457537.png" srcset="/img/loading.gif" class="" title="image-20200727165457537">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165949003.png" srcset="/img/loading.gif" class="" title="image-20200727165949003"> 

<h3 id="Register-Allocation"><a href="#Register-Allocation" class="headerlink" title="Register Allocation"></a>Register Allocation</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730092739618.png" srcset="/img/loading.gif" class="" title="image-20200730092739618">

<h4 id="principle"><a href="#principle" class="headerlink" title="principle"></a>principle</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730093244462.png" srcset="/img/loading.gif" class="" title="image-20200730093244462">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730093639654.png" srcset="/img/loading.gif" class="" title="image-20200730093639654">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730093758586.png" srcset="/img/loading.gif" class="" title="image-20200730093758586">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730094201480.png" srcset="/img/loading.gif" class="" title="image-20200730094201480">

<h3 id="Graph-Coloring"><a href="#Graph-Coloring" class="headerlink" title="Graph Coloring"></a>Graph Coloring</h3><p>A <strong>coloring of a graph</strong> is an assignment of colors to nodes, sch that nodes connected by an edge have different colors.</p>
<p>A graph is <strong>k-colorable</strong> if it has a coloring with k colors.In here, colors = registers. Let k = number of machine registers.</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730100849423.png" srcset="/img/loading.gif" class="" title="image-20200730100849423">

<p>再用寄存器名字替换</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730101320589.png" srcset="/img/loading.gif" class="" title="image-20200730101320589">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730104742443.png" srcset="/img/loading.gif" class="" title="image-20200730104742443">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730105029797.png" srcset="/img/loading.gif" class="" title="image-20200730105029797">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730105203033.png" srcset="/img/loading.gif" class="" title="image-20200730105203033">

<h4 id="example-3"><a href="#example-3" class="headerlink" title="example"></a>example</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730105810302.png" srcset="/img/loading.gif" class="" title="image-20200730105810302">

<p>Remove d Stack:{d,a}</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730105936761.png" srcset="/img/loading.gif" class="" title="image-20200730105936761">

<p> now it doesn’t matter which node we pick because we can process them in any</p>
<p>Remove c,b,e,f </p>
<p><strong>now Empty-graph - done with the first part</strong></p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730110258876.png" srcset="/img/loading.gif" class="" title="image-20200730110258876">

<p>going to pick the <strong>lowest numbered register</strong> that is not used by any of its neighbors. </p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730110339115.png" srcset="/img/loading.gif" class="" title="image-20200730110339115">

<p>b is the only register that isnt used</p>
<h3 id="Spilling"><a href="#Spilling" class="headerlink" title="Spilling"></a>Spilling</h3><p>if tgere’s no node that we can delete from the graph, in this situation, we’re going to pick and know that<br>there is a candidate for spilling.</p>
<ul>
<li>A spilled value “lives” in memory</li>
</ul>
<blockquote>
<p>optimisitic coloring =&gt; hope that among the 4 neighbors of f we use less than 3 colors</p>
</blockquote>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730112509274.png" srcset="/img/loading.gif" class="" title="image-20200730112509274"> 

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730112551179.png" srcset="/img/loading.gif" class="" title="image-20200730112551179">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730113112519.png" srcset="/img/loading.gif" class="" title="image-20200730113112519">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730112936005.png" srcset="/img/loading.gif" class="" title="image-20200730112936005">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730113228217.png" srcset="/img/loading.gif" class="" title="image-20200730113228217">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730113618452.png" srcset="/img/loading.gif" class="" title="image-20200730113618452">

<h3 id="Managing-Caches"><a href="#Managing-Caches" class="headerlink" title="Managing Caches"></a>Managing Caches</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730114154225.png" srcset="/img/loading.gif" class="" title="image-20200730114154225">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730114748858.png" srcset="/img/loading.gif" class="" title="image-20200730114748858">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730114725025.png" srcset="/img/loading.gif" class="" title="image-20200730114725025">

<h2 id="Garbage-collection"><a href="#Garbage-collection" class="headerlink" title="Garbage collection"></a>Garbage collection</h2><h3 id="Automatic-Memory-Management"><a href="#Automatic-Memory-Management" class="headerlink" title="Automatic Memory Management"></a>Automatic Memory Management</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730144340907.png" srcset="/img/loading.gif" class="" title="image-20200730144340907">

<h4 id="How-to-know-an-object-will-“never-be-used-again”"><a href="#How-to-know-an-object-will-“never-be-used-again”" class="headerlink" title="How to know an object will “never be used again”?"></a>How to know an object will “never be used again”?</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730145148008.png" srcset="/img/loading.gif" class="" title="image-20200730145148008">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730145452186.png" srcset="/img/loading.gif" class="" title="image-20200730145452186">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730150153526.png" srcset="/img/loading.gif" class="" title="image-20200730150153526"> 

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730150244426.png" srcset="/img/loading.gif" class="" title="image-20200730150244426">

<h3 id="Mark-and-Sweep"><a href="#Mark-and-Sweep" class="headerlink" title="Mark and Sweep"></a>Mark and Sweep</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730150356190.png" srcset="/img/loading.gif" class="" title="image-20200730150356190">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730150542396.png" srcset="/img/loading.gif" class="" title="image-20200730150542396">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730162740553.png" srcset="/img/loading.gif" class="" title="image-20200730162740553">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730163335635.png" srcset="/img/loading.gif" class="" title="image-20200730163335635">

<h3 id="Stop-and-Copy"><a href="#Stop-and-Copy" class="headerlink" title="Stop and Copy"></a>Stop and Copy</h3><p>当旧区域满的时候，将有用的复制到新区域，然后新旧区域名字对换。</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730171624649.png" srcset="/img/loading.gif" class="" title="image-20200730171624649">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730171725223.png" srcset="/img/loading.gif" class="" title="image-20200730171725223">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730172133916.png" srcset="/img/loading.gif" class="" title="image-20200730172133916">

<p>被复制过去之后，指针访问旧区域的时候，会发现旧区域已被标记，然后会更新指针指向新区域</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730172842124.png" srcset="/img/loading.gif" class="" title="image-20200730172842124">

<p>scan到alloc之间就是需要被更新的</p>
<h4 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h4><p>先复制A，然后根据指向按序复制到新区域并更新pointer</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730173025615.png" srcset="/img/loading.gif" class="" title="image-20200730173025615">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730173211485.png" srcset="/img/loading.gif" class="" title="image-20200730173211485">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730174134335.png" srcset="/img/loading.gif" class="" title="image-20200730174134335">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730174236562.png" srcset="/img/loading.gif" class="" title="image-20200730174236562">

<h3 id="Conservative-Collection"><a href="#Conservative-Collection" class="headerlink" title="Conservative Collection"></a>Conservative Collection</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730175043466.png" srcset="/img/loading.gif" class="" title="image-20200730175043466">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730175410736.png" srcset="/img/loading.gif" class="" title="image-20200730175410736">

<h3 id="Reference-Counting"><a href="#Reference-Counting" class="headerlink" title="Reference Counting"></a>Reference Counting</h3><p>Try to collect an object when there are no more pointers to it.</p>
<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730180530542.png" srcset="/img/loading.gif" class="" title="image-20200730180530542">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730181146802.png" srcset="/img/loading.gif" class="" title="image-20200730181146802">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730181841627.png" srcset="/img/loading.gif" class="" title="image-20200730181841627">

<img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730182213114.png" srcset="/img/loading.gif" class="" title="image-20200730182213114">
            </div>
            <hr>
            <div>
              <p>
                
                
              </p>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a href="https://zh.wikipedia.org/wiki/Wikipedia:CC_BY-SA_3.0%E5%8D%8F%E8%AE%AE%E6%96%87%E6%9C%AC" target="_blank" rel="nofollow noopener noopener">CC BY-SA 3.0协议</a> 。转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <div class="post-prev col-6">
                    
                    
                      <a href="/2020/08/21/LLVM%20pass/">
                        <i class="fa fa-chevron-left"></i>
                        <span class="hidden-mobile">LLVM pass</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </div>
                  <div class="post-next col-6">
                    
                    
                      <a href="/2020/05/23/Natas/">
                        <span class="hidden-mobile">Natas</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="fa fa-chevron-right"></i>
                      </a>
                    
                  </div>
                </div>
              
            </div>

              
                <!-- Comments -->
                <div class="comments" id="comments">
                  
                  
  <div id="gitalk-container"></div>
  <link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css">
  <script defer src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.11.1/js/md5.min.js"></script>
  <script type="text/javascript">
    var oldLoad = window.onload;
    window.onload = function () {
      var gitalk = new Gitalk({
        clientID: 'c16704b33f7cc977ea90',
        clientSecret: '9f8ad5600be82be115466ef0daf0f8a24a7b2da1',
        repo: 'mrbelieve128.github.io',
        owner: 'mrbelieve128',
        admin: 'mrbelieve128',
        id: md5(location.pathname),
        language: 'zh-CN',
        perPage: 15,
        pagerDirection: 'last',
        createIssueManually: 'false',
        distractionFreeMode: 'false'
      });

      gitalk.render('gitalk-container')
      oldLoad && oldLoad();
    }
  </script>


                </div>
              
          </div>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc-start"></div>
<div id="toc">
  <p class="h5"><i class="far fa-list-alt"></i>&nbsp;TOC</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    </div>
    
  <div>
    
      <!-- 不蒜子统计PV -->
      
      <span id="busuanzi_container_site_pv" style="display: none">
      总访问量 <span id="busuanzi_value_site_pv"></span> 次
    </span>
    
    
      <!-- 不蒜子统计UV -->
      
      <span id="busuanzi_container_site_uv" style="display: none">
      总访客数 <span id="busuanzi_value_site_uv"></span> 人
    </span>
    
  </div>


    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/popper.js/1.16.1/umd/popper.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="https://cdn.staticfile.org/mdbootstrap/4.13.0/js/mdb.min.js" ></script>
<script  src="/js/main.js" ></script>


  <script  src="/js/lazyload.js" ></script>



  
  <script  src="https://cdn.staticfile.org/tocbot/4.10.0/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var navHeight = $('#navbar').height();
      var toc = $('#toc');
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;
      var tocLimMax = 2 * boardTop + boardCtn.height();

      $(window).scroll(function () {
        var tocLimMin = $('#toc-start').offset().top - navHeight;
        var scroH = document.body.scrollTop + document.documentElement.scrollTop;

        if (tocLimMin <= scroH && scroH <= tocLimMax) {
          toc.css({
            'display': 'block',
            'position': 'fixed',
            'top': navHeight,
          });
        } else if (scroH <= tocLimMin) {
          toc.css({
            'position': '',
            'top': '',
          });
        } else if (scroH > tocLimMax) {
          toc.css('display', 'none');
        }
      });
      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '.post-content',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc > p').css('visibility', 'visible');
      }
      var offset = boardCtn.css('margin-right')
      $('#toc-ctn').css({
        'right': offset
      })
    });
  </script>





  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>



  <script defer src="https://cdn.staticfile.org/smoothscroll/1.4.10/SmoothScroll.min.js" ></script>



  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>




<!-- Plugins -->



  <script  src="https://cdn.staticfile.org/prettify/188.0.0/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "编译原理学习笔记&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script defer src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>





  
  
    <script>
      !function (e, t, a) {
        function r() {
          for (var e = 0; e < s.length; e++) s[e].alpha <= 0 ? (t.body.removeChild(s[e].el), s.splice(e, 1)) : (s[e].y--, s[e].scale += .004, s[e].alpha -= .013, s[e].el.style.cssText = "left:" + s[e].x + "px;top:" + s[e].y + "px;opacity:" + s[e].alpha + ";transform:scale(" + s[e].scale + "," + s[e].scale + ") rotate(45deg);background:" + s[e].color + ";z-index:99999");
          requestAnimationFrame(r)
        }

        function n() {
          var t = "function" == typeof e.onclick && e.onclick;
          e.onclick = function (e) {
            t && t(), o(e)
          }
        }

        function o(e) {
          var a = t.createElement("div");
          a.className = "heart", s.push({
            el: a,
            x: e.clientX - 5,
            y: e.clientY - 5,
            scale: 1,
            alpha: 1,
            color: c()
          }), t.body.appendChild(a)
        }

        function i(e) {
          var a = t.createElement("style");
          a.type = "text/css";
          try {
            a.appendChild(t.createTextNode(e))
          } catch (t) {
            a.styleSheet.cssText = e
          }
          t.getElementsByTagName("head")[0].appendChild(a)
        }

        function c() {
          return "rgb(" + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + "," + ~~(255 * Math.random()) + ")"
        }

        var s = [];
        e.requestAnimationFrame = e.requestAnimationFrame || e.webkitRequestAnimationFrame || e.mozRequestAnimationFrame || e.oRequestAnimationFrame || e.msRequestAnimationFrame || function (e) {
          setTimeout(e, 1e3 / 60)
        }, i(".heart{width: 10px;height: 10px;position: fixed;background: #f00;transform: rotate(45deg);-webkit-transform: rotate(45deg);-moz-transform: rotate(45deg);}.heart:after,.heart:before{content: '';width: inherit;height: inherit;background: inherit;border-radius: 50%;-webkit-border-radius: 50%;-moz-border-radius: 50%;position: fixed;}.heart:after{top: -5px;}.heart:before{left: -5px;}"), n(), r()
      }(window, document);
    </script>
  








</body>
</html>
